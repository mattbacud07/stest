import{B as Ne}from"./BaseLayout-De698axt.js";import{s as Ve,c as ve,v as pe,r as t,A as xe,C as qe,T as Ee,D as he,x as _e,e as a,o as S,f as L,w as l,h as e,E as ce,j as d,t as P,m as E,i as Ie,G as Pe,H as se,k as r,n as oe,F as ye,y as be,d as we,I as ge,J as Se,K as Ce,L as Ae,M as $e,N as Me}from"./index-C8ph-EQq.js";import{g as ke}from"./vue3-datatable-BuM4cnvr.js";/* empty css              */import{_ as De}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./topBarUserProfile-ExGO6QtX.js";import"./logout-D7B5usQQ.js";const Te={__name:"RoleAssigning",setup(M){const{width:x}=Ve();ve().getUserData;const q=pe(),y=t(!1),h=t(null),w=t(null),b=t(null),$=t(!1);t([]);const C=t(null),N=t(!1),k=t(!0),O=t([]),H=t([]),c=t(!1),f=t(!1),I=t(!1),D=t(0),J=t({role:[p=>!!p||"Required"],SSU:[p=>!!p||"Required"]}),T=p=>Object.keys(p).map(i=>({text:"SSU"+p[i],value:"SSU"+p[i]}));xe(h,p=>{var i,_;w.value=le.value.find(Y=>Y.roleID===p),((i=w.value)==null?void 0:i.role_name)===qe||((_=w.value)==null?void 0:_.role_name)===Ee?$.value=!0:($.value=!1,b.value="")});const R=t([]),A=p=>{R.value=C.value.getSelectedRows(),p&&p.length>0?k.value=!1:k.value=!0},Z=p=>R.value.map(_=>_.id).includes(p.id)?"highlightRow":"",g=async()=>{I.value=!0;const p=Array.from(C.value.getSelectedRows()),{valid:i}=await y.value.validate();if(!i){I.value=!1;return}try{const _=await q.post("assign-role",{user:p,role_id:h.value,ssu:b.value});_.data&&_.data.success?(O.value=_.data.userExist,H.value=_.data.succeed,f.value=!0,y.value.reset(),C.value.clearSelectedRows(),setTimeout(()=>{N.value=!1,D.value+=1},500)):console.log(_.data.error)}catch(_){console.error("API Request Error:",_)}finally{I.value=!1}},G=t(!0);t(0),t(!1);const u=he({current_page:1,pagesize:10}),v=t(null),j=t([{field:"id",title:"ID",isUnique:!0,type:"number",hide:!0},{field:"first_name",title:"Name"},{field:"email",title:"Email"},{field:"name",title:"Department"}])||[],W=async()=>{try{G.value=!0;const i=(await q.get("users")).data.users;v.value=i}catch(p){console.log(p)}G.value=!1},le=t([]),X=async()=>{try{G.value=!0;const i=(await q.get("get_role_name")).data.role_name;le.value=i.map(_=>({roleID:_.roleID,role_name:_.role_name}))}catch(p){console.log(p)}G.value=!1},ne=()=>{X()};return _e(()=>{W(),X()}),(p,i)=>{const _=a("v-icon"),Y=a("v-btn"),te=a("v-divider"),ae=a("v-select"),s=a("v-card-text"),o=a("v-spacer"),n=a("v-card-actions"),m=a("v-form"),re=a("v-card"),ie=a("v-dialog"),ee=a("v-col"),K=a("v-text-field"),ue=a("v-row"),de=a("v-snackbar");return S(),L(ue,null,{default:l(()=>[e(ee,{cols:"12"},{default:l(()=>[e(ue,null,{default:l(()=>[e(ee,{lg:"8",md:"8",sm:"6",cols:"3"},{default:l(()=>[e(ie,{width:"400",scrollable:"",modelValue:N.value,"onUpdate:modelValue":i[2]||(i[2]=U=>N.value=U)},{activator:l(({props:U})=>[e(Y,ce({color:"primary",disabled:k.value,variant:"tonal",class:"text-none"},U),{default:l(()=>[e(_,{class:"mr-2"},{default:l(()=>[d("mdi-lock-plus")]),_:1}),d(" "+P(E(x)<=500?"":" Assign Role"),1)]),_:2},1040,["disabled"])]),default:l(({isActive:U})=>[e(re,{"prepend-icon":"mdi-account-search",title:"Select Role"},{default:l(()=>[e(m,{onSubmit:Ie(g,["prevent"]),ref_key:"form",ref:y},{default:l(()=>[e(te,{class:"mt-1"}),e(s,{class:"px-4"},{default:l(()=>[e(ae,{color:"primary",modelValue:h.value,"onUpdate:modelValue":i[0]||(i[0]=B=>h.value=B),rules:J.value.role,onClick:ne,items:le.value,"item-title":"role_name","item-value":"roleID",density:"compact",variant:"outlined",label:"Roles",hint:"Assign roles to the selected users","persistent-hint":""},null,8,["modelValue","rules","items"]),$.value?(S(),L(ae,{key:0,color:"primary",modelValue:b.value,"onUpdate:modelValue":i[1]||(i[1]=B=>b.value=B),rules:J.value.SSU,items:T(Pe),"item-title":"text","item-value":"value",density:"compact",variant:"outlined",label:"SSU",class:"mt-5"},null,8,["modelValue","rules","items"])):se("",!0)]),_:1}),e(te),e(n,null,{default:l(()=>[e(Y,{text:"Close",prependIcon:"mdi-arrow-left",class:"text-none",onClick:B=>U.value=!1},null,8,["onClick"]),e(o),e(Y,{type:"submit",color:"primary",prependIcon:"mdi-content-save-check-outline",class:"text-none",text:"Save",variant:"flat",loading:I.value},null,8,["loading"])]),_:2},1024)]),_:2},1536)]),_:2},1024)]),_:1},8,["modelValue"])]),_:1}),e(o),e(ee,{lg:"4",md:"4",sm:"6",cols:"9"},{default:l(()=>[e(K,{color:"primary",modelValue:u.search,"onUpdate:modelValue":i[3]||(i[3]=U=>u.search=U),clearable:"",density:"compact",label:"Search all fields",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),e(E(ke),{ref_key:"datatable",ref:C,rows:v.value,columns:E(j),loading:G.value,search:u.search,selectRowOnClick:!0,hasCheckbox:!0,sortable:!0,hide:!0,filter:!0,skin:"bh-table-compact bh-table-bordered",class:"mt-4",rowClass:Z,onRowSelect:A},{first_name:l(U=>[r("span",null,P(U.value.first_name)+" "+P(U.value.last_name),1)]),_:1},8,["rows","columns","loading","search"])]),_:1}),e(de,{color:"error",modelValue:c.value,"onUpdate:modelValue":i[4]||(i[4]=U=>c.value=U),location:"right bottom",timeout:3e3},{default:l(()=>[e(_,{class:"ml-3"},{default:l(()=>[d("mdi-account-alert")]),_:1}),d(" Please select one option ")]),_:1},8,["modelValue"]),e(de,{color:"#19197000",variant:"outlined",modelValue:f.value,"onUpdate:modelValue":i[5]||(i[5]=U=>f.value=U),location:"right bottom",timeout:3e3},{default:l(()=>[O.value.length>0?(S(),L(re,{key:0,color:"error",class:"p-3"},{default:l(()=>[(S(!0),oe(ye,null,be(O.value,(U,B)=>(S(),oe("div",{key:B,class:"mt-4"},[e(_,{class:"ml-3"},{default:l(()=>[d("mdi-account-tag")]),_:1}),d(" "+P(U)+" already has a role ",1)]))),128))]),_:1})):se("",!0),H.value.length>0?(S(),L(re,{key:1,color:"success",class:"p-3"},{default:l(()=>[(S(!0),oe(ye,null,be(H.value,(U,B)=>(S(),oe("div",{key:B,class:"mt-4"},[e(_,{class:"ml-3"},{default:l(()=>[d("mdi-check")]),_:1}),d(" "+P(U)+" successfully assigned role ",1)]))),128))]),_:1})):se("",!0)]),_:1},8,["modelValue"])]),_:1})}}},Oe=De(Te,[["__scopeId","data-v-0668b97e"]]),Be=M=>(Ae("data-v-800934e0"),M=M(),$e(),M),ze={class:"text-primary"},Le={class:"small textDown"},Fe={class:"mb-2"},He=Be(()=>r("p",null,[r("b",null,"Current designation: ")],-1)),Je={__name:"AssignedRoles",setup(M){const{width:x}=Ve(),F=we.useToast();ve().getUserData;const y=pe(),h=t(null),w=t(!1);t(!1);const b=t(!1);t(!0);const $=t(!1),C=t(!1),N=t(!0),k=t(!0),O=t(!0),H=t([]),c=t(null),f=t(""),I=t(""),D=t(!1),J=t(!1),T=t(""),R=t(""),A=t({designation:[s=>!!s||"Required field",s=>s.key!==void 0?!0:"Select one of the options listed",s=>s.value!==void 0?!0:"Select one of the options listed"],name:[s=>!!s||"Required field"],id:[s=>!!s||"Required field"],approver_category:[s=>!!s||"Required field"]}),Z=t([]),g=s=>{Z.value=h.value.getSelectedRows(),s.length>1?k.value=!0:s&&s.length>0?(k.value=!1,O.value=!1,N.value=!1,I.value=s[0].users.fullname,f.value=s[0].users.id):(k.value=!0,O.value=!0,N.value=!0),H.value=s.map(o=>o.id)[0]},G=s=>Z.value.map(n=>n.id).includes(s.id)?"highlightRow":"",u=async()=>{D.value=!0;const{valid:s}=await J.value.validate();if(!s){D.value=!1;return}try{const o=await y.post("submit-approver",{user_id:f.value,roleID:c.value,role_user_id:H.value,approver_level:T.value.value,approver_level_name:T.value.key,approver_category:R.value});o.data&&o.data.success?(J.value.reset(),i(c.value),F.success("Designation assigned successfully")):(J.value.reset(),F.error("Designation has already been set!"))}catch(o){console.log(o)}finally{D.value=!1,b.value=!1}},v=s=>{console.log(s)},j=async()=>{C.value=!0;try{const s=await y.delete("delete-role",{params:{id:H.value}});s.data&&s.data.success?(F.success("Successfully deleted"),w.value=!1,i(c.value)):console.log(s.data.error)}catch(s){console.log(s)}finally{C.value=!1}},W=t(!0),le=t(0);t(!1);const X=he({current_page:1,pagesize:10,sort_column:"roles.role_name",sort_direction:"desc"}),ne=t(null),p=t([{field:"users.first_name",title:"Action",hide:!0},{field:"id",title:"ID",isUnique:!0,type:"number",hide:!0},{field:"users.fullname",title:"Name"},{field:"roles.role_name",title:"Role"},{field:"SSU",title:"SSU",hide:!0},{field:"users.approval_level_name",title:"Approver Designation",hide:!0},{field:"users.approval_id",title:"approval id",hide:!0},{field:"users.name",title:"Department"},{field:"users.position_name",title:"Position",hide:!0}])||[],i=async s=>{var o;try{W.value=!0;const m=(await y.get("assigned-user-role",{params:{role:s}})).data.users_role;ne.value=m,le.value=(o=m==null?void 0:m.meta)==null?void 0:o.total}catch(n){console.log(n)}W.value=!1},_=(s,o)=>{p.value.forEach(n=>{(n.title==="Approver Designation"||n.title==="Approver Category"||n.title==="Action")&&(n.hide=!s),n.title==="SSU"&&(n.hide=!o)})};xe(c,s=>{i(s),s===1?_(!0,!1):s===2||s===3?_(!1,!0):_(!1,!1)});const Y=t([]),te=async()=>{try{W.value=!0;const o=(await y.get("get_role_name")).data.role_name;Y.value=o.map(n=>({role_id:n.roleID,role_name:n.role_name}))}catch(s){console.log(s)}W.value=!1},ae=()=>{i(c.value),te()};return _e(()=>{i(),te()}),(s,o)=>{const n=a("v-icon"),m=a("v-btn"),re=a("v-combobox"),ie=a("v-select"),ee=a("v-text-field"),K=a("v-col"),ue=a("v-row"),de=a("v-form"),U=a("v-card-text"),B=a("v-card"),me=a("v-dialog"),Ue=a("v-tooltip");return S(),L(K,{cols:"12"},{default:l(()=>[e(ue,null,{default:l(()=>[e(K,{cols:"12",xl:"6",md:"6",sm:"6",style:ge({"margin-top":E(x)<=550?"-15px":""})},{default:l(()=>[c.value===1?(S(),L(m,{key:0,color:"warning",disabled:N.value,class:"text-none mr-2",variant:"tonal",onClick:o[0]||(o[0]=V=>b.value=!0)},{default:l(()=>[e(n,null,{default:l(()=>[d("mdi-account-arrow-right")]),_:1}),d(" "+P(E(x)<=768?"":" Approver Designation"),1)]),_:1},8,["disabled"])):se("",!0),e(me,{modelValue:b.value,"onUpdate:modelValue":o[6]||(o[6]=V=>b.value=V),"max-width":"400"},{default:l(({isActive:V})=>[e(B,{"prepend-icon":"mdi-account-arrow-right",title:"Set Approver Designation"},{actions:l(()=>[e(m,{class:"ml-auto text-none",variant:"tonal",text:"Close",onClick:o[5]||(o[5]=z=>b.value=!1)}),e(m,{onClick:u,color:"primary",loading:$.value,variant:"flat",class:"text-none",text:"Save"},null,8,["loading"])]),default:l(()=>[e(U,{class:"pt-3"},{default:l(()=>[e(de,{ref_key:"form",ref:J},{default:l(()=>[e(re,{color:"primary",modelValue:T.value,"onUpdate:modelValue":o[1]||(o[1]=z=>T.value=z),rules:A.value.designation,clearable:"",label:"Designation",density:"compact",items:Se,variant:"outlined",itemValue:"value",itemTitle:"key",class:"mt-5"},null,8,["modelValue","rules","items"]),e(ie,{modelValue:R.value,"onUpdate:modelValue":o[2]||(o[2]=z=>R.value=z),items:Ce,"item-title":"value","item-value":"value",clearable:"",label:"Approver Category",color:"primary",variant:"outlined",density:"compact",class:"mt-5",rules:A.value.approver_category},null,8,["modelValue","items","rules"]),e(ue,{class:"mt-4"},{default:l(()=>[e(K,{cols:"8"},{default:l(()=>[e(ee,{variant:"outlined",placeholder:"Name",density:"compact",rules:A.value.name,disabled:"",modelValue:I.value,"onUpdate:modelValue":o[3]||(o[3]=z=>I.value=z),color:"primary",label:"User Name"},null,8,["rules","modelValue"])]),_:1}),e(K,{cols:"4"},{default:l(()=>[e(ee,{variant:"outlined",placeholder:"User ID",density:"compact",rules:A.value.id,disabled:"",modelValue:f.value,"onUpdate:modelValue":o[4]||(o[4]=z=>f.value=z),color:"primary",label:"User ID"},null,8,["rules","modelValue"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(m,{color:"primary",class:"text-none mr-2",variant:"tonal",disabled:k.value},{default:l(()=>[e(n,null,{default:l(()=>[d("mdi-file-document-edit")]),_:1}),d(" "+P(E(x)<=768?"":" Edit"),1)]),_:1},8,["disabled"]),e(m,{color:"error",class:"text-none",disabled:O.value,variant:"tonal",onClick:o[7]||(o[7]=V=>w.value=!0)},{default:l(()=>[e(n,null,{default:l(()=>[d("mdi-delete-empty")]),_:1}),d(" "+P(E(x)<=768?"":" Delete"),1)]),_:1},8,["disabled"]),e(me,{modelValue:w.value,"onUpdate:modelValue":o[9]||(o[9]=V=>w.value=V),"max-width":"340"},{default:l(({isActive:V})=>[e(B,{"prepend-icon":"mdi-trash-can-outline",text:"Are you sure you want to delete assigned role?",title:"Delete"},{actions:l(()=>[e(m,{class:"ml-auto text-none",variant:"tonal",text:"No",onClick:o[8]||(o[8]=z=>w.value=!1)}),e(m,{color:"error",loading:C.value,variant:"flat",class:"text-none",text:"Delete",onClick:j},null,8,["loading"])]),_:1})]),_:1},8,["modelValue"]),e(m,{onClick:ae,icon:"",color:"primary",size:"small",variant:"text",class:"mr-1"},{default:l(()=>[e(n,null,{default:l(()=>[d("mdi-refresh")]),_:1})]),_:1})]),_:1},8,["style"]),e(K,{cols:"12",xl:"3",md:"3",sm:"3",style:ge({"margin-top":E(x)<=550?"-15px":""})},{default:l(()=>[e(ie,{color:"primary",modelValue:c.value,"onUpdate:modelValue":o[10]||(o[10]=V=>c.value=V),items:Y.value,clearable:"","item-title":"role_name","item-value":"role_id",density:"compact",variant:"outlined",label:"Filter by role"},null,8,["modelValue","items"])]),_:1},8,["style"]),e(K,{cols:"12",xl:"3",md:"3",sm:"3",style:ge({"margin-top":E(x)<=550?"-15px":""})},{default:l(()=>[e(ee,{color:"primary",modelValue:X.search,"onUpdate:modelValue":o[11]||(o[11]=V=>X.search=V),clearable:"",density:"compact",label:"Search all fields",variant:"outlined"},null,8,["modelValue"])]),_:1},8,["style"])]),_:1}),e(E(ke),{ref_key:"datatable",ref:h,rows:ne.value,columns:E(p),loading:W.value,search:X.search,selectRowOnClick:!0,hasCheckbox:!0,sortable:!0,sortColumn:X.sort_column,sortDirection:X.sort_direction,hide:!0,filter:!0,skin:"bh-table-compact bh-table-bordered",onRowSelect:g,cellClass:"assignedRoleCellClass",rowClass:G},{"users.fullname":l(V=>[r("p",ze,[r("b",null,P(V.value.users.fullname),1)]),r("p",Le,P(V.value.users.position_name),1)]),"users.first_name":l(V=>[V.value.users.approval_level_name?(S(),L(Ue,{key:0,text:"Delete designation of "+V.value.users.fullname,location:"top"},{activator:l(({props:z})=>[e(m,ce(z,{color:"error",class:"text-none",variant:"tonal",density:"compact",icon:""}),{default:l(()=>[e(n,null,{default:l(()=>[d("mdi-trash-can-outline")]),_:1}),e(me,{activator:"parent","max-width":"400"},{default:l(({isActive:fe})=>[e(B,{"prepend-icon":"mdi-trash-can-outline",text:"Are you sure you want to remove user designation?",title:"Delete"},{actions:l(()=>[e(m,{class:"ml-auto text-none",variant:"tonal",text:"No",onClick:Q=>fe.value=!1},null,8,["onClick"]),e(m,{color:"error",onClick:Q=>v(V.value.users.approval_id),variant:"tonal",class:"text-none"},{default:l(()=>[e(n,null,{default:l(()=>[d("mdi-trash-can-outline")]),_:1}),d(" Remove")]),_:2},1032,["onClick"])]),default:l(()=>[e(K,{class:"ma-3"},{default:l(()=>[r("p",Fe,P(V.value.users.fullname),1),He,r("p",null,P(V.value.users.approval_level_name),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:2},1032,["text"])):se("",!0),V.value.users.approval_level_name?(S(),L(Ue,{key:1,text:"Update designation of "+V.value.users.fullname,location:"top"},{activator:l(({props:z})=>[e(m,ce(z,{color:"primary",class:"text-none ml-1",variant:"tonal",density:"compact",icon:""}),{default:l(()=>[e(n,null,{default:l(()=>[d("mdi-pencil-box-outline")]),_:1}),e(me,{activator:"parent","max-width":"400"},{default:l(({isActive:fe})=>[e(B,{"prepend-icon":"mdi-pencil-box-outline",title:"Update"},{actions:l(()=>[e(m,{class:"ml-auto text-none",variant:"tonal",text:"No",onClick:Q=>fe.value=!1},null,8,["onClick"]),e(m,{color:"primary",onClick:Q=>s.updateDesignation(V.value.users.approval_id),variant:"tonal",class:"text-none"},{default:l(()=>[e(n,null,{default:l(()=>[d("mdi-pencil-box-outline")]),_:1}),d(" Update")]),_:2},1032,["onClick"])]),default:l(()=>[e(K,{class:"pa-3"},{default:l(()=>[e(de,{ref_key:"form",ref:J},{default:l(()=>[e(re,{color:"primary",modelValue:T.value,"onUpdate:modelValue":o[12]||(o[12]=Q=>T.value=Q),rules:A.value.designation,clearable:"",label:"Designation",density:"compact",items:Se,variant:"outlined",itemValue:"value",itemTitle:"key",class:"mt-5"},null,8,["modelValue","rules","items"]),e(ie,{modelValue:R.value,"onUpdate:modelValue":o[13]||(o[13]=Q=>R.value=Q),items:Ce,"item-title":"value","item-value":"value",clearable:"",label:"Approver Category",color:"primary",variant:"outlined",density:"compact",class:"mt-5",rules:A.value.approver_category},null,8,["modelValue","items","rules"]),e(ue,{class:"mt-4"},{default:l(()=>[e(K,{cols:"8"},{default:l(()=>[e(ee,{variant:"outlined",placeholder:"Name",density:"compact",rules:A.value.name,disabled:"",modelValue:I.value,"onUpdate:modelValue":o[14]||(o[14]=Q=>I.value=Q),color:"primary",label:"User Name"},null,8,["rules","modelValue"])]),_:1}),e(K,{cols:"4"},{default:l(()=>[e(ee,{variant:"outlined",placeholder:"User ID",density:"compact",rules:A.value.id,disabled:"",modelValue:f.value,"onUpdate:modelValue":o[15]||(o[15]=Q=>f.value=Q),color:"primary",label:"User ID"},null,8,["rules","modelValue"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:2},1032,["text"])):se("",!0)]),_:1},8,["rows","columns","loading","search","sortColumn","sortDirection"])]),_:1})}}},Ge=De(Je,[["__scopeId","data-v-800934e0"]]),Ke={__name:"alertMessage",props:{details:{type:Object}},setup(M){const x=t(!0);t(""),t("");const F=M;return(q,y)=>{const h=a("v-icon"),w=a("v-snackbar");return S(),L(w,{color:F.details.color,modelValue:x.value,"onUpdate:modelValue":y[0]||(y[0]=b=>x.value=b),location:"right bottom",timeout:5e3},{default:l(()=>[e(h,null,{default:l(()=>[d("mdi-alert-circle-outline")]),_:1}),d(" "+P(F.details.text)+". ",1)]),_:1},8,["color","modelValue"])}}},je=r("p",{class:"p3"},null,-1),Qe=r("p",{class:"text-danger",style:{"font-size":".8em"}},"* Please consult your IT administrator before making any changes",-1),We={__name:"Roles",setup(M){const x=we.useToast();ve().getUserData;const q=pe(),y=t(!1),h=t(""),w=t(""),b=t(null),$=t(!1),C=t(!1),N=t(!0),k=t(!1);t(0);const O=t({}),H=t(null),c=t(""),f=t(Array.from({length:20},(u,v)=>v+1)),I=t({role:[u=>!!u||"Required"]}),D=()=>{const u=b.value.getSelectedRows();u&&u.length>0?N.value=!1:N.value=!0,H.value=u.map(v=>v.id)[0]},J=async()=>{k.value=!0;const{valid:u}=await y.value.validate();if(!u){k.value=!1;return}try{const v=await q.post("add_role_name",{role_name:h.value,roleID:c.value,description:w.value});v.data&&v.data.success?(x.success("Successfully created"),$.value=!1,G(),getPermission(),getModules(),y.value.reset()):v.data&&v.data.role_id_exist&&x.error("Role ID or role name exist")}catch(v){console.log(v)}finally{k.value=!1}},T=async()=>{try{const u=await q.delete("delete_role_name",{params:{id:H.value}});u.data&&u.data.success&&(x.success("Successfully deleted"),C.value=!1,G())}catch(u){console.log(u)}finally{}},R=t(!0);t(0);const A=he({current_page:1,pagesize:10,sort_column:"roleID",sort_direction:"asc"}),Z=t(null),g=t([{field:"id",title:"ID",isUnique:!0,type:"number",hide:!0},{field:"roleID",title:"Role ID",sortable:!0},{field:"role_name",title:"Role"},{field:"description",title:"Description"},{field:"created_at",title:"Created_at"}])||[],G=async()=>{try{R.value=!0;const v=(await q.get("get_role_name")).data.role_name;Z.value=v}catch(u){console.log(u)}R.value=!1};return t([]),t({}),t([]),t({}),_e(()=>{G()}),(u,v)=>{const j=a("v-btn"),W=a("v-divider"),le=a("v-text-field"),X=a("v-select"),ne=a("v-textarea"),p=a("v-card-text"),i=a("v-spacer"),_=a("v-card-actions"),Y=a("v-form"),te=a("v-card"),ae=a("v-dialog"),s=a("v-col"),o=a("v-row");return S(),L(o,null,{default:l(()=>[e(s,{cols:"12"},{default:l(()=>[e(o,null,{default:l(()=>[e(s,{lg:"8",md:"8",sm:"6",cols:"12"},{default:l(()=>[e(ae,{width:"400",scrollable:"",modelValue:$.value,"onUpdate:modelValue":v[3]||(v[3]=n=>$.value=n)},{activator:l(({props:n})=>[e(j,ce({color:"primary","prepend-icon":"mdi-shield-plus-outline",text:"Add",class:"text-none"},n),null,16)]),default:l(({isActive:n})=>[e(te,{"prepend-icon":"mdi-shield-plus-outline",title:"Role"},{default:l(()=>[e(Y,{onSubmit:Ie(J,["prevent"]),ref_key:"form",ref:y},{default:l(()=>[e(W,{class:"mt-1"}),e(p,{class:"px-4"},{default:l(()=>[e(le,{modelValue:h.value,"onUpdate:modelValue":v[0]||(v[0]=m=>h.value=m),rules:I.value.role,density:"compact",variant:"outlined",label:"Role Name"},null,8,["modelValue","rules"]),e(X,{modelValue:c.value,"onUpdate:modelValue":v[1]||(v[1]=m=>c.value=m),items:f.value,class:"mt-3",rules:[m=>!!m||"Required"],density:"compact",variant:"outlined",label:"Role ID"},null,8,["modelValue","items","rules"]),e(ne,{modelValue:w.value,"onUpdate:modelValue":v[2]||(v[2]=m=>w.value=m),density:"compact",rows:"5",label:"Description",variant:"outlined",color:"primary",class:"mt-5"},null,8,["modelValue"])]),_:1}),e(W),e(_,null,{default:l(()=>[e(j,{text:"Close",prependIcon:"mdi-arrow-left",class:"text-none",onClick:m=>n.value=!1},null,8,["onClick"]),e(i),e(j,{type:"submit",color:"primary",prependIcon:"mdi-content-save-check-outline",class:"text-none",text:"Save",variant:"flat",loading:k.value},null,8,["loading"])]),_:2},1024)]),_:2},1536)]),_:2},1024)]),_:1},8,["modelValue"]),e(j,{color:"primary",disabled:N.value,"prepend-icon":"mdi-shield-edit-outline",text:"Edit",class:"text-none ml-2",variant:"tonal"},null,8,["disabled"]),e(ae,{width:"400",scrollable:"",modelValue:C.value,"onUpdate:modelValue":v[4]||(v[4]=n=>C.value=n)},{activator:l(({props:n})=>[e(j,ce({color:"error",disabled:N.value,"prepend-icon":"mdi-delete-empty",text:"Delete",class:"text-none ml-2",variant:"plain"},n),null,16,["disabled"])]),default:l(({isActive:n})=>[e(te,{"prepend-icon":"mdi-trash-can",subtitle:"Delete Role"},{default:l(()=>[je,e(p,null,{default:l(()=>[d("Are you sure you want to delete?")]),_:1}),e(_,null,{default:l(()=>[e(j,{text:"Close",prependIcon:"mdi-arrow-left",class:"text-none",onClick:m=>n.value=!1},null,8,["onClick"]),e(i),e(j,{color:"error","prepend-icon":"mdi-shield-remove-outline",text:"Delete",class:"text-none ml-2",variant:"flat",onClick:T,loading:k.value},null,8,["loading"])]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue"])]),_:1}),e(i),e(s,{lg:"4",md:"4",sm:"6",cols:"12"},{default:l(()=>[e(le,{color:"primary",modelValue:A.search,"onUpdate:modelValue":v[5]||(v[5]=n=>A.search=n),clearable:"",density:"compact",label:"Search all fields",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),Qe,e(E(ke),{ref_key:"datatable",ref:b,rows:Z.value,columns:E(g),loading:R.value,search:A.search,selectRowOnClick:!0,hasCheckbox:!0,sortable:!0,sortColumn:A.sort_column,sortDirection:A.sort_direction,skin:"bh-table-compact bh-table-bordered",class:"mt-5",onRowSelect:D},{created_at:l(n=>[r("span",null,P(Me(n.value.created_at)),1)]),_:1},8,["rows","columns","loading","search","sortColumn","sortDirection"])]),_:1}),O.value.show?(S(),L(Ke,{key:0,details:O.value},null,8,["details"])):se("",!0)]),_:1})}}},Re=M=>(Ae("data-v-8f7eced8"),M=M(),$e(),M),Xe=Re(()=>r("p",{class:"small text-danger mb-3"},[r("b",null,"Reminder:"),d(),r("span",{class:"text-dark"},"Don't forget to save")],-1)),Ye={class:"table-responsive"},Ze={class:"table table-borderless align-middle"},el=Re(()=>r("thead",{class:"table-light"},[r("tr",null,[r("th",null,"Modules"),r("th",null,"Create"),r("th",null,"Read"),r("th",null,"Edit"),r("th",null,"Delete"),r("th",null,"Approve"),r("th",null,"Delegate"),r("th",null,"Installer"),r("th",null,"Report")])],-1)),ll={class:"table-group-divider"},tl={key:1},al={rowspan:"9"},ol={style:{opacity:".1"}},sl=Re(()=>r("p",{class:"text-grey"},"Loading ...",-1)),nl={__name:"Permission",setup(M){const x=we.useToast(),{width:F}=Ve();ve().getUserData;const y=pe();t(!1),t(!1);const h=t(!1),w=t(!1),b=t([]),$=t(null),C=t([{module:"Equipment Handling",create:!1,read:!1,edit:!1,delete:!1,approve:!1,delegate:!1,installer:!1,report:!1,name:"EquipmentHandling",icong:"mdi-file-document-edit"},{module:"Internal Servicing",create:!1,read:!1,edit:!1,delete:!1,approve:!1,delegate:!1,installer:!1,report:!1,name:"InternalServicing",icong:"mdi-file-compare"},{module:"Preventive Maintenance",create:!1,read:!1,edit:!1,delete:!1,approve:!1,delegate:!1,installer:!1,report:!1,name:"PreventiveMaintenance",icong:"mdi-calendar-cursor-outline"},{module:"Corrective Maintenance",create:!1,read:!1,edit:!1,delete:!1,approve:!1,delegate:!1,installer:!1,report:!1,name:"CorrectiveMaintenance",icong:"mdi-calendar-clock"}]);xe($,async c=>{await k(c)});const N=async()=>{w.value=!0;try{const c=await y.put("set_permissions_per_role",{role_id:$.value,permissions:JSON.stringify(C.value)});c.data&&c.data.success&&x.success("Successfully save")}catch(c){alert(c)}finally{w.value=!1}},k=async c=>{h.value=!0;try{const f=await y.get("get_permission_per_role",{params:{role_id:c}});if(f.data&&f.data.permission){const I=f.data.permission;I&&I.permissions?C.value=JSON.parse(I.permissions):C.value.forEach(D=>{D.create=!1,D.read=!1,D.edit=!1,D.delete=!1,D.approve=!1,D.delegate=!1,D.installer=!1,D.report=!1})}}catch(f){console.log(f)}finally{h.value=!1}},O=async()=>{try{const c=await y.get("get_role_name");c.data&&c.data.role_name&&(b.value=c.data.role_name.filter(f=>f.roleID!==6).map(f=>({roleID:f.roleID,role_name:f.role_name})))}catch(c){console.log(c)}},H=()=>{O()};return _e(()=>{O(),k()}),(c,f)=>{const I=a("v-btn"),D=a("v-col"),J=a("v-select"),T=a("v-row"),R=a("v-checkbox"),A=a("v-progress-circular"),Z=a("v-icon");return S(),L(T,null,{default:l(()=>[e(D,{cols:"12"},{default:l(()=>[e(T,null,{default:l(()=>[e(D,{cols:"3",lg:"2",md:"2",sm:"2"},{default:l(()=>[e(I,{color:"primary",loading:w.value,disabled:!$.value,onClick:N,"prepend-icon":"mdi-check",text:"SAVE",stacked:E(F)<=425,density:E(F)<=425?"compact":"default",class:"text-none ml-2",variant:"flat"},null,8,["loading","disabled","stacked","density"])]),_:1}),e(D,{cols:"9",lg:"4",md:"4",sm:"4"},{default:l(()=>[e(J,{modelValue:$.value,"onUpdate:modelValue":f[0]||(f[0]=g=>$.value=g),items:b.value,"item-title":"role_name","item-value":"roleID",density:"compact",color:"primary",variant:"outlined",label:"Select Role","onClick:appendInner":H,"append-inner-icon":"mdi-refresh"},null,8,["modelValue","items"])]),_:1})]),_:1}),e(T,null,{default:l(()=>[e(D,null,{default:l(()=>[Xe,r("div",Ye,[r("table",Ze,[el,r("tbody",ll,[h.value?(S(),oe("tr",tl,[r("td",al,[r("h1",ol,[e(Z,null,{default:l(()=>[e(A,{indeterminate:""})]),_:1})]),sl])])):(S(!0),oe(ye,{key:0},be(C.value,(g,G)=>(S(),oe("tr",{key:g.module},[r("td",null,P(g.module),1),r("td",null,[e(R,{modelValue:g.create,"onUpdate:modelValue":u=>g.create=u},null,8,["modelValue","onUpdate:modelValue"])]),r("td",null,[e(R,{modelValue:g.read,"onUpdate:modelValue":u=>g.read=u},null,8,["modelValue","onUpdate:modelValue"])]),r("td",null,[e(R,{modelValue:g.edit,"onUpdate:modelValue":u=>g.edit=u},null,8,["modelValue","onUpdate:modelValue"])]),r("td",null,[e(R,{modelValue:g.delete,"onUpdate:modelValue":u=>g.delete=u},null,8,["modelValue","onUpdate:modelValue"])]),r("td",null,[e(R,{modelValue:g.approve,"onUpdate:modelValue":u=>g.approve=u},null,8,["modelValue","onUpdate:modelValue"])]),r("td",null,[e(R,{modelValue:g.delegate,"onUpdate:modelValue":u=>g.delegate=u},null,8,["modelValue","onUpdate:modelValue"])]),r("td",null,[e(R,{modelValue:g.installer,"onUpdate:modelValue":u=>g.installer=u},null,8,["modelValue","onUpdate:modelValue"])]),r("td",null,[e(R,{modelValue:g.report,"onUpdate:modelValue":u=>g.report=u},null,8,["modelValue","onUpdate:modelValue"])])]))),128))])])])]),_:1})]),_:1})]),_:1})]),_:1})}}},rl=De(nl,[["__scopeId","data-v-8f7eced8"]]),_l={__name:"RolesMain",setup(M){const x=t("one");return(F,q)=>{const y=a("v-icon"),h=a("v-tab"),w=a("v-tabs"),b=a("v-window-item"),$=a("v-window"),C=a("v-card-text"),N=a("v-card");return S(),L(Ne,null,{default:l(()=>[e(N,null,{default:l(()=>[e(w,{modelValue:x.value,"onUpdate:modelValue":q[0]||(q[0]=k=>x.value=k),density:"compact",class:"border-b-sm"},{default:l(()=>[e(h,{value:"roles",class:"text-none",color:"primary"},{default:l(()=>[e(y,{class:"mr-2"},{default:l(()=>[d("mdi-account-file")]),_:1}),d(" Roles")]),_:1}),e(h,{value:"role_assigning",class:"text-none",color:"primary"},{default:l(()=>[e(y,{class:"mr-2"},{default:l(()=>[d("mdi-account-details")]),_:1}),d(" Role Assigning")]),_:1}),e(h,{value:"assigned_roles",class:"text-none",color:"primary"},{default:l(()=>[e(y,{class:"mr-2"},{default:l(()=>[d("mdi-account-multiple-outline")]),_:1}),d(" Assigned Roles")]),_:1}),e(h,{value:"permission",class:"text-none",color:"primary"},{default:l(()=>[e(y,{class:"mr-2"},{default:l(()=>[d("mdi-key-alert-outline")]),_:1}),d(" Permissions")]),_:1})]),_:1},8,["modelValue"]),e(C,null,{default:l(()=>[e($,{modelValue:x.value,"onUpdate:modelValue":q[1]||(q[1]=k=>x.value=k),disabled:!0},{default:l(()=>[e(b,{value:"roles"},{default:l(()=>[e(We,{class:"mt-3"})]),_:1}),e(b,{value:"role_assigning"},{default:l(()=>[e(Oe,{class:"mt-3"})]),_:1}),e(b,{value:"assigned_roles"},{default:l(()=>[e(Ge,{class:"mt-3"})]),_:1}),e(b,{value:"permission"},{default:l(()=>[e(rl,{class:"mt-3"})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})}}};export{_l as default};
