import{d as pe,v as ve,u as fe,Y as _e,c as ye,x as be,r as n,E as Ve,J as ge,y as we,f as qe,w as o,i as ke,e as i,o as j,h as e,p as Ce,z as Ue,F as Re,j as _,Z as H,n as r,k as M,t as J,M as De,H as Se}from"./index-Cz72bSYw.js";import{O as z}from"./vue-datepicker-2fw8wqA2.js";/* empty css             */import{m as xe,a as ze,b as Ie,o as Me,r as Ae}from"./master_data-ZlZ6Ytdf.js";import{L as Ee}from"./LayoutSinglePage-Dk5b2Jaw.js";import{g as Te}from"./vue3-datatable-BQ6DeCI2.js";import{_ as I}from"./lodash-Bli92X11.js";import{p as Be}from"./maintenance-C4GvCYOP.js";import{u as Fe}from"./getInstitution-D_2iXmUv.js";import{_ as he}from"./VDialog-J0ifEPXl.js";import"./topBarUserProfile-tltSc7lJ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Ne=M("p",{class:"text-danger small"},"Select one equipment",-1),Le={class:"text-danger"},al={__name:"CreateMasterData",setup(Oe){const k=pe.useToast(),{name:Pe,width:A}=ve(),C=fe();_e(),ye();const V=be(),E=n(null),T=n(!1),g=n(!1),y=n(!1),Y=n(!1),b=n(!1);n([]),n(null);const Z=[{title:"Back",disabled:!1,href:"/master-data"},{title:"Master Data",disabled:!0,href:""},{title:"Create-Master-Data",disabled:!0,href:""}],G=t=>{!t.disabled&&t.href&&C.push(t.href)},K=n(""),s=n({institution:null,address:null,item_code:null,item_id:null,equipment:null,serial:null,sbu:null,dealer_name:null,area:null,operation_time:null,software_version:null,admission_date:null,date_installed:null,contract_due_date:null,region:null,frequency:null,analyzer_type:null,class:null,initially_installed:null,reason_equipment_status:null,email:null,mode:null,supplier:null,status:null}),Q=t=>{s.value.address=(t==null?void 0:t.address)??null},c=n({institutionValue:[t=>!!t||"Required",t=>N.value.some(l=>l.id===((t==null?void 0:t.id)||t))||"Please select a valid data in the list"],address:[t=>t&&t.trim()!==""||"Required"],item_code:[t=>t&&t.trim()!==""||"Required"],equipment:[t=>t&&t.trim()!==""||"Required"],serial:[t=>t&&t.trim()!==""||"Required"],mode:[t=>t&&t.trim()!==""||"Required"],supplier:[t=>!!t||"Required"],status:[t=>t&&t.trim()!==""||"Required"]}),W=async()=>{b.value=!0;const{valid:t}=await T.value.validate();if(!t){k.error("Please ensure that required fields are not left blank"),b.value=!1;return}try{const l=await V.post("createMasterData",{...s.value,institution:K.value});l.data&&l.data.success?(k.success("Item successfully added"),Y.value=!0,C.push("/master-data")):k.error("Something went wrong")}catch(l){console.error(l)}finally{b.value=!1}},v=n(!0),B=n(0),F=n([{field:"id",title:"ID",isUnique:!0,type:"number",hide:!0},{field:"item_code",title:"Item Code"},{field:"description",title:"Item Description"},{field:"name",title:"Category"}])||[],X=F.value.map(t=>t.field),p=Ve({current_page:1,pagesize:10,search:""}),h=n(null),ee=t=>{t.length>0?(s.value.item_id=t[0].id,s.value.item_code=t[0].item_code):(s.value.item_id="",s.value.item_code="")},le=t=>E.value.getSelectedRows().map(D=>D.id).includes(t.id)?"highlightRow":"",U=async()=>{try{v.value=!0;const l=(await V.get("master-data-equipments",{params:{...p,searchColumn:X}})).data.equipments;h.value=l.data,B.value=l.total}catch(t){console.log(t)}v.value=!1},{institutions:N}=Fe(),L=n([]),ae=async()=>{try{v.value=!0;const t=await V.get("get_supplier");L.value=t.data.supplier.map(l=>({supplier_id:l.id,value:l.id,key:l.name}))}catch(t){console.log(t)}v.value=!1},O=n([]),te=async()=>{try{v.value=!0;const t=await V.get("/users");O.value=t.data.users.filter(l=>l.name==="Service Department").map(l=>({user_id:l.id,value:l.id,key:l.user_name}))}catch(t){console.log(t)}v.value=!1},oe=I.debounce(U,300),se=t=>{p.current_page=t.current_page,p.pagesize=t.pagesize,p.search=t.search,t.change_type==="search"?oe():U()},ue=I.cloneDeep(s.value),R=ge(()=>!I.isEqual(s.value,ue)),ne=()=>{if(R.value){g.value=!0;return}P()},P=()=>{g.value=!1,C.push("/master-data")};return we(()=>{U(),ae(),te()}),(t,l)=>{const w=i("v-icon"),D=i("v-breadcrumbs-item"),re=i("v-breadcrumbs"),u=i("v-col"),$=i("v-spacer"),S=i("v-btn"),x=i("v-combobox"),m=i("v-text-field"),d=i("v-row"),q=i("v-card"),f=i("v-select"),ie=i("v-container"),de=i("v-overlay"),me=i("v-form");return j(),qe(me,{onSubmit:ke(W,["prevent"]),ref_key:"form",ref:T},{default:o(()=>[e(Ee,null,{topBarFixed:o(()=>[e(u,{lg:"6",md:"6",sm:"8",cols:"8"},{default:o(()=>[e(re,{class:"pt-7"},{default:o(()=>[(j(),Ce(Re,null,Ue(Z,(a,ce)=>e(D,{key:ce,class:H({"custom-pointer":!a.disabled}),style:De({display:r(A)<=768?a.display:""}),onClick:$e=>G(a),disabled:a.disabled},{default:o(()=>[_(J(a.title)+" ",1),e(w,{class:"ml-1",icon:"mdi-chevron-right"})]),_:2},1032,["class","style","onClick","disabled"])),64))]),_:1})]),_:1}),e($),e(u,{lg:"6",md:"6",sm:"4",cols:"4","align-self":"center",class:"d-flex justify-end"},{default:o(()=>[e(S,{disabled:b.value,onClick:ne,color:"primary",variant:"tonal",class:"text-none mr-2"},{default:o(()=>[_(" Cancel ")]),_:1},8,["disabled"]),e(S,{type:"submit",loading:b.value,disabled:!R.value,color:"primary",variant:"flat",class:H(["text-none","btnSubmit",{"cursor-not-allowed":!R.value}])},{default:o(()=>[e(w,{class:"mr-2"},{default:o(()=>[_("mdi-note-plus-outline")]),_:1}),_(" Create ")]),_:1},8,["loading","disabled","class"])]),_:1})]),default:o(()=>[e(ie,{class:"container-form mt-15"},{default:o(()=>[e(q,{class:"pa-7 mb-5"},{default:o(()=>[e(d,null,{default:o(()=>[e(u,{cols:"12",lg:"6",md:"6",sm:"6"},{default:o(()=>[e(x,{color:"primary",modelValue:s.value.institution,"onUpdate:modelValue":[l[0]||(l[0]=a=>s.value.institution=a),l[1]||(l[1]=a=>Q(a))],clearable:"",label:"Institution *",density:"compact",items:r(N),variant:"outlined",itemValue:"id",itemTitle:"name",rules:c.value.institutionValue,"close-on-content-click":!1},null,8,["modelValue","items","rules"])]),_:1}),e(u,{cols:"12",lg:"6",md:"6",sm:"6"},{default:o(()=>[e(m,{color:"primary",modelValue:s.value.address,"onUpdate:modelValue":l[2]||(l[2]=a=>s.value.address=a),label:"Address *",density:"compact",variant:"outlined",readonly:"","onUpdate:Item":"(newVal) => { address.value = newVal.key }",rules:c.value.address,"hide-details":""},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(d,null,{default:o(()=>[e(u,{cols:"12",lg:"6",md:"6",sm:"6"},{default:o(()=>[e(m,{color:"primary",modelValue:s.value.item_code,"onUpdate:modelValue":l[3]||(l[3]=a=>s.value.item_code=a),label:"Item Code *",clearable:"",density:"compact",variant:"outlined",readonly:"",rules:c.value.item_code,onClick:l[4]||(l[4]=a=>y.value=!y.value)},null,8,["modelValue","rules"])]),_:1}),e(u,{cols:"12",lg:"6",md:"6",sm:"6"},{default:o(()=>[e(m,{color:"primary",modelValue:s.value.equipment,"onUpdate:modelValue":l[5]||(l[5]=a=>s.value.equipment=a),label:"Equipment *",clearable:"",density:"compact",variant:"outlined",rules:c.value.equipment},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(d,null,{default:o(()=>[e(u,{cols:"12",lg:"6",md:"6",sm:"6"},{default:o(()=>[e(m,{color:"primary",modelValue:s.value.serial,"onUpdate:modelValue":l[6]||(l[6]=a=>s.value.serial=a),label:"Serial Number *",clearable:"",density:"compact",variant:"outlined",rules:c.value.serial},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}),e(q,{class:"pa-7 mb-5"},{default:o(()=>[e(d,null,{default:o(()=>[e(u,{cols:"12",lg:"6",md:"6",sm:"6"},{default:o(()=>[e(f,{color:"primary",modelValue:s.value.mode,"onUpdate:modelValue":l[7]||(l[7]=a=>s.value.mode=a),label:"Mode *",clearable:"",density:"compact",variant:"outlined",rules:c.value.mode,items:r(xe)},null,8,["modelValue","rules","items"])]),_:1}),e(u,{cols:"12",lg:"6",md:"6",sm:"6"},{default:o(()=>[e(x,{color:"primary",modelValue:s.value.supplier,"onUpdate:modelValue":l[8]||(l[8]=a=>s.value.supplier=a),clearable:"",label:"Supplier *",density:"compact",items:L.value,variant:"outlined",itemValue:"value",itemTitle:"key",rules:c.value.institutionValue,"close-on-content-click":!1,"hide-details":""},null,8,["modelValue","items","rules"])]),_:1})]),_:1}),e(d,null,{default:o(()=>[e(u,{cols:"12",lg:"6",md:"6",sm:"6"},{default:o(()=>[e(f,{color:"primary",modelValue:s.value.sbu,"onUpdate:modelValue":l[9]||(l[9]=a=>s.value.sbu=a),label:"SBU *",clearable:"",density:"compact",variant:"outlined",rules:[a=>!!a||"Required"],items:r(Se)},null,8,["modelValue","rules","items"])]),_:1}),e(u,{cols:"12",lg:"6",md:"6",sm:"6"},{default:o(()=>[e(f,{color:"primary",modelValue:s.value.status,"onUpdate:modelValue":l[10]||(l[10]=a=>s.value.status=a),label:"Status *",clearable:"",density:"compact",variant:"outlined",rules:c.value.status,items:r(ze)},null,8,["modelValue","rules","items"])]),_:1})]),_:1}),e(d,null,{default:o(()=>[e(u,{cols:"12",lg:"6",md:"6",sm:"6"},{default:o(()=>[e(m,{color:"primary",modelValue:s.value.dealer_name,"onUpdate:modelValue":l[11]||(l[11]=a=>s.value.dealer_name=a),label:"Dealer Name",clearable:"",density:"compact",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(u,{cols:"12",lg:"6",md:"6",sm:"6"},{default:o(()=>[e(f,{color:"primary",modelValue:s.value.area,"onUpdate:modelValue":l[12]||(l[12]=a=>s.value.area=a),label:"Area Categorization",clearable:"",density:"compact",variant:"outlined",items:r(Ie)},null,8,["modelValue","items"])]),_:1})]),_:1}),e(d,null,{default:o(()=>[e(u,{cols:"12",lg:"6",md:"6",sm:"6"},{default:o(()=>[e(f,{color:"primary",modelValue:s.value.operation_time,"onUpdate:modelValue":l[13]||(l[13]=a=>s.value.operation_time=a),label:"Operation Time",clearable:"",density:"compact",variant:"outlined",items:r(Me)},null,8,["modelValue","items"])]),_:1}),e(u,{cols:"12",lg:"6",md:"6",sm:"6"},{default:o(()=>[e(m,{color:"primary",modelValue:s.value.software_version,"onUpdate:modelValue":l[14]||(l[14]=a=>s.value.software_version=a),label:"Software Version",clearable:"",density:"compact",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(q,{class:"pa-7 mb-5"},{default:o(()=>[e(d,null,{default:o(()=>[e(u,{cols:"12",lg:"6",md:"6",sm:"6"},{default:o(()=>[e(r(z),{modelValue:s.value.admission_date,"onUpdate:modelValue":l[15]||(l[15]=a=>s.value.admission_date=a),"auto-apply":"","enable-time-picker":!1,teleport:!0,placeholder:"Admission Date *",rules:[a=>!!a||"Required"]},null,8,["modelValue","rules"])]),_:1}),e(u,{cols:"12",lg:"6",md:"6",sm:"6"},{default:o(()=>[e(r(z),{modelValue:s.value.date_installed,"onUpdate:modelValue":l[16]||(l[16]=a=>s.value.date_installed=a),"auto-apply":"","enable-time-picker":!1,teleport:!0,placeholder:"Date Installed"},null,8,["modelValue"])]),_:1})]),_:1}),e(d,null,{default:o(()=>[e(u,{cols:"12",lg:"6",md:"6",sm:"6"},{default:o(()=>[e(r(z),{modelValue:s.value.contract_due_date,"onUpdate:modelValue":l[17]||(l[17]=a=>s.value.contract_due_date=a),"auto-apply":"","enable-time-picker":!1,teleport:!0,placeholder:"Contract Due Date"},null,8,["modelValue"])]),_:1}),e(u,{cols:"12",lg:"6",md:"6",sm:"6"},{default:o(()=>[e(f,{color:"primary",modelValue:s.value.region,"onUpdate:modelValue":l[18]||(l[18]=a=>s.value.region=a),label:"Region",clearable:"",density:"compact",variant:"outlined",items:r(Ae)},null,8,["modelValue","items"])]),_:1})]),_:1}),e(d,null,{default:o(()=>[e(u,{cols:"12",lg:"6",md:"6",sm:"6"},{default:o(()=>[e(f,{color:"primary",modelValue:s.value.frequency,"onUpdate:modelValue":l[19]||(l[19]=a=>s.value.frequency=a),label:"Frequency for PM *",clearable:"",density:"compact",variant:"outlined",rules:[a=>!!a||"Required"],items:r(Be)},null,8,["modelValue","rules","items"])]),_:1}),e(u,{cols:"12",lg:"6",md:"6",sm:"6"},{default:o(()=>[e(m,{color:"primary",modelValue:s.value.analyzer_type,"onUpdate:modelValue":l[20]||(l[20]=a=>s.value.analyzer_type=a),label:"Analyzer Type *",clearable:"",density:"compact",variant:"outlined",rules:[a=>!!a||"Required"]},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(d,null,{default:o(()=>[e(u,{cols:"12",lg:"6",md:"6",sm:"6"},{default:o(()=>[e(m,{color:"primary",modelValue:s.value.class,"onUpdate:modelValue":l[21]||(l[21]=a=>s.value.class=a),label:"Class",clearable:"",density:"compact",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(u,{cols:"12",lg:"6",md:"6",sm:"6"},{default:o(()=>[e(x,{color:"primary",modelValue:s.value.initially_installed,"onUpdate:modelValue":l[22]||(l[22]=a=>s.value.initially_installed=a),clearable:"",label:"Initially Installed",density:"compact",items:O.value,variant:"outlined",itemValue:"value",itemTitle:"key","close-on-content-click":!1,"hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1}),e(d,null,{default:o(()=>[e(u,{cols:"12",lg:"6",md:"6",sm:"6"},{default:o(()=>[e(m,{color:"primary",modelValue:s.value.reason_equipment_status,"onUpdate:modelValue":l[23]||(l[23]=a=>s.value.reason_equipment_status=a),label:"Reason for Equipment Status",clearable:"",density:"compact",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(u,{cols:"12",lg:"6",md:"6",sm:"6",class:"mb-5"},{default:o(()=>[e(m,{color:"primary",modelValue:s.value.email,"onUpdate:modelValue":l[24]||(l[24]=a=>s.value.email=a),label:"Email",clearable:"",density:"compact",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(u,{cols:"12"},{default:o(()=>[e(de,{modelValue:y.value,"onUpdate:modelValue":l[27]||(l[27]=a=>y.value=a),class:"d-flex align-items-center justify-content-center",width:r(A)<=600?400:1e3,"location-strategy":"connected"},{default:o(()=>[e(q,{class:"pa-7","min-height":"500"},{default:o(()=>[e(d,null,{default:o(()=>[e(u,{cols:"10",xl:"4",md:"4",sm:"5"},{default:o(()=>[e(m,{modelValue:p.search,"onUpdate:modelValue":l[25]||(l[25]=a=>p.search=a),clearable:"",density:"compact",label:"Search all fields",variant:"outlined",color:"primary"},null,8,["modelValue"])]),_:1}),e($),e(S,{onClick:l[26]||(l[26]=a=>y.value=!1),icon:"",variant:"plain",color:"primary"},{default:o(()=>[e(w,null,{default:o(()=>[_("mdi-close")]),_:1})]),_:1})]),_:1}),e(r(Te),{ref_key:"datatable",ref:E,rows:h.value,columns:r(F),loading:v.value,selectRowOnClick:!0,sortable:!0,hasCheckbox:!1,search:p.search,isServerMode:!0,totalRows:B.value,pageSize:p.pagesize,hide:!0,filter:!0,skin:"bh-table-compact bh-table-bordered bh-table-responsive",class:"",onRowSelect:ee,onChange:se,rowClass:le},null,8,["rows","columns","loading","search","totalRows","pageSize"]),Ne,M("p",Le,[_("Selected Item: "),M("b",null,"["+J(s.value.item_code)+"]",1)])]),_:1})]),_:1},8,["modelValue","width"])]),_:1}),e(he,{modelValue:g.value,"onUpdate:modelValue":l[28]||(l[28]=a=>g.value=a),title:"Discard Changes",text:"Are you sure you want to leave?",onConfirm:P},null,8,["modelValue"])]),_:1})]),_:1},512)}}};export{al as default};
