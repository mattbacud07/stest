import{d as fe,v as ve,u as be,c as ye,x as he,r as n,C as T,E as ge,ae as ke,y as we,f as Se,w as l,i as qe,e as d,o as c,h as t,p as _,z as $,F as j,j as u,n as x,k as o,X as xe,Z as Ce,M as Ve,t as g,N as Ie,O as De}from"./index-BVXPU9zS.js";import{O as Re}from"./vue-datepicker-B1Ef9scS.js";/* empty css             */import{L as Ee}from"./LayoutSinglePage-Bv3n2_4P.js";import{g as ze}from"./vue3-datatable-C2ljW4qF.js";import{d as Ue}from"./debounce-KHlJyMIn.js";import{_ as Me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./topBarUserProfile-DtdqdVcI.js";const C=V=>(Ie("data-v-e2bf4e96"),V=V(),De(),V),Ne=C(()=>o("h5",{class:"p-3",style:{"font-weight":"500",color:"#191970"}},"EQUIPMENT",-1)),Be={class:"table-responsive"},Oe={class:"table table-sm table-bordered"},Pe=C(()=>o("thead",{style:{background:"#afafaf2e"}},[o("tr",null,[o("th",{scope:"col"},"Item Code"),o("th",{scope:"col"},"Item Description"),o("th",{scope:"col"},"Serial Number"),o("th",{scope:"col"},"Remarks"),o("th",{scope:"col"})])],-1)),Fe={key:0},Ae={key:1},Le={colspan:"5",class:"text-center p-1",style:{opacity:".2"}},Te=C(()=>o("br",null,null,-1)),$e={class:"d-flex justify-content-center"},je={class:"text-danger"},Ye=C(()=>o("b",null,"List of Selected Row",-1)),Qe=C(()=>o("br",null,null,-1)),Xe={key:0},Ze={key:1,class:"small"},Ge={__name:"PullOutRequestForm",setup(V){const k=fe.useToast(),{name:He,width:I}=ve(),M=be(),N=ye();N.getUserData;const B=he(),W=n(null),O=n(!1),w=n(!1),Y=n(!1);n(!1);const b=n(!1),Q=n([]),P=n(!1),ee=[{title:"Back",disabled:!1,href:"/pull-out-request",display:"block"},{title:"Pull Out Request",disabled:!0,href:"",display:"none"},{title:"Pull Out Request Form",disabled:!0,href:"",display:"none"}],te=e=>{!e.disabled&&e.href&&M.push(e.href)},y=n(6);T(I,e=>{e<550?y.value=12:e<768?cols.value.forEach(a=>{a.field==="description"&&(a.hide=!0)}):(y.value=6,cols.value.forEach(a=>{a.field==="description"&&(a.hide=!1)}))});const i=n({requested_by:N.user.first_name+" "+N.user.last_name,institution:"",address:"",proposed_pullout_date:""}),F=n({ruleInstitution:[e=>!!e||"Required field",e=>e.key!==void 0?!0:"Select one of the options listed",e=>e.value!==void 0?!0:"Select one of the options listed"],ruleAddress:[e=>!!e||"Address is required"],ruleRequestedBy:[e=>!!e||"Field is required"]}),X=n(null);T(()=>i.value.institution,e=>{X.value=(e==null?void 0:e.institution_id)??null,i.value.address=e?e.value:"",E()});const D=n(null);T(()=>i.value.proposed_pullout_date,e=>{D.value=e?null:!1});const le=async()=>{b.value=!0;const e=Array.from(v.value),a=xe(i.value.proposed_pullout_date).format("YYYY-MM-DD"),{valid:r}=await O.value.validate();if(!r){b.value=!1,i.value.proposed_pullout_date||(D.value=!1);return}if(!i.value.proposed_pullout_date){D.value=!1,b.value=!1;return}if(!e||e.length<=0){k.error("Select atleast one equipment"),b.value=!1;return}try{const m=await B.post("create-pullout",{...i.value,proposed_pullout_date:a,equipments:e});m.data&&m.data.success?(k.success("Request successfully created"),Y.value=!0,M.push("/pull-out-request")):k.error("Something went wrong")}catch(m){k.error(m),console.log(m)}finally{b.value=!1}},A=n(!0),R=n(0),ae=n([{field:"id",title:"ID",isUnique:!0,type:"number",hide:!0},{field:"master_data_id",title:"Master Data ID",type:"number",hide:!0},{field:"name",title:"Institution"},{field:"item_code",title:"Item Code"},{field:"equipment",title:"Equipment"},{field:"serial",title:"Serial No."},{field:"description",title:"Item Description"},{field:"status",title:"Status"}])||[],f=ge({current_page:1,pagesize:10,search:"",sort_column:"id",sort_direction:"desc"}),Z=n(null),v=n([]),se=e=>{v.value.some(r=>r.service_master_data_id===e.id)?k.info("Equipment is already in the list"):v.value.push({service_master_data_id:e.id,item_id:e.master_data_id,item_code:e.item_code,description:e.description,serial:e.serial,remarks:""})},G=e=>{v.value.splice(e,1)},E=async()=>{try{A.value=!0;const a=(await B.get("get_master_data",{params:{...f,category:"pullout",item_in_institution_id:X.value}})).data.md_data;Z.value=a.data,R.value=a.total}catch(e){console.log(e)}A.value=!1},oe=async()=>{try{P.value=!0;const e=await B.get("get_institution");Q.value=e.data.institutions.map(a=>({key:a.name,value:a.address,institution_id:a.id}))}catch(e){console.log(e)}P.value=!1},ne=Ue(E,300),ie=e=>{f.current_page=e.current_page,f.pagesize=e.pagesize,f.search=e.search,e.change_type==="search"?ne():E()},re=()=>{y.value=I.value<550?12:6};ke(async(e,a,r)=>{const{valid:m}=await O.value.validate();m||window.confirm("Discard Changes?")?r():r(!1)});const de=()=>{M.push("/pull-out-request")};return we(()=>{E(),oe(),re()}),(e,a)=>{const r=d("v-icon"),m=d("v-breadcrumbs-item"),H=d("v-breadcrumbs"),p=d("v-col"),J=d("v-spacer"),z=d("v-btn"),ue=d("v-combobox"),S=d("v-text-field"),q=d("v-row"),ce=d("v-badge"),K=d("v-divider"),L=d("v-card"),me=d("v-overlay"),pe=d("v-container"),_e=d("v-form");return c(),Se(_e,{onSubmit:qe(le,["prevent"]),ref_key:"form",ref:O},{default:l(()=>[t(Ee,null,{topBarFixed:l(()=>[t(p,{lg:"6",md:"6",sm:"8",cols:"8"},{default:l(()=>[t(H,{class:"pt-7"},{default:l(()=>[(c(),_(j,null,$(ee,(s,h)=>t(m,{key:h,class:Ce({"custom-pointer":!s.disabled}),style:Ve({display:x(I)<=768?s.display:""}),onClick:U=>te(s),disabled:s.disabled},{default:l(()=>[u(g(s.title)+" ",1),t(r,{class:"ml-1",icon:"mdi-chevron-right"})]),_:2},1032,["class","style","onClick","disabled"])),64))]),_:1})]),_:1}),t(J),t(p,{lg:"6",md:"6",sm:"4",cols:"4","align-self":"center",class:"d-flex justify-end"},{default:l(()=>[t(z,{disabled:b.value,onClick:de,color:"primary",variant:"tonal",class:"text-none mr-2"},{default:l(()=>[u(" Cancel ")]),_:1},8,["disabled"]),t(z,{type:"submit",loading:b.value,disabled:Y.value,color:"primary",variant:"flat",class:"text-none btnSubmit"},{default:l(()=>[t(r,{class:"mr-2"},{default:l(()=>[u("mdi-note-plus-outline")]),_:1}),u(" Create ")]),_:1},8,["loading","disabled"])]),_:1})]),default:l(()=>[t(pe,{class:"container-form mt-10"},{default:l(()=>[t(L,{class:"pa-5 border-sm pt-7 border-dashed",elevation:"0"},{default:l(()=>[t(q,null,{default:l(()=>[t(p,{cols:y.value},{default:l(()=>[t(ue,{color:"primary",modelValue:i.value.institution,"onUpdate:modelValue":a[0]||(a[0]=s=>i.value.institution=s),clearable:"",loading:P.value,label:"Institution",density:"compact",items:Q.value,variant:"outlined",itemValue:"value",itemTitle:"key",rules:F.value.ruleInstitution,"close-on-content-click":!1,"hide-details":""},null,8,["modelValue","loading","items","rules"])]),_:1},8,["cols"]),t(p,{cols:y.value},{default:l(()=>[t(S,{color:"primary",density:"compact",label:"Requested by",placeholder:"Requested by",variant:"outlined",readonly:"",modelValue:i.value.requested_by,"onUpdate:modelValue":a[1]||(a[1]=s=>i.value.requested_by=s),rules:F.value.ruleRequestedBy,"hide-details":""},null,8,["modelValue","rules"])]),_:1},8,["cols"])]),_:1}),t(q,{class:"mb-2"},{default:l(()=>[t(p,{cols:y.value},{default:l(()=>[t(S,{color:"primary",modelValue:i.value.address,"onUpdate:modelValue":a[2]||(a[2]=s=>i.value.address=s),label:"Address",density:"compact",variant:"outlined",readonly:"","onUpdate:Item":"(newVal) => { address.value = newVal.key }",rules:F.value.ruleAddress,"hide-details":""},null,8,["modelValue","rules"])]),_:1},8,["cols"]),t(p,{cols:y.value},{default:l(()=>[t(x(Re),{modelValue:i.value.proposed_pullout_date,"onUpdate:modelValue":a[3]||(a[3]=s=>i.value.proposed_pullout_date=s),"auto-apply":"","min-date":new Date,"enable-time-picker":!1,teleport:!0,state:D.value,placeholder:"Propose Pullout Date"},null,8,["modelValue","min-date","state"])]),_:1},8,["cols"])]),_:1}),t(L,{class:"mt-3 p-3",elevation:"0"},{default:l(()=>[t(q,null,{default:l(()=>[Ne,t(p,{cols:"12"},{default:l(()=>[o("div",Be,[o("table",Oe,[Pe,v.value.length>0?(c(),_("tbody",Fe,[(c(!0),_(j,null,$(v.value,(s,h)=>(c(),_("tr",{key:h},[o("td",null,[u(g(s.item_code)+" ",1),t(S,{class:"hideID"},{default:l(()=>[u(g(s.id),1)]),_:2},1024)]),o("td",null,g(s.description),1),o("td",null,g(s.serial),1),o("td",null,[t(S,{clearable:"",density:"compact",variant:"plain",placeholder:"Remarks...","w-100":"",modelValue:s.remarks,"onUpdate:modelValue":U=>s.remarks=U},null,8,["modelValue","onUpdate:modelValue"])]),o("td",null,[t(r,{onClick:U=>G(h),class:"text-danger"},{default:l(()=>[u("mdi-trash-can-outline")]),_:2},1032,["onClick"])])]))),128))])):(c(),_("tbody",Ae,[o("tr",null,[o("td",Le,[t(r,{class:"mb-3",style:{"font-size":"50px"}},{default:l(()=>[u("mdi-file-document-alert-outline")]),_:1}),Te,u(" No records found ")])])]))])]),o("div",$e,[t(z,{color:"primary",size:"medium",disabled:R.value===0,flat:"",class:"text-none mt-3 p-2",onClick:a[4]||(a[4]=s=>w.value=!w.value)},{append:l(()=>[t(ce,{color:"warning",content:R.value,inline:""},null,8,["content"])]),default:l(()=>[t(r,{class:"mr-3"},{default:l(()=>[u("mdi-database-cog")]),_:1}),u(" Select Equipment ")]),_:1},8,["disabled"]),t(me,{modelValue:w.value,"onUpdate:modelValue":a[7]||(a[7]=s=>w.value=s),class:"d-flex align-items-center justify-content-center",width:x(I)<=600?400:1e3,"location-strategy":"connected"},{default:l(()=>[t(L,{class:"pa-7","min-height":"500"},{default:l(()=>[t(q,null,{default:l(()=>[t(p,{cols:"5",xl:"4",md:"4",sm:"5"},{default:l(()=>[t(S,{modelValue:f.search,"onUpdate:modelValue":a[5]||(a[5]=s=>f.search=s),clearable:"",density:"compact",label:"Search all fields",variant:"outlined",color:"primary"},null,8,["modelValue"])]),_:1}),t(J),t(z,{onClick:a[6]||(a[6]=s=>w.value=!1),icon:"",variant:"plain",color:"primary"},{default:l(()=>[t(r,null,{default:l(()=>[u("mdi-close")]),_:1})]),_:1})]),_:1}),t(x(ze),{ref_key:"datatable",ref:W,rows:Z.value,columns:x(ae),loading:A.value,selectRowOnClick:!0,sortable:!0,search:f.search,isServerMode:!0,totalRows:R.value,pageSize:f.pagesize,hide:!0,filter:!0,skin:"bh-table-compact bh-table-bordered",class:"",noDataContent:"No data available for the selected institution",onRowClick:se,onChange:ie},null,8,["rows","columns","loading","search","totalRows","pageSize"]),t(K),o("p",je,[Ye,Qe,v.value.length>0?(c(),_("span",Xe,[(c(!0),_(j,null,$(v.value,(s,h)=>(c(),_("span",{key:s.id},[u(" [ "+g(s.item_code)+" - ",1),t(r,{onClick:U=>G(h),class:"text-danger"},{default:l(()=>[u("mdi-trash-can-outline")]),_:2},1032,["onClick"]),u("]   ")]))),128))])):(c(),_("span",Ze,"No data selected"))])]),_:1})]),_:1},8,["modelValue","width"])])]),_:1})]),_:1})]),_:1}),t(K),t(q,null,{default:l(()=>[t(p,{cols:"12"})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},512)}}},ot=Me(Ge,[["__scopeId","data-v-e2bf4e96"]]);export{ot as default};
