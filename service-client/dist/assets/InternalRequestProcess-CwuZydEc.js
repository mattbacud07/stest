import{s as de,c as ue,v as ie,r as t,D as ke,an as Ve,x as ce,e as u,o as m,n as g,h as e,w as a,k as U,I as me,aa as ne,t as z,f as S,H as L,F as H,y as Q,N as W,g as xe,d as he,aj as we,u as Se,m as J,U as qe,a9 as M,E as re,j as n,a4 as De}from"./index-C8ph-EQq.js";import{R as Re,_ as Ce}from"./RequestDetails-C6D_ZG6o.js";import{L as Ie}from"./LayoutSinglePage-CszXxlTG.js";import{_ as Ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./topBarUserProfile-ExGO6QtX.js";import"./logout-D7B5usQQ.js";const Ae=U("span",{class:"text-dark mr-2"},"Status:",-1),Ne=U("h5",{class:"pb-5 text-primary"},"Internal Servicing Details",-1),$e=U("b",{class:"text-primary ml-1"},"Actions Done",-1),Pe={key:0},Ee={__name:"InternalServicingActivity",props:{id:{type:Number,default:null}},setup(X){de(),ue();const Z=ie(),A=t(!1),d=t({}),x=ke({}),q=f=>{const r=d.value.equipments.find(B=>B.id===f.equipment_id);return r?{code:`Item Code -  ${r.item_code}`,serialNo:`Serial No. -  ${r.serial_number}`}:""},D=t(""),N=t(""),O=t(""),R=t(""),$=t(""),h=t(""),k=t(""),c=t(""),v=t(""),F=t(""),C=t(""),P=t(""),E=t(""),y=t(""),I=t(""),T=X,{id:w}=Ve(T),Y=async()=>{A.value=!0;try{const f=await Z.get("getInternalRequest",{params:{id:w.value,category:"specificRowServicing"}});if(f.data&&f.data.request){const r=f.data.request;d.value=r[0],D.value=d.value.received_by,N.value=d.value.internal_external_name.name||"--",O.value=d.value.type_of_activity,R.value=d.value.other,$.value=W(d.value.delegation_date),h.value=d.value.get_user.first_name+" "+d.value.get_user.last_name,k.value=W(d.value.date_started)||"--",c.value=W(d.value.accomplished_date)||"--",v.value=d.value.packed_endorse_to_warehouse===1?"Yes":"--",F.value=d.value.packed_date,C.value=d.value.checklist_number,P.value=W(d.value.endorsement_date)||"--",E.value=d.value.remarks,y.value=W(d.value.accepted_by_warehouse)||"--",I.value=d.value.status,x.value={...d.value.actions_done,...d.value.equipments}}}catch(f){console.log(f)}A.value=!1};return ce(()=>{Y()}),(f,r)=>{const B=u("v-chip"),p=u("v-col"),V=u("v-row"),s=u("v-skeleton-loader"),l=u("v-text-field"),_=u("v-spacer"),j=u("v-card");return m(),g(H,null,[e(V,null,{default:a(()=>[e(p,{cols:"12",class:"d-flex justify-content-end mt-7 mb-5"},{default:a(()=>[e(B,{variant:"tonal",color:"grey lighten-5",label:""},{default:a(()=>[Ae,U("span",{style:me({color:ne(I.value).color})},z(ne(I.value).text),5)]),_:1})]),_:1})]),_:1}),A.value?(m(),S(s,{key:0,type:"article",class:"mb-2"})):(m(),S(j,{key:1,style:{border:"dashed thin #19197023"},flat:"",class:"pl-2 pr-2 pt-5 pb-4 mb-7"},{default:a(()=>[e(V,null,{default:a(()=>[e(p,{cols:"12"},{default:a(()=>[Ne]),_:1})]),_:1}),e(V,null,{default:a(()=>[e(p,{cols:"12",lg:"4",md:"4",sm:"6"},{default:a(()=>[e(l,{color:"primary",density:"compact",label:"Delegated to",modelValue:h.value,"onUpdate:modelValue":r[0]||(r[0]=i=>h.value=i),placeholder:"",variant:"outlined",readonly:""},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",lg:"4",md:"4",sm:"6"},{default:a(()=>[e(l,{color:"primary",density:"compact",label:"Type of Activity",modelValue:N.value,"onUpdate:modelValue":r[1]||(r[1]=i=>N.value=i),placeholder:"",variant:"outlined",readonly:""},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",lg:"4",md:"4",sm:"6"},{default:a(()=>[O.value===12?(m(),S(l,{key:0,color:"primary",density:"compact",label:"Type of Activity (Other)",modelValue:R.value,"onUpdate:modelValue":r[2]||(r[2]=i=>R.value=i),placeholder:"",variant:"outlined",readonly:""},null,8,["modelValue"])):L("",!0)]),_:1})]),_:1}),e(V,null,{default:a(()=>[e(p,{cols:"12",lg:"4",md:"4",sm:"6"},{default:a(()=>[e(l,{color:"primary",density:"compact",label:"Delegation Date",modelValue:$.value,"onUpdate:modelValue":r[3]||(r[3]=i=>$.value=i),placeholder:"",variant:"outlined",readonly:""},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",lg:"4",md:"4",sm:"6"},{default:a(()=>[e(l,{color:"primary",density:"compact",label:"Date Started",modelValue:k.value,"onUpdate:modelValue":r[4]||(r[4]=i=>k.value=i),placeholder:"",variant:"outlined",readonly:""},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",lg:"4",md:"4",sm:"6"},{default:a(()=>[e(l,{color:"primary",density:"compact",label:"Date Accomplished",modelValue:c.value,"onUpdate:modelValue":r[5]||(r[5]=i=>c.value=i),placeholder:"",variant:"outlined",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(V,null,{default:a(()=>[e(p,{cols:"12",lg:"4",md:"4",sm:"6"},{default:a(()=>[e(l,{color:"primary",density:"compact",label:"Packed & Endorsed to Warehouse",modelValue:v.value,"onUpdate:modelValue":r[6]||(r[6]=i=>v.value=i),placeholder:"",variant:"outlined",readonly:""},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",lg:"4",md:"4",sm:"6"},{default:a(()=>[e(l,{color:"primary",density:"compact",label:"Endorsement Date",modelValue:P.value,"onUpdate:modelValue":r[7]||(r[7]=i=>P.value=i),placeholder:"",variant:"outlined",readonly:""},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",lg:"4",md:"4",sm:"6"},{default:a(()=>[e(l,{color:"primary",density:"compact",label:"Confirmed by Warehouse",modelValue:y.value,"onUpdate:modelValue":r[8]||(r[8]=i=>y.value=i),placeholder:"",variant:"outlined",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(V,null,{default:a(()=>[e(p,{cols:"12",lg:"6",md:"6",sm:"12"},{default:a(()=>[$e,d.value.actions_done&&d.value.actions_done.length>0?(m(),g("div",Pe,[(m(!0),g(H,null,Q(d.value.actions_done,i=>(m(),S(j,{key:i.key,text:i.action??"No remarks","prepend-icon":"mdi-playlist-check",class:"mt-3",elevation2:""},{subtitle:a(()=>[e(V,{class:"p-3"},{default:a(()=>[U("span",null,z(q(i).code),1),e(_),U("span",null,z(q(i).serialNo),1)]),_:2},1024)]),_:2},1032,["text"]))),128))])):(m(),S(j,{key:1,lines:"two",title:"No Actions Done",text:"In Progress","prepend-icon":"mdi-playlist-check"}))]),_:1})]),_:1})]),_:1}))],64)}}},Te={key:0},Be={key:0},je={key:1},We={key:2},Le={key:1},Oe={key:0},Fe={__name:"InternalRequestProcess",setup(X){const A=xe().currentUserRole,{width:d}=de(),x=he.useToast(),q=t(!1),D=t("equipments"),N=[{title:"Back",disabled:!1,href:"/internal-servicing",display:"block"},{title:"Equipment Handling",disabled:!0,href:"",display:"none"},{title:"Internal Servicing",disabled:!0,href:"",display:"none"}],O=s=>{!s.disabled&&s.href&&$.push(s.href)},R=we(),$=Se();ue();const h=ie(),k=t(!1),c=t(!1),v=t(!1),F=t(null),C=t(0);t({}),t([]);const P=t(""),E=R.params.id??0,y=R.params.service_id??0,I=t(E);t(y);const T=t([]),w=t(null),Y=s=>{T.value=Array.from(s)},f=async()=>{try{const s=await h.get("getInternalRequest",{params:{id:y,category:"specificRow"}});if(s.data&&s.data.request&&s.data.request.length>0){c.value=!0;const l=s.data.request[0];w.value=l.status,P.value=l.type_of_activity_name}}catch(s){console.log(s)}finally{c.value=!1}},r=async()=>{},B=async()=>{c.value=!0,v.value=!0;try{const s=await h.post("accept-internal-request",{service_id:E,requested_id:y});s.data&&s.data.success?(x.success("Successfully accepted"),f(),C.value++,c.value=!0):(c.value=!1,x.error(s.data.error))}catch{c.value=!1,x.error("Something went wrong")}finally{v.value=!1}},p=async()=>{c.value=!0,v.value=!0;const s=T.value.map(l=>({service_id:l.service_id,equipment_id:l.equipment_id,work_type_id:y,serial:l.serial_number,action:(l==null?void 0:l.actions_done)??"",work_type:"Internal"}));try{const l=await h.post("internal-servicing-completed",{arrayOfData:s,requested_id:y});l.data&&l.data.success?(x.success("Operation completed successfully"),f(),C.value++,c.value=!0):(c.value=!1,x.error(l.data.error))}catch(l){console.log(l)}finally{v.value=!1,c.value=!1}},V=async()=>{c.value=!0,v.value=!0;try{const s=await h.post("markPackedEndorsedToWarehouse",{requested_id:y,status:w.value,service_id:E});s.data&&s.data.success?(x.success("Operation completed successfully"),f(),C.value++):(c.value=!1,x.error(s.data.error))}catch(s){console.log(s)}finally{v.value=!1}};return ce(()=>{f()}),(s,l)=>{const _=u("v-icon"),j=u("v-breadcrumbs-item"),i=u("v-breadcrumbs"),ve=u("v-spacer"),b=u("v-btn"),ee=u("v-textarea"),ae=u("v-col"),le=u("v-row"),G=u("v-card"),te=u("v-dialog"),_e=u("v-snackbar"),oe=u("v-tab"),pe=u("v-tabs"),se=u("v-window-item"),fe=u("v-window"),ye=u("v-card-text"),be=u("v-container"),ge=u("v-form");return m(),S(Ie,null,{topBarFixed:a(()=>[e(i,{class:"pt-7"},{default:a(()=>[(m(),g(H,null,Q(N,(o,K)=>e(j,{key:K,class:De({"custom-pointer":!o.disabled}),style:me({display:J(d)<=768?o.display:""}),onClick:Me=>O(o),disabled:o.disabled},{default:a(()=>[n(z(o.title)+" ",1),e(_,{class:"ml-1",icon:"mdi-chevron-right"})]),_:2},1032,["class","style","onClick","disabled"])),64))]),_:1}),e(ve),J(A)===qe?(m(),g("div",Te,[w.value===M.Delegated?(m(),g("span",Be,[e(te,{modelValue:k.value,"onUpdate:modelValue":l[2]||(l[2]=o=>k.value=o),"max-width":"400",persistent:""},{activator:a(({props:o})=>[e(b,re({disabled:c.value},o,{color:"primary",variant:"tonal",class:"text-none mr-2"}),{default:a(()=>[e(_,{class:"mr-2"},{default:a(()=>[n("mdi-close")]),_:1}),n(" Decline")]),_:2},1040,["disabled"])]),default:a(()=>[e(G,{text:"",title:"Decline"},{actions:a(()=>[e(le,{justify:"end"},{default:a(()=>[e(b,{elevation:"2",onClick:l[1]||(l[1]=o=>k.value=!1),"background-color":"red",color:"#191970",class:"text-none mr-2"},{default:a(()=>[e(_,null,{default:a(()=>[n("mdi-close")]),_:1}),n(" Cancel")]),_:1}),e(b,{onClick:r,color:"primary",elevation:"2",class:"text-none mr-3",style:{"background-color":"#191970",color:"#fff!important"}},{default:a(()=>[e(_,{class:"mr-1"},{default:a(()=>[n("mdi-close")]),_:1}),n(" Decline")]),_:1})]),_:1})]),default:a(()=>[e(ae,{cols:"12"},{default:a(()=>[e(ee,{class:"mr-2 ml-2",modelValue:F.value,"onUpdate:modelValue":l[0]||(l[0]=o=>F.value=o),clearable:"",label:"Reason",color:"primary",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(b,{type:"button",loading:v.value,onClick:B,disabled:c.value,color:"primary",variant:"flat",class:"text-none btnSubmit"},{default:a(()=>[e(_,{class:"mr-2"},{default:a(()=>[n("mdi-check")]),_:1}),n(" Accept")]),_:1},8,["loading","disabled"])])):L("",!0),w.value===M.InProgress?(m(),g("span",je,[e(te,{modelValue:k.value,"onUpdate:modelValue":l[4]||(l[4]=o=>k.value=o),"max-width":"400",persistent:""},{activator:a(({props:o})=>[e(b,re({type:"button"},o,{loading:v.value,disabled:c.value,color:"primary",variant:"flat",class:"text-none btnSubmit"}),{default:a(()=>[e(_,{class:"mr-2"},{default:a(()=>[n("mdi-check")]),_:1}),n(" Set as Done")]),_:2},1040,["loading","disabled"])]),default:a(()=>[e(G,{text:"",title:"Actions Done"},{actions:a(()=>[e(le,{justify:"end"},{default:a(()=>[e(b,{elevation:"2",onClick:l[3]||(l[3]=o=>k.value=!1),"background-color":"red",color:"#191970",class:"text-none mr-2"},{default:a(()=>[e(_,null,{default:a(()=>[n("mdi-close")]),_:1}),n(" Cancel")]),_:1}),e(b,{onClick:p,color:"primary",class:"text-none mr-3",loading:v.value,style:{"background-color":"#191970",color:"#fff!important"}},{default:a(()=>[e(_,{class:"mr-1"},{default:a(()=>[n("mdi-check")]),_:1}),n(" Set as Done")]),_:1},8,["loading"])]),_:1})]),default:a(()=>[e(ae,{cols:"12"},{default:a(()=>[(m(!0),g(H,null,Q(T.value,o=>(m(),S(ee,{class:"mr-2 ml-2 mb-3",key:o.key,modelValue:o.actions_done,"onUpdate:modelValue":K=>o.actions_done=K,clearable:"",label:"Actions Done in Serial -"+o.serial_number,color:"primary",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","label"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])])):L("",!0),w.value===M.Completed?(m(),g("span",We,[e(b,{type:"button",loading:v.value,onClick:V,disabled:c.value,color:"primary",variant:"flat",class:"text-none btnSubmit"},{default:a(()=>[e(_,{class:"mr-2"},{default:a(()=>[n("mdi-check")]),_:1}),n(" Packed & Sent to Warehouse")]),_:1},8,["loading","disabled"])])):L("",!0)])):(m(),g("div",Le,[w.value===M.Packed?(m(),g("span",Oe,[e(b,{type:"button",loading:v.value,onClick:l[5]||(l[5]=o=>q.value=!0),disabled:c.value,color:"primary",variant:"flat",class:"text-none btnSubmit"},{default:a(()=>[e(_,{class:"mr-2"},{default:a(()=>[n("mdi-check")]),_:1}),n(" Mark as Confirmed")]),_:1},8,["loading","disabled"]),e(_e,{modelValue:q.value,"onUpdate:modelValue":l[7]||(l[7]=o=>q.value=o),tile:"",position:"sticky",vertical:"","close-on-content-click":!0,color:"info",timeout:"-1"},{actions:a(()=>[e(b,{type:"button",loading:v.value,onClick:V,disabled:c.value,color:"primary",variant:"flat",class:"btnSubmit mr-2"},{default:a(()=>[e(_,null,{default:a(()=>[n("mdi-check")]),_:1}),n(" Yes")]),_:1},8,["loading","disabled"]),e(b,{color:"error",variant:"flat",onClick:l[6]||(l[6]=o=>q.value=!1)},{default:a(()=>[n("Cancel")]),_:1})]),default:a(()=>[n(" Would you like to continue with this action? ")]),_:1},8,["modelValue"])])):L("",!0)]))]),default:a(()=>[e(ge,{ref:"form"},{default:a(()=>[e(be,{class:"container-form mt-7"},{default:a(()=>[(m(),S(Ee,{id:parseInt(J(y)),key:C.value},null,8,["id"])),e(G,{class:"mt-10"},{default:a(()=>[e(pe,{modelValue:D.value,"onUpdate:modelValue":l[8]||(l[8]=o=>D.value=o),density:"compact",class:"border-b-sm","bg-color":"grey-lighten-5"},{default:a(()=>[e(oe,{value:"details",class:"text-none",color:"primary"},{default:a(()=>[e(_,{class:"mr-2"},{default:a(()=>[n("mdi-tooltip-text-outline")]),_:1}),n(" Request Details")]),_:1}),e(oe,{value:"equipments",class:"text-none",color:"primary"},{default:a(()=>[e(_,{class:"mr-2"},{default:a(()=>[n("mdi-hammer-screwdriver")]),_:1}),n(" Requested Equipments")]),_:1})]),_:1},8,["modelValue"]),e(ye,null,{default:a(()=>[e(fe,{modelValue:D.value,"onUpdate:modelValue":l[9]||(l[9]=o=>D.value=o),disabled:!0},{default:a(()=>[e(se,{value:"details"},{default:a(()=>[e(Re,{service_id:parseInt(I.value)},null,8,["service_id"])]),_:1}),e(se,{value:"equipments"},{default:a(()=>[e(Ce,{service_id:parseInt(I.value),onSetSerial:s.getSerialNumber,onGetSerials:Y,editSerial:!0},null,8,["service_id","onSetSerial"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})}}},Qe=Ue(Fe,[["__scopeId","data-v-72290c8f"]]);export{Qe as default};
