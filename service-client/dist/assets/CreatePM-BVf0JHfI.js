import{d as ye,v as ge,u as he,Y as ke,c as Ve,x as Ce,r as n,C as J,E as we,y as xe,f as Ie,w as l,i as qe,e as r,o as _,h as e,p as y,z as j,F as T,j as c,k as d,n as S,Z as Re,M as Se,t as Me,N as De,O as Ne}from"./index-Cz72bSYw.js";import"./vue-datepicker-2fw8wqA2.js";/* empty css             */import{L as Pe}from"./LayoutSinglePage-Dk5b2Jaw.js";import{g as Ue}from"./vue3-datatable-BQ6DeCI2.js";import{d as ze}from"./debounce-BH-WzkiD.js";import{_ as Fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./topBarUserProfile-tltSc7lJ.js";const M=x=>(De("data-v-e134d305"),x=x(),Ne(),x),Be=M(()=>d("p",{class:"text-primary"},[d("b",null,"Customer Complaint")],-1)),Ee={class:"d-flex align-items-center",style:{"border-bottom":"none!important"}},je={key:1},Te={class:"text-grey text-center"},$e=M(()=>d("br",null,null,-1)),Ae=M(()=>d("p",{class:"text-primary"},[d("b",null,"Cause of Problem")],-1)),Le={class:"d-flex align-items-center",style:{"border-bottom":"none!important"}},Oe={key:1},We={class:"text-grey text-center"},Ye=M(()=>d("br",null,null,-1)),Ze={__name:"CreatePM",setup(x){const D=ye.useToast(),{name:Ge,width:$}=ge(),N=he(),I=ke();Ve();const P=Ce(),K=n(null),A=n(!1);n(!1);const g=n(!1),q=n(!1),h=n(!1),L=n([]),O=n(null),U=n(I.params.work_type==="PM"?"/preventive-maintenance":"/corrective-maintenance"),Q=[{title:"Back",disabled:!1,href:U.value},{title:I.params.work_type==="PM"?"Preventive Maintenance":"Corrective Maintenance",disabled:!0,href:""},{title:I.params.work_type==="PM"?"PM-Details":"CM-Details",disabled:!0,href:""}],X=t=>{!t.disabled&&t.href&&N.push(t.href)},R=n(""),s=n({institutionValue:"",address:"",item_code:"",equipment:"",item_id:"",serial:"",IRNo:""});J(R,t=>{s.value.address=t?t.value:""});const k=n({institutionValue:[t=>!!t||"Required"],address:[t=>t&&t.trim()!==""||"Required"],item_code:[t=>t&&t.trim()!==""||"Required"],serial:[t=>t&&t.trim()!==""||"Required"],IRNo:[]}),f=n([]),ee=()=>{f.value.push("")},te=t=>{f.value.splice(t,1)},b=n([]),le=()=>{b.value.push("")},ae=t=>{b.value.splice(t,1)};J(()=>s.value.item_code,t=>{t||(s.value.serial="",s.value.equipment="",s.value.item_id="")});const oe=async()=>{h.value=!0,q.value=!0;const{valid:t}=await A.value.validate();if(!t){D.error("Please ensure that required fields are not left blank"),h.value=!1,q.value=!1;return}try{const a=await P.post("createPMRequest",{...s.value,complaints:f.value,problems:b.value,work_type:O.value,institution:R.value.institutionId});a.data&&a.data.success?(D.success("Request successfully created"),q.value=!1,N.push(U.value)):D.error("Something went wrong")}catch(a){console.error(a)}finally{h.value=!1}},z=n(!0),W=n(0),Y=n([{field:"id",title:"ID",isUnique:!0,type:"number",hide:!0},{field:"master_data_id",title:"Master Data ID",type:"number",hide:!0},{field:"item_code",title:"Item Code"},{field:"equipment",title:"Equipment"},{field:"serial",title:"Serial No."},{field:"description",title:"Item Description"},{field:"status",title:"Status"}])||[],p=we({current_page:1,pagesize:10,search:"",sort_column:"id",sort_direction:"desc",serviceStatus:""}),se=Y.value.map(t=>t.field),Z=n(null),ne=t=>{s.value.item_id=t.id,s.value.item_code=t.item_code,s.value.equipment=t.equipment,s.value.serial=t.serial},F=async()=>{try{z.value=!0;const a=(await P.get("get_master_data",{params:{...p,searchColumn:se}})).data.md_data;Z.value=a.data,W.value=a.total}catch(t){console.log(t)}z.value=!1},B=n(!1),re=async()=>{try{B.value=!0;const t=await P.get("get_institution");L.value=t.data.institutions.map(a=>({key:a.name,value:a.address,institutionId:a.id}))}catch(t){console.log(t)}B.value=!1},ie=ze(F,300),de=t=>{p.current_page=t.current_page,p.pagesize=t.pagesize,p.search=t.search,t.change_type==="search"?ie():F()},ue=()=>{N.push(U)};return xe(()=>{F(),re(),O.value=I.params.work_type}),(t,a)=>{const V=r("v-icon"),ce=r("v-breadcrumbs-item"),me=r("v-breadcrumbs"),i=r("v-col"),G=r("v-spacer"),C=r("v-btn"),pe=r("v-combobox"),v=r("v-text-field"),w=r("v-row"),E=r("v-card"),H=r("v-table"),ve=r("v-divider"),_e=r("v-container"),fe=r("v-overlay"),be=r("v-form");return _(),Ie(be,{onSubmit:qe(oe,["prevent"]),ref_key:"form",ref:A},{default:l(()=>[e(Pe,null,{topBarFixed:l(()=>[e(i,{lg:"6",md:"6",sm:"8",cols:"8"},{default:l(()=>[e(me,{class:"pt-7"},{default:l(()=>[(_(),y(T,null,j(Q,(o,u)=>e(ce,{key:u,class:Re({"custom-pointer":!o.disabled}),style:Se({display:S($)<=768?o.display:""}),onClick:m=>X(o),disabled:o.disabled},{default:l(()=>[c(Me(o.title)+" ",1),e(V,{class:"ml-1",icon:"mdi-chevron-right"})]),_:2},1032,["class","style","onClick","disabled"])),64))]),_:1})]),_:1}),e(G),e(i,{lg:"6",md:"6",sm:"4",cols:"4","align-self":"center",class:"d-flex justify-end"},{default:l(()=>[e(C,{disabled:h.value,onClick:ue,color:"primary",variant:"tonal",class:"text-none mr-2"},{default:l(()=>[c(" Cancel ")]),_:1},8,["disabled"]),e(C,{type:"submit",loading:h.value,disabled:q.value,color:"primary",variant:"flat",class:"text-none btnSubmit"},{default:l(()=>[e(V,{class:"mr-2"},{default:l(()=>[c("mdi-note-plus-outline")]),_:1}),c(" Create ")]),_:1},8,["loading","disabled"])]),_:1})]),default:l(()=>[e(_e,{class:"container-form mt-15"},{default:l(()=>[e(E,{class:"p-3 mb-5",elevation:"1"},{default:l(()=>[e(w,null,{default:l(()=>[e(i,{cols:"12",lg:"6",md:"6",sm:"6"},{default:l(()=>[e(pe,{color:"primary",modelValue:R.value,"onUpdate:modelValue":a[0]||(a[0]=o=>R.value=o),clearable:"",label:"Institution",density:"compact",items:L.value,variant:"outlined",itemValue:"value",itemTitle:"key",rules:k.value.institutionValue,"close-on-content-click":!1,loading:B.value,"hide-details":""},null,8,["modelValue","items","rules","loading"])]),_:1}),e(i,{cols:"12",lg:"6",md:"6",sm:"6"},{default:l(()=>[e(v,{color:"primary",modelValue:s.value.address,"onUpdate:modelValue":a[1]||(a[1]=o=>s.value.address=o),label:"Address",density:"compact",variant:"outlined",readonly:"","onUpdate:Item":"(newVal) => { address.value = newVal.key }",rules:k.value.address,"hide-details":""},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(w,null,{default:l(()=>[e(i,{cols:"12",lg:"6",md:"6",sm:"6"},{default:l(()=>[e(v,{color:"primary",modelValue:s.value.item_code,"onUpdate:modelValue":a[2]||(a[2]=o=>s.value.item_code=o),label:"Item Code",clearable:"",density:"compact",variant:"outlined",readonly:"",rules:k.value.item_code,onClick:a[3]||(a[3]=o=>g.value=!g.value)},null,8,["modelValue","rules"])]),_:1}),e(i,{cols:"12",lg:"6",md:"6",sm:"6"},{default:l(()=>[e(v,{color:"primary",modelValue:s.value.equipment,"onUpdate:modelValue":a[4]||(a[4]=o=>s.value.equipment=o),label:"Equipment",clearable:"",density:"compact",variant:"outlined",rules:[o=>!!o||"Required"],readonly:""},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(w,null,{default:l(()=>[e(i,{cols:"12",lg:"6",md:"6",sm:"6"},{default:l(()=>[e(v,{color:"primary",modelValue:s.value.serial,"onUpdate:modelValue":a[5]||(a[5]=o=>s.value.serial=o),label:"Serial Number",clearable:"",density:"compact",variant:"outlined",rules:k.value.serial,readonly:""},null,8,["modelValue","rules"])]),_:1}),e(i,{cols:"12",lg:"6",md:"6",sm:"6"},{default:l(()=>[e(v,{color:"primary",modelValue:s.value.IRNo,"onUpdate:modelValue":a[6]||(a[6]=o=>s.value.IRNo=o),label:"ID/IR No.",clearable:"",density:"compact",variant:"outlined",rules:k.value.IRNo},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}),e(E,{class:"p-3",elevation:"0",style:{border:"1px dashed #191970"}},{default:l(()=>[e(w,null,{default:l(()=>[e(i,{cols:"12",lg:"12",md:"12",sm:"12"},{default:l(()=>[e(i,{class:"d-flex justify-space-between align-items-center"},{default:l(()=>[Be,e(C,{onClick:ee,class:"text-none",color:"primary",variant:"text","prepend-icon":"mdi-comment-plus"},{default:l(()=>[c("Add Field")]),_:1})]),_:1}),e(H,{class:"mt-4",style:{border:"none!important"}},{default:l(()=>[d("tbody",null,[f.value.length>0?(_(!0),y(T,{key:0},j(f.value,(o,u)=>(_(),y("tr",{key:u},[d("td",Ee,[e(v,{modelValue:f.value[u],"onUpdate:modelValue":m=>f.value[u]=m,label:"Complaint","append-inner-icon":"mdi-trash-can-outline","hide-details":"",variant:"outlined",color:"primary",density:"compact",clearable:"",rules:[m=>!!m||"Required"],"onClick:appendInner":m=>te(u)},null,8,["modelValue","onUpdate:modelValue","rules","onClick:appendInner"])])]))),128)):(_(),y("tr",je,[d("td",Te,[e(V,{style:{"font-size":"5em",opacity:".3"}},{default:l(()=>[c("mdi-file-search-outline")]),_:1}),$e,c(" No records found ")])]))])]),_:1})]),_:1}),e(ve),e(i,{cols:"12",lg:"12",md:"12",sm:"12"},{default:l(()=>[e(i,{class:"d-flex justify-space-between align-items-center"},{default:l(()=>[Ae,e(C,{onClick:le,class:"text-none",color:"primary",variant:"text","prepend-icon":"mdi-comment-plus"},{default:l(()=>[c("Add Field")]),_:1})]),_:1}),e(H,{class:"mt-4",style:{border:"none!important"}},{default:l(()=>[d("tbody",null,[b.value.length>0?(_(!0),y(T,{key:0},j(b.value,(o,u)=>(_(),y("tr",{key:u},[d("td",Le,[e(v,{modelValue:b.value[u],"onUpdate:modelValue":m=>b.value[u]=m,label:"Cause of Problem","append-inner-icon":"mdi-trash-can-outline","hide-details":"",variant:"outlined",color:"primary",density:"compact",clearable:"",rules:[m=>!!m||"Required"],"onClick:appendInner":m=>ae(u)},null,8,["modelValue","onUpdate:modelValue","rules","onClick:appendInner"])])]))),128)):(_(),y("tr",Oe,[d("td",We,[e(V,{style:{"font-size":"5em",opacity:".3"}},{default:l(()=>[c("mdi-file-search-outline")]),_:1}),Ye,c(" No records found ")])]))])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(i,{cols:"12"},{default:l(()=>[e(fe,{modelValue:g.value,"onUpdate:modelValue":a[9]||(a[9]=o=>g.value=o),class:"d-flex align-items-center justify-content-center",width:S($)<=600?400:1e3,"location-strategy":"connected"},{default:l(()=>[e(E,{class:"pa-7","min-height":"500"},{default:l(()=>[e(w,null,{default:l(()=>[e(i,{cols:"10",xl:"4",md:"4",sm:"5"},{default:l(()=>[e(v,{modelValue:p.search,"onUpdate:modelValue":a[7]||(a[7]=o=>p.search=o),clearable:"",density:"compact",label:"Search all fields",variant:"outlined",color:"primary"},null,8,["modelValue"])]),_:1}),e(G),e(C,{onClick:a[8]||(a[8]=o=>g.value=!1),icon:"",variant:"plain",color:"primary"},{default:l(()=>[e(V,null,{default:l(()=>[c("mdi-close")]),_:1})]),_:1})]),_:1}),e(S(Ue),{ref_key:"datatable",ref:K,rows:Z.value,columns:S(Y),loading:z.value,selectRowOnClick:!0,sortable:!0,hasCheckbox:!0,search:p.search,isServerMode:!0,totalRows:W.value,pageSize:p.pagesize,hide:!0,skin:"bh-table-compact bh-table-bordered bh-table-striped bh-table-hover",class:"",onRowClick:ne,onChange:de},null,8,["rows","columns","loading","search","totalRows","pageSize"])]),_:1})]),_:1},8,["modelValue","width"])]),_:1})]),_:1})]),_:1},512)}}},at=Fe(Ze,[["__scopeId","data-v-e134d305"]]);export{at as default};
