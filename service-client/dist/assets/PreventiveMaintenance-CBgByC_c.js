import{r as n,c as Me,u as De,v as Pe,g as Re,s as Te,A as ie,ak as Ae,P as Y,D as Ne,x as Oe,f as p,w as l,S as se,U as re,o as u,h as o,E as C,H as g,m as d,j as m,n as I,y as z,F as E,k as v,I as ue,t as w,V as Ue,aq as Fe,e as c,a2 as ce,L as Be,M as qe}from"./index-C8ph-EQq.js";import{s as L,a as Ye,t as ze,S as Ee}from"./maintenance-sOfZEb8F.js";import{d as Le}from"./debounce-VX6vs7ks.js";import{g as je}from"./vue3-datatable-BuM4cnvr.js";/* empty css              */import{O as Je}from"./main-Z0aCj2Rp.js";import{L as $e}from"./LayoutWithActions-lJJIN9jM.js";import{p as He}from"./permitted-BzPEUTiR.js";import{_ as We}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./topBarUserProfile-ExGO6QtX.js";import"./logout-D7B5usQQ.js";const j=x=>(Be("data-v-672c6174"),x=x(),qe(),x),Ge=j(()=>v("span",{class:"ml-2"},null,-1)),Ke=j(()=>v("span",{class:"ml-2"},null,-1)),Qe={style:{position:"absolute",bottom:"0!important",left:"0",width:"100%"},class:"d-flex justify-content-center"},Xe={color:"primary"},Ze=j(()=>v("br",null,null,-1)),et={key:0,class:"small"},tt={__name:"PreventiveMaintenance",setup(x){const{can:M}=He(),de=n([]),me=n([]);Me();const fe=De(),J=Pe(),$=Re().currentUserRole,H=n(null),{width:D}=Te(),P=n(!1),W=n(!1),G=n(!1),K=n(!1);n(!1);const S=n({filterOptions:[]});ie(S,t=>{localStorage.setItem("filterChip",JSON.stringify(t)),y()},{deep:!0});const i=n({filterStatus:[],filterInstitution:[],filterSchedule_at:"",filterStatusAfterService:[],filterTag:[]});ie(i,t=>{localStorage.setItem("PMFilterState",JSON.stringify(t)),y()},{deep:!0});const R=n(!1),Q=t=>{const e=S.value.filterOptions;if(!e.includes(t))e.push(t),e.includes("assign-next-month")&&(R.value=!0,e.splice(0,e.length),e.push("assign-next-month"));else{e.includes("assign-next-month")&&(R.value=!1);const s=e.indexOf(t);s>-1&&e.splice(s,1)}},X=Ae(()=>Object.values(i.value).filter(t=>Array.isArray(t)&&t.length>0||typeof t=="string"&&t.trim()!=="").length),pe=()=>{i.value={filterOptions:[],filterStatus:[],filterInstitution:[],filterSchedule_at:"",filterStatusAfterService:[],filterTag:[]},localStorage.removeItem("PMFilterState"),localStorage.removeItem("filterChip")},T=n(""),ve=n("PMView"),Z=n(null);n(null);const A=n(!0),ee=n(null);M("create","Preventive Maintenance")&&(Z.value="CreatePM");const _e={selectedId:ee,btnDisable:A,routeView:ve,createRequest:Z.value,work_type:"PM"};Y("data",_e);const te=n([]),he=t=>{te.value=H.value.getSelectedRows(),t.length===1?A.value=!1:A.value=!0,ee.value=t.map(e=>e.id)[0]},ge=t=>te.value.map(s=>s.id).includes(t.id)?"highlightRow":"",Se=t=>{fe.push({name:"PMView",params:{id:t.id,work_type:"PM"}})},ye=t=>{f.search=t},N=n(!0),le=n(0),f=Ne({current_page:1,pagesize:10,sort_column:"scheduled_at",sort_direction:"desc",search:""}),O=n(null),U=n([{field:"id",title:"ID",isUnique:!0,type:"number",hide:!1},{field:"service_id",title:"Service No",hide:!0},{field:"item_id",title:"Item No",hide:!0},{field:"item_code",title:"Item Code"},{field:"description",title:"Item Description",hide:!0},{field:"serial",title:"Serial No."},{field:"institution_name",title:"Institution"},{field:"address",title:"Address",hide:!0},{field:"date_installed",title:"Date Installed",hide:!0},{field:"scheduled_at",title:"Scheduled at"},{field:"schedule",title:"Frequency"},{field:"ssu",title:"SSU",hide:!0},{field:"username",title:"Delegated to"},{field:"delegation_date",title:"Delegation Date"},{field:"date_accepted",title:"Date Accepted"},{field:"departed_date",title:"Date Out"},{field:"travel_duration",title:"Travel Time"},{field:"start_date",title:"Time In"},{field:"end_date",title:"Time Out"},{field:"monitoring_end",title:"Enf of Monitoring"},{field:"status_after_service",title:"Status After Service"},{field:"status",title:"Status"},{field:"tag",title:"Tag"}])||[],be=U.value.reduce((t,e)=>(e.title&&e.field&&(t[e.title]=e.field),t),{});Y("column",U);const y=async()=>{$===se&&(T.value=se),$===re&&(T.value=re);try{N.value=!0;const t=await J.get("get-preventive-maintenance",{params:{...f,category:T.value,...i.value,...S.value,work_type:"PM"}});if(t.data&&t.data.pm_data){const e=t.data.pm_data;O.value=e.data,le.value=e.total,de.value=e.data.map(s=>s.item_id),me.value=e.data.map(s=>s.item_id)}}catch(t){console.log(t)}N.value=!1};Y("refresh",y);const ae=n([]),F=n(!1),we=async()=>{try{F.value=!0;const t=await J.get("get_institution");if(t.data&&t.data.institutions){const e=t.data.institutions;ae.value=e.map(s=>({iName:s.name,iId:s.id}))}}catch(t){console.log(t)}finally{F.value=!1}},xe=Le(y,300),ke=t=>{f.current_page=t.current_page,f.pagesize=t.pagesize,f.sort_column=t.sort_column,f.sort_direction=t.sort_direction,t.change_type==="search"?xe():y()};return Oe(()=>{const t=localStorage.getItem("PMFilterState"),e=localStorage.getItem("filterChip");t&&(i.value=JSON.parse(t)),e&&(S.value=JSON.parse(e)),y(),we()}),(t,e)=>{const s=c("v-badge"),h=c("v-btn"),B=c("v-icon"),q=c("v-checkbox"),k=c("v-card"),V=c("v-menu"),_=c("v-col"),Ve=c("v-combobox"),Ce=c("v-spacer"),oe=c("v-row"),ne=c("v-chip"),Ie=c("download-excel");return u(),p($e,{onSearchText:ye},{filter:l(()=>[o(oe,null,{default:l(()=>[o(_,{cols:"12",sm:"4",md:"4",lg:"4"},{default:l(()=>[o(V,{modelValue:P.value,"onUpdate:modelValue":e[9]||(e[9]=a=>P.value=a),"close-on-content-click":!1,location:"bottom",transition:"slide-x-reverse-transition"},{activator:l(({props:a})=>[o(h,C({color:"primary","prepend-icon":"mdi-filter-outline",variant:"tonal",text:"Advanced filtering",class:"text-none mb-4"},a),{append:l(()=>[X.value>0?(u(),p(s,{key:0,color:"warning",content:X.value,inline:""},null,8,["content"])):g("",!0)]),_:2},1040)]),default:l(()=>[o(k,{"min-width":"350",width:d(D)<500?"350":"500","max-width":"450","min-height":"500",style:{"overflow-x":"hidden!important"}},{default:l(()=>[o(oe,null,{default:l(()=>[o(_,{cols:"12"},{default:l(()=>[o(_,{cols:"12"},{default:l(()=>[o(V,{modelValue:W.value,"onUpdate:modelValue":e[1]||(e[1]=a=>W.value=a),"close-on-content-click":!1,height:"auto",location:"bottom","min-width":"auto"},{activator:l(({props:a})=>[o(h,C({color:"primary",variant:"tonal"},a,{class:"text-none w-50 text-left"}),{default:l(()=>[i.value.filterStatus.length>0?(u(),p(s,{key:0,color:"primary",content:i.value.filterStatus.length,class:"mr-3 ml-2"},null,8,["content"])):g("",!0),m(" Status "),o(B,null,{default:l(()=>[m("mdi-chevron-down")]),_:1})]),_:2},1040)]),default:l(()=>[o(k,{width:"auto",class:"pr-3"},{default:l(()=>[(u(!0),I(E,null,z(Ye,(a,r)=>(u(),p(q,{modelValue:i.value.filterStatus,"onUpdate:modelValue":e[0]||(e[0]=b=>i.value.filterStatus=b),class:"columnChooserCheckBox",label:L(a).text,value:a,key:a},null,8,["modelValue","label","value"]))),128))]),_:1})]),_:1},8,["modelValue"]),Ge,o(V,{modelValue:K.value,"onUpdate:modelValue":e[3]||(e[3]=a=>K.value=a),"close-on-content-click":!1,"min-width":"400",width:"400",height:"auto",location:"bottom",class:"ml-3"},{activator:l(({props:a})=>[o(h,C({color:"primary",variant:"tonal"},a,{class:"text-none"}),{default:l(()=>[i.value.filterTag.length>0?(u(),p(s,{key:0,color:"primary",content:i.value.filterTag.length,class:"mr-3"},null,8,["content"])):g("",!0),m(" Tag as"),o(B,null,{default:l(()=>[m("mdi-chevron-down")]),_:1})]),_:2},1040)]),default:l(()=>[o(k,{width:"auto",class:"pr-3"},{default:l(()=>[(u(!0),I(E,null,z(ze,(a,r)=>(u(),p(q,{modelValue:i.value.filterTag,"onUpdate:modelValue":e[2]||(e[2]=b=>i.value.filterTag=b),class:"columnChooserCheckBox",label:a,value:a,key:r},null,8,["modelValue","label","value"]))),128))]),_:1})]),_:1},8,["modelValue"]),o(V,{modelValue:G.value,"onUpdate:modelValue":e[5]||(e[5]=a=>G.value=a),"close-on-content-click":!1,"min-width":"400",width:"400",height:"auto",location:"bottom",class:"ml-3"},{activator:l(({props:a})=>[o(h,C({color:"primary",variant:"tonal"},a,{class:"text-none w-100 mt-5"}),{default:l(()=>[i.value.filterStatusAfterService.length>0?(u(),p(s,{key:0,color:"primary",content:i.value.filterStatusAfterService.length,class:"mr-3"},null,8,["content"])):g("",!0),m(" Status After Service "),o(B,null,{default:l(()=>[m("mdi-chevron-down")]),_:1})]),_:2},1040)]),default:l(()=>[o(k,{width:"auto",class:"pr-3"},{default:l(()=>[(u(!0),I(E,null,z(Ee,(a,r)=>(u(),p(q,{modelValue:i.value.filterStatusAfterService,"onUpdate:modelValue":e[4]||(e[4]=b=>i.value.filterStatusAfterService=b),class:"columnChooserCheckBox",label:a,value:a,key:r},null,8,["modelValue","label","value"]))),128))]),_:1})]),_:1},8,["modelValue"]),Ke]),_:1}),o(_,{cols:"12"},{default:l(()=>[o(Ve,{loading:F.value,color:"primary",modelValue:i.value.filterInstitution,"onUpdate:modelValue":e[6]||(e[6]=a=>i.value.filterInstitution=a),label:"Institution",density:"compact",items:ae.value,chips:"","closable-chips":"","single-line":"",itemValue:"iId",variant:"outlined",itemTitle:"iName",multiple:""},null,8,["loading","modelValue","items"])]),_:1}),o(_,{cols:"12"},{default:l(()=>[o(d(Je),{modelValue:i.value.filterSchedule_at,"onUpdate:modelValue":e[7]||(e[7]=a=>i.value.filterSchedule_at=a),"auto-apply":"",range:"","model-type":"yyyy-MM-dd","enable-time-picker":!1,"month-change-on-scroll":!1,placeholder:"Schedule at"},null,8,["modelValue"])]),_:1}),o(_,{cols:"12"},{default:l(()=>[v("div",Qe,[o(Ce),o(h,{variant:"tonal",onClick:e[8]||(e[8]=a=>P.value=!1),class:"text-none rounded-0",style:{width:"50%"}},{default:l(()=>[m(" Close ")]),_:1}),o(h,{color:"primary",variant:"flat","prepend-icon":"mdi-close",onClick:pe,class:"text-none rounded-0",style:{width:"50%"}},{default:l(()=>[m(" Clear ")]),_:1})])]),_:1}),o(_,{cols:"12"})]),_:1})]),_:1})]),_:1},8,["width"])]),_:1},8,["modelValue"])]),_:1}),o(_,{cols:"12",sm:"8",md:"8",lg:"8",class:"d-flex justify-end",style:ue({"margin-top":d(D)<=595?"-20px":"","margin-bottom":d(D)<=595?"20px":""})},{default:l(()=>[d(M)("delegate","Preventive Maintenance")?(u(),p(ne,{key:0,color:"primary",variant:"text",label:"","prepend-icon":S.value.filterOptions.includes("assign-next-month")?"mdi-checkbox-marked":"mdi-checkbox-blank-outline",onClick:e[10]||(e[10]=a=>Q("assign-next-month"))},{default:l(()=>[m("Next Month Assignment")]),_:1},8,["prepend-icon"])):g("",!0),d(M)("delegate","Preventive Maintenance")?(u(),p(ne,{key:1,color:"primary",variant:"text",label:"",disabled:R.value,"prepend-icon":S.value.filterOptions.includes("not-set")?"mdi-checkbox-marked":"mdi-checkbox-blank-outline",onClick:e[11]||(e[11]=a=>Q("not-set"))},{default:l(()=>[m("Not Set")]),_:1},8,["disabled","prepend-icon"])):g("",!0),o(Ie,{data:O.value,type:"xlsx",fields:d(be),name:"PreventiveMaintenance - "+d(ce)().format("MM-DD-YYYY")},{default:l(()=>[o(h,{text:"Export","prepend-icon":"mdi-download",variant:"tonal",color:"primary",class:"text-none"})]),_:1},8,["data","fields","name"])]),_:1},8,["style"])]),_:1})]),default:l(({searchText:a})=>[o(d(je),{ref_key:"datatable",ref:H,rows:O.value,columns:d(U),loading:N.value,search:f.search,isServerMode:!0,totalRows:le.value,pageSize:f.pagesize,onChange:ke,onRowSelect:he,columnFilter:!1,sortColumn:f.sort_column,sortDirection:f.sort_direction,sortable:!0,style:{border:"1px solid #99999926","border-radius":"3px"},skin:"bh-table-compact bh-table-bordered bh-table-striped bh-table-hover",hasCheckbox:!0,selectRowOnClick:!0,onRowDBClick:Se,rowClass:ge},{id:l(r=>[m(w("PM-"+r.value.id),1)]),scheduled_at:l(r=>[v("div",null,w(d(ce)(r.value.scheduled_at).format("MMMM DD, YYYY")),1)]),service_id:l(r=>[v("span",Xe,w(Ue(r.value.service_id)),1)]),monitoring_end:l(r=>[v("span",null,w(Fe(r.value.monitoring_end)),1)]),status:l(r=>[v("span",{style:ue({color:L(r.value.status).color})},[v("b",null,w(L(r.value.status).text),1)],4),Ze,r.value.status==="Not Set"?(u(),I("span",et,"Contact the admin to configure the frequency")):g("",!0)]),_:1},8,["rows","columns","loading","search","totalRows","pageSize","sortColumn","sortDirection"])]),_:1})}}},pt=We(tt,[["__scopeId","data-v-672c6174"]]);export{pt as default};
