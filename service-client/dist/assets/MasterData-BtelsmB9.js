import{d as G,c as H,u as J,x as K,g as Q,v as Z,r as a,U as h,V as w,E as $,y as ee,f as te,w as o,o as ae,h as i,n as u,k as D,t as b,W as y,e as c,X as se}from"./index-BVXPU9zS.js";import"./maintenance-D6-EqnL4.js";import{d as oe}from"./debounce-KHlJyMIn.js";import{g as le}from"./vue3-datatable-C2ljW4qF.js";import"./vue-datepicker-B1Ef9scS.js";/* empty css             */import{L as ie}from"./LayoutWithActions-BLO8pnbP.js";import{p as ne}from"./permitted-CQa1RmFG.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./topBarUserProfile-DtdqdVcI.js";const ce={__name:"MasterData",setup(de){const{can:m}=ne(),q=G.useToast();H();const k=J(),p=K();Q().currentUserRole,Z(),a("");const z=a("ViewMasterData"),x=a(null),R=a(null);a(null),a(null);const d=a(!0),_=a(null);m("create",h)&&(x.value="CreateMasterData"),m("edit",h)&&(R.value="EditMasterData");const V=async()=>{var e;try{(e=(await p.delete("delete_master_data",{params:{id:_.value}})).data)!=null&&e.success&&(q.success("Deleted successfully"),n(),d.value=!0)}catch(t){console.log(t)}},E={selectedId:_,btnDisable:d,routeView:z,createRequest:x.value,editRequest:R.value,deleteFunction:m("delete",h)?V:null};w("data",E);const S=a([]),N=e=>{S.value=C.value.getSelectedRows(),e.length===1?d.value=!1:d.value=!0,_.value=e.map(t=>t.id)[0]},A=e=>S.value.map(l=>l.id).includes(e.id)?"highlightRow":"",T=e=>{k.push({name:"ViewMasterData",params:{id:e.id}})},B=e=>{s.search=e},C=a(null),f=a(!0),I=a(0),s=$({current_page:1,pagesize:10,sort_column:"id",sort_direction:"desc",search:""}),v=a(null),g=a([{field:"id",title:"ID",isUnique:!0,type:"number",hide:!1},{field:"name",title:"Institution",hide:!1},{field:"master_data_id",title:"Item No",hide:!1},{field:"item_code",title:"Item Code"},{field:"serial",title:"Serial No."},{field:"equipment",title:"Equipment"},{field:"description",title:"Description"},{field:"sbu",title:"SBU"},{field:"dealer_name",title:"Dealer Name"},{field:"area",title:"Area Categorization"},{field:"operation_time",title:"Operation Time"},{field:"software_version",title:"Software Version"},{field:"admission_date",title:"Admission Date"},{field:"date_installed",title:"Date Installed"},{field:"contract_due_date",title:"Contract Due Date"},{field:"region",title:"Region"},{field:"frequency",title:"Frequency"},{field:"analyzer_type",title:"Analyzer Type"},{field:"class",title:"Class"},{field:"initially_installed",title:"Initially Installed"},{field:"reason_equipment_status",title:"Reason for Equipment Status"},{field:"email",title:"Email"},{field:"status",title:"Status"},{field:"added_by",title:"Added by"}])||[],F=g.value.reduce((e,t)=>(t.title&&t.field&&(e[t.title]=t.field),e),{});w("column",g);const n=async()=>{try{f.value=!0;const e=await p.get("get_master_data",{params:{...s}});if(e.data&&e.data.md_data){const t=e.data.md_data;v.value=t.data,I.value=t.total}}catch(e){console.log(e)}f.value=!1};w("refresh",n);const U=a([]),M=a(!1),Y=async()=>{try{M.value=!0;const e=await p.get("get_institution");if(e.data&&e.data.institutions){const t=e.data.institutions;U.value=t.map(l=>({iName:l.name,iId:l.id}))}}catch(e){console.log(e)}finally{M.value=!1}},L=oe(n,300),O=e=>{s.current_page=e.current_page,s.pagesize=e.pagesize,s.sort_column=e.sort_column,s.sort_direction=e.sort_direction,e.change_type==="search"?L():n()};return ee(()=>{n(),Y()}),(e,t)=>{const l=c("v-spacer"),W=c("v-btn"),j=c("download-excel"),P=c("v-col"),X=c("v-row");return ae(),te(ie,{onSearchText:B},{default:o(()=>[i(X,null,{default:o(()=>[i(l),i(P,{cols:"4",class:"d-flex justify-content-end"},{default:o(()=>[i(j,{data:v.value,type:"xlsx",fields:u(F),name:"ServiceMasterData - "+u(se)().format("MM-DD-YYYY")},{default:o(()=>[i(W,{text:"Export","prepend-icon":"mdi-download",variant:"tonal",color:"primary",class:"text-none mb-5"})]),_:1},8,["data","fields","name"])]),_:1})]),_:1}),i(u(le),{ref_key:"datatable",ref:C,rows:v.value,columns:u(g),loading:f.value,search:s.search,isServerMode:!0,totalRows:I.value,pageSize:s.pagesize,onChange:O,onRowSelect:N,columnFilter:!1,sortColumn:s.sort_column,sortDirection:s.sort_direction,sortable:!0,style:{border:"1px solid #99999926","border-radius":"3px"},skin:"bh-table-compact bh-table-bordered bh-table-striped bh-table-hover",hasCheckbox:!0,selectRowOnClick:!0,onRowDBClick:T,rowClass:A},{admission_date:o(r=>[D("span",null,b(y(r.value.admission_date)),1)]),date_installed:o(r=>[D("span",null,b(y(r.value.date_installed)),1)]),contract_due_date:o(r=>[D("span",null,b(y(r.value.contract_due_date)),1)]),_:1},8,["rows","columns","loading","search","totalRows","pageSize","sortColumn","sortDirection"])]),_:1})}}},ye=re(ce,[["__scopeId","data-v-6335ce07"]]);export{ye as default};
