import{s as be,r as s,d as ge,c as we,v as he,D as Ve,x as Se,f as xe,w as l,o as Ee,h as e,j as u,E as ee,i as le,m as S,t as x,e as n}from"./index-C8ph-EQq.js";import{B as qe}from"./BaseLayout-De698axt.js";import{p as te}from"./maintenance-sOfZEb8F.js";import{d as Ce}from"./debounce-VX6vs7ks.js";import{g as ae}from"./vue3-datatable-BuM4cnvr.js";/* empty css              */import"./topBarUserProfile-ExGO6QtX.js";import"./logout-D7B5usQQ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const je={__name:"PMSettings",setup(Re){be();const _=s(null),B=ge.useToast();we().getUserData;const y=he(),P=s(null),T=s(null),v=s(!1),b=s(!1),E=s(!1),q=s(!1),j=s(!1),A=s(!1),p=s(!1),C=s(!1);s(!1),s(!1);const oe=s(!1);s(!1);const R=s(""),D=s(""),g=s(""),w=s(""),U=s(""),h=s(""),V=s({frequency:[a=>!!a||"Required field"],frequencyEdit:[a=>!!a||"Required field"],idEdit:[a=>!!a||"Required field"]}),k=s(!1),I=s(!1),N=s(0),i=Ve({current_page:1,pagesize:10,sortDirection:"desc",search:""}),O=s(null),$=s(null),L=s([{field:"id",title:"",isUnique:!0,type:"number",hide:!0},{field:"item_code",title:"Item Code"},{field:"description",title:"Description",hide:!1}])||[],se=L.value.map(a=>a.field),ne=s([{field:"id",title:"",isUnique:!0,type:"number",hide:!0},{field:"item_code",title:"Item Code"},{field:"description",title:"Description",hide:!0},{field:"schedule",title:"Schedule",hide:!1}])||[],ue=s(""),z=async()=>{k.value=!0;try{const a=await y.get("master-data-equipments",{params:{...i,item_category:ue.value,searchColumn:se}});if(a.data&&a.data.equipments){const t=a.data.equipments;O.value=t.data,N.value=t.total,k.value=!1}}catch(a){alert(a)}},ie=Ce(z,300),de=a=>{i.current_page=a.current_page,i.pagesize=a.pagesize,i.search=a.search,a.change_type==="search"?ie():z()},M=async()=>{I.value=!0;try{const a=await y.get("get-pm-sched");a.data&&a.data.equipments_set_sched&&($.value=a.data.equipments_set_sched,I.value=!1)}catch(a){alert(a)}},G=s([]),re=a=>{G.value=P.value.getSelectedRows(),a&&a.length===1?(E.value=!1,D.value=a[0].item_code,g.value=a[0].id):E.value=!0},ce=a=>G.value.map(r=>r.id).includes(a.id)?"highlightRow":"",H=s([]),me=a=>{H.value=T.value.getSelectedRows(),a&&a.length===1?(q.value=!1,U.value=a[0].item_code,h.value=a[0].id,w.value=a[0].schedule):q.value=!0},fe=a=>H.value.map(r=>r.id).includes(a.id)?"highlightRow":"",ve=async()=>{p.value=!0;const{valid:a}=await j.value.validate();if(!a){p.value=!1;return}try{const t=await y.post("save-pm-sched",{equipmentId:g.value,frequency:R.value});t.data&&t.data.success&&(B.success("Successfully Set"),v.value=!1,M()),t.data&&t.data.set&&(oe.value=!0,v.value=!1)}catch(t){alert(t)}finally{p.value=!1}},pe=async()=>{C.value=!0;const{valid:a}=await A.value.validate();if(!a){C.value=!1;return}try{const t=await y.put("edit-pm-sched",{id:h.value,frequency:w.value});t.data&&t.data.success&&(B.success("Edited uccessfully"),b.value=!1,M())}catch(t){alert(t)}finally{C.value=!1}};return Se(()=>{z(),M()}),(a,t)=>{const r=n("v-icon"),J=n("v-tab"),K=n("v-tabs"),m=n("v-btn"),Q=n("v-select"),f=n("v-text-field"),d=n("v-col"),c=n("v-row"),W=n("v-divider"),X=n("v-form"),F=n("v-card"),Y=n("v-dialog"),Z=n("v-window-item"),_e=n("v-window"),ye=n("v-card-text");return Ee(),xe(qe,null,{default:l(()=>[e(F,{class:"p-4"},{default:l(()=>[e(K,{modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=o=>_.value=o),density:"compact",class:"border-b-sm","bg-color":"grey-lighten-5"},{default:l(()=>[e(J,{value:"set",class:"text-none",color:"primary"},{default:l(()=>[e(r,{class:"mr-2"},{default:l(()=>[u("mdi-set-split")]),_:1}),u(" Set Frequency")]),_:1}),e(J,{value:"edit",class:"text-none",color:"primary"},{default:l(()=>[e(r,{class:"mr-2"},{default:l(()=>[u("mdi-archive-edit-outline")]),_:1}),u(" Edit Frequency")]),_:1})]),_:1},8,["modelValue"]),e(ye,null,{default:l(()=>[e(_e,{modelValue:_.value,"onUpdate:modelValue":t[13]||(t[13]=o=>_.value=o),disabled:!0},{default:l(()=>[e(Z,{value:"set"},{default:l(()=>[e(c,null,{default:l(()=>[e(d,{cols:"4",xl:"8",md:"8",sm:"8",style:{"text-align":"left"}},{default:l(()=>[e(Y,{modelValue:v.value,"onUpdate:modelValue":t[5]||(t[5]=o=>v.value=o),"max-width":"400",persistent:""},{activator:l(({props:o})=>[e(m,ee({disabled:E.value},o,{color:"primary",variant:"tonal",class:"text-none mr-2"}),{default:l(()=>[e(r,{class:"mr-2"},{default:l(()=>[u("mdi-calendar-arrow-right")]),_:1}),u(" Set")]),_:2},1040,["disabled"])]),default:l(()=>[e(F,{text:"",title:"Set PM Frequency"},{default:l(()=>[e(d,{cols:"12",class:"fix-item"},{default:l(()=>[e(X,{onSubmit:le(ve,["prevent"]),ref_key:"form",ref:j},{default:l(()=>[e(Q,{modelValue:R.value,"onUpdate:modelValue":t[1]||(t[1]=o=>R.value=o),rules:V.value.frequency,color:"primary",clearable:"",label:"Schedule",variant:"outlined",density:"compact",items:te},null,8,["modelValue","rules","items"]),e(c,null,{default:l(()=>[e(d,{cols:"8"},{default:l(()=>[e(f,{variant:"filled",placeholder:"Item Code",density:"compact",readonly:"",modelValue:D.value,"onUpdate:modelValue":t[2]||(t[2]=o=>D.value=o),color:"primary"},null,8,["modelValue"])]),_:1}),e(d,{cols:"4"},{default:l(()=>[e(f,{variant:"filled",placeholder:"Equipment #",density:"compact",rules:V.value.id,readonly:"",modelValue:g.value,"onUpdate:modelValue":t[3]||(t[3]=o=>g.value=o),color:"primary"},null,8,["rules","modelValue"])]),_:1})]),_:1}),e(W),e(c,{justify:"end",class:"p-3"},{default:l(()=>[e(m,{elevation:"0",onClick:t[4]||(t[4]=o=>v.value=!1),class:"text-none mr-2"},{default:l(()=>[u(" Cancel")]),_:1}),e(m,{type:"submit",color:"primary",title:"Submit",class:"text-none",loading:p.value},{default:l(()=>[u(" Save")]),_:1},8,["loading"])]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(d,{cols:"8",xl:"4",md:"4",sm:"4"},{default:l(()=>[e(f,{color:"primary",modelValue:i.search,"onUpdate:modelValue":t[6]||(t[6]=o=>i.search=o),clearable:"",density:"compact",label:"Search all fields",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),e(c,null,{default:l(()=>[e(d,{cols:"12"},{default:l(()=>[e(S(ae),{ref_key:"dataTable",ref:P,rows:O.value,columns:S(L),loading:k.value,search:i.search,isServerMode:!0,totalRows:N.value,pageSize:i.pagesize,hasCheckbox:!0,selectRowOnClick:!0,sortable:!0,skin:"bh-table-compact bh-table-bordered",class:"set_approver_tables",onRowSelect:re,rowClass:ce,onChange:de},{first_name:l(o=>[u(x(o.value.first_name)+" "+x(o.value.last_name),1)]),_:1},8,["rows","columns","loading","search","totalRows","pageSize"])]),_:1})]),_:1})]),_:1}),e(Z,{value:"edit"},{default:l(()=>[e(c,null,{default:l(()=>[e(d,{cols:"4",xl:"8",md:"8",sm:"8",style:{"text-align":"left"}},{default:l(()=>[e(Y,{modelValue:b.value,"onUpdate:modelValue":t[11]||(t[11]=o=>b.value=o),"max-width":"400",persistent:""},{activator:l(({props:o})=>[e(m,ee({disabled:q.value},o,{color:"primary",variant:"tonal",class:"text-none mr-2"}),{default:l(()=>[e(r,{class:"mr-2"},{default:l(()=>[u("mdi-file-edit")]),_:1}),u(" Edit")]),_:2},1040,["disabled"])]),default:l(()=>[e(F,{text:"",title:"Set PM Frequency"},{default:l(()=>[e(d,{cols:"12",class:"fix-item"},{default:l(()=>[e(X,{onSubmit:le(pe,["prevent"]),ref_key:"formEdit",ref:A},{default:l(()=>[e(Q,{modelValue:w.value,"onUpdate:modelValue":t[7]||(t[7]=o=>w.value=o),rules:V.value.frequencyEdit,color:"primary",clearable:"",label:"Schedule",variant:"outlined",density:"compact",items:te},null,8,["modelValue","rules","items"]),e(c,{class:"mt-3"},{default:l(()=>[e(d,{cols:"8"},{default:l(()=>[e(f,{variant:"filled",placeholder:"Item Code",density:"compact",readonly:"",modelValue:U.value,"onUpdate:modelValue":t[8]||(t[8]=o=>U.value=o),color:"primary"},null,8,["modelValue"])]),_:1}),e(d,{cols:"4"},{default:l(()=>[e(f,{variant:"filled",placeholder:"Equipment #",density:"compact",rules:V.value.idEdit,readonly:"",modelValue:h.value,"onUpdate:modelValue":t[9]||(t[9]=o=>h.value=o),color:"primary"},null,8,["rules","modelValue"])]),_:1})]),_:1}),e(W),e(c,{justify:"end",class:"p-3"},{default:l(()=>[e(m,{elevation:"0",onClick:t[10]||(t[10]=o=>b.value=!1),class:"text-none mr-2"},{default:l(()=>[u(" Cancel")]),_:1}),e(m,{type:"submit",color:"primary",title:"Submit",class:"text-none",loading:p.value},{default:l(()=>[u(" Save")]),_:1},8,["loading"])]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(d,{cols:"8",xl:"4",md:"4",sm:"4"},{default:l(()=>[e(f,{color:"primary",modelValue:i.searchEdit,"onUpdate:modelValue":t[12]||(t[12]=o=>i.searchEdit=o),clearable:"",density:"compact",label:"Search all fields",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),e(c,null,{default:l(()=>[e(d,{cols:"12"},{default:l(()=>[e(S(ae),{ref_key:"datatable",ref:T,rows:$.value,columns:S(ne),loading:I.value,search:i.searchEdit,hasCheckbox:!0,sortDirection:i.sortDirection,selectRowOnClick:!0,sortable:!0,skin:"bh-table-compact bh-table-bordered",class:"set_approver_tables",onRowSelect:me,rowClass:fe},{first_name:l(o=>[u(x(o.value.first_name)+" "+x(o.value.last_name),1)]),_:1},8,["rows","columns","loading","search","sortDirection"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(K)]),_:1})}}};export{je as default};
