import{s as $e,c as Ae,v as qe,r as o,A as Be,x as De,e as p,o as a,f as z,w as s,h as t,H as b,L as Oe,M as We,k as e,n as l,F as q,y as C,a5 as _e,a4 as I,t as n,a6 as ue,a7 as ce,a8 as K,j as f,a9 as de,aa as ct,N as ye,ab as re,ac as se,ad as X,ae as _t,af as ae,ag as le,ah as ne,ai as oe,$ as we,a0 as Re,Y as mt,d as vt,g as pt,u as ft,aj as yt,P as xt,m as Y,E as Ve,i as je,I as ht,G as gt}from"./index-C8ph-EQq.js";import{L as bt}from"./LayoutSinglePage-CszXxlTG.js";import{_ as Fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{R as kt,_ as It}from"./RequestDetails-C6D_ZG6o.js";import{p as St}from"./permitted-BzPEUTiR.js";import"./topBarUserProfile-ExGO6QtX.js";import"./logout-D7B5usQQ.js";const Ee=v=>(Oe("data-v-eeb900dc"),v=v(),We(),v),Vt=Ee(()=>e("h5",{class:"mb-1",style:{"font-weight":"700",color:"#191970"}},"Other Request Details",-1)),wt=Ee(()=>e("h5",{class:"mb-2",style:{"font-weight":"700",color:"#191970"}},"External Request",-1)),Rt=Ee(()=>e("h5",{class:"mb-2",style:{"font-weight":"700",color:"#191970"}},"Internal Request",-1)),At={__name:"RequestType",props:{service_id:{type:Number}},setup(v){const{width:S}=$e();Ae();const me=qe(),ie=o(!1),P=o(""),H=o(!1),Z=o(!1),J=o(!1),k=o(null),N=o(""),U=o(null),j=o(null),W=o(""),G=v,T=o(6);Be(S,w=>{w<550?T.value=12:T.value=6});const d=async()=>{try{ie.value=!0;const w=await me.get("get-specific-equipment-handling",{params:{service_id:G.service_id}});if(w.data&&w.data.equipment_handling){const V=w.data.equipment_handling[0];H.value=V.occular===1,Z.value=V.bypass===1,J.value=V.ship===1,W.value=V.endorsement??".",k.value=V.request_type.toString(),N.value=V.other,U.value=V.attach_gate===1,j.value=V.with_contract===1,P.value=V.main_status}else alert("Something went wrong")}catch(w){console.log(w)}finally{ie.value=!1}},D=()=>{T.value=S.value<550?12:6};return De(()=>{d(),D()}),(w,y)=>{const V=p("v-skeleton-loader"),M=p("v-checkbox"),$=p("v-col"),E=p("v-textarea"),B=p("v-row"),L=p("v-divider"),R=p("v-radio"),x=p("v-radio-group"),A=p("v-text-field"),m=p("v-card");return ie.value?(a(),z(V,{key:0,type:"list-item, list-item, button, table-row, table-tbody",class:"mb-2"})):(a(),z(m,{key:1,style:{padding:"1em 1em"},elevation:"1"},{default:s(()=>[t(B,null,{default:s(()=>[t($,{cols:T.value},{default:s(()=>[Vt,t(M,{modelValue:H.value,"onUpdate:modelValue":y[0]||(y[0]=i=>H.value=i),color:"primary",label:"Request for Ocular",class:"vCheckbox",readonly:""},null,8,["modelValue"]),t(M,{modelValue:Z.value,"onUpdate:modelValue":y[1]||(y[1]=i=>Z.value=i),color:"primary",label:"Bypass Internal Servicing Procedures",class:"vCheckbox",readonly:""},null,8,["modelValue"]),t(M,{modelValue:J.value,"onUpdate:modelValue":y[2]||(y[2]=i=>J.value=i),color:"primary",label:"Ship & Deliver direct to customer immediately",class:"vCheckbox",readonly:""},null,8,["modelValue"])]),_:1},8,["cols"]),t($,{cols:T.value},{default:s(()=>[t(E,{color:"primary",label:"Endorsement",modelValue:W.value,"onUpdate:modelValue":y[3]||(y[3]=i=>W.value=i),"row-height":"25",rows:"3",variant:"outlined",readonly:"","auto-grow":"",shaped:""},null,8,["modelValue"])]),_:1},8,["cols"])]),_:1}),t(L,{class:"mb-3"}),t(B,{class:"mt-3"},{default:s(()=>[t($,{cols:"12",md:"6",sm:"6"},{default:s(()=>[wt,t(B,null,{default:s(()=>[t($,{cols:"12",md:"6",sm:"6"},{default:s(()=>[t(x,{modelValue:k.value,"onUpdate:modelValue":y[4]||(y[4]=i=>k.value=i),column:"",readonly:""},{default:s(()=>[t(R,{color:"primary",label:"For Demonstration",value:"1"}),t(R,{color:"primary",label:"Reagent Tie-up",value:"2"}),t(R,{color:"primary",label:"Purchased",value:"3"}),t(R,{color:"primary",label:"Shipment / Delivery",value:"4"}),t(R,{color:"primary",label:"Service Unit",value:"5"}),t(R,{color:"primary",label:"Others",value:"6"})]),_:1},8,["modelValue"])]),_:1}),t($,{cols:"12",md:"6",sm:"6"},{default:s(()=>[t(M,{modelValue:U.value,"onUpdate:modelValue":y[5]||(y[5]=i=>U.value=i),class:"vCheckbox",color:"primary",label:"Attached gate/entry pass",readonly:""},null,8,["modelValue"]),t(M,{modelValue:j.value,"onUpdate:modelValue":y[6]||(y[6]=i=>j.value=i),class:"vCheckbox mt-3",color:"primary",label:"with contract/other docs",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),t(B,null,{default:s(()=>[k.value==="6"?(a(),z(A,{key:0,readonly:"",color:"primary",density:"compact",variant:"outlined",placeholder:"Other External Request",modelValue:N.value,"onUpdate:modelValue":y[7]||(y[7]=i=>N.value=i),class:"ml-5"},null,8,["modelValue"])):b("",!0)]),_:1})]),_:1}),t($,{cols:"12",md:"6",sm:"6"},{default:s(()=>[Rt,t(x,{modelValue:k.value,"onUpdate:modelValue":y[8]||(y[8]=i=>k.value=i),column:"",readonly:""},{default:s(()=>[t(R,{color:"primary",label:"For Corrective",value:"7"}),t(R,{color:"primary",label:"For Refurbishment",value:"8"}),t(R,{color:"primary",label:"For Quality Control",value:"9"}),t(R,{color:"primary",label:"Training Purposes",value:"10"}),t(R,{color:"primary",label:"For Disposal",value:"11"}),t(R,{color:"primary",label:"Other",value:"12"})]),_:1},8,["modelValue"]),k.value==="12"?(a(),z(A,{key:0,readonly:"",density:"compact",variant:"outlined",placeholder:"Other External Request","w-90":"",modelValue:N.value,"onUpdate:modelValue":y[9]||(y[9]=i=>N.value=i)},null,8,["modelValue"])):b("",!0)]),_:1})]),_:1})]),_:1}))}}},qt=Fe(At,[["__scopeId","data-v-eeb900dc"]]),Dt={class:"d-flex justify-space-between"},Et=e("strong",null,"IT Department",-1),Ut={key:0},Tt={key:0,class:"d-flex flex-column text-right timeRemarks"},Ct={class:"me-4 text-disabled"},Nt={key:1},Mt=e("span",{class:"me-4 text-disabled"},"00-00-00 00-00 00 0",-1),Lt=[Mt],zt={class:"d-flex justify-space-between"},Pt=e("strong",null,"APM/NSM/SM",-1),jt={key:0},$t={key:0,class:"d-flex flex-column text-right timeRemarks"},Bt={class:"me-4 text-disabled"},Ot={key:1},Wt=e("span",{class:"me-4 text-disabled"},"00-00-00 00-00 00 0",-1),Ft=[Wt],Ht={class:"d-flex justify-space-between"},Gt=e("strong",null,"Warehouse & Inventory Management",-1),Qt={key:0},Yt={key:0,class:"d-flex flex-column text-right timeRemarks"},Zt={class:"me-4 text-disabled"},Jt={key:1},Kt=e("span",{class:"me-4 text-disabled"},"00-00-00 00-00 00 0",-1),Xt=[Kt],es={class:"d-flex justify-space-between"},ts=e("strong",null,"Service Dept Team Leader",-1),ss={key:0},as={key:0,class:"d-flex flex-column text-right timeRemarks"},ls={class:"me-4 text-disabled"},ns={key:1},os=e("span",{class:"me-4 text-disabled"},"00-00-00 00-00 00 0",-1),rs=[os],ds={class:"d-flex justify-space-between"},is={class:"mt-5"},us=e("br",null,null,-1),cs={class:"text-success"},_s={class:"me-4 text-disabled text-right"},ms=e("br",null,null,-1),vs={key:0,class:"small text-disabled"},ps={key:1,class:"small text-disabled"},fs={key:0,class:"small text-grey"},ys={class:"d-flex justify-space-between"},xs=e("strong",null,"Service Dept Head / Service Engineer",-1),hs={key:0},gs={key:0,class:"d-flex flex-column text-right timeRemarks"},bs={class:"me-4 text-disabled"},ks={key:1},Is=e("span",{class:"me-4 text-disabled"},"00-00-00 00-00 00 0",-1),Ss=[Is],Vs={class:"d-flex justify-space-between"},ws=e("strong",null,"Billing & Invoicing Staff / WIM Personnel",-1),Rs={key:0},As={key:0,class:"d-flex flex-column text-right timeRemarks"},qs={class:"me-4 text-disabled"},Ds={key:1},Es=e("span",{class:"me-4 text-disabled"},"00-00-00 00-00 00 0",-1),Us=[Es],Ts={class:"d-flex justify-space-between"},Cs=e("strong",null,"Outbound",-1),Ns={key:0},Ms={key:0,class:"d-flex flex-column text-right timeRemarks"},Ls={class:"me-4 text-disabled"},zs={key:1},Ps=e("span",{class:"me-4 text-disabled"},"00-00-00 00-00 00 0",-1),js=[Ps],$s={class:"d-flex justify-space-between"},Bs={class:"mt-5"},Os={class:"text-dark"},Ws={class:"small text-grey"},Fs={class:"d-flex justify-space-between"},Hs=e("strong",null,"Area Warehouse & Inventory Management",-1),Gs={key:0},Qs={key:0,class:"d-flex flex-column text-right timeRemarks"},Ys={class:"me-4 text-disabled"},Zs={key:1},Js=e("span",{class:"me-4 text-disabled"},"00-00-00 00-00 00 0",-1),Ks=[Js],Xs={class:"d-flex justify-space-between"},ea=e("strong",null,"Area RSM/APM/NSM/SM",-1),ta={key:0},sa={key:0,class:"d-flex flex-column text-right timeRemarks"},aa={class:"me-4 text-disabled"},la={key:1},na=e("span",{class:"me-4 text-disabled"},"00-00-00 00-00 00 0",-1),oa=[na],ra={class:"d-flex justify-space-between"},da=e("strong",null,"Area Service TL & Service Engineer",-1),ia={key:0},ua={key:0,class:"d-flex flex-column text-right timeRemarks"},ca={class:"me-4 text-disabled"},_a={key:1},ma=e("span",{class:"me-4 text-disabled"},"00-00-00 00-00 00 0",-1),va=[ma],pa={class:"d-flex justify-space-between"},fa=e("strong",null,"Area Billing and Invoicing Staff",-1),ya={key:0},xa={key:0,class:"d-flex flex-column text-right timeRemarks"},ha={class:"me-4 text-disabled"},ga={key:1},ba=e("span",{class:"me-4 text-disabled"},"00-00-00 00-00 00 0",-1),ka=[ba],Ia={class:"d-flex justify-space-between"},Sa={key:0},Va={key:1},wa=e("i",{class:"small"}," (Delegate installation)",-1),Ra={class:"text-caption"},Aa={class:"text-success"},qa={key:0,class:"d-flex flex-column text-right timeRemarks"},Da={class:"me-4 text-disabled"},Ea={key:1},Ua=e("span",{class:"me-4 text-disabled"},"00-00-00 00-00 00 0",-1),Ta=[Ua],Ca={class:"d-flex justify-space-between"},Na=e("strong",null,[f("Completed "),e("i",null,"(Installed)")],-1),Ma={class:"text-caption"},La={class:"text-primary"},za={key:0},Pa={key:0,class:"d-flex flex-column text-right timeRemarks"},ja={class:"me-4 text-disabled"},$a={key:1},Ba=e("span",{class:"me-4 text-disabled"},"00-00-00 00-00 00 0",-1),Oa=[Ba],Wa={__name:"ApproverHistoryLog",props:{status:{type:Number,default:()=>0},service_id:{type:Number}},setup(v){const S=o([]),me=o([]);Ae().getUserData;const P=qe(),H=o(""),Z=o(""),J=o(""),k=o(""),N=o(""),U=o(""),j=o(""),W=o(""),G=o(""),T=v,d=x=>{const m=me.value.filter(i=>i.level===x).reduce((i,O)=>{const ee=new Date(i==null?void 0:i.created_at),F=new Date(O.created_at);return O?i?F>ee?O:i:O:i},null);return m?{date:ye(m.created_at),remarks:m.remarks,userId:m.user_id,checkIfApproved:m.status===parseInt(mt)}:{date:"",remarks:"",userId:"",checkIfApproved:!1}},D=async()=>{try{const A=(await P.get("get-approver")).data.users;S.value=A}catch(x){alert(x)}},w=async()=>{try{const A=(await P.get("get-approval-history",{params:{service_id:T.service_id}})).data.approval_history;me.value=A}catch(x){alert(x)}},y=o(null),V=o(null),M=o(""),$=async()=>{try{const x=await P.get("get-specific-equipment-handling",{params:{service_id:T.service_id}});if(x.data&&x.data.equipment_handling){const m=x.data.equipment_handling[0];H.value=m.tl_assigned,Z.value=m.assigned_tl_fname,J.value=m.assigned_tl_lname,k.value=m.assigned_date,N.value=m.installer,j.value=m.fname,W.value=m.lname,U.value=m.date_installed,V.value=m.final_installation_date,M.value=m.driver,G.value=m.ssu,y.value=m.area}else alert("Something went wrong")}catch(x){console.log(x)}},E=o(null),B=o(null),L=o(null),R=async()=>{try{const x=await P.get("getInternalRequest",{params:{service_id:T.service_id,category:"specificService"}});if(x.data&&x.data.request&&x.data.request.length>0){const A=x.data.request;E.value=A.map(i=>i.status)[0],B.value=A.map(i=>i.updated_at)[0];const m=A.map(i=>({fname:i.get_user.first_name,lname:i.get_user.last_name}))[0];L.value=m.fname+" "+m.lname}}catch(x){alert(x)}};return De(()=>{D(),w(),$(),R()}),(x,A)=>{const m=p("v-timeline-item"),i=p("v-col"),O=p("v-row"),ee=p("v-timeline"),F=p("v-card");return a(),z(F,{class:"mt-5",elevation:"0"},{default:s(()=>[t(ee,{density:"compact",align:"start",side:"end","line-thickness":"1"},{default:s(()=>[t(m,{"dot-color":v.status>0?"#555":"#d3d3d3",size:"extra-small"},{default:s(()=>[e("div",Dt,[e("div",null,[Et,(a(!0),l(q,null,C(S.value,(r,h)=>(a(),l("div",{class:"text-caption",key:h},[r.approval_level===_e?(a(),l("span",Ut,[e("span",{class:I([d(_e).userId===r.user_id?"text-success":"text-black"])},n(r.first_name)+" "+n(r.last_name),3)])):b("",!0)]))),128))]),v.status>0?(a(),l("span",Tt,[e("span",Ct,n(d(_e).date),1),e("span",{class:I(["me-4",d(_e).checkIfApproved?"text-danger":"text-primary"])},n(d(_e).remarks),3)])):(a(),l("span",Nt,Lt))])]),_:1},8,["dot-color"]),t(m,{"dot-color":v.status>2?"#555":"#d3d3d3",size:"extra-small"},{default:s(()=>[e("div",zt,[e("div",null,[Pt,(a(!0),l(q,null,C(S.value,(r,h)=>(a(),l("div",{class:"text-caption",key:h},[r.approval_level===ue?(a(),l("span",jt,[e("span",{class:I([d(ue).userId===r.user_id?"text-success":"text-black"])},n(r.first_name)+" "+n(r.last_name),3)])):b("",!0)]))),128))]),v.status>ue?(a(),l("span",$t,[e("span",Bt,n(d(ue).date),1),e("span",{class:I(["me-4",d(ue).checkIfApproved?"text-danger":"text-primary"])},n(d(ue).remarks),3)])):(a(),l("span",Ot,Ft))])]),_:1},8,["dot-color"]),t(m,{"dot-color":v.status>ce?"#555":"#d3d3d3",size:"extra-small"},{default:s(()=>[e("div",Ht,[e("div",null,[Gt,(a(!0),l(q,null,C(S.value,(r,h)=>(a(),l("div",{class:"text-caption",key:h},[r.approval_level===ce?(a(),l("span",Qt,[e("span",{class:I([d(ce).userId===r.user_id?"text-success":"text-black"])},n(r.first_name)+" "+n(r.last_name),3)])):b("",!0)]))),128))]),v.status>3?(a(),l("span",Yt,[e("span",Zt,n(d(ce).date),1),e("span",{class:I(["me-4",d(ce).checkIfApproved?"text-danger":"text-primary"])},n(d(ce).remarks),3)])):(a(),l("span",Jt,Xt))])]),_:1},8,["dot-color"]),t(m,{"dot-color":v.status>K?"#555":"#d3d3d3",size:"extra-small"},{default:s(()=>[e("div",es,[e("div",null,[ts,(a(!0),l(q,null,C(S.value,(r,h)=>(a(),l("div",{class:"text-caption",key:h},[r.approval_level===K?(a(),l("span",ss,[e("span",{class:I([d(K).userId===r.user_id?"text-success":"text-black"])},n(r.first_name)+" "+n(r.last_name),3)])):b("",!0)]))),128))]),v.status>K?(a(),l("span",as,[e("span",ls,n(d(K).date),1),e("span",{class:I(["me-4",d(K).checkIfApproved?"text-danger":"text-primary"])},n(d(K).remarks),3)])):(a(),l("span",ns,rs))]),E.value?(a(),z(O,{key:0},{default:s(()=>[t(i,{cols:"12"},{default:s(()=>[e("div",ds,[e("div",is,[f(" Internal Status : "),us,e("span",cs,n(E.value===de.Delegated?"Waiting for Acceptance":ct(E.value).text),1)]),e("div",_s,[f(n(ye(B.value)),1),ms,E.value===de.ConfirmedByWIM?(a(),l("span",vs,[f("Task completed by ["),e("b",null,n(L.value),1),f("]")])):(a(),l("span",ps,[f("Task assigned to ["),e("b",null,n(L.value),1),f("]")]))])]),E.value===de.ConfirmedByWIM?(a(),l("span",fs,"Internal Process Completed")):b("",!0)]),_:1})]),_:1})):b("",!0)]),_:1},8,["dot-color"]),t(m,{"dot-color":v.status>re?"#555":"#d3d3d3",size:"extra-small"},{default:s(()=>[e("div",ys,[e("div",null,[xs,(a(!0),l(q,null,C(S.value,(r,h)=>(a(),l("div",{class:"text-caption",key:h},[r.approval_level===re?(a(),l("span",hs,[e("span",{class:I([d(re).userId===r.user_id?"text-success":"text-black"])},n(r.first_name)+" "+n(r.last_name),3)])):b("",!0)]))),128))]),v.status>5?(a(),l("span",gs,[e("span",bs,n(d(re).date),1),e("span",{class:I(["me-4",d(re).checkIfApproved?"text-danger":"text-primary"])},n(d(re).remarks),3)])):(a(),l("span",ks,Ss))])]),_:1},8,["dot-color"]),t(m,{"dot-color":v.status>se?"#555":"#d3d3d3",size:"extra-small"},{default:s(()=>[e("div",Vs,[e("div",null,[ws,(a(!0),l(q,null,C(S.value,(r,h)=>(a(),l("div",{class:"text-caption",key:h},[r.approval_level===se?(a(),l("span",Rs,[e("span",{class:I([d(se).userId===r.user_id?"text-success":"text-black"])},n(r.first_name)+" "+n(r.last_name),3)])):b("",!0)]))),128))]),v.status>se?(a(),l("span",As,[e("span",qs,n(d(se).date),1),e("span",{class:I(["me-4",d(se).checkIfApproved?"text-danger":"text-primary"])},n(d(se).remarks),3)])):(a(),l("span",Ds,Us))])]),_:1},8,["dot-color"]),t(m,{"dot-color":v.status>X?"#555":"#d3d3d3",size:"extra-small"},{default:s(()=>[e("div",Ts,[e("div",null,[Cs,(a(!0),l(q,null,C(S.value,(r,h)=>(a(),l("div",{class:"text-caption",key:h},[r.approval_level===X?(a(),l("span",Ns,[e("span",{class:I([d(X).userId===r.user_id?"text-success":"text-black"])},n(r.first_name)+" "+n(r.last_name),3)])):b("",!0)]))),128))]),v.status>X?(a(),l("span",Ms,[e("span",Ls,n(d(X).date),1),e("span",{class:I(["me-4",d(X).checkIfApproved?"text-danger":"text-primary"])},n(d(X).remarks),3)])):(a(),l("span",zs,js))]),V.value?(a(),z(O,{key:0},{default:s(()=>[t(i,{cols:"12"},{default:s(()=>[e("div",$s,[e("div",Bs,[f(" Final Installation Date : "),e("span",Os,n(_t(V.value)),1)])]),e("span",Ws,"Driver : "+n(M.value),1)]),_:1})]),_:1})):b("",!0)]),_:1},8,["dot-color"]),y.value!=="luzon"&&y.value!=="LUZON"&&y.value!=="Luzon"?(a(),l(q,{key:0},[t(m,{"dot-color":v.status>ae?"#555":"#d3d3d3",size:"extra-small"},{default:s(()=>[e("div",Fs,[e("div",null,[Hs,(a(!0),l(q,null,C(S.value,(r,h)=>(a(),l("div",{class:"text-caption",key:h},[r.approval_level===ae?(a(),l("span",Gs,[e("span",{class:I([d(ae).userId===r.user_id?"text-success":"text-black"])},n(r.first_name)+" "+n(r.last_name),3)])):b("",!0)]))),128))]),v.status>ae?(a(),l("span",Qs,[e("span",Ys,n(d(ae).date),1),e("span",{class:I(["me-4",d(ae).checkIfApproved?"text-danger":"text-primary"])},n(d(ae).remarks),3)])):(a(),l("span",Zs,Ks))])]),_:1},8,["dot-color"]),t(m,{"dot-color":v.status>le?"#555":"#d3d3d3",size:"extra-small"},{default:s(()=>[e("div",Xs,[e("div",null,[ea,(a(!0),l(q,null,C(S.value,(r,h)=>(a(),l("div",{class:"text-caption",key:h},[r.approval_level===le?(a(),l("span",ta,[e("span",{class:I([d(le).userId===r.user_id?"text-success":"text-black"])},n(r.first_name)+" "+n(r.last_name),3)])):b("",!0)]))),128))]),v.status>le?(a(),l("span",sa,[e("span",aa,n(d(le).date),1),e("span",{class:I(["me-4",d(le).checkIfApproved?"text-danger":"text-primary"])},n(d(le).remarks),3)])):(a(),l("span",la,oa))])]),_:1},8,["dot-color"]),t(m,{"dot-color":v.status>ne?"#555":"#d3d3d3",size:"extra-small"},{default:s(()=>[e("div",ra,[e("div",null,[da,(a(!0),l(q,null,C(S.value,(r,h)=>(a(),l("div",{class:"text-caption",key:h},[r.approval_level===ne?(a(),l("span",ia,[e("span",{class:I([d(ne).userId===r.user_id?"text-success":"text-black"])},n(r.first_name)+" "+n(r.last_name),3)])):b("",!0)]))),128))]),v.status>ne?(a(),l("span",ua,[e("span",ca,n(d(ne).date),1),e("span",{class:I(["me-4",d(ne).checkIfApproved?"text-danger":"text-primary"])},n(d(ne).remarks),3)])):(a(),l("span",_a,va))])]),_:1},8,["dot-color"]),t(m,{"dot-color":v.status>oe?"#555":"#d3d3d3",size:"extra-small"},{default:s(()=>[e("div",pa,[e("div",null,[fa,(a(!0),l(q,null,C(S.value,(r,h)=>(a(),l("div",{class:"text-caption",key:h},[r.approval_level===oe?(a(),l("span",ya,[e("span",{class:I([d(oe).userId===r.user_id?"text-success":"text-black"])},n(r.first_name)+" "+n(r.last_name),3)])):b("",!0)]))),128))]),v.status>oe?(a(),l("span",xa,[e("span",ha,n(d(oe).date),1),e("span",{class:I(["me-4",d(oe).checkIfApproved?"text-danger":"text-primary"])},n(d(oe).remarks),3)])):(a(),l("span",ga,ka))])]),_:1},8,["dot-color"])],64)):b("",!0),t(m,{"dot-color":v.status>we?"#555":"#d3d3d3",size:"extra-small"},{default:s(()=>[e("div",Ia,[e("div",null,[e("strong",null,[f("Team Leader "),G.value!==""?(a(),l("span",Sa,"("+n(G.value)+")",1)):(a(),l("span",Va,"(Team Leader per SSU)"))]),wa,e("div",Ra,[e("span",Aa,n(Z.value)+" "+n(J.value),1)])]),k.value!==""?(a(),l("span",qa,[e("span",Da,n(ye(k.value)),1)])):(a(),l("span",Ea,Ta))])]),_:1},8,["dot-color"]),t(m,{"dot-color":v.status>Re?"#555":"#d3d3d3",size:"extra-small"},{default:s(()=>[e("div",Ca,[e("div",null,[Na,e("div",Ma,[e("span",La,[U.value!==""?(a(),l("i",za,"Installer : ")):b("",!0),f(n(j.value)+" "+n(W.value),1)])])]),U.value!==""?(a(),l("span",Pa,[e("span",ja,n(ye(U.value)),1)])):(a(),l("span",$a,Oa))])]),_:1},8,["dot-color"])]),_:1})]),_:1})}}},Fa=v=>(Oe("data-v-037b74ec"),v=v(),We(),v),Ha={key:0},Ga=Fa(()=>e("p",{style:{color:"orange"}},"* Internal Processing Still in Progress",-1)),Qa=[Ga],Ya={key:1},Za={class:"text-danger ml-3"},Ja={__name:"WorkOrderApprover",setup(v){var Ne,Me;const S=vt.useToast(),ie=pt().currentUserRole,{can:P}=St(),H=ft(),Z=yt(),{width:J}=$e(),k=Ae(),N=qe(),U=o((Me=(Ne=k.user.user_roles)==null?void 0:Ne.filter(_=>_.role_id===ie)[0])==null?void 0:Me.SSU),j=o("equipments"),W=o(!1),G=o(!1),T=o(!1),d=o(!1),D=o(!1),w=o(!1),y=Z.params.id,V=o(y),M=o([]),$=o(!1),E=o(""),B=o(""),L=o(null),R=o(null),x=o(null),A=o(null),m=o({}),i=o(0);o(null);const O=o(""),ee=o([]),F=o(""),r=_=>{ee.value=Array.from(_)},h=o({final_installation_date:"",driver:""}),He=_=>Object.keys(_).map(c=>({text:"SSU"+_[c],value:"SSU"+_[c]})),Ue=o([_=>!!_||"Required"]);Be(Ue,_=>{});const Ge=[{title:"Back",disabled:!1,href:"/equipment-handling",display:"block"},{title:"Equipment Handling",disabled:!0,href:"",display:"none"},{title:"Work Order",disabled:!0,href:"",display:"none"}],Qe=_=>{!_.disabled&&_.href&&H.push(_.href)},Te=async()=>{w.value=!0;const _=ee.value.map(g=>({service_id:g.service_id,equipment_id:g.equipment_id,serial:g.serial_number,action:(g==null?void 0:g.actions_done)??"",work_type:"EquipmentHandling"}));if(k.user.approval_level===_e&&!$.value){S.error("Please ensure all serial number fields are filled in"),w.value=!1;return}const{valid:c}=await W.value.validate();if(!c){w.value=!1;return}try{const g=await N.post("approve-request",{approval_level:k.user.approval_level,id:k.user.id,item:M.value,service_id:y,ssu:B.value,engineer:O.value.value,status:i.value,remark:E.value,...h.value,actionsDone:_??[]});g.data&&g.data.success?(D.value=!0,S.success("Approved successfully"),H.push("/equipment-handling")):(console.log(g.data.error),S.error("Something went wrong"))}catch(g){console.log(g)}finally{w.value=!1}},ve=o(""),xe=o(""),Ye=async()=>{if(ve.value===""){xe.value="Field is required",setTimeout(()=>{xe.value=""},3e3);return}try{const _=await N.post("disapprove-request",{id:k.user.id,service_id:y,remark:ve.value,approval_level:k.user.approval_level});_.data&&_.data.success&&(S.success("Disapproval successful"),H.push("/equipment-handling"))}catch(_){alert(_)}finally{}},Ze=async()=>{try{const _=await N.get("getInternalRequest",{params:{service_id:y,category:"specificService"}});if(_.data&&_.data.request&&_.data.request.length>0){const c=_.data.request[0];L.value=c.status,A.value=c.id,R.value=c.updated_at,x.value=c.get_user.first_name+" "+c.get_user.last_name,m.value=c}}catch(_){alert(_)}},Ce=o([]),Je=async()=>{try{const _=await N.get("get-engineers-data");if(_.data&&_.data.engineers){const g=_.data.engineers.filter(te=>te.SSU===F.value).map(te=>({key:te.users.first_name+" "+te.users.last_name,value:te.user_id}));Ce.value=g}}catch(_){alert(_)}},Ke=_=>{M.value=Array.from(_),$.value=M.value.every(c=>c.serial&&c.serial.trim()!=="")},Xe=_=>{i.value=_},et=_=>{F.value=_},tt=o(null),st=_=>{tt.value=_};return xt("disableButton",()=>{D.value=!0}),De(async()=>{D.value=!0,await Ze(),await Je(),k.user.approval_level!==1&&(D.value=!1),D.value=!1}),(_,c)=>{const g=p("v-icon"),te=p("v-breadcrumbs-item"),at=p("v-breadcrumbs"),lt=p("v-spacer"),Q=p("v-btn"),pe=p("v-textarea"),he=p("v-col"),ge=p("v-row"),fe=p("v-card"),be=p("v-dialog"),nt=p("v-select"),Le=p("v-text-field"),ze=p("v-divider"),Pe=p("v-form"),ot=p("v-combobox"),ke=p("v-tab"),rt=p("v-tabs"),Ie=p("v-window-item"),dt=p("v-window"),it=p("v-card-text"),ut=p("v-container");return a(),z(bt,null,{topBarFixed:s(()=>[e("div",null,[t(at,{class:"pt-7"},{default:s(()=>[(a(),l(q,null,C(Ge,(u,Se)=>t(te,{key:Se,class:I({"custom-pointer":!u.disabled}),style:ht({display:Y(J)<=768?u.display:""}),onClick:Xa=>Qe(u),disabled:u.disabled},{default:s(()=>[f(n(u.title)+" ",1),t(g,{class:"ml-1",icon:"mdi-chevron-right"})]),_:2},1032,["class","style","onClick","disabled"])),64))]),_:1})]),t(lt),L.value===de.Delegated||L.value===de.InProgress||L.value===de.Packed||L.value===de.Completed?(a(),l("div",Ha,Qa)):(a(),l("div",Ya,[Y(P)("approve","Equipment Handling")&&Y(k).user.approval_level===i.value?(a(),l(q,{key:0},[t(be,{modelValue:G.value,"onUpdate:modelValue":c[2]||(c[2]=u=>G.value=u),"max-width":"400",persistent:""},{activator:s(({props:u})=>[t(Q,Ve({disabled:D.value},u,{color:"primary",variant:"tonal",class:"text-none mr-2"}),{default:s(()=>[f(" Disapprove")]),_:2},1040,["disabled"])]),default:s(()=>[t(fe,{text:"",title:"Disapprove"},{actions:s(()=>[t(ge,{justify:"end"},{default:s(()=>[t(Q,{elevation:"2",onClick:c[1]||(c[1]=u=>G.value=!1),"background-color":"red",color:"#191970",class:"text-none mr-2"},{default:s(()=>[t(g,null,{default:s(()=>[f("mdi-close")]),_:1}),f(" Cancel")]),_:1}),t(Q,{onClick:Ye,color:"primary",elevation:"2",class:"text-none mr-3",style:{"background-color":"#191970",color:"#fff!important"}},{default:s(()=>[t(g,{class:"mr-1"},{default:s(()=>[f("mdi-text-box-remove-outline")]),_:1}),f(" Disapprove")]),_:1})]),_:1})]),default:s(()=>[t(he,{cols:"12"},{default:s(()=>[t(pe,{class:"mr-2 ml-2",modelValue:ve.value,"onUpdate:modelValue":c[0]||(c[0]=u=>ve.value=u),clearable:"",label:"Reason of Disapproval",color:"primary",variant:"outlined"},null,8,["modelValue"]),e("p",Za,n(xe.value),1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(be,{modelValue:T.value,"onUpdate:modelValue":c[8]||(c[8]=u=>T.value=u),"max-width":"400",persistent:""},{activator:s(({props:u})=>[t(Q,Ve({type:"button"},u,{disabled:D.value,color:"primary",variant:"flat",class:"text-none btnSubmit"}),{default:s(()=>[t(g,{class:"mr-2"},{default:s(()=>[f("mdi-check")]),_:1}),f(" Approve")]),_:2},1040,["disabled"])]),default:s(()=>[t(fe,{text:"",title:"Approve"},{default:s(()=>[t(Pe,{onSubmit:je(Te,["prevent"]),ref_key:"form",ref:W},{default:s(()=>[t(he,{cols:"12"},{default:s(()=>[t(pe,{class:"mr-2 ml-2",modelValue:E.value,"onUpdate:modelValue":c[3]||(c[3]=u=>E.value=u),clearable:"",label:"Remarks (optional)",color:"primary",variant:"outlined"},null,8,["modelValue"]),re===Y(k).user.approval_level?(a(),z(nt,{key:0,color:"primary",class:"mr-2 ml-2 mt-5",label:"Set SSU",density:"compact",variant:"outlined",items:He(gt),"item-title":"text","item-value":"value",item:"",modelValue:B.value,"onUpdate:modelValue":c[4]||(c[4]=u=>B.value=u),rules:Ue.value},null,8,["items","modelValue","rules"])):b("",!0),X===Y(k).user.approval_level?(a(),l(q,{key:1},[t(Le,{type:"date",class:"mr-2 ml-2 mt-5",modelValue:h.value.final_installation_date,"onUpdate:modelValue":c[5]||(c[5]=u=>h.value.final_installation_date=u),variant:"outlined",color:"primary",density:"compact",rules:[u=>!!u||"Required"],label:"Final Installation Date"},null,8,["modelValue","rules"]),t(Le,{class:"mr-2 ml-2 mt-5",modelValue:h.value.driver,"onUpdate:modelValue":c[6]||(c[6]=u=>h.value.driver=u),variant:"outlined",color:"primary",density:"compact",rules:[u=>!!u||"Required"],label:"Driver"},null,8,["modelValue","rules"])],64)):b("",!0)]),_:1}),t(ze),t(ge,{justify:"end",class:"mt-7 mb-5 pr-3"},{default:s(()=>[t(Q,{variant:"tonal",onClick:c[7]||(c[7]=u=>T.value=!1),color:"primary",class:"text-none mr-2"},{default:s(()=>[t(g,null,{default:s(()=>[f("mdi-close")]),_:1}),f(" Cancel")]),_:1}),t(Q,{type:"submit",loading:w.value,disabled:D.value,color:"#191970",flat:"",class:"text-none bg-primary mr-5"},{default:s(()=>[t(g,{class:"mr-2"},{default:s(()=>[f("mdi-check")]),_:1}),f(" Approve")]),_:1},8,["loading","disabled"])]),_:1})]),_:1},512)]),_:1})]),_:1},8,["modelValue"])],64)):b("",!0),Re===i.value&&U.value===F.value&&Y(P)("installer","Equipment Handling")||we===i.value&&U.value===F.value&&Y(P)("delegate","Equipment Handling")?(a(),z(be,{key:1,modelValue:d.value,"onUpdate:modelValue":c[12]||(c[12]=u=>d.value=u),"max-width":"600",persistent:""},{activator:s(({props:u})=>[t(Q,Ve({type:"button"},u,{disabled:D.value,color:"primary",variant:"flat",class:"text-none btnSubmit"}),{default:s(()=>[t(g,{class:"mr-2"},{default:s(()=>[f("mdi-check")]),_:1}),f(" "+n(Y(P)("delegate","Equipment Handling")?"Delegate Installation":"Installation Complete"),1)]),_:2},1040,["disabled"])]),default:s(()=>[t(fe,{text:"",title:"Approve"},{default:s(()=>[t(Pe,{onSubmit:je(Te,["prevent"]),ref_key:"form",ref:W},{default:s(()=>[t(he,{cols:"12"},{default:s(()=>[t(pe,{class:"mr-2 ml-2",modelValue:E.value,"onUpdate:modelValue":c[9]||(c[9]=u=>E.value=u),clearable:"",label:"Remarks (optional)",color:"primary",variant:"outlined"},null,8,["modelValue"]),we===i.value&&U.value===F.value?(a(),z(ot,{key:0,color:"primary",class:"ml-2 mr-2 mt-5",modelValue:O.value,"onUpdate:modelValue":c[10]||(c[10]=u=>O.value=u),rules:[u=>!!u||"Required"],label:"Assign Engineer",placeholder:"Assign to",density:"compact",items:Ce.value,variant:"outlined",itemValue:"value",itemTitle:"key"},null,8,["modelValue","rules","items"])):b("",!0),Re===i.value&&U.value===F.value?(a(!0),l(q,{key:1},C(ee.value,u=>(a(),z(pe,{class:"mr-2 ml-2 mt-3",key:u.key,modelValue:u.actions_done,"onUpdate:modelValue":Se=>u.actions_done=Se,clearable:"",label:"Actions Done in Serial -"+u.serial_number,color:"primary",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","label"]))),128)):b("",!0)]),_:1}),t(ze),t(ge,{justify:"end",class:"mt-7 mb-5 pr-3"},{default:s(()=>[t(Q,{variant:"tonal",onClick:c[11]||(c[11]=u=>d.value=!1),size:"small",color:"primary",class:"text-none mr-2"},{default:s(()=>[t(g,null,{default:s(()=>[f("mdi-close")]),_:1}),f(" Cancel")]),_:1}),t(Q,{type:"submit",size:"small",loading:w.value,disabled:D.value,color:"#191970",flat:"",class:"text-none bg-primary mr-5"},{default:s(()=>[t(g,{class:"mr-2"},{default:s(()=>[f("mdi-check")]),_:1}),f(" Approve")]),_:1},8,["loading","disabled"])]),_:1})]),_:1},512)]),_:1})]),_:1},8,["modelValue"])):b("",!0)]))]),default:s(()=>[t(ut,{class:"container-form mt-3"},{default:s(()=>[t(kt,{service_id:parseInt(V.value),showInternalRequest:Y(k).user.approval_level===K,onSetStatus:Xe,onSetUpdatedSsu:et,onGetInstallationEngineer:st,internalStatus:L.value,internalDelegatedTo:x.value,internalID:A.value,internalServicing:m.value},null,8,["service_id","showInternalRequest","internalStatus","internalDelegatedTo","internalID","internalServicing"]),t(fe,{class:"mt-10"},{default:s(()=>[t(rt,{modelValue:j.value,"onUpdate:modelValue":c[13]||(c[13]=u=>j.value=u),density:"compact",class:"border-b-sm","bg-color":"grey-lighten-5"},{default:s(()=>[t(ke,{value:"request_type",class:"text-none",color:"primary"},{default:s(()=>[t(g,{class:"mr-2"},{default:s(()=>[f("mdi-tooltip-text-outline")]),_:1}),f(" Request Type")]),_:1}),t(ke,{value:"equipments",class:"text-none",color:"primary"},{default:s(()=>[t(g,{class:"mr-2"},{default:s(()=>[f("mdi-hammer-screwdriver")]),_:1}),f(" Requested Equipments")]),_:1}),t(ke,{value:"history",class:"text-none",color:"primary"},{default:s(()=>[t(g,{class:"mr-2"},{default:s(()=>[f("mdi-account-details")]),_:1}),f(" Approval Requirements")]),_:1})]),_:1},8,["modelValue"]),t(it,null,{default:s(()=>[t(dt,{modelValue:j.value,"onUpdate:modelValue":c[14]||(c[14]=u=>j.value=u),disabled:!0},{default:s(()=>[t(Ie,{value:"request_type"},{default:s(()=>[t(qt,{service_id:parseInt(V.value)},null,8,["service_id"])]),_:1}),t(Ie,{value:"equipments"},{default:s(()=>[t(It,{service_id:parseInt(V.value),onSetSerial:Ke,onGetSerials:r,editSerial:i.value===1},null,8,["service_id","editSerial"])]),_:1}),t(Ie,{value:"history"},{default:s(()=>[t(Wa,{service_id:parseInt(V.value),status:i.value},null,8,["service_id","status"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})}}},rl=Fe(Ja,[["__scopeId","data-v-037b74ec"]]);export{rl as default};
