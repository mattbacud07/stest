import{d as qe,u as Se,c as we,g as Ie,r,x as Ce,C as Re,E as De,V as A,a1 as $,m as Ve,y as Ee,f as q,w as t,o,h as l,j as _,I as Q,_ as Te,M as Ae,n as b,p as u,z as N,F as L,k as x,t as i,a2 as Ne,a3 as Le,a4 as Oe,a5 as Be,a6 as Z,a7 as ee,a8 as te,a9 as ae,aa as le,ab as se,W as oe,ac as ne,e as d,ad as Ue,K as Fe,X as ze}from"./index-BVXPU9zS.js";import{L as He}from"./LayoutWithActions-BLO8pnbP.js";import{d as We}from"./debounce-KHlJyMIn.js";import{a as Me}from"./getInstitution-BQ_ruXxw.js";import{p as Pe}from"./permitted-CQa1RmFG.js";import{g as Je}from"./vue3-datatable-C2ljW4qF.js";import{n as Ye}from"./filters-CoHlS7tX.js";import{_ as je}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./topBarUserProfile-DtdqdVcI.js";const Ge={key:0},Ke={key:1},Xe={class:"mb-1 mt-1"},$e={key:0},Qe={key:0,class:"text-danger"},Ze={key:1,class:"text-success"},et={key:2},tt={key:0,class:"text-danger"},at={key:1,class:"text-success"},lt={key:2},st={__name:"EquipmentHandling",setup(ot){const{institutionData:re}=Me(),ie=qe.useToast(),O=Se(),{can:B}=Pe(),ue=we(),U=Ie(),ce=U.currentUserRole,k=r(!0),F=r(null),S=r(null);r(null);const z=Ce(),f=r(!1),p=r({filterStatus:[],filterInstitution:[],filterApprovalLevel:[]}),H=r(0);Re(p,a=>{H.value=Ye(a),localStorage.setItem("EHFilter",JSON.stringify(a)),m.current_page=1,v()},{deep:!0});const de=a=>{m.search=a},w=r(!0),W=r(""),m=De({current_page:1,pagesize:10,sort_column:"created_at",sort_direction:"desc",search:""}),I=r(null),C=r([{field:"id",title:"Report Number",isUnique:!0,type:"number",hide:!1},{field:"name",title:"Institution",hide:!1},{field:"address",title:"Address",hide:!1},{field:"user_name",title:"Requested by"},{field:"request_type",title:"Request Category",hide:!1},{field:"request_name",title:"Type of Request",hide:!1},{field:"equipments",title:"Equipment"},{field:"proposed_delivery_date",title:"Proposed Delivery Date",type:"date",hide:!1},{field:"final_installation_date",title:"Final Installation Date",hide:!1},{field:"created_at",title:"Date Requested",type:"date",hide:!1},{field:"approver_name",title:"Pending Approval",hide:!1},{field:"main_status",title:"Status",cellClass:"sticky-last",headerClass:"sticky-last-header",type:"number",hide:!1}])||[],pe=C.value.reduce((a,s)=>(s.title&&s.field&&(a[s.title]=s.field),a),{});A("column",C);const me=a=>{(a==null?void 0:a.main_status)===ne?O.push({name:"WorkOrderInstallation",params:{id:a.id}}):O.push({name:"WorkOrderApprover",params:{id:a.id}})},M=r([]),_e=a=>{var s,c;M.value=F.value.getSelectedRows(),a&&a.length===1?k.value=!1:k.value=!0,S.value=(s=a[0])==null?void 0:s.id,P.value=((c=a[0])==null?void 0:c.main_status)===ne?"WorkOrderInstallation":"WorkOrderApprover"},ve=a=>M.value.map(c=>c.id).includes(a.id)?"highlightRow":"";r(null);const P=r(null),J=r(null);r(null),B("create",$)&&U.currentUserRole===Ve&&(J.value="WorkOrder");const fe=async()=>{var a;try{(a=(await z.delete(`delete_eh/${S.value}`)).data)!=null&&a.success&&(ie.success("Deleted successfully"),v(),k.value=!0)}catch(s){console.log(s)}},he={selectedId:S,btnDisable:k,routeView:P,createRequest:J.value,deleteFunction:B("delete",$)?fe:null};A("data",he);const v=async()=>{var a;try{w.value=!0;const c=(a=(await z.get("get-equipment-handling",{params:{...m,user_id:ue.user.id,current_role:ce,...p.value}})).data)==null?void 0:a.equipment_handling;I.value=c.data,W.value=c.total}catch(s){console.log(s)}w.value=!1},ye=We(v,300),ge=a=>{m.current_page=a.current_page,m.pagesize=a.pagesize,m.sort_column=a.sort_column,m.sort_direction=a.sort_direction,a.change_type==="search"?ye():v()};return A("refresh",v),Ee(()=>{const a=localStorage.getItem("EHFilter");a&&(p.value=JSON.parse(a)),v()}),(a,s)=>{const c=d("v-tooltip"),R=d("v-checkbox"),D=d("v-badge"),be=d("v-combobox"),h=d("v-col"),V=d("v-icon"),E=d("v-card"),Y=d("v-menu"),T=d("v-btn"),xe=d("download-excel"),j=d("v-row"),ke=d("v-chip");return o(),q(He,{onSearchText:de},{filter:t(()=>[l(j,null,{default:t(()=>[l(h,{cols:"12",class:"d-flex justify-space-between align-items-center pa-0"},{default:t(()=>[l(D,{color:"warning",dense:"",content:H.value,"offset-y":5},{default:t(()=>[l(R,{"false-icon":"mdi-filter-menu","true-icon":"mdi-close",color:"primary",modelValue:f.value,"onUpdate:modelValue":s[0]||(s[0]=n=>f.value=n)},{default:t(()=>[f.value?Q("",!0):(o(),q(c,{key:0,activator:"parent"},{default:t(()=>[_("Expanded Filter")]),_:1}))]),_:1},8,["modelValue"])]),_:1},8,["content"]),l(Te,{name:"slide-x-transition"},{default:t(()=>[l(h,{class:"d-flex",style:Ae({visibility:f.value?"visible":"hidden",opacity:f.value?"1":"0"})},{default:t(()=>[l(h,{cols:"3",class:"pa-0 mr-1"},{default:t(()=>[l(be,{transition:"slide-x-transition",color:"primary",modelValue:p.value.filterInstitution,"onUpdate:modelValue":s[1]||(s[1]=n=>p.value.filterInstitution=n),label:"Institution",density:"compact",items:b(re),chips:"","closable-chips":"","single-line":"",itemValue:"institution_id",variant:"outlined",itemTitle:"key",multiple:""},null,8,["modelValue","items"])]),_:1}),l(h,{cols:"auto",class:"pa-0 mr-1"},{default:t(()=>[l(T,{color:"primary",variant:"plain",class:"text-none"},{prepend:t(()=>{var n;return[l(D,{color:"primary",content:(n=p.value.filterStatus)==null?void 0:n.length,inline:""},null,8,["content"])]}),default:t(()=>[_(" Status "),l(V,null,{default:t(()=>[_("mdi-chevron-down")]),_:1}),l(Y,{transition:"slide-x-transition","close-on-content-click":!1,"min-width":"400",width:"400",height:"auto",location:"bottom",activator:"parent"},{default:t(()=>[l(E,{width:"auto",class:"pr-3"},{default:t(()=>[(o(!0),u(L,null,N(Ue,n=>(o(),q(R,{modelValue:p.value.filterStatus,"onUpdate:modelValue":s[2]||(s[2]=e=>p.value.filterStatus=e),class:"columnChooserCheckBox",label:n.text,value:n.key},null,8,["modelValue","label","value"]))),256))]),_:1})]),_:1})]),_:1})]),_:1}),l(h,{cols:"auto",class:"pa-0 mr-1"},{default:t(()=>[l(T,{color:"primary",variant:"plain",class:"text-none"},{prepend:t(()=>{var n;return[l(D,{color:"primary",content:(n=p.value.filterApprovalLevel)==null?void 0:n.length,inline:""},null,8,["content"])]}),default:t(()=>[_(" Pending Approval "),l(V,null,{default:t(()=>[_("mdi-chevron-down")]),_:1}),l(Y,{transition:"slide-x-transition","close-on-content-click":!1,"min-width":"400",width:"400",height:"auto",location:"bottom",activator:"parent"},{default:t(()=>[l(E,{width:"auto",class:"pr-3"},{default:t(()=>[(o(!0),u(L,null,N(Fe,n=>(o(),q(R,{modelValue:p.value.filterApprovalLevel,"onUpdate:modelValue":s[3]||(s[3]=e=>p.value.filterApprovalLevel=e),class:"columnChooserCheckBox pa-0 ma-0",label:n.key,value:n.value},null,8,["modelValue","label","value"]))),256))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["style"])]),_:1}),l(xe,{data:I.value,type:"xlsx",fields:b(pe),name:"EquipmentHandling - "+b(ze)().format("MM-DD-YYYY")},{default:t(()=>[l(T,{text:"Export","prepend-icon":"mdi-download",variant:"text",color:"primary",class:"text-none"})]),_:1},8,["data","fields","name"])]),_:1})]),_:1}),l(j)]),default:t(({searchText:n})=>[l(E,{class:"mx-auto"},{default:t(()=>[l(b(Je),{ref_key:"datatable",ref:F,class:"tableLimitText sticky-last-header",rows:I.value,columns:b(C),loading:w.value,search:m.search,totalRows:W.value,pageSize:m.pagesize,isServerMode:!0,onChange:ge,onRowSelect:_e,sortColumn:m.sort_column,sortDirection:m.sort_direction,sortable:!0,skin:"bh-table-compact bh-table-bordered bh-table-striped bh-table-hover",hasCheckbox:!0,rowClass:ve,selectRowOnClick:!0,cellClass:"internalCell",onRowDBClick:me},{id:t(e=>[x("span",null,i(Ne(e.value.id,e.value.created_at)),1)]),request_type:t(e=>[x("span",null,i(Le(e.value.request_type)),1)]),request_name:t(e=>{var y;return[((y=e.value)==null?void 0:y.request_type)===Oe?(o(),u("span",Ge,[_(i(e.value.request_name)+" ",1),l(c,{location:"left",activator:"parent"},{default:t(()=>[_(" Satellite: "+i(e.value.satellite),1)]),_:2},1024)])):(o(),u("span",Ke,i(Be(e.value.request_type,e.value.request_name,e.value.other)),1))]}),equipments:t(e=>[l(c,{activator:"parent",color:"primary"},{default:t(()=>{var y;return[(o(!0),u(L,null,N((y=e.value.equipments)==null?void 0:y.filter(g=>g.category==="Equipment"),g=>{var G,K,X;return o(),u("p",Xe,[l(V,null,{default:t(()=>[_("mdi-circle-medium")]),_:1}),_(" "+i((G=g.master_data)==null?void 0:G.equipment)+" ",1),(K=g.master_data)!=null&&K.sbu?(o(),u("span",$e,"[ SBU - "+i((X=g.master_data)==null?void 0:X.sbu)+" ] ",1)):Q("",!0)])}),256))]}),_:2},1024)]),approver_name:t(e=>[parseInt(e.value.main_status)===Z?(o(),u("span",Qe,"Disapproved")):parseInt(e.value.main_status)===ee?(o(),u("span",Ze,"Completed")):(o(),u("span",et,i(te(e.value.level,1))+" "+i(ae===e.value.level||le===e.value.level?e.value.SBU:""),1))]),main_status:t(e=>[x("span",null,[l(ke,{label:"",density:"compact",color:se(e.value.main_status).color},{default:t(()=>[_(i(se(e.value.main_status).text)+" ",1),l(c,{activator:"parent",location:"left"},{default:t(()=>[parseInt(e.value.main_status)===Z?(o(),u("span",tt,"Disapproved")):parseInt(e.value.main_status)===ee?(o(),u("span",at,"Completed")):(o(),u("span",lt,i(te(e.value.level,1))+" "+i(ae===e.value.level||le===e.value.level?e.value.SBU:""),1))]),_:2},1024)]),_:2},1032,["color"])])]),created_at:t(e=>[x("span",null,i(oe(e.value.created_at)),1)]),final_installation_date:t(e=>[x("span",null,i(oe(e.value.final_installation_date)),1)]),_:1},8,["rows","columns","loading","search","totalRows","pageSize","sortColumn","sortDirection"])]),_:1})]),_:1})}}},vt=je(st,[["__scopeId","data-v-607f5939"]]);export{vt as default};
