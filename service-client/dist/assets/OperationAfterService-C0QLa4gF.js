import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{ap as H,J as q,e as a,o as A,f as P,w as t,h as e,k as l,t as y,n as B,N as ae,O as oe,x as K,d as Q,r as w,j as v,i as se,$ as ie,a0 as ce,p as ne,I as G,G as L,c as de,Y as ue,aG as j,X as z,F as _e}from"./index-BVXPU9zS.js";import{u as me}from"./getUsers-CWxP2GaZ.js";import{e as X,f as ee,g as pe}from"./maintenance-D6-EqnL4.js";import{p as fe}from"./permitted-CQa1RmFG.js";const E=g=>(ae("data-v-d0f75d79"),g=g(),oe(),g),ve=E(()=>l("p",null,"Institution",-1)),ge={class:"text-grey-darken-1 textTransform"},ye=E(()=>l("p",null,"Address",-1)),be={class:"text-grey-darken-1 textTransform"},xe=E(()=>l("p",null,"Equipment",-1)),he={class:"text-grey-darken-1"},ke=E(()=>l("p",null,"Serial",-1)),we={class:"text-grey-darken-1"},Ce=E(()=>l("p",null,"Frequency",-1)),Se={class:"text-grey-darken-1"},Me=E(()=>l("p",null,"Scheduled",-1)),De={class:"text-grey-darken-1"},$e={__name:"PMCustomerDetails",props:{customer_details:{type:Object,default:()=>({})}},setup(g){const V=g,{customer_details:M}=H(V),h=q(()=>{var u;return(u=M.value)==null?void 0:u.equipment}),f=q(()=>{var u;return(u=M.value)==null?void 0:u.institution});return(u,_)=>{const m=a("v-col"),d=a("v-row"),D=a("v-card");return A(),P(D,{flat:"",style:{"padding-top":"1em"},class:"mb-7 pa-5 mt-5"},{default:t(()=>[e(d,{class:"d-flex justify-space-between"},{default:t(()=>[e(m,{lg:"4",md:"4",sm:"6",cols:"12"},{default:t(()=>{var o,b;return[ve,l("p",ge,y(((b=(o=f.value)==null?void 0:o.name)==null?void 0:b.toLowerCase())??"---"),1)]}),_:1}),e(m,{lg:"4",md:"4",sm:"6",cols:"12"},{default:t(()=>{var o;return[ye,l("p",be,y((o=f.value)==null?void 0:o.address.toLowerCase()),1)]}),_:1})]),_:1}),e(d,null,{default:t(()=>[e(m,{lg:"4",md:"4",sm:"6",cols:"12"},{default:t(()=>{var o;return[xe,l("p",he,y((o=h.value)==null?void 0:o.equipment),1)]}),_:1}),e(m,{lg:"4",md:"4",sm:"6",cols:"12"},{default:t(()=>{var o;return[ke,l("p",we,y((o=h.value)==null?void 0:o.serial),1)]}),_:1}),e(m,{lg:"4",md:"4",sm:"6",cols:"12"},{default:t(()=>{var o;return[Ce,l("p",Se,y((o=h.value)==null?void 0:o.frequency),1)]}),_:1})]),_:1}),e(d,null,{default:t(()=>[e(m,{lg:"4",md:"4",sm:"6",cols:"12"},{default:t(()=>{var o;return[Me,l("p",De,y((o=B(M))==null?void 0:o.scheduled_at),1)]}),_:1})]),_:1})]),_:1})}}},He=te($e,[["__scopeId","data-v-d0f75d79"]]),Z=g=>(ae("data-v-b1cdc489"),g=g(),oe(),g),Ve=Z(()=>l("p",null,"Name",-1)),Ye={class:"text-grey-darken-1 textTransform"},Ae=Z(()=>l("p",null,"Desgination",-1)),qe={class:"text-grey-darken-1 textTransform"},Te=Z(()=>l("p",null,"Signature",-1)),Pe={__name:"PMCustomerSignature",props:{customer_details:{type:Object,default:()=>({})}},setup(g){const V=g,{customer_details:M}=H(V),h=q(()=>{var f,u;return(u=(f=M.value)==null?void 0:f.task_delegation)==null?void 0:u.customer});return(f,u)=>{const _=a("v-col"),m=a("v-row"),d=a("v-img"),D=a("v-card");return A(),P(D,{flat:"",style:{"padding-top":"1em"},class:"mb-7 pa-5 mt-5"},{default:t(()=>[e(m,{class:"d-flex justify-space-between"},{default:t(()=>[e(_,{lg:"4",md:"4",sm:"6",cols:"12"},{default:t(()=>{var o,b;return[Ve,l("p",Ye,y(((b=(o=h.value)==null?void 0:o.name)==null?void 0:b.toLowerCase())??"---"),1)]}),_:1}),e(_,{lg:"4",md:"4",sm:"6",cols:"12"},{default:t(()=>{var o,b;return[Ae,l("p",qe,y(((b=(o=h.value)==null?void 0:o.designation)==null?void 0:b.toLowerCase())??"---"),1)]}),_:1})]),_:1}),e(m,null,{default:t(()=>[e(_,{lg:"4",md:"4",sm:"6",cols:"12"},{default:t(()=>{var o;return[Te,e(d,{src:"/"+((o=h.value)==null?void 0:o.signature),alt:"Signature","max-width":"150",class:"rounded-lg"},null,8,["src"])]}),_:1})]),_:1})]),_:1})}}},Ke=te(Pe,[["__scopeId","data-v-b1cdc489"]]),Re={class:"small text-disabled"},Ne={class:"small text-primary",style:{"font-size":"12px"}},Oe={key:0,class:"text-disabled"},Qe={__name:"PMDelegateEngineer",props:{id:{type:Number,default:null}},emits:["refresh-data"],setup(g,{emit:V}){const M=K(),h=Q.useToast(),{engineers:f}=me(),u=w(""),_=w(!1),m=w(!1),d=w(!1),D=w(!1),o=V,b=g,F=async()=>{var c,x;m.value=!0;const{valid:Y}=await D.value.validate();if(!Y){m.value=!1;return}try{const k=await M.post("pm_delegate_engineer",{id:b.id,engineer:(c=u.value)==null?void 0:c.value});k.data&&k.data.success?(h.success("Successfully delegated"),o("refresh-data",!0)):(x=k==null?void 0:k.data)!=null&&x.exist?h.error("Currently active"):(h.error(response.data.errorE),m.value=!1)}catch(k){console.log(k),m.value=!1}finally{m.value=!1}};return(Y,c)=>{const x=a("v-icon"),k=a("v-list-item-title"),R=a("v-list-item"),T=a("v-combobox"),N=a("v-col"),i=a("v-divider"),n=a("v-btn"),s=a("v-row"),r=a("v-form"),C=a("v-card"),U=a("v-dialog");return A(),P(n,{type:"button",disabled:_.value,color:"primary",variant:"flat",class:"text-none btnSubmit"},{default:t(()=>[e(x,{class:"mr-2"},{default:t(()=>[v("mdi-account-arrow-left-outline")]),_:1}),v(" Delegate Engineer "),e(U,{modelValue:d.value,"onUpdate:modelValue":c[2]||(c[2]=p=>d.value=p),activator:"parent","max-width":"400",persistent:""},{default:t(()=>[e(C,{text:"",title:"Delegate Engineer","prepend-icon":"mdi-account"},{default:t(()=>[e(r,{onSubmit:se(F,["prevent"]),ref_key:"engineerForm",ref:D},{default:t(()=>[e(N,{cols:"12"},{default:t(()=>[e(T,{color:"primary",class:"mt-5",modelValue:u.value,"onUpdate:modelValue":c[0]||(c[0]=p=>u.value=p),clearable:"",label:"Delegate to",placeholder:"Delegate to",density:"compact",items:B(f),variant:"outlined",itemValue:"value",rules:[p=>!!p||"Required",p=>p.key!==void 0?!0:"Select one of the options listed"],itemTitle:"key"},{item:t(({item:p,props:O})=>[e(R,ie(ce(O)),{default:t(()=>[e(k,null,{default:t(()=>[l("p",Re,"SBU "+y(p.raw.sbu),1)]),_:2},1024)]),_:2},1040)]),selection:t(({item:p,index:O})=>[l("span",Ne,[l("b",null,y(p.title),1),v(),p.title?(A(),ne("span",Oe,"- [SBU : "+y(p.raw.sbu)+"]",1)):G("",!0)])]),_:1},8,["modelValue","items","rules"])]),_:1}),e(i),e(s,{justify:"end",class:"mt-7 mb-5 pr-3"},{default:t(()=>[e(n,{variant:"plain",onClick:c[1]||(c[1]=p=>d.value=!1),color:"primary",class:"text-none mr-2"},{default:t(()=>[v(" Cancel")]),_:1}),e(n,{type:"submit",loading:m.value,disabled:_.value,color:"#191970",flat:"",class:"text-none bg-primary mr-5"},{default:t(()=>[e(x,{class:"mr-2"},{default:t(()=>[v("mdi-check")]),_:1}),v(" Submit")]),_:1},8,["loading","disabled"])]),_:1})]),_:1},512)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["disabled"])}}},Ze={__name:"PMAcceptDecline",props:{id:{type:Number,default:null},delegation_id:{type:Number,default:null}},emits:["refresh-data"],setup(g,{emit:V}){const M=K(),h=Q.useToast(),f=w(!1),u=w(!1),_=w(""),m=w(""),d=Y=>{m.value=Y,u.value=!0},D=V,o=g,b=w(!1),F=async()=>{var c;f.value=!0;const{valid:Y}=await b.value.validate();if(!Y){f.value=!1;return}try{(c=(await M.post("accept-decline-delegated",{service_id:o.id,delegation_id:o.delegation_id,status:m.value,remarks:_.value})).data)!=null&&c.success&&(h.success("Successful"),D("refresh-data",!0))}catch(x){console.log(x)}finally{f.value=!1,u.value=!1}};return(Y,c)=>{const x=a("v-btn"),k=a("v-icon"),R=a("v-textarea"),T=a("v-col"),N=a("v-row"),i=a("v-form"),n=a("v-card"),s=a("v-dialog");return A(),P(s,{modelValue:u.value,"onUpdate:modelValue":c[4]||(c[4]=r=>u.value=r),"max-width":"600",persistent:""},{activator:t(({props:r})=>[e(x,L({type:"button"},r,{color:"primary",variant:"plain",class:"text-none mr-2",onClick:c[0]||(c[0]=C=>d("declined"))}),{default:t(()=>[v(" Decline ")]),_:2},1040),e(x,L({type:"button"},r,{color:"primary",variant:"flat",class:"text-none",onClick:c[1]||(c[1]=C=>d("accepted"))}),{default:t(()=>[e(k,{class:"mr-2"},{default:t(()=>[v("mdi-check")]),_:1}),v(" Accept ")]),_:2},1040)]),default:t(()=>[e(n,{class:"pa-5"},{default:t(()=>[e(i,{onSubmit:se(F,["prevent"]),ref_key:"formAcceptDecline",ref:b},{default:t(()=>[e(N,null,{default:t(()=>[e(T,{class:"d-flex justify-center"},{default:t(()=>[e(R,{modelValue:_.value,"onUpdate:modelValue":c[2]||(c[2]=r=>_.value=r),rules:m.value==="declined"?[r=>!!(r!=null&&r.trim())||"Required"]:[],label:"Remarks",placeholder:"Remarks",dense:"",rows:"3",variant:"outlined",class:"mt-5 w-100"},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(N,{justify:"end",class:"mt-7 mb-5"},{default:t(()=>[e(x,{variant:"plain",onClick:c[3]||(c[3]=r=>u.value=!1),color:"primary",class:"text-none mr-2"},{default:t(()=>[v(" Cancel")]),_:1}),e(x,{type:"submit",loading:f.value,color:"primary",variant:"flat",class:"text-none mr-5"},{default:t(()=>[v(y(m.value==="accepted"?"Accept":"Decline"),1)]),_:1},8,["loading"])]),_:1})]),_:1},512)]),_:1})]),_:1},8,["modelValue"])}}},Ie={class:"mt-4 text-primary"},je={class:"mt-4 text-danger"},Ee=l("p",null," Set the number of days for the observation period. ",-1),Fe={class:"text-danger"},Ue={class:"mt-4 text-primary"},Be={class:"text-danger"},et={__name:"OperationAfterService",props:{data:{type:Object,default:()=>({})}},emits:["refresh-data"],setup(g,{emit:V}){const M=Q.useToast();de();const h=ue(),{can:f}=fe(),u=K(),_=w(!1);w(!0),h.params.work_type;const m=g,{data:d}=H(m),D=V,o=q(()=>{var i,n;return(n=(i=d.value)==null?void 0:i.task_delegation)==null?void 0:n.monitoring_end}),b=q(()=>{var i,n;return(n=(i=d.value)==null?void 0:i.task_delegation)==null?void 0:n.id}),F=q(()=>{var i,n,s,r;return((n=(i=d.value)==null?void 0:i.task_delegation)==null?void 0:n.status_after_service)===X.operational&&(f("delegate",j)||f("installer",j))&&((r=(s=d.value)==null?void 0:s.task_delegation)==null?void 0:r.tag)===ee}),Y=q(()=>{var i,n,s,r;return((n=(i=d.value)==null?void 0:i.task_delegation)==null?void 0:n.status_after_service)===X.further_monitoring&&(f("delegate",j)||f("installer",j))&&((r=(s=d.value)==null?void 0:s.task_delegation)==null?void 0:r.tag)===pe}),c=q(()=>{var i,n,s,r;return((n=(i=d.value)==null?void 0:i.task_delegation)==null?void 0:n.status_after_service)===X.further_monitoring&&(f("delegate",j)||f("installer",j))&&((r=(s=d.value)==null?void 0:s.task_delegation)==null?void 0:r.tag)===ee}),x=async()=>{var i,n,s,r;_.value=!0;try{const C=await u.post("sendToCM",{id:b.value,pm_id:(i=d.value)==null?void 0:i.id,module:(s=(n=d.value)==null?void 0:n.task_delegation)==null?void 0:s.type});(r=C==null?void 0:C.data)!=null&&r.success&&(M.success("Successfully created for corrective maintenance"),D("refresh-data",!0))}catch(C){console.log(C)}finally{_.value=!1}},k=()=>{const i=z(o.value,"YYYY-MM-DD"),n=z().startOf("day"),s=i.diff(n,"days");return s<0?"The waiting period has elapsed by "+Math.abs(s)+" days":s},R=w(null),T=w(""),N=async()=>{var n;_.value=!0;const{valid:i}=await R.value.validate();if(!i){_.value=!1;return}try{const s=await u.post("setDaysObservation",{id:b.value,set_days:parseInt(T.value)});(n=s==null?void 0:s.data)!=null&&n.success&&(M.success("Successfully set"),D("refresh-data",!0))}catch(s){console.log(s)}finally{_.value=!1}};return(i,n)=>{const s=a("v-btn"),r=a("v-card-text"),C=a("v-spacer"),U=a("v-card-actions"),p=a("v-card"),O=a("v-dialog"),I=a("v-col"),J=a("v-row"),le=a("v-text-field"),re=a("v-form");return A(),ne(_e,null,[F.value?(A(),P(p,{key:0,class:"bg-orange-lighten-5 p-2 mb-7",transition:"fab-transition",elevation:"0"},{default:t(()=>[e(I,{cols:"12"},{default:t(()=>[e(J,null,{default:t(()=>[e(I,{cols:"12"},{default:t(()=>{var $,S;return[l("p",null,"After "+y(((S=($=B(d))==null?void 0:$.task_delegation)==null?void 0:S.type)==="pm"?"30":"10")+" days with no issues, it will be tagged as completed. If sent for CM or a problem occurs, it will be tagged as backjob",1),l("p",Ie,[v("Date montoring ends: "),l("b",null,y(B(z)(o.value).format("MMMM DD, YYYY")),1)]),l("p",je,[v("Monitoring days left: "),l("b",null,y(k()),1)]),e(O,{"max-width":"500"},{activator:t(({props:W})=>[e(s,L({color:"primary",variant:"tonal",text:"Send for CM",class:"text-none mt-4",loading:_.value,"prepend-icon":"mdi-transfer-right"},W),null,16,["loading"])]),default:t(({isActive:W})=>[e(p,{title:"Confirmation"},{default:t(()=>[e(r,null,{default:t(()=>[v(" Are you sure you want to proceed with this action? ")]),_:1}),e(U,null,{default:t(()=>[e(C),e(s,{text:"No",color:"primary",variant:"tonal",class:"text-none",onClick:Le=>W.value=!1},null,8,["onClick"]),e(s,{color:"primary",variant:"flat",text:"Yes, Proceed",class:"text-none",loading:_.value,"prepend-icon":"mdi-transfer-right",onClick:x},null,8,["loading"])]),_:2},1024)]),_:2},1024)]),_:1})]}),_:1})]),_:1})]),_:1})]),_:1})):G("",!0),Y.value?(A(),P(p,{key:1,class:"bg-teal-lighten-5 p-2 mb-7",transition:"fab-transition",elevation:"0"},{default:t(()=>[e(I,{cols:"12"},{default:t(()=>[e(J,null,{default:t(()=>[e(I,{cols:"12"},{default:t(()=>[Ee,e(O,{"max-width":"500"},{activator:t(({props:$})=>[e(s,L({color:"primary",variant:"tonal",text:"Set days of Observation",class:"text-none mt-4",loading:_.value,"prepend-icon":"mdi-transfer-right"},$),null,16,["loading"])]),default:t(({isActive:$})=>[e(p,{title:"Confirmation"},{default:t(()=>[e(r,null,{default:t(()=>[e(re,{ref_key:"form",ref:R},{default:t(()=>[e(le,{modelValue:T.value,"onUpdate:modelValue":n[0]||(n[0]=S=>T.value=S),variant:"outlined",color:"primary",rules:[S=>!!S||"Required",S=>/^[0-9]+$/.test(S)||"Must be a number",S=>S>=1&&S<=31||"Must be between 1 and 31"],label:"Set days of Observation",density:"compact"},null,8,["modelValue","rules"])]),_:1},512)]),_:1}),e(U,null,{default:t(()=>[e(C),e(s,{text:"No",color:"primary",variant:"tonal",class:"text-none",onClick:S=>$.value=!1},null,8,["onClick"]),e(s,{color:"primary",variant:"flat",text:"Yes, Proceed",class:"text-none",loading:_.value,"prepend-icon":"mdi-transfer-right",onClick:N},null,8,["loading"])]),_:2},1024)]),_:2},1024)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):G("",!0),c.value?(A(),P(p,{key:2,class:"bg-teal-lighten-5 p-2 mb-7",transition:"fab-transition",elevation:"0"},{default:t(()=>[e(I,{cols:"12"},{default:t(()=>[e(J,null,{default:t(()=>[e(I,{cols:"12"},{default:t(()=>[l("p",null,[v(" After "),l("b",Fe,y(B(z)(o.value).format("MMMM DD, YYYY")),1),v(" with no issues, it will be marked as completed. If sent for CM or a problem occurs, it will be tagged as non-operational ")]),l("p",Ue,[v("Monitoring days left: "),l("b",Be,y(k()),1)]),e(O,{"max-width":"500"},{activator:t(({props:$})=>[e(s,L({color:"primary",variant:"tonal",text:"Send for CM",class:"text-none mt-4",loading:_.value,"prepend-icon":"mdi-transfer-right"},$),null,16,["loading"])]),default:t(({isActive:$})=>[e(p,{title:"Confirmation"},{default:t(()=>[e(r,null,{default:t(()=>[v(" Are you sure you want to proceed with this action? ")]),_:1}),e(U,null,{default:t(()=>[e(C),e(s,{text:"No",color:"primary",variant:"tonal",class:"text-none",onClick:S=>$.value=!1},null,8,["onClick"]),e(s,{color:"primary",variant:"flat",text:"Yes, Proceed",class:"text-none",loading:_.value,"prepend-icon":"mdi-transfer-right",onClick:x},null,8,["loading"])]),_:2},1024)]),_:2},1024)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):G("",!0)],64)}}};export{He as P,Qe as _,Ze as a,et as b,Ke as c};
