import{g as Ve,r as o,s as Ce,A as le,ak as ke,P as B,c as Ie,v as De,u as Me,D as Re,x as Te,f,w as l,S as ae,U as oe,o as u,h as a,E as V,H as y,m as h,j as m,n as C,y as F,F as Y,k as p,t as k,V as Ae,I as Ne,e as c,a2 as ne,L as Ue,M as Pe}from"./index-C8ph-EQq.js";import{s as q,a as Oe,t as Be,S as Fe}from"./maintenance-sOfZEb8F.js";import{d as Ye}from"./debounce-VX6vs7ks.js";import{g as qe}from"./vue3-datatable-BuM4cnvr.js";/* empty css              */import{O as ze}from"./main-Z0aCj2Rp.js";import{L as Le}from"./LayoutWithActions-lJJIN9jM.js";import{p as je}from"./permitted-BzPEUTiR.js";import{_ as Ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./topBarUserProfile-ExGO6QtX.js";import"./logout-D7B5usQQ.js";const z=w=>(Ue("data-v-1e1fa10d"),w=w(),Pe(),w),Je=z(()=>p("span",{class:"ml-2"},null,-1)),He=z(()=>p("span",{class:"ml-2"},null,-1)),We={style:{position:"absolute",bottom:"0!important",left:"0",width:"100%"},class:"d-flex justify-content-center"},$e={color:"primary"},Ge=z(()=>p("br",null,null,-1)),Ke={key:0,class:"small"},Qe={__name:"Corrective",setup(w){const L=Ve().currentUserRole,j=o(null),{width:se}=Ce(),{can:re}=je(),I=o(!1),E=o(!1),J=o(!1),H=o(!1);o(!1);const D=o({filterOptions:[]});le(D,e=>{localStorage.setItem("filterChip",JSON.stringify(e)),g()},{deep:!0});const s=o({filterStatus:[],filterInstitution:[],filterSchedule_at:"",filterStatusAfterService:[],filterTag:[]});le(s,e=>{localStorage.setItem("PMFilterState",JSON.stringify(e)),g()},{deep:!0}),o(!1);const W=ke(()=>Object.values(s.value).filter(e=>Array.isArray(e)&&e.length>0||typeof e=="string"&&e.trim()!=="").length),ie=()=>{s.value={filterOptions:[],filterStatus:[],filterInstitution:[],filterSchedule_at:"",filterStatusAfterService:[],filterTag:[]},localStorage.removeItem("PMFilterState"),localStorage.removeItem("filterChip")},M=o(""),ue=o("PMView");o(null);const R=o(!0),$=o(null),G=o(null);re("create","Preventive Maintenance")&&(G.value="CreatePM");const ce={selectedId:$,btnDisable:R,routeView:ue,work_type:"CM",createRequest:G.value};B("data",ce),Ie();const K=De(),de=Me();o(!1),o(!1);const me=o([]),fe=o([]);o(!1),o(""),o({}),o([]),o([]),o({serial_number:[e=>!!e||"Required field"]});const Q=o([]),pe=e=>{Q.value=j.value.getSelectedRows(),e.length===1?R.value=!1:R.value=!0,$.value=e.map(t=>t.id)[0]},ve=e=>Q.value.map(i=>i.id).includes(e.id)?"highlightRow":"",_e=e=>{de.push({name:"PMView",params:{id:e.id,work_type:"CM"}})},he=e=>{d.search=e},T=o(!0),X=o(0),d=Re({current_page:1,pagesize:10,sort_column:"scheduled_at",sort_direction:"desc",search:""}),A=o(null),N=o([{field:"id",title:"ID",isUnique:!0,type:"number",hide:!1},{field:"item_id",title:"Item No",hide:!0},{field:"item_code",title:"Item Code"},{field:"description",title:"Item Description",hide:!0},{field:"serial",title:"Serial No."},{field:"institution_name",title:"Institution"},{field:"address",title:"Address",hide:!0},{field:"ssu",title:"SSU"},{field:"username",title:"Delegated to"},{field:"delegation_date",title:"Delegation Date"},{field:"date_accepted",title:"Date Accepted"},{field:"departed_date",title:"Date Out"},{field:"travel_duration",title:"Travel Time"},{field:"start_date",title:"Time In"},{field:"end_date",title:"Time Out"},{field:"status_after_service",title:"Status After Service"},{field:"status",title:"Status"},{field:"tag",title:"Tag"}])||[],ge=N.value.reduce((e,t)=>(t.title&&t.field&&(e[t.title]=t.field),e),{});B("column",N);const g=async()=>{L===ae&&(M.value=ae),L===oe&&(M.value=oe);try{T.value=!0;const e=await K.get("get-preventive-maintenance",{params:{...d,category:M.value,...s.value,...D.value,work_type:"CM"}});if(e.data&&e.data.pm_data){const t=e.data.pm_data;A.value=t.data,X.value=t.total,me.value=t.data.map(i=>i.item_id),fe.value=t.data.map(i=>i.item_id)}}catch(e){console.log(e)}T.value=!1};B("refresh",g);const Z=o([]),U=o(!1),Se=async()=>{try{U.value=!0;const e=await K.get("get_institution");if(e.data&&e.data.institutions){const t=e.data.institutions;Z.value=t.map(i=>({iName:i.name,iId:i.id}))}}catch(e){console.log(e)}finally{U.value=!1}},ye=Ye(g,300),we=e=>{d.current_page=e.current_page,d.pagesize=e.pagesize,d.sort_column=e.sort_column,d.sort_direction=e.sort_direction,e.change_type==="search"?ye():g()};return Te(()=>{const e=localStorage.getItem("PMFilterState"),t=localStorage.getItem("filterChip");e&&(s.value=JSON.parse(e)),t&&(D.value=JSON.parse(t)),g(),Se()}),(e,t)=>{const i=c("v-badge"),v=c("v-btn"),P=c("v-icon"),O=c("v-checkbox"),b=c("v-card"),x=c("v-menu"),_=c("v-col"),be=c("v-combobox"),ee=c("v-spacer"),te=c("v-row"),xe=c("download-excel");return u(),f(Le,{onSearchText:he},{filter:l(()=>[a(te,null,{default:l(()=>[a(_,{cols:"12",class:"d-flex justify-content-between"},{default:l(()=>[a(x,{modelValue:I.value,"onUpdate:modelValue":t[9]||(t[9]=n=>I.value=n),"close-on-content-click":!1,location:"bottom",transition:"slide-x-reverse-transition"},{activator:l(({props:n})=>[a(v,V({color:"primary","prepend-icon":"mdi-filter-outline",variant:"tonal",text:"Advanced filtering",class:"text-none mb-4"},n),{append:l(()=>[W.value>0?(u(),f(i,{key:0,color:"warning",content:W.value,inline:""},null,8,["content"])):y("",!0)]),_:2},1040)]),default:l(()=>[a(b,{"min-width":"350",width:h(se)<500?"350":"450","max-width":"450","min-height":"500",style:{"overflow-x":"hidden!important"}},{default:l(()=>[a(te,null,{default:l(()=>[a(_,{cols:"12"},{default:l(()=>[a(_,{cols:"12"},{default:l(()=>[a(x,{modelValue:E.value,"onUpdate:modelValue":t[1]||(t[1]=n=>E.value=n),"close-on-content-click":!1,height:"auto",location:"bottom","min-width":"auto"},{activator:l(({props:n})=>[a(v,V({color:"primary",variant:"tonal"},n,{class:"text-none w-50 text-left"}),{default:l(()=>[s.value.filterStatus.length>0?(u(),f(i,{key:0,color:"primary",content:s.value.filterStatus.length,class:"mr-3 ml-2"},null,8,["content"])):y("",!0),m(" Status "),a(P,null,{default:l(()=>[m("mdi-chevron-down")]),_:1})]),_:2},1040)]),default:l(()=>[a(b,{width:"auto",class:"pr-3"},{default:l(()=>[(u(!0),C(Y,null,F(Oe,(n,r)=>(u(),f(O,{modelValue:s.value.filterStatus,"onUpdate:modelValue":t[0]||(t[0]=S=>s.value.filterStatus=S),class:"columnChooserCheckBox",label:q(n).text,value:n,key:n},null,8,["modelValue","label","value"]))),128))]),_:1})]),_:1},8,["modelValue"]),Je,a(x,{modelValue:H.value,"onUpdate:modelValue":t[3]||(t[3]=n=>H.value=n),"close-on-content-click":!1,"min-width":"400",width:"400",height:"auto",location:"bottom",class:"ml-3"},{activator:l(({props:n})=>[a(v,V({color:"primary",variant:"tonal"},n,{class:"text-none"}),{default:l(()=>[s.value.filterTag.length>0?(u(),f(i,{key:0,color:"primary",content:s.value.filterTag.length,class:"mr-3"},null,8,["content"])):y("",!0),m(" Tag as"),a(P,null,{default:l(()=>[m("mdi-chevron-down")]),_:1})]),_:2},1040)]),default:l(()=>[a(b,{width:"auto",class:"pr-3"},{default:l(()=>[(u(!0),C(Y,null,F(Be,(n,r)=>(u(),f(O,{modelValue:s.value.filterTag,"onUpdate:modelValue":t[2]||(t[2]=S=>s.value.filterTag=S),class:"columnChooserCheckBox",label:n,value:n,key:r},null,8,["modelValue","label","value"]))),128))]),_:1})]),_:1},8,["modelValue"]),a(x,{modelValue:J.value,"onUpdate:modelValue":t[5]||(t[5]=n=>J.value=n),"close-on-content-click":!1,"min-width":"400",width:"400",height:"auto",location:"bottom",class:"ml-3"},{activator:l(({props:n})=>[a(v,V({color:"primary",variant:"tonal"},n,{class:"text-none w-100 mt-5"}),{default:l(()=>[s.value.filterStatusAfterService.length>0?(u(),f(i,{key:0,color:"primary",content:s.value.filterStatusAfterService.length,class:"mr-3"},null,8,["content"])):y("",!0),m(" Status After Service "),a(P,null,{default:l(()=>[m("mdi-chevron-down")]),_:1})]),_:2},1040)]),default:l(()=>[a(b,{width:"auto",class:"pr-3"},{default:l(()=>[(u(!0),C(Y,null,F(Fe,(n,r)=>(u(),f(O,{modelValue:s.value.filterStatusAfterService,"onUpdate:modelValue":t[4]||(t[4]=S=>s.value.filterStatusAfterService=S),class:"columnChooserCheckBox",label:n,value:n,key:r},null,8,["modelValue","label","value"]))),128))]),_:1})]),_:1},8,["modelValue"]),He]),_:1}),a(_,{cols:"12"},{default:l(()=>[a(be,{loading:U.value,color:"primary",modelValue:s.value.filterInstitution,"onUpdate:modelValue":t[6]||(t[6]=n=>s.value.filterInstitution=n),label:"Institution",density:"compact",items:Z.value,chips:"","closable-chips":"","single-line":"",itemValue:"iId",variant:"outlined",itemTitle:"iName",multiple:""},null,8,["loading","modelValue","items"])]),_:1}),a(_,{cols:"12"},{default:l(()=>[a(h(ze),{modelValue:s.value.filterSchedule_at,"onUpdate:modelValue":t[7]||(t[7]=n=>s.value.filterSchedule_at=n),"auto-apply":"",range:"","model-type":"yyyy-MM-dd","enable-time-picker":!1,"month-change-on-scroll":!1,placeholder:"Schedule at"},null,8,["modelValue"])]),_:1}),a(_,{cols:"12"},{default:l(()=>[p("div",We,[a(ee),a(v,{variant:"tonal",onClick:t[8]||(t[8]=n=>I.value=!1),class:"text-none rounded-0",style:{width:"50%"}},{default:l(()=>[m(" Close ")]),_:1}),a(v,{color:"primary",variant:"flat","prepend-icon":"mdi-close",onClick:ie,class:"text-none rounded-0",style:{width:"50%"}},{default:l(()=>[m(" Clear ")]),_:1})])]),_:1}),a(_,{cols:"12"})]),_:1})]),_:1})]),_:1},8,["width"])]),_:1},8,["modelValue"]),a(ee),a(xe,{data:A.value,type:"xlsx",fields:h(ge),name:"PreventiveMaintenance - "+h(ne)().format("MM-DD-YYYY")},{default:l(()=>[a(v,{text:"Export","prepend-icon":"mdi-download",variant:"tonal",color:"primary",class:"text-none ml-2"})]),_:1},8,["data","fields","name"])]),_:1})]),_:1})]),default:l(({searchText:n})=>[a(h(qe),{ref_key:"datatable",ref:j,rows:A.value,columns:h(N),loading:T.value,search:d.search,isServerMode:!0,totalRows:X.value,pageSize:d.pagesize,onChange:we,onRowSelect:pe,columnFilter:!1,sortColumn:d.sort_column,sortDirection:d.sort_direction,sortable:!0,style:{border:"1px solid #99999926","border-radius":"3px"},skin:"bh-table-compact bh-table-bordered bh-table-striped bh-table-hover",hasCheckbox:!0,selectRowOnClick:!0,onRowDBClick:_e,rowClass:ve},{id:l(r=>[m(k("PM-"+r.value.id),1)]),scheduled_at:l(r=>[p("div",null,k(h(ne)(r.value.scheduled_at).format("MMMM DD, YYYY")),1)]),service_id:l(r=>[p("span",$e,k(Ae(r.value.service_id)),1)]),status:l(r=>[p("span",{style:Ne({color:q(r.value.status).color})},[p("b",null,k(q(r.value.status).text),1)],4),Ge,r.value.status==="Not Set"?(u(),C("span",Ke,"Contact the admin to configure the frequency")):y("",!0)]),_:1},8,["rows","columns","loading","search","totalRows","pageSize","sortColumn","sortDirection"])]),_:1})}}},ct=Ee(Qe,[["__scopeId","data-v-1e1fa10d"]]);export{ct as default};
