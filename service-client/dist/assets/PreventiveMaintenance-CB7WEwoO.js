import{d as ie,c as re,u as ce,x as ue,g as de,r as s,v as me,C as pe,aG as U,V,E as _e,y as fe,f as y,w as t,o as _,h as a,j as f,I as M,_ as ve,M as he,n as d,p as B,z as ge,F as be,t as v,k as g,aH as ye,a2 as xe,P as we,e as i,X as Se}from"./index-BVXPU9zS.js";import{s as E,a as Ce}from"./maintenance-D6-EqnL4.js";import{d as ke}from"./debounce-KHlJyMIn.js";import{g as De}from"./vue3-datatable-C2ljW4qF.js";import{L as Ve}from"./LayoutWithActions-BLO8pnbP.js";import{a as Me}from"./getInstitution-BQ_ruXxw.js";import{p as Ie}from"./permitted-CQa1RmFG.js";import{n as Re}from"./filters-CoHlS7tX.js";import{_ as Pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./topBarUserProfile-DtdqdVcI.js";const Fe={color:"primary"},Ne={key:0},qe={__name:"PreventiveMaintenance",setup(ze){const A=ie.useToast(),{institutionData:L}=Me(),{can:x}=Ie();re();const Y=ce(),I=ue(),j=de().currentUserRole,R=s(null);me();const h=s(!1),c=s({filterStatus:[],filterInstitution:[],assignment:!1}),P=s(0);pe(c,e=>{P.value=Re(e),localStorage.setItem("PMFilter",JSON.stringify(e)),r.current_page=1,m()},{deep:!0});const F=s(null),O=s("PMView"),b=s(!0),w=s(null);x("create","Preventive Maintenance")&&(F.value="CreatePM");const J=async()=>{var e;try{(e=(await I.delete(`delete_pm/${w.value}`)).data)!=null&&e.success&&(A.success("Deleted successfully"),m(),b.value=!0)}catch(l){console.log(l)}},G={selectedId:w,btnDisable:b,routeView:O,createRequest:F.value,deleteFunction:x("delete",U)?J:null};V("data",G);const N=s([]),H=e=>{N.value=R.value.getSelectedRows(),e.length===1?b.value=!1:b.value=!0,w.value=e.map(l=>l.id)[0]},W=e=>N.value.map(p=>p.id).includes(e.id)?"highlightRow":"",X=e=>{Y.push({name:"PMView",params:{id:e.id}})},$=e=>{r.search=e},S=s(!0),q=s(0),r=_e({current_page:1,pagesize:10,sort_column:"scheduled_at",sort_direction:"desc",search:""}),C=s(null),k=s([{field:"id",title:"ID",isUnique:!0,type:"number",hide:!1},{field:"service_id",title:"Service No",hide:!0},{field:"item_id",title:"Item No",hide:!0},{field:"item_code",title:"Item Code"},{field:"equipment",title:"Equipment"},{field:"description",title:"Item Description",hide:!0},{field:"serial",title:"Serial No."},{field:"institution_name",title:"Institution"},{field:"address",title:"Address",hide:!0},{field:"date_installed",title:"Date Installed",hide:!0},{field:"scheduled_at",title:"Scheduled at"},{field:"frequency",title:"Frequency"},{field:"sbu",title:"SBU",hide:!1},{field:"delegated_by",title:"Delegated by"},{field:"delegated_to",title:"Delegated to"},{field:"created_at",title:"Date Created"},{field:"status",title:"Status",cellClass:"sticky-last",headerClass:"sticky-last-header"}])||[],K=k.value.reduce((e,l)=>(l.title&&l.field&&(e[l.title]=l.field),e),{});V("column",k);const m=async()=>{var e;try{S.value=!0;const l=await I.get("get-preventive-maintenance",{params:{...r,...c.value,current_role:j}});if((e=l==null?void 0:l.data)!=null&&e.pm_data){const p=l.data.pm_data;C.value=p.data,q.value=p.total}}catch(l){console.log(l)}S.value=!1};V("refresh",m);const Q=ke(m,300),Z=e=>{r.current_page=e.current_page,r.pagesize=e.pagesize,r.sort_column=e.sort_column,r.sort_direction=e.sort_direction,e.change_type==="search"?Q():m()};return fe(()=>{const e=localStorage.getItem("PMFilter");e&&(c.value=JSON.parse(e)),m()}),(e,l)=>{const p=i("v-tooltip"),D=i("v-checkbox"),z=i("v-badge"),ee=i("v-combobox"),u=i("v-col"),te=i("v-icon"),le=i("v-card"),ae=i("v-menu"),T=i("v-btn"),oe=i("download-excel"),se=i("v-row"),ne=i("v-chip");return _(),y(Ve,{onSearchText:$},{filter:t(()=>[a(se,null,{default:t(()=>[a(u,{cols:"12",md:"6",sm:"6",class:"d-flex justify-space-between align-items-center pa-0"},{default:t(()=>[a(z,{color:"warning",dense:"",content:P.value,"offset-y":5},{default:t(()=>[a(D,{"false-icon":"mdi-filter-menu","true-icon":"mdi-close",color:"primary",modelValue:h.value,"onUpdate:modelValue":l[0]||(l[0]=n=>h.value=n)},{default:t(()=>[h.value?M("",!0):(_(),y(p,{key:0,activator:"parent"},{default:t(()=>[f("Expanded Filter")]),_:1}))]),_:1},8,["modelValue"])]),_:1},8,["content"]),a(ve,{name:"slide-x-transition"},{default:t(()=>[a(u,{class:"d-flex",style:he({visibility:h.value?"visible":"hidden",opacity:h.value?"1":"0"})},{default:t(()=>[a(u,{cols:"12",md:"6",sm:"6",class:"pa-0 mr-1"},{default:t(()=>[a(ee,{transition:"slide-x-transition",color:"primary",modelValue:c.value.filterInstitution,"onUpdate:modelValue":l[1]||(l[1]=n=>c.value.filterInstitution=n),label:"Institution",density:"compact",items:d(L),chips:"","closable-chips":"","single-line":"",itemValue:"institution_id",variant:"outlined",itemTitle:"key",multiple:""},null,8,["modelValue","items"])]),_:1}),a(u,{cols:"auto",class:"pa-0 mr-1"},{default:t(()=>[a(T,{color:"primary",variant:"plain",class:"text-none"},{prepend:t(()=>{var n;return[a(z,{color:"primary",content:(n=c.value.filterStatus)==null?void 0:n.length,inline:""},null,8,["content"])]}),default:t(()=>[f(" Status "),a(te,null,{default:t(()=>[f("mdi-chevron-down")]),_:1}),a(ae,{transition:"slide-x-transition","close-on-content-click":!1,height:"auto",location:"bottom",activator:"parent"},{default:t(()=>[a(le,{width:"auto",class:"pr-3"},{default:t(()=>[(_(!0),B(be,null,ge(Ce,n=>(_(),y(D,{modelValue:c.value.filterStatus,"onUpdate:modelValue":l[2]||(l[2]=o=>c.value.filterStatus=o),class:"columnChooserCheckBox",label:n.text,value:n.key},null,8,["modelValue","label","value"]))),256))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["style"])]),_:1})]),_:1}),a(u,{cols:"12",md:"6",sm:"6",class:"d-flex d-inline-flex align-center align-content-center justify-end"},{default:t(()=>[a(u,{cols:"8"},{default:t(()=>[d(x)("delegate",d(U))?(_(),y(D,{key:0,label:"Next Month Assignments",class:"mr-3",color:"primary",inline:"",modelValue:c.value.assignment,"onUpdate:modelValue":l[3]||(l[3]=n=>c.value.assignment=n)},null,8,["modelValue"])):M("",!0)]),_:1}),a(u,{cols:"auto"},{default:t(()=>[a(oe,{data:C.value,type:"xlsx",fields:d(K),name:"PreventiveMaintenance - "+d(Se)().format("MM-DD-YYYY")},{default:t(()=>[a(T,{text:"Export","prepend-icon":"mdi-download",density:"compact",variant:"tonal",color:"primary",class:"text-none"})]),_:1},8,["data","fields","name"])]),_:1})]),_:1})]),_:1})]),default:t(({searchText:n})=>[a(d(De),{ref_key:"datatable",ref:R,rows:C.value,columns:d(k),loading:S.value,search:r.search,isServerMode:!0,totalRows:q.value,pageSize:r.pagesize,onChange:Z,onRowSelect:H,columnFilter:!1,sortColumn:r.sort_column,sortDirection:r.sort_direction,sortable:!0,class:"tableLimitText sticky-last-header",style:{border:"1px solid #99999926","border-radius":"3px"},skin:"bh-table-compact bh-table-bordered bh-table-striped bh-table-hover",hasCheckbox:!0,selectRowOnClick:!0,onRowDBClick:X,rowClass:W,cellClass:"internalCell"},{id:t(o=>[f(v("PM-"+o.value.id),1)]),scheduled_at:t(o=>[g("div",null,v(ye(o.value.scheduled_at)),1)]),service_id:t(o=>[g("span",Fe,v(xe(o.value.service_id)),1)]),sbu:t(o=>[g("span",null,[o.value.sbu?(_(),B("i",Ne,"SBU - ")):M("",!0),f(v(o.value.sbu),1)])]),created_at:t(o=>[g("span",null,v(we(o.value.created_at)),1)]),status:t(o=>[g("span",null,[a(ne,{color:E(o.value.status).color,label:"",size:"small"},{default:t(()=>[f(v(E(o.value.status).text),1)]),_:2},1032,["color"])])]),_:1},8,["rows","columns","loading","search","totalRows","pageSize","sortColumn","sortDirection"])]),_:1})}}},He=Pe(qe,[["__scopeId","data-v-8c282333"]]);export{He as default};
