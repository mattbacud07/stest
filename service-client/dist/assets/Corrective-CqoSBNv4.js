import{c as ne,u as ie,x as re,g as ce,r as l,v as ue,C as de,aJ as U,V as C,E as me,y as pe,f as S,w as o,o as f,h as a,j as p,I as E,_ as _e,M as fe,n as v,p as P,z as ve,F as he,t as g,k,P as ge,e as s,X as be}from"./index-BVXPU9zS.js";import{s as T,d as ye}from"./maintenance-D6-EqnL4.js";import{d as xe}from"./debounce-KHlJyMIn.js";import{g as we}from"./vue3-datatable-C2ljW4qF.js";import"./vue-datepicker-B1Ef9scS.js";/* empty css             */import{L as Ce}from"./LayoutWithActions-BLO8pnbP.js";import{a as Se}from"./getInstitution-BQ_ruXxw.js";import{p as ke}from"./permitted-CQa1RmFG.js";import{n as De}from"./filters-CoHlS7tX.js";import{_ as Ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./topBarUserProfile-DtdqdVcI.js";const Ie={key:0},Me={__name:"Corrective",setup(Re){const{institutionData:Y}=Se(),{can:D}=ke();ne();const j=ie(),V=re(),A=ce().currentUserRole,I=l(null);ue();const _=l(!1),c=l({filterStatus:[],filterInstitution:[],assignment:!1}),M=l(0);de(c,e=>{M.value=De(e),localStorage.setItem("CMFilter",JSON.stringify(e)),n.current_page=1,u()},{deep:!0}),l("");const J=l("CMView");l(null);const h=l(!0),b=l(null),R=l(null);D("create",U)&&(R.value="CreateCM");const L=async()=>{var e;try{(e=(await V.delete(`delete_cm/${b.value}`)).data)!=null&&e.success&&(toast.success("Deleted successfully"),u(),h.value=!0)}catch(t){console.log(t)}},O={selectedId:b,btnDisable:h,routeView:J,createRequest:R.value,deleteFunction:D("delete",U)?L:null};C("data",O);const F=l([]),W=e=>{F.value=I.value.getSelectedRows(),e.length===1?h.value=!1:h.value=!0,b.value=e.map(t=>t.id)[0]},X=e=>F.value.map(d=>d.id).includes(e.id)?"highlightRow":"",$=e=>{j.push({name:"CMView",params:{id:e.id}})},G=e=>{n.search=e},y=l(!0),q=l(0),n=me({current_page:1,pagesize:10,sort_column:"created_at",sort_direction:"desc",search:""}),x=l(null),w=l([{field:"id",title:"ID",isUnique:!0,type:"number",hide:!1},{field:"service_id",title:"Service No",hide:!0},{field:"item_id",title:"Item No",hide:!0},{field:"item_code",title:"Item Code"},{field:"equipment",title:"Equipment"},{field:"description",title:"Item Description",hide:!0},{field:"serial",title:"Serial No."},{field:"institution_name",title:"Institution"},{field:"address",title:"Address",hide:!0},{field:"frequency",title:"Frequency"},{field:"sbu",title:"SBU",hide:!1},{field:"delegated_by",title:"Delegated by"},{field:"delegated_to",title:"Delegated to"},{field:"created_at",title:"Date Created"},{field:"status",title:"Status",cellClass:"sticky-last",headerClass:"sticky-last-header"}])||[],H=w.value.reduce((e,t)=>(t.title&&t.field&&(e[t.title]=t.field),e),{});C("column",w);const u=async()=>{var e;try{y.value=!0;const t=await V.get("get-corrective-maintenance",{params:{...n,...c.value,current_role:A}});if((e=t==null?void 0:t.data)!=null&&e.cm_data){const d=t.data.cm_data;x.value=d.data,q.value=d.total}}catch(t){console.log(t)}y.value=!1};C("refresh",u);const K=xe(u,300),Q=e=>{n.current_page=e.current_page,n.pagesize=e.pagesize,n.sort_column=e.sort_column,n.sort_direction=e.sort_direction,e.change_type==="search"?K():u()};return pe(()=>{const e=localStorage.getItem("CMFilter");e&&(c.value=JSON.parse(e)),u()}),(e,t)=>{const d=s("v-tooltip"),z=s("v-checkbox"),N=s("v-badge"),Z=s("v-combobox"),m=s("v-col"),ee=s("v-icon"),te=s("v-card"),oe=s("v-menu"),B=s("v-btn"),ae=s("download-excel"),le=s("v-row"),se=s("v-chip");return f(),S(Ce,{onSearchText:G},{filter:o(()=>[a(le,null,{default:o(()=>[a(m,{cols:"12",md:"6",sm:"6",class:"d-flex justify-space-between align-items-center pa-0"},{default:o(()=>[a(N,{color:"warning",dense:"",content:M.value,"offset-y":5},{default:o(()=>[a(z,{"false-icon":"mdi-filter-menu","true-icon":"mdi-close",color:"primary",modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=r=>_.value=r)},{default:o(()=>[_.value?E("",!0):(f(),S(d,{key:0,activator:"parent"},{default:o(()=>[p("Expanded Filter")]),_:1}))]),_:1},8,["modelValue"])]),_:1},8,["content"]),a(_e,{name:"slide-x-transition"},{default:o(()=>[a(m,{class:"d-flex",style:fe({visibility:_.value?"visible":"hidden",opacity:_.value?"1":"0"})},{default:o(()=>[a(m,{cols:"12",md:"6",sm:"6",class:"pa-0 mr-1"},{default:o(()=>[a(Z,{transition:"slide-x-transition",color:"primary",modelValue:c.value.filterInstitution,"onUpdate:modelValue":t[1]||(t[1]=r=>c.value.filterInstitution=r),label:"Institution",density:"compact",items:v(Y),chips:"","closable-chips":"","single-line":"",itemValue:"institution_id",variant:"outlined",itemTitle:"key",multiple:""},null,8,["modelValue","items"])]),_:1}),a(m,{cols:"auto",class:"pa-0 mr-1"},{default:o(()=>[a(B,{color:"primary",variant:"plain",class:"text-none"},{prepend:o(()=>{var r;return[a(N,{color:"primary",content:(r=c.value.filterStatus)==null?void 0:r.length,inline:""},null,8,["content"])]}),default:o(()=>[p(" Status "),a(ee,null,{default:o(()=>[p("mdi-chevron-down")]),_:1}),a(oe,{transition:"slide-x-transition","close-on-content-click":!1,height:"auto",location:"bottom",activator:"parent"},{default:o(()=>[a(te,{width:"auto",class:"pr-3"},{default:o(()=>[(f(!0),P(he,null,ve(ye,r=>(f(),S(z,{modelValue:c.value.filterStatus,"onUpdate:modelValue":t[2]||(t[2]=i=>c.value.filterStatus=i),class:"columnChooserCheckBox",label:r.text,value:r.key},null,8,["modelValue","label","value"]))),256))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["style"])]),_:1})]),_:1}),a(m,{cols:"12",md:"6",sm:"6",class:"d-flex d-inline-flex align-center align-content-center justify-end"},{default:o(()=>[a(m,{cols:"auto"},{default:o(()=>[a(ae,{data:x.value,type:"xlsx",fields:v(H),name:"PreventiveMaintenance - "+v(be)().format("MM-DD-YYYY")},{default:o(()=>[a(B,{text:"Export","prepend-icon":"mdi-download",density:"compact",variant:"tonal",color:"primary",class:"text-none"})]),_:1},8,["data","fields","name"])]),_:1})]),_:1})]),_:1})]),default:o(({searchText:r})=>[a(v(we),{ref_key:"datatable",ref:I,rows:x.value,columns:v(w),loading:y.value,search:n.search,isServerMode:!0,totalRows:q.value,pageSize:n.pagesize,onChange:Q,onRowSelect:W,columnFilter:!1,sortColumn:n.sort_column,sortDirection:n.sort_direction,sortable:!0,style:{border:"1px solid #99999926","border-radius":"3px"},skin:"bh-table-compact bh-table-bordered bh-table-striped bh-table-hover",hasCheckbox:!0,selectRowOnClick:!0,onRowDBClick:$,rowClass:X},{id:o(i=>[p(g("CM-"+i.value.id),1)]),sbu:o(i=>[k("span",null,[i.value.sbu?(f(),P("i",Ie,"SBU - ")):E("",!0),p(g(i.value.sbu),1)])]),created_at:o(i=>[k("span",null,g(ge(i.value.created_at)),1)]),status:o(i=>[k("span",null,[a(se,{color:T(i.value.status).color,label:"",size:"small"},{default:o(()=>[p(g(T(i.value.status).text),1)]),_:2},1032,["color"])])]),_:1},8,["rows","columns","loading","search","totalRows","pageSize","sortColumn","sortDirection"])]),_:1})}}},Le=Ve(Me,[["__scopeId","data-v-274711ee"]]);export{Le as default};
