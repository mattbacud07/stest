import{g as ke,d as Pe,an as xe,r as o,ap as pe,A as _e,x as ve,e as a,o as u,f as Q,w as t,h as e,m as I,S as at,E as se,j as n,H as Y,k as l,n as $,c as Se,v as we,U as he,D as lt,F as Z,y as ie,t as O,ar as ye,as as ge,L as $e,M as Ue,ao as ot,s as Le,N as me,I as nt,aj as Be,a2 as be,u as st,P as Oe,i as Ye,a4 as rt}from"./index-C8ph-EQq.js";import{L as it}from"./LayoutSinglePage-CszXxlTG.js";import{b as We,I as re,s as ze,S as Me,c as Fe,d as ut,D as ct,A as dt,e as mt}from"./maintenance-sOfZEb8F.js";import{d as _t}from"./debounce-VX6vs7ks.js";import{g as pt}from"./vue3-datatable-BuM4cnvr.js";/* empty css              */import{_ as Re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{p as He}from"./permitted-BzPEUTiR.js";import"./topBarUserProfile-ExGO6QtX.js";import"./logout-D7B5usQQ.js";const vt=l("h5",{class:"text-primary"},"Customer Details",-1),ft={class:"text-red ml-2 mt-5 mb-3"},yt={key:0,class:"text-success mr-7"},gt={__name:"CustomerDetails",props:{status:{type:String,default:""}},emits:["set-confirm-serial","set-signature"],setup(q,{emit:m}){const h=ke().currentUserRole;Pe.useToast();const E=m,p=q,{status:c}=xe(p),U=o(!0),M=o(!1),V=o(null),w=o(null),N=()=>{const{isEmpty:W,data:r}=V.value.saveSignature();W&&alert("No signature to save"),w.value=r,E("set-signature",r)},f=()=>{V.value.clearSignature(),w.value=null,E("set-signature",w.value)},x=o({serial:"",institution:"",address:"",item_code:"",item_description:""}),ee=o(pe("pm_data"));_e(ee,W=>{if(W){const r=W.equipment,S=W;x.value={serial:S.serial||"---",institution:S.institution_name||"---",address:S.address||"---",item_code:r.item_code||"---",item_description:r.description||"---"}}},{immediate:!0});const F=()=>{x.value.serial===""||x.value.serial.trim()===""?E("set-confirm-serial",null):E("set-confirm-serial",x.value.serial)};return ve(()=>{}),(W,r)=>{const S=a("v-col"),P=a("v-row"),A=a("v-text-field"),y=a("v-icon"),g=a("v-btn"),i=a("VueSignaturePad"),G=a("v-card-actions"),L=a("v-card"),j=a("v-dialog");return u(),Q(L,{class:"mt-3",elevation:"1"},{default:t(()=>[e(S,{cols:"12"},{default:t(()=>[e(P,null,{default:t(()=>[e(S,{class:"d-flex justify-content-between"},{default:t(()=>[vt]),_:1})]),_:1}),e(P,null,{default:t(()=>[e(S,{cols:"12",lg:"6",md:"6",sm:"6"},{default:t(()=>[e(A,{modelValue:x.value.serial,"onUpdate:modelValue":r[0]||(r[0]=_=>x.value.serial=_),onInput:F,color:"primary",variant:"outlined",density:"compact",label:"Serial No.",placeholder:"Serial No.",readonly:I(h)===at&&I(c)===We?!1:U.value},null,8,["modelValue","readonly"])]),_:1}),I(c)===re?(u(),Q(S,{key:0,cols:"12",lg:"6",md:"6",sm:"6"},{default:t(()=>[e(j,{modelValue:M.value,"onUpdate:modelValue":r[2]||(r[2]=_=>M.value=_),full:"",persistent:"","min-height":"320"},{activator:t(({props:_})=>[e(g,se({type:"button"},_,{color:"primary",class:"text-none mr-2"}),{default:t(()=>[e(y,{class:"mr-2"},{default:t(()=>[n("mdi-draw-pen")]),_:1}),n(" Client Signatture")]),_:2},1040),n(),w.value?(u(),Q(y,{key:0,class:"text-success"},{default:t(()=>[n("mdi-check-circle-outline")]),_:1})):Y("",!0)]),default:t(()=>[e(L,null,{default:t(()=>[e(P,null,{default:t(()=>[e(S,{class:"p-4"},{default:t(()=>[l("p",ft,[e(y,{class:"mr-1"},{default:t(()=>[n("mdi-information-outline")]),_:1}),n(" Don't forget to save every after finalizing the signature.")]),e(i,{ref_key:"signaturePad",ref:V,height:"400px",style:{border:"1px solid #333"}},null,512)]),_:1})]),_:1}),e(G,null,{default:t(()=>[e(P,null,{default:t(()=>[e(S,{cols:"12",lg:"8",md:"8",sm:"8",class:"d-flex justify-content-end"},{default:t(()=>[w.value?(u(),$("p",yt,[e(y,null,{default:t(()=>[n("mdi-check")]),_:1}),n(" Signature was set")])):Y("",!0)]),_:1}),e(S,{cols:"12",lg:"4",md:"4",sm:"4",class:"d-flex justify-content-end"},{default:t(()=>[e(g,{onClick:N,color:"primary",variant:"flat"},{default:t(()=>[n("Save")]),_:1}),e(g,{onClick:f,color:"primary",variant:"tonal"},{default:t(()=>[n("Clear")]),_:1}),e(g,{onClick:r[1]||(r[1]=_=>M.value=!1),color:"error",variant:"tonal"},{default:t(()=>[e(y,null,{default:t(()=>[n("mdi-close")]),_:1}),n(" Close")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})):Y("",!0)]),_:1}),e(P,null,{default:t(()=>[e(S,{cols:"12",lg:"6",md:"6",sm:"6"},{default:t(()=>[e(A,{modelValue:x.value.institution,"onUpdate:modelValue":r[3]||(r[3]=_=>x.value.institution=_),color:"primary",variant:"outlined",density:"compact",label:"Institution",placeholder:"Institution",readonly:U.value},null,8,["modelValue","readonly"])]),_:1}),e(S,{cols:"12",lg:"6",md:"6",sm:"6"},{default:t(()=>[e(A,{modelValue:x.value.address,"onUpdate:modelValue":r[4]||(r[4]=_=>x.value.address=_),color:"primary",variant:"outlined",density:"compact",label:"Address",placeholder:"Address",readonly:U.value},null,8,["modelValue","readonly"])]),_:1})]),_:1}),e(P,null,{default:t(()=>[e(S,{cols:"12",lg:"6",md:"6",sm:"6"},{default:t(()=>[e(A,{modelValue:x.value.item_code,"onUpdate:modelValue":r[5]||(r[5]=_=>x.value.item_code=_),color:"primary",variant:"outlined",density:"compact",label:"Item Code",placeholder:"Item Code",readonly:U.value},null,8,["modelValue","readonly"])]),_:1}),e(S,{cols:"12",lg:"6",md:"6",sm:"6"},{default:t(()=>[e(A,{modelValue:x.value.item_description,"onUpdate:modelValue":r[6]||(r[6]=_=>x.value.item_description=_),color:"primary",variant:"outlined",density:"compact",label:"Item Description",placeholder:"Item Description",readonly:U.value},null,8,["modelValue","readonly"])]),_:1})]),_:1})]),_:1})]),_:1})}}},ue=q=>($e("data-v-398c1060"),q=q(),Ue(),q),bt=ue(()=>l("h5",{class:"text-primary"},"Status After The Service",-1)),ht=ue(()=>l("h5",{class:"text-primary"},"Reagents / Spare Parts Used",-1)),kt={class:"table-responsive sparepartsField"},xt={class:"table table-sm table-bordered table-responsive"},St=ue(()=>l("thead",{style:{background:"#afafaf2e"}},[l("tr",null,[l("th",{scope:"col"},"Item Code"),l("th",{scope:"col"},"Item Description"),l("th",null,"Qty"),l("th",null,"DR#"),l("th",null,"SI#"),l("th",null,"Remarks"),l("th")])],-1)),wt={key:0},Vt=["onUpdate:modelValue"],Dt=["onUpdate:modelValue"],Ct=["onUpdate:modelValue"],Mt=["onUpdate:modelValue"],Pt={key:1},$t={colspan:"2"},Ut={key:2},Rt={colspan:"7",class:"text-center p-3",style:{opacity:".3"}},It=ue(()=>l("br",null,null,-1)),At={class:"d-flex justify-content-center"},qt={class:"text-danger"},Tt=ue(()=>l("b",null,"List of Selected Row",-1)),Nt=ue(()=>l("br",null,null,-1)),jt={key:0},Et={key:1,class:"small"},Ot={__name:"StatusAfterService",props:{status:{type:String},pm_id:{type:Number,default:0}},emits:["status-after-service","sparePartsData"],setup(q,{emit:m}){Se();const v=we(),h=m,p=ke().currentUserRole,c=o({status_after_service:""}),U=o(pe("pm_data")),M=q,{status:V,pm_id:w}=xe(M),N=o(!(p===he&&V.value===re)),f=o(!1),x=o([]),ee=o(!1),F=o(!0),W=o(0),r=o([{field:"id",title:"ID",isUnique:!0,type:"number",hide:!0},{field:"item_code",title:"Item Code"},{field:"description",title:"Item Description"},{field:"name",title:"Category"}])||[],S=r.value.map(d=>d.field),P=lt({current_page:1,pagesize:10,search:""}),A=o(null),y=async()=>{try{F.value=!0;const k=(await v.get("master-data-equipments",{params:{...P,searchColumn:S,item_category:[5,6]}})).data.equipments;A.value=k.data,W.value=k.total}catch(d){console.log(d)}F.value=!1},g=_t(y,300),i=d=>{P.current_page=d.current_page,P.pagesize=d.pagesize,P.search=d.search,d.change_type==="search"?g():y()},G=d=>{x.value.push({item_id:d.id,item_code:d.item_code,description:d.description,qty:"",dr:"",si:"",remarks:""})},L=d=>{x.value.splice(d,1)};_e(x,d=>{d.length>0&&(d.forEach(k=>{(k.qty<1||isNaN(k.qty))&&(k.qty="")}),h("sparePartsData",d))},{deep:!0});const j=()=>{h("status-after-service",c.value.status_after_service)},_=o([]),B=async()=>{try{const d=await v.get("spareparts",{params:{pm_id:w.value}});d.data&&d.data.spareparts&&(_.value=d.data.spareparts)}catch(d){alert(d)}};return _e(U,d=>{if(d){const k=d;c.value={status_after_service:k.status_after_service||""}}},{immediate:!0}),ve(()=>{y(),B()}),(d,k)=>{const J=a("v-col"),R=a("v-row"),z=a("v-radio"),Ve=a("v-radio-group"),le=a("v-card"),oe=a("v-icon"),fe=a("v-btn"),ce=a("v-text-field"),ae=a("v-spacer"),X=a("v-divider"),De=a("v-overlay");return u(),$(Z,null,[e(le,{class:"pt-3 pl-2 mt-3",elevation:"1"},{default:t(()=>[e(R,null,{default:t(()=>[e(J,{class:"d-flex justify-content-between"},{default:t(()=>[bt]),_:1})]),_:1}),e(R,null,{default:t(()=>[e(J,{cols:"12"},{default:t(()=>[e(Ve,{modelValue:c.value.status_after_service,"onUpdate:modelValue":k[0]||(k[0]=b=>c.value.status_after_service=b),disabled:N.value,onChange:j,color:"primary",class:"radioStatAfterService"},{default:t(()=>[e(z,{value:"Operational",label:"Operational","true-icon":"mdi-checkbox-marked","false-icon":"mdi-checkbox-blank-outline"}),e(z,{value:"For Further Monitoring",label:"For Further Monitoring","true-icon":"mdi-checkbox-marked","false-icon":"mdi-checkbox-blank-outline"}),e(z,{value:"Non-Operational",label:"Non-Operational","true-icon":"mdi-checkbox-marked","false-icon":"mdi-checkbox-blank-outline"})]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),e(le,{class:"pt-3 pl-2 mt-3",elevation:"0",style:{border:"1px dashed #191970"}},{default:t(()=>[e(R,null,{default:t(()=>[e(J,{class:"d-flex justify-content-between"},{default:t(()=>[ht]),_:1})]),_:1}),e(J,{col:"12"},{default:t(()=>[l("div",kt,[l("table",xt,[St,x.value.length>0?(u(),$("tbody",wt,[(u(!0),$(Z,null,ie(x.value,(b,K)=>(u(),$("tr",{key:K},[l("td",null,O(b.item_code),1),l("td",null,O(b.description),1),l("td",null,[ye(l("input",{placeholder:"Required field ...",required:!0,"onUpdate:modelValue":H=>b.qty=H},null,8,Vt),[[ge,b.qty]])]),l("td",null,[ye(l("input",{type:"text",placeholder:"Required field ...","onUpdate:modelValue":H=>b.dr=H},null,8,Dt),[[ge,b.dr]])]),l("td",null,[ye(l("input",{type:"text",placeholder:"Required field ...","onUpdate:modelValue":H=>b.si=H},null,8,Ct),[[ge,b.si]])]),l("td",null,[ye(l("input",{type:"text",placeholder:"Type here ...","onUpdate:modelValue":H=>b.remarks=H},null,8,Mt),[[ge,b.remarks]])]),l("td",null,[e(oe,{onClick:H=>L(K),class:"text-danger"},{default:t(()=>[n("mdi-trash-can-outline")]),_:2},1032,["onClick"])])]))),128))])):Y("",!0),_.value.length>0?(u(),$("tbody",Pt,[(u(!0),$(Z,null,ie(_.value,(b,K)=>(u(),$("tr",{key:b.id},[l("td",null,O(b.equipment.item_code),1),l("td",null,O(b.equipment.description),1),l("td",null,O(b.qty),1),l("td",null,O(b.dr),1),l("td",null,O(b.si),1),l("td",$t,O(b.remarks),1)]))),128))])):(u(),$("tbody",Ut,[l("tr",null,[l("td",Rt,[e(oe,{class:"mb-3",style:{"font-size":"50px"}},{default:t(()=>[n("mdi-file-document-alert-outline")]),_:1}),It,n(" No records found ")])])]))])]),l("div",At,[N.value?Y("",!0):(u(),Q(fe,{key:0,color:"primary",size:"medium",flat:"",class:"text-none mt-3 p-2",onClick:k[1]||(k[1]=b=>f.value=!f.value)},{default:t(()=>[e(oe,{class:"mr-3"},{default:t(()=>[n("mdi-database-cog")]),_:1}),n(" Select Item ")]),_:1})),e(De,{modelValue:f.value,"onUpdate:modelValue":k[4]||(k[4]=b=>f.value=b),class:"d-flex align-items-center justify-content-center","location-strategy":"connected"},{default:t(()=>[e(le,{class:"pa-7","min-height":"500"},{default:t(()=>[e(R,null,{default:t(()=>[e(J,{cols:"4"},{default:t(()=>[e(ce,{modelValue:P.search,"onUpdate:modelValue":k[2]||(k[2]=b=>P.search=b),clearable:"",density:"compact",label:"Search all fields",variant:"outlined",color:"primary"},null,8,["modelValue"])]),_:1}),e(ae),e(fe,{onClick:k[3]||(k[3]=b=>f.value=!1),icon:"",variant:"plain",color:"primary"},{default:t(()=>[e(oe,null,{default:t(()=>[n("mdi-close")]),_:1})]),_:1})]),_:1}),e(I(pt),{ref_key:"datatable",ref:ee,rows:A.value,columns:I(r),loading:F.value,selectRowOnClick:!0,sortable:!0,search:P.search,isServerMode:!0,totalRows:W.value,pageSize:P.pagesize,hide:!0,filter:!0,skin:"bh-table-compact bh-table-bordered bh-table-responsive",class:"",onRowClick:G,onChange:i},null,8,["rows","columns","loading","search","totalRows","pageSize"]),e(X),l("p",qt,[Tt,Nt,x.value.length>0?(u(),$("span",jt,[(u(!0),$(Z,null,ie(x.value,(b,K)=>(u(),$("span",{key:b.id},[n(" [ "+O(b.item_code)+" - ",1),e(oe,{onClick:H=>L(K),class:"text-danger"},{default:t(()=>[n("mdi-trash-can-outline")]),_:2},1032,["onClick"]),n("] Â  ")]))),128))])):(u(),$("span",Et,"No data selected"))])]),_:1})]),_:1},8,["modelValue"])])]),_:1})]),_:1})],64)}}},Yt=Re(Ot,[["__scopeId","data-v-398c1060"]]),Qe=q=>($e("data-v-e81a6ece"),q=q(),Ue(),q),zt=Qe(()=>l("h5",{class:"text-primary"},"Actions Taken",-1)),Ft={class:"d-flex align-items-center",style:{"border-bottom":"none!important"}},Lt=Qe(()=>l("h5",{class:"text-primary"},"Remarks & Recommendation",-1)),Bt={__name:"ActionsRemarks",props:{status:{type:String}},emits:["actions","remarks"],setup(q){Se();const m=we(),h=ke().currentUserRole,E=ot();o(!0);const p=o({remarks:""}),c=q,{status:U}=xe(c),M=o(pe("pm_data")),V=o([]);_e(M,r=>{if(r){const S=r;V.value=r.actions||[],p.value={remarks:S.remarks||""}}},{immediate:!0});const w=o([]),N=()=>{w.value.push("")},f=r=>{w.value.splice(r,1)},x=()=>{E.emit("actions",w.value)},ee=()=>{E.emit("remarks",p.value.remarks)},F=o([]),W=async()=>{try{const r=await m.get("getStandardActions");r.data&&r.data.actions&&(F.value=r.data.actions.map(S=>S.actions))}catch(r){console.log(r)}};return ve(()=>{W()}),(r,S)=>{const P=a("v-col"),A=a("v-row"),y=a("v-icon"),g=a("v-list-item-title"),i=a("v-list-item"),G=a("v-list"),L=a("v-btn"),j=a("v-combobox"),_=a("v-table"),B=a("v-card"),d=a("v-textarea");return u(),$(Z,null,[e(B,{density:"compact",class:"p-3 mt-3",elevation:"1"},{default:t(()=>[e(A,null,{default:t(()=>[e(P,{class:"d-flex justify-content-between"},{default:t(()=>[zt]),_:1})]),_:1}),e(G,null,{default:t(()=>[V.value.length>0?(u(!0),$(Z,{key:0},ie(V.value,k=>(u(),Q(i,{key:k},{prepend:t(()=>[e(y,{color:"primary"},{default:t(()=>[n("mdi-file-document-check-outline")]),_:1})]),default:t(()=>[e(g,null,{default:t(()=>[n(O(k.action),1)]),_:2},1024)]),_:2},1024))),128)):(u(),Q(i,{key:1},{prepend:t(()=>[e(y,{color:"primary"},{default:t(()=>[n("mdi-file-document-check-outline")]),_:1})]),default:t(()=>[e(g,null,{default:t(()=>[n(" No records found ")]),_:1})]),_:1}))]),_:1}),I(h)===he&&I(U)===re?(u(),Q(P,{key:0,cols:"12"},{default:t(()=>[e(B,{elevation:"0"},{default:t(()=>[e(L,{onClick:N,class:"text-none",color:"primary",variant:"flat","prepend-icon":"mdi-comment-plus-outline"},{default:t(()=>[n("Add Field")]),_:1}),e(_,{class:"mt-4",style:{border:"none!important"}},{default:t(()=>[l("tbody",null,[(u(!0),$(Z,null,ie(w.value,(k,J)=>(u(),$("tr",{key:J},[l("td",Ft,[e(j,{modelValue:w.value[J],"onUpdate:modelValue":[R=>w.value[J]=R,x],items:F.value,"item-title":"actions","item-value":"actions",label:"Select an option or enter your action manually","append-inner-icon":"mdi-trash-can-outline","hide-details":"",variant:"outlined",color:"primary",density:"compact",clearable:"",rules:[R=>!!R||"Required"],"onClick:appendInner":R=>f(J)},null,8,["modelValue","onUpdate:modelValue","items","rules","onClick:appendInner"])])]))),128))])]),_:1})]),_:1})]),_:1})):Y("",!0)]),_:1}),e(B,{class:"p-3 mt-3",elevation:"1"},{default:t(()=>[e(A,null,{default:t(()=>[e(P,{class:"d-flex justify-content-between"},{default:t(()=>[Lt]),_:1})]),_:1}),e(P,{col:"12"},{default:t(()=>[e(d,{modelValue:p.value.remarks,"onUpdate:modelValue":S[0]||(S[0]=k=>p.value.remarks=k),onInput:ee,color:"primary",variant:I(h)===he&&I(U)===re?"underlined":"plain",placeholder:"Type your remarks & recommendations here ...",readonly:!(I(h)===he&&I(U)===re)},null,8,["modelValue","variant","readonly"])]),_:1})]),_:1})],64)}}},Wt=Re(Bt,[["__scopeId","data-v-e81a6ece"]]),Ht=l("span",{class:"text-dark mr-2"},"Status:",-1),Qt=l("span",{class:"text-dark mr-2"},"Status after service:",-1),Gt={style:{"font-weight":"500"}},Jt=l("span",{class:"text-dark mr-2"},"Tag:",-1),Kt={style:{"font-weight":"500"}},Xt=l("h5",{class:"text-primary"},"Service Provider Details",-1),Zt={__name:"ServiceProvider",setup(q){Le();const m=o(!0),v=o({engineer:"",delegation_date:"",date_accepted:"",date_out:"",travel_time:"",time_in:"",time_out:"",tag:"",status_after_service:""}),h=o(""),E=o(pe("pm_data"));return _e(E,p=>{if(p){const c=p,U=c.user||{};v.value={engineer:`${U.first_name||""} ${U.last_name||""}`.trim()||"--",delegation_date:me(c.delegation_date)||"--",date_accepted:me(c.date_accepted)||"--",date_out:me(c.departed_date)||"--",travel_time:c.travel_duration||"--",time_in:me(c.start_date)||"--",time_out:me(c.end_date)||"--",tag:c.tag||"--",status_after_service:c.status_after_service||"--"},h.value=c.status||"---"}},{immediate:!0}),ve(()=>{}),(p,c)=>{const U=a("v-chip"),M=a("v-col"),V=a("v-row"),w=a("v-text-field"),N=a("v-card");return u(),$(Z,null,[e(V,null,{default:t(()=>[e(M,{cols:"12",class:"d-flex justify-content-end"},{default:t(()=>[e(U,{variant:"tonal",color:"primary",label:""},{default:t(()=>[Ht,l("span",{style:nt({color:ze(h.value).color,"font-weight":"500"})},O(ze(h.value).text),5)]),_:1}),v.value.status_after_service!==""?(u(),Q(U,{key:0,variant:"tonal",color:"error",label:"",class:"ml-2"},{default:t(()=>[Qt,l("span",Gt,O(v.value.status_after_service),1)]),_:1})):Y("",!0),v.value.tag!==""?(u(),Q(U,{key:1,variant:"tonal",color:"warning",label:"",class:"ml-2"},{default:t(()=>[Jt,l("span",Kt,O(v.value.tag),1)]),_:1})):Y("",!0)]),_:1})]),_:1}),e(N,{class:"mt-3 mb-10",elevation:"1"},{default:t(()=>[e(M,{cols:"12"},{default:t(()=>[e(V,null,{default:t(()=>[e(M,{cols:"12"},{default:t(()=>[Xt]),_:1})]),_:1}),e(V,null,{default:t(()=>[e(M,{cols:"12",lg:"6",md:"6",sm:"6"},{default:t(()=>[e(w,{modelValue:v.value.engineer,"onUpdate:modelValue":c[0]||(c[0]=f=>v.value.engineer=f),color:"primary",variant:"outlined",density:"compact",label:"Delegated to",placeholder:"Delegated to",readonly:m.value},null,8,["modelValue","readonly"])]),_:1}),e(M,{cols:"12",lg:"6",md:"6",sm:"6"},{default:t(()=>[e(w,{modelValue:v.value.delegation_date,"onUpdate:modelValue":c[1]||(c[1]=f=>v.value.delegation_date=f),color:"primary",variant:"outlined",density:"compact",label:"Delegation Date",placeholder:"Delegation Date",readonly:m.value},null,8,["modelValue","readonly"])]),_:1})]),_:1}),e(V,null,{default:t(()=>[e(M,{cols:"12",lg:"6",md:"6",sm:"6"},{default:t(()=>[e(w,{modelValue:v.value.date_accepted,"onUpdate:modelValue":c[2]||(c[2]=f=>v.value.date_accepted=f),color:"primary",variant:"outlined",density:"compact",label:"Date Accepted",placeholder:"Date Accepted",readonly:m.value},null,8,["modelValue","readonly"])]),_:1})]),_:1}),e(V,null,{default:t(()=>[e(M,{cols:"12",lg:"6",md:"6",sm:"6"},{default:t(()=>[e(w,{modelValue:v.value.date_out,"onUpdate:modelValue":c[3]||(c[3]=f=>v.value.date_out=f),color:"primary",variant:"outlined",density:"compact",label:"Date Out",placeholder:"Date Out",readonly:m.value},null,8,["modelValue","readonly"])]),_:1}),e(M,{cols:"12",lg:"6",md:"6",sm:"6"},{default:t(()=>[e(w,{modelValue:v.value.travel_time,"onUpdate:modelValue":c[4]||(c[4]=f=>v.value.travel_time=f),color:"primary",variant:"outlined",density:"compact",label:"Travel Time",placeholder:"Travel Time",readonly:m.value},null,8,["modelValue","readonly"])]),_:1})]),_:1}),e(V,null,{default:t(()=>[e(M,{cols:"12",lg:"6",md:"6",sm:"6"},{default:t(()=>[e(w,{modelValue:v.value.time_in,"onUpdate:modelValue":c[5]||(c[5]=f=>v.value.time_in=f),color:"primary",variant:"outlined",density:"compact",label:"Time In",placeholder:"Time In",readonly:m.value},null,8,["modelValue","readonly"])]),_:1}),e(M,{cols:"12",lg:"6",md:"6",sm:"6"},{default:t(()=>[e(w,{modelValue:v.value.time_out,"onUpdate:modelValue":c[6]||(c[6]=f=>v.value.time_out=f),color:"primary",variant:"outlined",density:"compact",label:"Time Out",placeholder:"Time Out",readonly:m.value},null,8,["modelValue","readonly"])]),_:1})]),_:1})]),_:1})]),_:1})],64)}}},ea={class:"mt-4 text-primary"},ta={class:"mt-4 text-danger"},aa=l("p",null," Set the number of days for the observation period. ",-1),la={class:"text-danger"},oa={class:"mt-4 text-primary"},na={class:"text-danger"},sa={__name:"OperationAfterService",props:{pm_id:{type:Number,default:0},currentRole:{type:Number,default:""},pm_data:{type:Object,default:()=>({})}},setup(q){var r,S,P;const m=Pe.useToast();Se();const v=Be(),{can:h}=He(),E=we(),p=o(!1);o(!0);const c=v.params.work_type,U=q,M=pe("refreshPMData"),{pm_id:V,pm_data:w}=xe(U),N=o({status_after_service:(r=w.value)==null?void 0:r.status_after_service,tag:(S=w.value)==null?void 0:S.tag,monitoring_end:((P=w.value)==null?void 0:P.monitoring_end)||""}),f=async()=>{p.value=!0;try{const A=await E.post("sendToCM",{pm_id:V.value});A.data&&A.data.success&&(m.success("Successfully created for corrective maintenance"),await M())}catch(A){console.log(A)}finally{p.value=!1}},x=()=>{var i;const A=be((i=N.value)==null?void 0:i.monitoring_end,"YYYY-MM-DD"),y=be().startOf("day"),g=A.diff(y,"days");return g<0?"The waiting period has elapsed by "+Math.abs(g)+" days":g},ee=o(null),F=o(""),W=async()=>{p.value=!0;const{valid:A}=await ee.value.validate();if(!A){p.value=!1;return}try{const y=await E.post("setDaysObservation",{id:V.value,set_days:parseInt(F.value)});y.data&&y.data.success&&(m.success("Successfully set"),await M())}catch(y){console.log(y)}finally{p.value=!1}};return(A,y)=>{const g=a("v-btn"),i=a("v-card-text"),G=a("v-spacer"),L=a("v-card-actions"),j=a("v-card"),_=a("v-dialog"),B=a("v-col"),d=a("v-row"),k=a("v-text-field"),J=a("v-form");return u(),$(Z,null,[N.value.status_after_service===Me.operational&&I(h)("delegate","Preventive Maintenance")&&N.value.tag===Fe?(u(),Q(j,{key:0,class:"bg-orange-lighten-5 p-2 mb-7",transition:"fab-transition",elevation:"0"},{default:t(()=>[e(B,{cols:"12"},{default:t(()=>[e(d,null,{default:t(()=>[e(B,{cols:"12"},{default:t(()=>[l("p",null,"After "+O(I(c)==="PM"?"30":"10")+" days with no issues, it will be tagged as completed. If sent for CM or a problem occurs, it will be tagged as backjob",1),l("p",ea,[n("Date montoring ends: "),l("b",null,O(I(be)(N.value.monitoring_end).format("MMMM DD, YYYY")),1)]),l("p",ta,[n("Monitoring days left: "),l("b",null,O(x()),1)]),e(_,{"max-width":"500"},{activator:t(({props:R})=>[e(g,se({color:"primary",variant:"tonal",text:"Send for CM",class:"text-none mt-4",loading:p.value,"prepend-icon":"mdi-transfer-right"},R),null,16,["loading"])]),default:t(({isActive:R})=>[e(j,{title:"Confirmation"},{default:t(()=>[e(i,null,{default:t(()=>[n(" Are you sure you want to proceed with this action? ")]),_:1}),e(L,null,{default:t(()=>[e(G),e(g,{text:"No",color:"primary",variant:"tonal",class:"text-none",onClick:z=>R.value=!1},null,8,["onClick"]),e(g,{color:"primary",variant:"flat",text:"Yes, Proceed",class:"text-none",loading:p.value,"prepend-icon":"mdi-transfer-right",onClick:f},null,8,["loading"])]),_:2},1024)]),_:2},1024)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):Y("",!0),N.value.status_after_service===Me.further_monitoring&&(I(h)("delegate","Preventive Maintenance")||I(h)("installer","Preventive Maintenance"))&&N.value.tag===ut?(u(),Q(j,{key:1,class:"bg-teal-lighten-5 p-2 mb-7",transition:"fab-transition",elevation:"0"},{default:t(()=>[e(B,{cols:"12"},{default:t(()=>[e(d,null,{default:t(()=>[e(B,{cols:"12"},{default:t(()=>[aa,e(_,{"max-width":"500"},{activator:t(({props:R})=>[e(g,se({color:"primary",variant:"tonal",text:"Set days of Observation",class:"text-none mt-4",loading:p.value,"prepend-icon":"mdi-transfer-right"},R),null,16,["loading"])]),default:t(({isActive:R})=>[e(j,{title:"Confirmation"},{default:t(()=>[e(i,null,{default:t(()=>[e(J,{ref_key:"form",ref:ee},{default:t(()=>[e(k,{modelValue:F.value,"onUpdate:modelValue":y[0]||(y[0]=z=>F.value=z),variant:"outlined",color:"primary",rules:[z=>!!z||"Required",z=>/^[0-9]+$/.test(z)||"Must be a number",z=>z>=1&&z<=31||"Must be between 1 and 31"],label:"Set days of Observation",density:"compact"},null,8,["modelValue","rules"])]),_:1},512)]),_:1}),e(L,null,{default:t(()=>[e(G),e(g,{text:"No",color:"primary",variant:"tonal",class:"text-none",onClick:z=>R.value=!1},null,8,["onClick"]),e(g,{color:"primary",variant:"flat",text:"Yes, Proceed",class:"text-none",loading:p.value,"prepend-icon":"mdi-transfer-right",onClick:W},null,8,["loading"])]),_:2},1024)]),_:2},1024)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):Y("",!0),N.value.status_after_service===Me.further_monitoring&&(I(h)("delegate","Preventive Maintenance")||I(h)("installer","Preventive Maintenance"))&&N.value.tag===Fe?(u(),Q(j,{key:2,class:"bg-teal-lighten-5 p-2 mb-7",transition:"fab-transition",elevation:"0"},{default:t(()=>[e(B,{cols:"12"},{default:t(()=>[e(d,null,{default:t(()=>[e(B,{cols:"12"},{default:t(()=>[l("p",null,[n(" After "),l("b",la,O(I(be)(N.value.monitoring_end).format("MMMM DD, YYYY")),1),n(" with no issues, it will be marked as completed. If sent for CM or a problem occurs, it will be tagged as non-operational ")]),l("p",oa,[n("Monitoring days left: "),l("b",na,O(x()),1)]),e(_,{"max-width":"500"},{activator:t(({props:R})=>[e(g,se({color:"primary",variant:"tonal",text:"Send for CM",class:"text-none mt-4",loading:p.value,"prepend-icon":"mdi-transfer-right"},R),null,16,["loading"])]),default:t(({isActive:R})=>[e(j,{title:"Confirmation"},{default:t(()=>[e(i,null,{default:t(()=>[n(" Are you sure you want to proceed with this action? ")]),_:1}),e(L,null,{default:t(()=>[e(G),e(g,{text:"No",color:"primary",variant:"tonal",class:"text-none",onClick:z=>R.value=!1},null,8,["onClick"]),e(g,{color:"primary",variant:"flat",text:"Yes, Proceed",class:"text-none",loading:p.value,"prepend-icon":"mdi-transfer-right",onClick:f},null,8,["loading"])]),_:2},1024)]),_:2},1024)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):Y("",!0)],64)}}},ra={__name:"PMPrint",setup(q){const m=o(!1);return(v,h)=>{const E=a("v-btn"),p=a("v-spacer"),c=a("v-toolbar"),U=a("v-card"),M=a("v-dialog");return u(),Q(M,{modelValue:m.value,"onUpdate:modelValue":h[1]||(h[1]=V=>m.value=V),transition:"dialog-bottom-transition",fullscreen:""},{activator:t(({props:V})=>[e(E,se({"prepend-icon":"mdi-printer",class:"text-none",variant:"plain",text:"Print Preview"},V),null,16)]),default:t(()=>[e(U,null,{default:t(()=>[e(c,{dense:""},{default:t(()=>[e(E,{icon:"mdi-close",onClick:h[0]||(h[0]=V=>m.value=!1)}),e(p),e(E,{"prepend-icon":"mdi-printer",class:"text-none",variant:"plain",text:"Print"})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}},ia=q=>($e("data-v-1ca1977d"),q=q(),Ue(),q),ua=ia(()=>l("p",{class:"text-danger"},"* Please confirm the serial number before proceeding",-1)),ca={key:0},da={key:1},ma={key:2},_a={key:3},pa={__name:"PMView",setup(q){Le();const m=Pe.useToast(),v=st(),h=Be(),E=Se(),p=we(),U=ke().currentUserRole,{can:M}=He(),V=o(h.params.work_type==="PM"?"/preventive-maintenance":"/corrective-maintenance"),w=[{title:"Back",disabled:!1,href:V.value},{title:h.params.work_type==="PM"?"Preventive Maintenance":"Corrective Maintenance",disabled:!0,href:""},{title:h.params.work_type==="PM"?"PM-Details":"CM-Details",disabled:!0,href:""}],N=s=>{!s.disabled&&s.href&&v.push(s.href)},f=o([]),x=o(!1),ee=s=>{f.value=s},F=o(""),W=s=>{F.value=s},r=o([]),S=s=>{r.value=s},P=o(""),A=s=>{P.value=s},y=o(!1),g=o(!1),i=o(!1),G=o(!1),L=o(!1),j=h.params.id,_=o(null),B=o(""),d=o("nullSerial"),k=o(""),J=s=>{d.value=s,k.value=s},R=o(null),z=s=>{R.value=s},Ve=async()=>{i.value=!0;const{valid:s}=await y.value.validate();if(d.value===null&&d.value!=="nullSerial"){i.value=!1,m.error("Serial number is required");return}if(!s){i.value=!1;return}try{const D=await p.post("pm_process",{id:j,engineer:B.value,serial:k.value});D.data&&D.data.success?(m.success("Successfully delegated"),y.value.reset(),de()):D.data.delegated_exist?m.error("Currently delegated"):(m.error(response.data.errorE),i.value=!1)}catch(D){alert(D),i.value=!1}finally{i.value=!1,y.value.reset(),G.value=!1}},le=o(""),oe=async()=>{i.value=!0;const{valid:s}=await y.value.validate();if(!s){i.value=!1;return}try{const D=await p.post("pm_decline",{pm_id:j,reason:le.value});D.data&&D.data.success?(m.success("Reason submitted"),y.value.reset(),v.push(V.value)):(m.error("Something went wrong"),i.value=!1)}catch(D){alert(D),i.value=!1}finally{i.value=!1,y.value.reset(),L.value=!1}},fe=async()=>{i.value=!0;try{const s=await p.post("pm_accepted",{id:j});s.data&&s.data.success?(m.success("PM Task Accepted"),de()):(m.error("Something went wrong"),i.value=!1)}catch(s){alert(s),i.value=!1}finally{i.value=!1}},ce=async()=>{if(i.value=!0,X.value===re){const s=f.value.some(C=>typeof C=="string"?C.trim()==="":C==null),D=r.value.every(C=>C.item_id&&C.item_code&&C.description&&C.qty&&C.dr&&C.si);if(!R.value){m.error("Client signature is required"),i.value=!1;return}if(f.value.length===0){m.error("Please submit actions taken"),i.value=!1;return}if(s){m.error("Please fill in required fields"),i.value=!1;return}if(F.value===""){m.error("Please choose one option what is the status after service"),i.value=!1;return}if(r.value.length>0&&!D){m.error("Please fill in all required fields in spareparts"),i.value=!1;return}}try{const s=await p.post("pm_task_processing",{id:j,actions:f.value,spareParts:r.value,status_after_service:F.value,remarks:P.value,work_type:h.params.work_type,signature:R.value});s.data&&s.data.success?(m.success("Successfully Save"),de()):(m.error(s.data.error),i.value=!1)}catch(s){alert(s),i.value=!1}finally{i.value=!1}},ae=o(!1),X=o(""),De=o(""),b=o(""),K=o(null),H=()=>{const s=E.user.user_roles.find(C=>C.role_id===U);return s?s.SSU:null},de=async()=>{ae.value=!0;try{const s=await p.get("get_pm_record_details",{params:{id:j}});if(s.data&&s.data.details){if(_.value=s.data.details[0],X.value=_.value.status,De.value=_.value.status_after_service,b.value=_.value.tag,K.value=_.value.ssu,ae.value=!1,_.value&&_.value.work_type&&_.value.work_type!==h.params.work_type){m.error("Something went wrong"),v.push("/");return}}else m.error("Something went wrong")}catch(s){console.log(s)}finally{ae.value=!1}};Oe("pm_data",_),Oe("refreshPMData",de);const Ie=o([]),Ge=async()=>{ae.value=!0;try{const s=await p.get("get-engineers-data");if(s.data&&s.data.engineers){const C=s.data.engineers.filter(ne=>ne.SSU===K.value).map(ne=>({title:ne.users.first_name+" "+ne.users.last_name,value:ne.user_id}));Ie.value=C}}catch(s){alert(s)}};return ve(async()=>{de(),Ge()}),(s,D)=>{const C=a("v-icon"),ne=a("v-breadcrumbs-item"),Je=a("v-breadcrumbs"),Ke=a("v-spacer"),te=a("v-btn"),Ce=a("v-col"),Xe=a("v-select"),Ae=a("v-divider"),qe=a("v-row"),Te=a("v-form"),Ne=a("v-card"),je=a("v-dialog"),Ze=a("v-textarea"),Ee=a("v-skeleton-loader"),et=a("v-container");return u(),Q(it,null,{topBarFixed:t(()=>[l("div",null,[e(Je,{class:"pt-7"},{default:t(()=>[(u(),$(Z,null,ie(w,(T,tt)=>e(ne,{key:tt,class:rt({"custom-pointer":!T.disabled}),onClick:va=>N(T),disabled:T.disabled},{default:t(()=>[n(O(T.title)+" ",1),e(C,{class:"ml-1",icon:"mdi-chevron-right"})]),_:2},1032,["class","onClick","disabled"])),64))]),_:1})]),e(Ke),e(Ee,{type:"button",loading:ae.value},{default:t(()=>[l("div",null,[I(M)("delegate","Preventive Maintenance")&&H()===K.value?(u(),$(Z,{key:0},[X.value===We?(u(),Q(je,{key:0,modelValue:G.value,"onUpdate:modelValue":D[2]||(D[2]=T=>G.value=T),"max-width":"400",persistent:""},{activator:t(({props:T})=>[e(te,se({type:"button"},T,{disabled:g.value,color:"primary",variant:"flat",class:"text-none btnSubmit"}),{default:t(()=>[e(C,{class:"mr-2"},{default:t(()=>[n("mdi-account-arrow-left-outline")]),_:1}),n(" Delegate Engineer")]),_:2},1040,["disabled"])]),default:t(()=>[e(Ne,{text:"",title:"Delegate Engineer","prepend-icon":"mdi-account"},{default:t(()=>[e(Ce,null,{default:t(()=>[ua]),_:1}),e(Te,{onSubmit:Ye(Ve,["prevent"]),ref_key:"form",ref:y},{default:t(()=>[e(Ce,{cols:"12"},{default:t(()=>[e(Xe,{color:"primary",modelValue:B.value,"onUpdate:modelValue":D[0]||(D[0]=T=>B.value=T),class:"mr-2 ml-2 mt-5",label:K.value+" Engineer",placeholder:"",density:"compact",variant:"outlined",items:Ie.value,"item-title":"title","item-value":"value",rules:[T=>!!T||"Required"],clearable:""},null,8,["modelValue","label","items","rules"])]),_:1}),e(Ae),e(qe,{justify:"end",class:"mt-7 mb-5 pr-3"},{default:t(()=>[e(te,{variant:"tonal",onClick:D[1]||(D[1]=T=>G.value=!1),color:"primary",class:"text-none mr-2"},{default:t(()=>[e(C,null,{default:t(()=>[n("mdi-close")]),_:1}),n(" Cancel")]),_:1}),e(te,{type:"submit",loading:i.value,disabled:g.value,color:"#191970",flat:"",class:"text-none bg-primary mr-5"},{default:t(()=>[e(C,{class:"mr-2"},{default:t(()=>[n("mdi-check")]),_:1}),n(" Submit")]),_:1},8,["loading","disabled"])]),_:1})]),_:1},512)]),_:1})]),_:1},8,["modelValue"])):Y("",!0)],64)):Y("",!0),I(M)("installer","Preventive Maintenance")&&H()===K.value?(u(),$(Z,{key:1},[X.value===ct?(u(),$("div",ca,[e(je,{modelValue:L.value,"onUpdate:modelValue":D[5]||(D[5]=T=>L.value=T),"max-width":"400",persistent:""},{activator:t(({props:T})=>[e(te,se({type:"button",disabled:g.value},T,{color:"primary",variant:"tonal",class:"text-none mr-2"}),{default:t(()=>[e(C,{class:"mr-2"},{default:t(()=>[n("mdi-check")]),_:1}),n(" Decline")]),_:2},1040,["disabled"])]),default:t(()=>[e(Ne,{text:"",title:"Decline Task"},{default:t(()=>[e(Te,{onSubmit:Ye(oe,["prevent"]),ref_key:"form",ref:y},{default:t(()=>[e(Ce,{cols:"12"},{default:t(()=>[e(Ze,{modelValue:le.value,"onUpdate:modelValue":D[3]||(D[3]=T=>le.value=T),color:"primary",label:"Reason",variant:"outlined",rules:[T=>!!T||"Required"]},null,8,["modelValue","rules"])]),_:1}),e(Ae),e(qe,{justify:"end",class:"mt-7 mb-5 pr-3"},{default:t(()=>[e(te,{variant:"tonal",onClick:D[4]||(D[4]=T=>L.value=!1),color:"primary",class:"text-none mr-2"},{default:t(()=>[e(C,null,{default:t(()=>[n("mdi-close")]),_:1}),n(" Cancel")]),_:1}),e(te,{type:"submit",loading:i.value,disabled:g.value,color:"#191970",flat:"",class:"text-none bg-primary mr-5"},{default:t(()=>[e(C,{class:"mr-2"},{default:t(()=>[n("mdi-check")]),_:1}),n(" Submit")]),_:1},8,["loading","disabled"])]),_:1})]),_:1},512)]),_:1})]),_:1},8,["modelValue"]),e(te,{type:"button",loading:i.value,disabled:g.value,onClick:fe,color:"primary",variant:"flat",class:"text-none"},{default:t(()=>[e(C,{class:"mr-2"},{default:t(()=>[n("mdi-check")]),_:1}),n(" Accept")]),_:1},8,["loading","disabled"])])):Y("",!0),X.value===dt&&H()===K.value?(u(),$("div",da,[e(te,{type:"button",loading:i.value,disabled:g.value,onClick:ce,color:"primary",variant:"flat",class:"text-none"},{default:t(()=>[e(C,{class:"mr-2"},{default:t(()=>[n("mdi-check")]),_:1}),n(" In Transit")]),_:1},8,["loading","disabled"])])):Y("",!0),X.value===mt&&H()===K.value?(u(),$("div",ma,[e(te,{type:"button",loading:i.value,disabled:g.value,onClick:ce,color:"primary",variant:"flat",class:"text-none"},{default:t(()=>[e(C,{class:"mr-2"},{default:t(()=>[n("mdi-check")]),_:1}),n(" Start PM Task")]),_:1},8,["loading","disabled"])])):Y("",!0),X.value===re&&H()===K.value?(u(),$("div",_a,[e(te,{type:"button",loading:i.value,disabled:x.value,onClick:ce,color:"primary",variant:"flat",class:"text-none"},{default:t(()=>[e(C,{class:"mr-2"},{default:t(()=>[n("mdi-check")]),_:1}),n(" Mark as Done")]),_:1},8,["loading","disabled"])])):Y("",!0)],64)):Y("",!0)])]),_:1},8,["loading"])]),default:t(()=>[e(Ee,{class:"d-print-none",type:"list-item-three-line@2, table@2","loading-text":"Prperties Loafding",loading:ae.value},{default:t(()=>[e(et,{class:"mt-10",id:"printThisA4"},{default:t(()=>[e(ra),e(sa,{pm_data:_.value,pm_id:parseInt(I(j)),currentRole:I(U)},null,8,["pm_data","pm_id","currentRole"]),e(Zt),e(gt,{onSetConfirmSerial:J,onSetSignature:z,status:X.value},null,8,["status"]),e(Wt,{onActions:ee,onRemarks:A,status:X.value},null,8,["status"]),e(Yt,{onStatusAfterService:W,status:X.value,pm_id:parseInt(I(j)),onSparePartsData:S},null,8,["status","pm_id"])]),_:1})]),_:1},8,["loading"])]),_:1})}}},Da=Re(pa,[["__scopeId","data-v-1ca1977d"]]);export{Da as default};
