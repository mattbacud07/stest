import{B as ll}from"./BaseLayout-C5Zn7NJa.js";import{v as Me,c as ke,x as Ue,r as t,C as Oe,D as Je,T as Ke,E as Se,y as Re,e as u,o as N,f as Y,w as l,h as e,j as g,G as fe,t as j,n as q,i as Be,H as Pe,I as he,k as r,p as _e,F as Ne,z as Te,d as Le,J as Ee,K as tl,L as $e,m as Fe,M as ze,S as al,N as Ge,O as Qe,P as ol}from"./index-Cz72bSYw.js";import{g as be}from"./vue3-datatable-BQ6DeCI2.js";import{_ as je}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{p as sl}from"./pullout-gEarTZ89.js";import{s as nl}from"./satellite-Dm0E7lMi.js";import{a as rl}from"./getUsers-BD_7D9yP.js";import"./lodash-Bli92X11.js";import"./topBarUserProfile-tltSc7lJ.js";const ul={__name:"RoleAssigning",setup(F){const{width:M}=Me();ke().getUserData;const A=Ue(),h=t(!1),x=t(null),S=t(null),$=t(null),z=t(!1);t([]);const B=t(null),k=t(!1),v=t(!0),E=t([]),J=t([]),_=t(!1),b=t(!1),K=t(0),R=t({role:[s=>!!s||"Required"],sbu:[s=>!!s||"Required"]});Oe(x,s=>{var p,V,le;S.value=ee.value.find(Q=>Q.roleID===s),((p=S.value)==null?void 0:p.roleID)===Je||((V=S.value)==null?void 0:V.roleID)===Ke||((le=S.value)==null?void 0:le.roleID)===void 0?z.value=!0:(z.value=!1,$.value="")});const H=t([]),W=s=>{H.value=B.value.getSelectedRows(),s&&s.length>0?v.value=!1:v.value=!0},O=s=>H.value.map(V=>V.id).includes(s.id)?"highlightRow":"",ne=async()=>{b.value=!0;const s=Array.from(B.value.getSelectedRows()),{valid:p}=await h.value.validate();if(!p){b.value=!1;return}try{const V=await A.post("assign-role",{user:s,role_id:x.value,sbu:$.value});V.data&&V.data.success?(E.value=V.data.userExist,J.value=V.data.succeed,_.value=!0,h.value.reset(),B.value.clearSelectedRows(),setTimeout(()=>{k.value=!1,K.value+=1},500)):console.log(V.data.error)}catch(V){console.error("API Request Error:",V)}finally{b.value=!1}},T=t(!0);t(0),t(!1);const f=Se({current_page:1,pagesize:10}),G=t(null),w=t([{field:"id",title:"ID",isUnique:!0,type:"number",hide:!0},{field:"first_name",title:"Name"},{field:"email",title:"Email"},{field:"position_name",title:"Position"},{field:"name",title:"Department"}])||[],ie=async()=>{try{T.value=!0;const p=(await A.get("users")).data.users;G.value=p}catch(s){console.log(s)}T.value=!1},ee=t([]),y=async()=>{try{T.value=!0;const p=(await A.get("get_roles")).data.role_name;ee.value=p.map(V=>({roleID:V.roleID,role_name:V.role_name}))}catch(s){console.log(s)}T.value=!1};return Re(()=>{ie(),y()}),(s,p)=>{const V=u("v-icon"),le=u("v-alert"),Q=u("v-col"),re=u("v-row"),te=u("v-btn"),X=u("v-divider"),ae=u("v-select"),de=u("v-card-text"),oe=u("v-spacer"),L=u("v-card-actions"),ue=u("v-form"),ce=u("v-card"),c=u("v-dialog"),D=u("v-text-field"),Ve=u("v-snackbar");return N(),Y(re,null,{default:l(()=>[e(Q,{cols:"12"},{default:l(()=>[e(re,null,{default:l(()=>[e(Q,null,{default:l(()=>[e(le,{color:"warning",class:"small",closable:"",density:"compact",variant:"tonal",prominent:""},{default:l(()=>[e(V,{class:"mr-2"},{default:l(()=>[g("mdi-information-outline")]),_:1}),g(" Easily assign roles by selecting multiple users ")]),_:1})]),_:1})]),_:1}),e(re,null,{default:l(()=>[e(Q,{lg:"8",md:"8",sm:"6",cols:"3"},{default:l(()=>[e(c,{width:"400",scrollable:"",modelValue:k.value,"onUpdate:modelValue":p[2]||(p[2]=P=>k.value=P)},{activator:l(({props:P})=>[e(te,fe({color:"primary",disabled:v.value,variant:"flat",class:"text-none"},P),{default:l(()=>[e(V,{class:"mr-2"},{default:l(()=>[g("mdi-lock-plus")]),_:1}),g(" "+j(q(M)<=500?"":" Assign Role"),1)]),_:2},1040,["disabled"])]),default:l(({isActive:P})=>[e(ce,{"prepend-icon":"mdi-account-search",title:"Select Role"},{default:l(()=>[e(ue,{onSubmit:Be(ne,["prevent"]),ref_key:"form",ref:h},{default:l(()=>[e(X,{class:"mt-1"}),e(de,{class:"px-4"},{default:l(()=>[e(ae,{color:"primary",modelValue:x.value,"onUpdate:modelValue":p[0]||(p[0]=se=>x.value=se),rules:R.value.role,items:ee.value,"item-title":"role_name","item-value":"roleID",density:"compact",variant:"outlined",label:"Roles",hint:"Assign roles to the selected users","persistent-hint":""},null,8,["modelValue","rules","items"]),z.value?(N(),Y(ae,{key:0,color:"primary",modelValue:$.value,"onUpdate:modelValue":p[1]||(p[1]=se=>$.value=se),rules:R.value.sbu,items:Pe,"item-title":"text","item-value":"value",density:"compact",variant:"outlined",label:"SBU",class:"mt-5"},null,8,["modelValue","rules","items"])):he("",!0)]),_:1}),e(X),e(L,null,{default:l(()=>[e(te,{text:"Close",prependIcon:"mdi-arrow-left",class:"text-none",onClick:se=>P.value=!1},null,8,["onClick"]),e(oe),e(te,{type:"submit",color:"primary",prependIcon:"mdi-content-save-check-outline",class:"text-none",text:"Save",variant:"flat",loading:b.value},null,8,["loading"])]),_:2},1024)]),_:2},1536)]),_:2},1024)]),_:1},8,["modelValue"])]),_:1}),e(oe),e(Q,{lg:"4",md:"4",sm:"6",cols:"9"},{default:l(()=>[e(D,{color:"primary",modelValue:f.search,"onUpdate:modelValue":p[3]||(p[3]=P=>f.search=P),clearable:"",density:"compact",label:"Search all fields",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),e(q(be),{ref_key:"datatable",ref:B,rows:G.value,columns:q(w),loading:T.value,search:f.search,selectRowOnClick:!0,hasCheckbox:!0,sortable:!0,hide:!0,filter:!0,skin:"bh-table-compact bh-table-bordered",class:"mt-4",rowClass:O,onRowSelect:W},{first_name:l(P=>[r("span",null,j(P.value.first_name)+" "+j(P.value.last_name),1)]),_:1},8,["rows","columns","loading","search"])]),_:1}),e(Ve,{color:"#19197000",variant:"outlined",modelValue:_.value,"onUpdate:modelValue":p[4]||(p[4]=P=>_.value=P),location:"right bottom",timeout:3e3},{default:l(()=>[E.value.length>0?(N(),Y(ce,{key:0,color:"error",class:"p-3"},{default:l(()=>[(N(!0),_e(Ne,null,Te(E.value,(P,se)=>(N(),_e("div",{key:se,class:"mt-4"},[e(V,{class:"ml-3"},{default:l(()=>[g("mdi-account-tag")]),_:1}),g(" "+j(P)+" already has that role assigned ",1)]))),128))]),_:1})):he("",!0),J.value.length>0?(N(),Y(ce,{key:1,color:"success",class:"p-3"},{default:l(()=>[(N(!0),_e(Ne,null,Te(J.value,(P,se)=>(N(),_e("div",{key:se,class:"mt-4"},[e(V,{class:"ml-3"},{default:l(()=>[g("mdi-check")]),_:1}),g(" "+j(P)+" successfully assigned role ",1)]))),128))]),_:1})):he("",!0)]),_:1},8,["modelValue"])]),_:1})}}},il=je(ul,[["__scopeId","data-v-f0302fdc"]]),xe=F=>(Ge("data-v-45b16034"),F=F(),Qe(),F),dl=xe(()=>r("p",null,[r("b",{class:"ml-5 text-primary"},"Approval Configuration Settings")],-1)),cl=xe(()=>r("p",{class:"small text-error"},"Don't forget to save after editing.",-1)),ml={class:"text-primary"},pl={class:"small textDown"},vl=xe(()=>r("p",null,[r("b",{class:"ml-5 text-primary"},"Requestor Configuration Settings")],-1)),_l=xe(()=>r("p",{class:"small text-error"},"Don't forget to save after editing.",-1)),fl={class:"text-primary"},gl={class:"small textDown"},yl=xe(()=>r("p",null,[r("b",{class:"ml-5 text-primary"},"Requestor Configuration Settings")],-1)),bl=xe(()=>r("p",{class:"small text-error"},"Don't forget to save after editing.",-1)),hl={class:"text-primary"},xl={class:"small textDown"},Vl={class:"text-primary"},wl={class:"small textDown"},Dl={__name:"AssignedRoles",setup(F){const{users:M}=rl(),{width:Z}=Me(),A=Le.useToast();ke();const h=Ue(),x=t(null),S=t(!1),$=t(!1),z=t(!0),B=t([]),k=t(null),v=t(!1);t(!1);const E=t(!1),J=t(!1),_=t({}),b=t([]),K=(i,o)=>{const d=o?o.id:null,n=b.value.find(C=>C.id===i);n?n.supervisor_id=d:b.value.push({id:i,supervisor_id:d})},R=async()=>{var i;if(v.value=!0,b.value.length===0){A.info("No changes made"),v.value=!1;return}try{const o=await h.post("assign_supervisor",{supervisor:b.value});o.data.success?(A.success("Successfully updated"),b.value=[],me(k.value)):console.log((i=o.data)==null?void 0:i.error)}catch(o){b.value=[],me(k.value),console.log(o)}finally{v.value=!1}},H=t(!1),W=[Ke,Je,al],O=Ee(()=>W.includes(k.value)),ne=t({}),T=t([]),f=(i,o)=>{const d=o||null,n=T.value.find(C=>C.id===i);n?n.sbu=d:T.value.push({id:i,sbu:d}),console.log(T.value),console.log(o)},G=async()=>{var i;if(v.value=!0,T.value.length===0){A.info("No changes made"),v.value=!1;return}try{const o=await h.post("assign_sbu",{sbu:T.value});o.data.success?(A.success("Successfully updated"),T.value=[],me(k.value)):console.log((i=o.data)==null?void 0:i.error)}catch(o){T.value=[],me(k.value),console.log(o)}finally{v.value=!1}},w=t({}),ie=(i,o,d,n,C)=>{const I=w.value[i]||{user_id:o,roleID:d,role_user_id:i,eh:[],pullout:[],sbu:"",satellite:""};n==="sbu"||n==="satellite"?I[n]=C:I[n]=C.map(pe=>({level:pe.value,level_name:pe.title})),w.value[i]={...I}},ee=async()=>{var o;const i=Object.values(w.value).map(d=>({role_user_id:d.role_user_id,user_id:d.user_id,roleID:d.roleID,eh_level:d.eh,pullout_level:d.pullout,sbu:d.sbu,satellite:d.satellite,approver_category:1}));v.value=!0;try{const d=await h.post("update_approver_config",{update_approval:i});d.data.success?(A.success("Successfully updated"),w.value={},Ce()):console.log((o=d.data)==null?void 0:o.error)}catch(d){console.log(d)}finally{v.value=!1}},y=t([]),s=i=>{y.value=x.value.getSelectedRows(),i&&i.length>0?z.value=!1:z.value=!0,B.value=i.map(o=>o.id)[0]},p=i=>y.value.map(d=>d.id).includes(i.id)?"highlightRow":"",V=Ee(()=>tl.map(i=>({title:"Level : "+i.key,value:i.value}))),le=Ee(()=>sl.map(i=>({title:"Level : "+i.key,value:i.value}))),Q=async()=>{$.value=!0;try{const i=await h.delete("delete-role",{params:{id:B.value}});i.data&&i.data.success?(A.success("Successfully deleted"),S.value=!1,me(k.value)):console.log(i.data.error)}catch(i){console.log(i)}finally{$.value=!1}},re=t([]),te=t([]),X=t([]),ae=t([]),de=t({}),oe=t({}),L=t(!0),ue=t(!1),ce=t(0);t(!1);const c=Se({current_page:1,pagesize:10,sort_column:"roles.role_name",sort_direction:"desc",search:""}),D=t(null),Ve=t(null),P=t([{field:"id",title:"ID",isUnique:!0,type:"number",hide:!0},{field:"users.fullname",title:"Name"},{field:"roles.role_name",title:"Role"},{field:"sbu",title:"SBU",hide:!0},{field:"users.approval_id",title:"approval id",hide:!0},{field:"users.name",title:"Department"},{field:"users.position_name",title:"Position",hide:!0}])||[],se=t([{field:"id",title:"ID",isUnique:!0,type:"number",hide:!0},{field:"user_id",title:"Approver ID",isUnique:!0,type:"number",hide:!0},{field:"users.fullname",title:"Approver"},{field:"users.name",title:"Department"},{field:"eh",title:"Equipment Handling Module",hide:!1},{field:"pullout",title:"Pullout Module",hide:!1},{field:"sbu",title:"SBU",hide:!1,minWidth:"200px"},{field:"satellite",title:"Satellite",hide:!1,minWidth:"200px"}])||[],Xe=t([{field:"id",title:"ID",isUnique:!0,type:"number",hide:!0},{field:"user_id",title:"Approver ID",isUnique:!0,type:"number",hide:!0},{field:"users.fullname",title:"Approver"},{field:"users.name",title:"Department"},{field:"supervisor",title:"Immediate Supervisor",minWidth:"300px",maxWidth:"300px"}])||[],Ye=t([{field:"id",title:"ID",isUnique:!0,type:"number",hide:!0},{field:"user_id",title:"Approver ID",isUnique:!0,type:"number",hide:!0},{field:"users.fullname",title:"Approver"},{field:"roles.role_name",title:"Role"},{field:"users.name",title:"Department"},{field:"sbu",title:"SBU",minWidth:"300px",maxWidth:"300px"}])||[],ge=Se({current_page:1,pagesize:500,sort_column:"users.department",sort_direction:"desc",search:""}),me=async i=>{var o,d;try{L.value=!0;const C=(o=(await h.get("assigned-user-role",{params:{role:i}})).data)==null?void 0:o.users_role;D.value=C,ce.value=(d=C==null?void 0:C.meta)==null?void 0:d.total,C.filter(m=>m.role_id===Fe).map(m=>({id:m.id,supervisor_id:m.supervisor_id})).forEach(m=>{_.value[m.id]=m.supervisor_id}),C.filter(m=>W.includes(m.role_id)).map(m=>({id:m.id,sbu:m.sbu})).forEach(m=>{ne.value[m.id]=m.sbu})}catch(n){console.log(n)}L.value=!1},Ce=async()=>{var i;try{ue.value=!0;const d=(i=(await h.get("assigned-user-role",{params:{role:$e}})).data)==null?void 0:i.users_role;Ve.value=d,d.forEach(n=>{const C=n.approver.filter(I=>I.approver_category===1).map(I=>({level:I.approval_level,level_name:I.approval_level_name}));re.value[n.id]=C,ae.value[n.id]=C.map(I=>I.level)}),d.forEach(n=>{const C=n.approver.filter(I=>I.approver_category===2).map(I=>({level:I.approval_level,level_name:I.approval_level_name}));te.value[n.id]=C,X.value[n.id]=C.map(I=>I.level)}),d.forEach(n=>{de.value[n.id]=n.sbu,oe.value[n.id]=n.satellite}),d.filter(n=>n.role_id===$e).forEach(n=>{w.value[n.id]={role_user_id:n.id,user_id:n.user_id,roleID:n.role_id,eh:re.value[n.id],pullout:te.value[n.id],sbu:n.sbu,satellite:n.satellite}})}catch(o){console.log(o)}ue.value=!1},Ie=(i,o)=>{P.value.forEach(d=>{(d.title==="Equipment Handling"||d.title==="Pullout")&&(d.hide=!i),d.title==="SBU"&&(d.hide=!o)})};Oe(k,i=>{me(i),i===1?Ie(!0,!1):i===2||i===3||i===8?Ie(!1,!0):Ie(!1,!1)});const We=t([]),Ae=async()=>{try{L.value=!0;const o=(await h.get("get_roles")).data.role_name;We.value=o.map(d=>({role_id:d.roleID,role_name:d.role_name}))}catch(i){console.log(i)}L.value=!1},qe=()=>{me(k.value),Ae()},Ze=()=>{Ce(),Ae()};return Re(()=>{me(),Ae()}),(i,o)=>{const d=u("v-icon"),n=u("v-btn"),C=u("v-spacer"),I=u("v-toolbar"),pe=u("v-text-field"),m=u("v-col"),ve=u("v-row"),ye=u("v-combobox"),we=u("v-card"),De=u("v-dialog"),el=u("v-select");return N(),Y(m,{cols:"12"},{default:l(()=>[e(ve,null,{default:l(()=>[k.value===$e?(N(),Y(m,{key:0,cols:"12",class:"d-flex justify-end"},{default:l(()=>[e(De,{modelValue:E.value,"onUpdate:modelValue":o[2]||(o[2]=a=>E.value=a),transition:"dialog-bottom-transition",fullscreen:"",style:{"z-index":"1080!important"}},{activator:l(({props:a})=>[e(n,fe(a,{color:"dark",variant:"tonal",density:"comfortable",loading:L.value,onClick:Ce,class:"text-none"}),{default:l(()=>[e(d,{class:"mr-2"},{default:l(()=>[g("mdi-cog")]),_:1}),g(" Setting")]),_:2},1040,["loading"])]),default:l(()=>[e(we,null,{default:l(()=>[e(I,{dense:"",style:{position:"fixed","z-index":"999"}},{default:l(()=>[dl,e(C),e(n,{icon:"mdi-close",class:"mr-2",variant:"text",onClick:o[0]||(o[0]=a=>E.value=!1)}),e(n,{text:"Save",variant:"flat",color:"primary",loading:v.value,onClick:ee},null,8,["loading"])]),_:1}),e(ve,{class:"mt-15 ma-4"},{default:l(()=>[e(m,{cols:"12"},{default:l(()=>[e(ve,null,{default:l(()=>[e(m,{cols:"4"},{default:l(()=>[e(pe,{"single-line":"",density:"compact",modelValue:ge.search,"onUpdate:modelValue":o[1]||(o[1]=a=>ge.search=a),clearable:"",variant:"outlined",placeholder:"Seach..."},null,8,["modelValue"])]),_:1}),e(m,{cols:"2"},{default:l(()=>[e(n,{onClick:Ze,icon:"",color:"primary",size:"small",variant:"text",class:"mr-1"},{default:l(()=>[e(d,null,{default:l(()=>[g("mdi-refresh")]),_:1})]),_:1})]),_:1}),e(m,{cols:"6",class:"d-flex justify-end align-center"},{default:l(()=>[cl]),_:1})]),_:1}),e(q(be),{ref_key:"datatable",ref:x,rows:Ve.value,columns:q(se),loading:ue.value,search:ge.search,selectRowOnClick:!1,hasCheckbox:!1,sortable:!1,sortColumn:ge.sort_column,sortDirection:ge.sort_direction,hide:!0,pageSize:ge.pagesize,filter:!1,skin:"bh-table-compact bh-table-bordered",cellClass:"assignedRoleCellClass"},{"users.fullname":l(a=>[r("p",ml,[r("b",null,j(a.value.users.fullname),1)]),r("p",pl,j(a.value.users.position_name),1)]),eh:l(a=>[e(ye,{color:"primary",variant:"plain",placeholder:"Select level",density:"compact",items:V.value,itemValue:"value",disabled:v.value,"onUpdate:modelValue":[U=>ie(a.value.id,a.value.user_id,a.value.role_id,"eh",U),U=>ae.value[a.value.id]=U],itemTitle:"title",multiple:"",chips:"",modelValue:ae.value[a.value.id]},null,8,["items","disabled","onUpdate:modelValue","modelValue"])]),pullout:l(a=>[e(ye,{color:"primary",variant:"plain",placeholder:"Select level",density:"compact",items:le.value,itemValue:"value",itemTitle:"title",multiple:"",chips:"",disabled:v.value,"onUpdate:modelValue":[U=>ie(a.value.id,a.value.user_id,a.value.role_id,"pullout",U),U=>X.value[a.value.id]=U],modelValue:X.value[a.value.id]},null,8,["items","disabled","onUpdate:modelValue","modelValue"])]),sbu:l(a=>[e(ye,{color:"primary",variant:"plain",placeholder:"Select SBU",density:"compact",items:Pe,disabled:v.value,modelValue:de.value[a.value.id],"onUpdate:modelValue":[U=>de.value[a.value.id]=U,U=>ie(a.value.id,a.value.user_id,a.value.role_id,"sbu",U)],clearable:"",chips:""},null,8,["items","disabled","modelValue","onUpdate:modelValue"])]),satellite:l(a=>[e(ye,{color:"primary",variant:"plain",placeholder:"Select Satellite",density:"compact",items:q(nl),disabled:v.value,modelValue:oe.value[a.value.id],"onUpdate:modelValue":[U=>oe.value[a.value.id]=U,U=>ie(a.value.id,a.value.user_id,a.value.role_id,"satellite",U)],clearable:"",chips:""},null,8,["items","disabled","modelValue","onUpdate:modelValue"])]),_:1},8,["rows","columns","loading","search","sortColumn","sortDirection","pageSize"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})):he("",!0),k.value===Fe?(N(),Y(m,{key:1,cols:"12",class:"d-flex justify-end"},{default:l(()=>[e(De,{modelValue:J.value,"onUpdate:modelValue":o[5]||(o[5]=a=>J.value=a),transition:"dialog-bottom-transition",fullscreen:"",style:{"z-index":"1080!important"}},{activator:l(({props:a})=>[e(n,fe(a,{color:"dark",variant:"tonal",density:"comfortable",loading:L.value,class:"text-none"}),{default:l(()=>[e(d,{class:"mr-2"},{default:l(()=>[g("mdi-cog")]),_:1}),g(" Setting")]),_:2},1040,["loading"])]),default:l(()=>[e(we,null,{default:l(()=>[e(I,{dense:"",style:{position:"fixed","z-index":"999"}},{default:l(()=>[vl,e(C),e(n,{icon:"mdi-close",class:"mr-2",variant:"text",onClick:o[3]||(o[3]=a=>J.value=!1)}),e(n,{text:"Save",variant:"flat",color:"primary",loading:v.value,onClick:R},null,8,["loading"])]),_:1}),e(ve,{class:"mt-15 ma-4"},{default:l(()=>[e(m,{cols:"12"},{default:l(()=>[e(ve,null,{default:l(()=>[e(m,{cols:"4"},{default:l(()=>[e(pe,{"single-line":"",density:"compact",modelValue:c.search,"onUpdate:modelValue":o[4]||(o[4]=a=>c.search=a),clearable:"",variant:"outlined",placeholder:"Seach..."},null,8,["modelValue"])]),_:1}),e(m,{cols:"2"},{default:l(()=>[e(n,{onClick:qe,icon:"",color:"primary",size:"small",variant:"text",class:"mr-1"},{default:l(()=>[e(d,null,{default:l(()=>[g("mdi-refresh")]),_:1})]),_:1})]),_:1}),e(m,{cols:"6",class:"d-flex justify-end align-center"},{default:l(()=>[_l]),_:1})]),_:1}),e(q(be),{ref_key:"datatable",ref:x,rows:D.value,columns:q(Xe),loading:L.value,search:c.search,skin:"bh-table-compact bh-table-bordered",cellClass:"assignedRoleCellClass"},{"users.fullname":l(a=>[r("p",fl,[r("b",null,j(a.value.users.fullname),1)]),r("p",gl,j(a.value.users.position_name),1)]),supervisor:l(a=>[e(ye,{color:"primary",variant:"plain",placeholder:"Select Supervisor",density:"compact",items:q(M),itemValue:"id",itemTitle:"user_name",modelValue:_.value[a.value.id],"onUpdate:modelValue":[U=>_.value[a.value.id]=U,U=>K(a.value.id,U)],clearable:"",chips:""},null,8,["items","modelValue","onUpdate:modelValue"])]),_:1},8,["rows","columns","loading","search"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})):he("",!0),O.value?(N(),Y(m,{key:2,cols:"12",class:"d-flex justify-end"},{default:l(()=>[e(De,{modelValue:H.value,"onUpdate:modelValue":o[8]||(o[8]=a=>H.value=a),transition:"dialog-bottom-transition",fullscreen:"",style:{"z-index":"1080!important"}},{activator:l(({props:a})=>[e(n,fe(a,{color:"dark",variant:"tonal",density:"comfortable",loading:L.value,class:"text-none"}),{default:l(()=>[e(d,{class:"mr-2"},{default:l(()=>[g("mdi-cog")]),_:1}),g(" Setting")]),_:2},1040,["loading"])]),default:l(()=>[e(we,null,{default:l(()=>[e(I,{dense:"",style:{position:"fixed","z-index":"999"}},{default:l(()=>[yl,e(C),e(n,{icon:"mdi-close",class:"mr-2",variant:"text",onClick:o[6]||(o[6]=a=>H.value=!1)}),e(n,{text:"Save",variant:"flat",color:"primary",loading:v.value,onClick:G},null,8,["loading"])]),_:1}),e(ve,{class:"mt-15 ma-4"},{default:l(()=>[e(m,{cols:"12"},{default:l(()=>[e(ve,null,{default:l(()=>[e(m,{cols:"4"},{default:l(()=>[e(pe,{"single-line":"",density:"compact",modelValue:c.search,"onUpdate:modelValue":o[7]||(o[7]=a=>c.search=a),clearable:"",variant:"outlined",placeholder:"Seach..."},null,8,["modelValue"])]),_:1}),e(m,{cols:"2"},{default:l(()=>[e(n,{onClick:qe,icon:"",color:"primary",size:"small",variant:"text",class:"mr-1"},{default:l(()=>[e(d,null,{default:l(()=>[g("mdi-refresh")]),_:1})]),_:1})]),_:1}),e(m,{cols:"6",class:"d-flex justify-end align-center"},{default:l(()=>[bl]),_:1})]),_:1}),e(q(be),{ref_key:"datatable",ref:x,rows:D.value,columns:q(Ye),loading:L.value,search:c.search,skin:"bh-table-compact bh-table-bordered",cellClass:"assignedRoleCellClass"},{"users.fullname":l(a=>[r("p",hl,[r("b",null,j(a.value.users.fullname),1)]),r("p",xl,j(a.value.users.position_name),1)]),sbu:l(a=>[e(ye,{color:"primary",variant:"plain",placeholder:"Select SBU",density:"compact",items:Pe,modelValue:ne.value[a.value.id],"onUpdate:modelValue":[U=>ne.value[a.value.id]=U,U=>f(a.value.id,U)],clearable:"",chips:""},null,8,["items","modelValue","onUpdate:modelValue"])]),_:1},8,["rows","columns","loading","search"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})):he("",!0),e(m,{cols:"12",xl:"6",md:"6",sm:"6",style:ze({"margin-top":q(Z)<=550?"-15px":""})},{default:l(()=>[e(n,{color:"error",class:"text-none",disabled:z.value,variant:"tonal",onClick:o[9]||(o[9]=a=>S.value=!0)},{default:l(()=>[e(d,null,{default:l(()=>[g("mdi-delete-empty")]),_:1}),g(" "+j(q(Z)<=768?"":" Delete"),1)]),_:1},8,["disabled"]),e(De,{modelValue:S.value,"onUpdate:modelValue":o[11]||(o[11]=a=>S.value=a),"max-width":"340"},{default:l(({isActive:a})=>[e(we,{"prepend-icon":"mdi-trash-can-outline",text:"Are you sure you want to delete assigned role?",title:"Delete"},{actions:l(()=>[e(n,{class:"ml-auto text-none",variant:"tonal",text:"No",onClick:o[10]||(o[10]=U=>S.value=!1)}),e(n,{color:"error",loading:$.value,variant:"flat",class:"text-none",text:"Delete",onClick:Q},null,8,["loading"])]),_:1})]),_:1},8,["modelValue"]),e(n,{onClick:qe,icon:"",color:"primary",size:"small",variant:"text",class:"mr-1"},{default:l(()=>[e(d,null,{default:l(()=>[g("mdi-refresh")]),_:1})]),_:1})]),_:1},8,["style"]),e(m,{cols:"12",xl:"3",md:"3",sm:"3",style:ze({"margin-top":q(Z)<=550?"-15px":""})},{default:l(()=>[e(el,{color:"primary",modelValue:k.value,"onUpdate:modelValue":o[12]||(o[12]=a=>k.value=a),items:We.value,clearable:"","item-title":"role_name","item-value":"role_id",density:"compact",variant:"outlined",label:"Filter by role"},null,8,["modelValue","items"])]),_:1},8,["style"]),e(m,{cols:"12",xl:"3",md:"3",sm:"3",style:ze({"margin-top":q(Z)<=550?"-15px":""})},{default:l(()=>[e(pe,{color:"primary",modelValue:c.search,"onUpdate:modelValue":o[13]||(o[13]=a=>c.search=a),clearable:"",density:"compact",label:"Search all fields",variant:"outlined"},null,8,["modelValue"])]),_:1},8,["style"])]),_:1}),e(q(be),{ref_key:"datatable",ref:x,rows:D.value,columns:q(P),loading:L.value,search:c.search,selectRowOnClick:!0,hasCheckbox:!0,sortable:!0,sortColumn:c.sort_column,sortDirection:c.sort_direction,hide:!0,filter:!0,skin:"bh-table-compact bh-table-bordered",onRowSelect:s,cellClass:"assignedRoleCellClass",rowClass:p},{"users.fullname":l(a=>[r("p",Vl,[r("b",null,j(a.value.users.fullname),1)]),r("p",wl,j(a.value.users.position_name),1)]),_:1},8,["rows","columns","loading","search","sortColumn","sortDirection"])]),_:1})}}},Sl=je(Dl,[["__scopeId","data-v-45b16034"]]),kl=r("p",{class:"p3"},null,-1),Ul=r("p",{class:"text-danger",style:{"font-size":".8em"}},"* Please consult your IT administrator before making any changes",-1),Rl={__name:"Roles",setup(F){const M=Le.useToast();ke().getUserData;const A=Ue(),h=t(!1),x=t(""),S=t(""),$=t(null),z=t(!1),B=t(!1),k=t(!1),v=t(!0),E=t(!1);t(0);const J=t(null),_=t(""),b=t(Array.from({length:20},(y,s)=>s+1)),K=t({role:[y=>!!y||"Required"]}),R=()=>{const y=$.value.getSelectedRows();y&&y.length>0?v.value=!1:v.value=!0,J.value=y.map(s=>s.id)[0]},H=t(null),W=y=>{H.value=y.id,x.value=y.role_name,_.value=y.roleID,S.value=y.description},O=async()=>{E.value=!0;const{valid:y}=await h.value.validate();if(!y){E.value=!1;return}try{const s=await A.post("add_role_name",{role_name:x.value,roleID:_.value,description:S.value});s.data&&s.data.success?(h.value.reset(),M.success("Successfully created"),z.value=!1,ee()):s.data&&s.data.role_id_exist&&M.error("Role ID or role name exist")}catch(s){console.log(s)}finally{E.value=!1}},ne=async()=>{E.value=!0;const{valid:y}=await h.value.validate();if(!y){E.value=!1;return}try{const s=await A.put("edit_role_name",{id:H.value,role_name:x.value,description:S.value});s.data&&s.data.success?(h.value.reset(),M.success("Updated successfully"),B.value=!1,ee()):s.data&&s.data.role_id_exist&&M.error("Role ID or role name exist")}catch(s){console.log(s)}finally{E.value=!1}},T=async()=>{try{const y=await A.delete("delete_role_name",{params:{id:J.value}});y.data&&y.data.success&&(M.success("Successfully deleted"),k.value=!1,ee())}catch(y){console.log(y)}finally{}},f=t(!0);t(0);const G=Se({current_page:1,pagesize:10,sort_column:"id",sort_direction:"asc"}),w=t(null),ie=t([{field:"id",title:"ID",isUnique:!0,type:"number",hide:!0},{field:"roleID",title:"Role ID"},{field:"role_name",title:"Role"},{field:"description",title:"Description"},{field:"created_at",title:"Created_at"}])||[],ee=async()=>{try{f.value=!0;const s=(await A.get("get_roles")).data.role_name;w.value=s}catch(y){console.log(y)}f.value=!1};return Re(()=>{ee()}),(y,s)=>{const p=u("v-btn"),V=u("v-divider"),le=u("v-text-field"),Q=u("v-select"),re=u("v-textarea"),te=u("v-card-text"),X=u("v-spacer"),ae=u("v-card-actions"),de=u("v-form"),oe=u("v-card"),L=u("v-dialog"),ue=u("v-col"),ce=u("v-row");return N(),Y(ce,null,{default:l(()=>[e(ue,{cols:"12"},{default:l(()=>[e(ce,null,{default:l(()=>[e(ue,{lg:"8",md:"8",sm:"6",cols:"12"},{default:l(()=>[e(L,{width:"400",scrollable:"",modelValue:z.value,"onUpdate:modelValue":s[3]||(s[3]=c=>z.value=c)},{activator:l(({props:c})=>[e(p,fe({color:"primary","prepend-icon":"mdi-shield-plus-outline",text:"Add",class:"text-none"},c),null,16)]),default:l(({isActive:c})=>[e(oe,{"prepend-icon":"mdi-shield-plus-outline",title:"Role"},{default:l(()=>[e(de,{onSubmit:Be(O,["prevent"]),ref_key:"form",ref:h},{default:l(()=>[e(V,{class:"mt-1"}),e(te,{class:"px-4"},{default:l(()=>[e(le,{modelValue:x.value,"onUpdate:modelValue":s[0]||(s[0]=D=>x.value=D),rules:K.value.role,density:"compact",variant:"outlined",label:"Role Name"},null,8,["modelValue","rules"]),e(Q,{modelValue:_.value,"onUpdate:modelValue":s[1]||(s[1]=D=>_.value=D),items:b.value,class:"mt-3",rules:[D=>!!D||"Required"],density:"compact",variant:"outlined",label:"Role ID"},null,8,["modelValue","items","rules"]),e(re,{modelValue:S.value,"onUpdate:modelValue":s[2]||(s[2]=D=>S.value=D),density:"compact",rows:"5",label:"Description",variant:"outlined",color:"primary",class:"mt-5"},null,8,["modelValue"])]),_:1}),e(V),e(ae,null,{default:l(()=>[e(p,{text:"Close",prependIcon:"mdi-arrow-left",class:"text-none",onClick:D=>c.value=!1},null,8,["onClick"]),e(X),e(p,{type:"submit",color:"primary",prependIcon:"mdi-content-save-check-outline",class:"text-none",text:"Save",variant:"flat",loading:E.value},null,8,["loading"])]),_:2},1024)]),_:2},1536)]),_:2},1024)]),_:1},8,["modelValue"]),e(L,{width:"400",scrollable:"",modelValue:B.value,"onUpdate:modelValue":s[7]||(s[7]=c=>B.value=c)},{activator:l(({props:c})=>[e(p,fe({color:"primary",variant:"tonal",disabled:v.value,"prepend-icon":"mdi-shield-edit-outline",text:"Edit",class:"text-none ml-2"},c),null,16,["disabled"])]),default:l(({isActive:c})=>[e(oe,{"prepend-icon":"mdi-shield-edit-outline",title:"Edit Role"},{default:l(()=>[e(de,{onSubmit:Be(ne,["prevent"]),ref_key:"form",ref:h},{default:l(()=>[e(V,{class:"mt-1"}),e(te,{class:"px-4"},{default:l(()=>[e(le,{modelValue:x.value,"onUpdate:modelValue":s[4]||(s[4]=D=>x.value=D),rules:K.value.role,density:"compact",variant:"outlined",label:"Role Name"},null,8,["modelValue","rules"]),e(Q,{modelValue:_.value,"onUpdate:modelValue":s[5]||(s[5]=D=>_.value=D),disabled:"",items:b.value,class:"mt-3",rules:[D=>!!D||"Required"],density:"compact",variant:"outlined",label:"Role ID"},null,8,["modelValue","items","rules"]),e(re,{modelValue:S.value,"onUpdate:modelValue":s[6]||(s[6]=D=>S.value=D),density:"compact",rows:"5",label:"Description",variant:"outlined",color:"primary",class:"mt-5"},null,8,["modelValue"])]),_:1}),e(V),e(ae,null,{default:l(()=>[e(p,{text:"Close",prependIcon:"mdi-arrow-left",class:"text-none",onClick:D=>c.value=!1},null,8,["onClick"]),e(X),e(p,{type:"submit",color:"primary",prependIcon:"mdi-content-save-check-outline",class:"text-none",text:"Save",variant:"flat",loading:E.value},null,8,["loading"])]),_:2},1024)]),_:2},1536)]),_:2},1024)]),_:1},8,["modelValue"]),e(L,{width:"400",scrollable:"",modelValue:k.value,"onUpdate:modelValue":s[8]||(s[8]=c=>k.value=c)},{activator:l(({props:c})=>[e(p,fe({color:"error",disabled:v.value,"prepend-icon":"mdi-delete-empty",text:"Delete",class:"text-none ml-2",variant:"plain"},c),null,16,["disabled"])]),default:l(({isActive:c})=>[e(oe,{"prepend-icon":"mdi-trash-can",subtitle:"Delete Role"},{default:l(()=>[kl,e(te,null,{default:l(()=>[g("Are you sure you want to delete?")]),_:1}),e(ae,null,{default:l(()=>[e(p,{text:"Close",prependIcon:"mdi-arrow-left",class:"text-none",onClick:D=>c.value=!1},null,8,["onClick"]),e(X),e(p,{color:"error","prepend-icon":"mdi-shield-remove-outline",text:"Delete",class:"text-none ml-2",variant:"flat",onClick:T,loading:E.value},null,8,["loading"])]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue"])]),_:1}),e(X),e(ue,{lg:"4",md:"4",sm:"6",cols:"12"},{default:l(()=>[e(le,{color:"primary",modelValue:G.search,"onUpdate:modelValue":s[9]||(s[9]=c=>G.search=c),clearable:"",density:"compact",label:"Search all fields",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),Ul,e(q(be),{ref_key:"datatable",ref:$,rows:w.value,columns:q(ie),loading:f.value,search:G.search,selectRowOnClick:!0,hasCheckbox:!0,sortable:!0,sortColumn:G.sort_column,sortDirection:G.sort_direction,skin:"bh-table-compact bh-table-bordered",class:"mt-5",onRowSelect:R,onRowClick:W},{created_at:l(c=>[r("span",null,j(ol(c.value.created_at)),1)]),_:1},8,["rows","columns","loading","search","sortColumn","sortDirection"])]),_:1})]),_:1})}}},He=F=>(Ge("data-v-c57921ff"),F=F(),Qe(),F),Cl=He(()=>r("p",{class:"small text-danger mb-3"},[r("b",null,"Reminder:"),g(),r("span",{class:"text-dark"},"Don't forget to save")],-1)),Il={class:"table-responsive"},Al={class:"table table-borderless align-middle"},ql=He(()=>r("thead",{class:"table-light"},[r("tr",null,[r("th",null,"Modules"),r("th",null,"Create"),r("th",null,"Read"),r("th",null,"Edit"),r("th",null,"Delete"),r("th",null,"Approve"),r("th",null,"Delegate"),r("th",null,"Install"),r("th",null,"Report")])],-1)),El={class:"table-group-divider"},$l={key:1},zl={rowspan:"9"},Bl={style:{opacity:".1"}},Pl=He(()=>r("p",{class:"text-grey"},"Loading ...",-1)),Nl={__name:"Permission",setup(F){const M=Le.useToast(),{width:Z}=Me();ke().getUserData;const h=Ue();t(!1),t(!1);const x=t(!1),S=t(!1),$=t([]),z=t(null),B=t([{module:"Master Data",create:!1,read:!1,edit:!1,delete:!1,approve:!1,delegate:!1,installer:!1,report:!1,name:"MasterData",icong:"mdi-list-box"},{module:"Equipment Handling",create:!1,read:!1,edit:!1,delete:!1,approve:!1,delegate:!1,installer:!1,report:!1,name:"EquipmentHandling",icong:"mdi-file-document-edit"},{module:"PullOut Request",create:!1,read:!1,edit:!1,delete:!1,approve:!1,delegate:!1,installer:!1,report:!1,name:"PullOut",icong:"mdi-tab-minus"},{module:"Internal Servicing",create:!1,read:!1,edit:!1,delete:!1,approve:!1,delegate:!1,installer:!1,report:!1,name:"InternalServicing",icong:"mdi-file-compare"},{module:"Preventive Maintenance",create:!1,read:!1,edit:!1,delete:!1,approve:!1,delegate:!1,installer:!1,report:!1,name:"PreventiveMaintenance",icong:"mdi-calendar-cursor-outline"},{module:"Corrective Maintenance",create:!1,read:!1,edit:!1,delete:!1,approve:!1,delegate:!1,installer:!1,report:!1,name:"CorrectiveMaintenance",icong:"mdi-calendar-clock"}]);Oe(z,async _=>{await v(_)});const k=async()=>{S.value=!0;try{const _=await h.put("set_permissions_per_role",{role_id:z.value,permissions:JSON.stringify(B.value)});_.data&&_.data.success&&M.success("Successfully save")}catch(_){alert(_)}finally{S.value=!1}},v=async _=>{x.value=!0;try{const b=await h.get("get_permission_per_role",{params:{role_id:_}});if(b.data&&b.data.permission){const K=b.data.permission;if(K&&K.permissions){const R=JSON.parse(K.permissions);console.log(R),R.forEach(H=>{const W=B.value.find(O=>O.name===H.name);W?Object.assign(W,H):B.value.push(H)})}else B.value.forEach(R=>{R.create=!1,R.read=!1,R.edit=!1,R.delete=!1,R.approve=!1,R.delegate=!1,R.installer=!1,R.report=!1})}}catch(b){console.log(b)}finally{x.value=!1}},E=async()=>{try{const _=await h.get("get_roles");_.data&&_.data.role_name&&($.value=_.data.role_name.filter(b=>b.roleID!==6).map(b=>({roleID:b.roleID,role_name:b.role_name})))}catch(_){console.log(_)}},J=()=>{E()};return Re(()=>{E(),v()}),(_,b)=>{const K=u("v-btn"),R=u("v-col"),H=u("v-select"),W=u("v-row"),O=u("v-checkbox"),ne=u("v-progress-circular"),T=u("v-icon");return N(),Y(W,null,{default:l(()=>[e(R,{cols:"12"},{default:l(()=>[e(W,null,{default:l(()=>[e(R,{cols:"3",lg:"2",md:"2",sm:"2"},{default:l(()=>[e(K,{color:"primary",loading:S.value,disabled:!z.value,onClick:k,"prepend-icon":"mdi-check",text:"SAVE",stacked:q(Z)<=425,density:q(Z)<=425?"compact":"default",class:"text-none ml-2",variant:"flat"},null,8,["loading","disabled","stacked","density"])]),_:1}),e(R,{cols:"9",lg:"4",md:"4",sm:"4"},{default:l(()=>[e(H,{modelValue:z.value,"onUpdate:modelValue":b[0]||(b[0]=f=>z.value=f),items:$.value,"item-title":"role_name","item-value":"roleID",density:"compact",color:"primary",variant:"outlined",label:"Select Role","onClick:appendInner":J,"append-inner-icon":"mdi-refresh"},null,8,["modelValue","items"])]),_:1})]),_:1}),e(W,null,{default:l(()=>[e(R,null,{default:l(()=>[Cl,r("div",Il,[r("table",Al,[ql,r("tbody",El,[x.value?(N(),_e("tr",$l,[r("td",zl,[r("h1",Bl,[e(T,null,{default:l(()=>[e(ne,{indeterminate:""})]),_:1})]),Pl])])):(N(!0),_e(Ne,{key:0},Te(B.value,(f,G)=>(N(),_e("tr",{key:f.module},[r("td",null,j(f.module),1),r("td",null,[e(O,{modelValue:f.create,"onUpdate:modelValue":w=>f.create=w},null,8,["modelValue","onUpdate:modelValue"])]),r("td",null,[e(O,{modelValue:f.read,"onUpdate:modelValue":w=>f.read=w},null,8,["modelValue","onUpdate:modelValue"])]),r("td",null,[e(O,{modelValue:f.edit,"onUpdate:modelValue":w=>f.edit=w},null,8,["modelValue","onUpdate:modelValue"])]),r("td",null,[e(O,{modelValue:f.delete,"onUpdate:modelValue":w=>f.delete=w},null,8,["modelValue","onUpdate:modelValue"])]),r("td",null,[e(O,{modelValue:f.approve,"onUpdate:modelValue":w=>f.approve=w},null,8,["modelValue","onUpdate:modelValue"])]),r("td",null,[e(O,{modelValue:f.delegate,"onUpdate:modelValue":w=>f.delegate=w},null,8,["modelValue","onUpdate:modelValue"])]),r("td",null,[e(O,{modelValue:f.installer,"onUpdate:modelValue":w=>f.installer=w},null,8,["modelValue","onUpdate:modelValue"])]),r("td",null,[e(O,{modelValue:f.report,"onUpdate:modelValue":w=>f.report=w},null,8,["modelValue","onUpdate:modelValue"])])]))),128))])])])]),_:1})]),_:1})]),_:1})]),_:1})}}},Tl=je(Nl,[["__scopeId","data-v-c57921ff"]]),Gl={__name:"RolesMain",setup(F){const M=t("one");return(Z,A)=>{const h=u("v-icon"),x=u("v-tab"),S=u("v-tabs"),$=u("v-window-item"),z=u("v-window"),B=u("v-card-text"),k=u("v-card");return N(),Y(ll,null,{default:l(()=>[e(k,null,{default:l(()=>[e(S,{modelValue:M.value,"onUpdate:modelValue":A[0]||(A[0]=v=>M.value=v),density:"compact",class:"border-b-sm"},{default:l(()=>[e(x,{value:"roles",class:"text-none",color:"primary"},{default:l(()=>[e(h,{class:"mr-2"},{default:l(()=>[g("mdi-account-file")]),_:1}),g(" Roles")]),_:1}),e(x,{value:"role_assigning",class:"text-none",color:"primary"},{default:l(()=>[e(h,{class:"mr-2"},{default:l(()=>[g("mdi-account-details")]),_:1}),g(" Role Assigning")]),_:1}),e(x,{value:"assigned_roles",class:"text-none",color:"primary"},{default:l(()=>[e(h,{class:"mr-2"},{default:l(()=>[g("mdi-account-multiple-outline")]),_:1}),g(" Assigned Roles")]),_:1}),e(x,{value:"permission",class:"text-none",color:"primary"},{default:l(()=>[e(h,{class:"mr-2"},{default:l(()=>[g("mdi-key-alert-outline")]),_:1}),g(" Permissions")]),_:1})]),_:1},8,["modelValue"]),e(B,null,{default:l(()=>[e(z,{modelValue:M.value,"onUpdate:modelValue":A[1]||(A[1]=v=>M.value=v),disabled:!0},{default:l(()=>[e($,{value:"roles"},{default:l(()=>[e(Rl,{class:"mt-3"})]),_:1}),e($,{value:"role_assigning"},{default:l(()=>[e(il,{class:"mt-3"})]),_:1}),e($,{value:"assigned_roles"},{default:l(()=>[e(Sl,{class:"mt-3"})]),_:1}),e($,{value:"permission"},{default:l(()=>[e(Tl,{class:"mt-3"})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})}}};export{Gl as default};
