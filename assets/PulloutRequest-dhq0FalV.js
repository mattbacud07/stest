import{L as J}from"./LayoutWithActions-CJHmZF5c.js";import{u as K,c as Q,g as X,r as s,x as Y,E as Z,V as m,m as $,y as ee,o as I,f as k,w as a,h as v,n as i,k as r,t as o,a1 as te,a2 as se,a4 as ae,j as f,I as le,W as V,e as h}from"./index-BFEiEqzV.js";import{d as oe}from"./debounce-Ciq6Vdb9.js";import{p as re}from"./permitted-DHah7rlL.js";import{g as ue}from"./vue3-datatable-4DUKYgRc.js";import{a as ne,b as N}from"./pullout-nLBaPcbY.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./topBarUserProfile-DObMqA0B.js";const ie={__name:"PulloutRequest",setup(de){const P=K(),{can:z}=re(),O=Q(),g=X(),T=g.currentUserRole,p=s(!0),R=s(null),b=s(null),B=s(null);s(null);const A=Y(),_=s(!0),q=s(""),l=Z({current_page:1,pagesize:10,sort_column:"created_at",sort_direction:"desc",search:""}),w=s(null),y=s([{field:"id",title:"Report Number",isUnique:!0,type:"number",hide:!1},{field:"name",title:"Institution",hide:!1},{field:"address",title:"Address",hide:!1},{field:"requestedBy",title:"Requested by"},{field:"proposed_pullout_date",title:"Proposed Pullout Date",type:"date",hide:!1},{field:"created_at",title:"Date Requested",type:"date",hide:!1},{field:"level",title:"Pending Approval",hide:!1},{field:"status",title:"Status",hide:!1}])||[],U=e=>{l.search=e};m("column",y);const L=e=>{P.push({name:"PullOutRequestView",params:{id:e.id}})},C=s([]),F=e=>{C.value=R.value.getSelectedRows(),e&&e.length===1?p.value=!1:p.value=!0;const u=e.map(c=>c.id),n=e.map(c=>c.status);b.value=u[0],B.value=n[0]},M=e=>C.value.map(n=>n.id).includes(e.id)?"highlightRow":"";s(null);const W=s("PullOutRequestView"),D=s(null);s(null),z("create","PullOut Request")&&g.currentUserRole===$&&(D.value="PullOutRequestForm");const j={selectedId:b,btnDisable:p,routeView:W,createRequest:D.value};m("data",j);const d=async()=>{try{_.value=!0;const e=await A.get("view-pullout",{params:{...l,user_id:O.user.id,current_role:T}});if(e.data&&e.data.pullout_request){const u=e.data.pullout_request;w.value=u.data,q.value=u.total}}catch(e){console.log(e)}_.value=!1},E=oe(d,300),G=e=>{l.current_page=e.current_page,l.pagesize=e.pagesize,l.sort_column=e.sort_column,l.sort_direction=e.sort_direction,e.change_type==="search"?E():d()};return m("refresh",d),ee(()=>{d()}),(e,u)=>{const n=h("v-tooltip"),c=h("v-chip"),H=h("v-card");return I(),k(J,{onSearchText:U},{default:a(()=>[v(H,{class:"mx-auto"},{default:a(()=>[v(i(ue),{ref_key:"datatable",ref:R,class:"tableLimitText",rows:w.value,columns:i(y),loading:_.value,onRowSelect:F,columnFilter:!1,sortColumn:l.sort_column,sortDirection:l.sort_direction,sortable:!0,noDataContent:"No records found",isServerMode:!0,totalRows:q.value,pageSize:l.pagesize,search:l.search,onChange:G,skin:"bh-table-compact bh-table-bordered bh-table-striped bh-table-hover",hasCheckbox:!0,rowClass:M,selectRowOnClick:!0,cellClass:"internalCell",onRowDBClick:L},{id:a(t=>[r("span",null,o(te(t.value.id,t.value.created_at)),1)]),request_type:a(t=>[r("span",null,o(se(t.value.request_type)),1)]),request_name:a(t=>[r("span",null,o(ae(t.value.request_type,t.value.request_name,t.value.other)),1)]),level:a(t=>[r("span",null,[f(o(i(ne)(t.value.level))+" ",1),t.value.level===1?(I(),k(n,{key:0,activator:"parent",location:"left"},{default:a(()=>{var x,S;return[f(o(((S=(x=t.value.role_user)==null?void 0:x.supervisor)==null?void 0:S.supervisor_name)??"---"),1)]}),_:2},1024)):le("",!0)])]),status:a(t=>[r("span",null,[v(c,{label:"",density:"compact",color:i(N)(t.value.status).color},{default:a(()=>[f(o(i(N)(t.value.status).text),1)]),_:2},1032,["color"])])]),created_at:a(t=>[r("span",null,o(V(t.value.created_at)),1)]),final_installation_date:a(t=>[r("span",null,o(V(t.value.final_installation_date)),1)]),_:1},8,["rows","columns","loading","sortColumn","sortDirection","totalRows","pageSize","search"])]),_:1})]),_:1})}}},be=ce(ie,[["__scopeId","data-v-ef4269bf"]]);export{be as default};
