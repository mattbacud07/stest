import{u as xe,c as ke,g as qe,r,x as we,C as Se,E as Ie,V as A,m as Re,y as De,f as q,w as t,o,h as l,j as _,I as X,_ as Ce,M as Ve,n as x,p as u,z as L,F as N,k,t as i,a1 as Ee,a2 as Te,a3 as Ae,a4 as Le,a5 as Q,a6 as Z,a7 as $,a8 as ee,a9 as te,aa as ae,W as le,e as c,ab as Ne,K as Oe,X as Be,T as Ue,S as Fe,D as ze}from"./index-Ck9pEVLk.js";import{L as He}from"./LayoutWithActions-DkCsU_ku.js";import{d as We}from"./debounce-Bm0l6c8n.js";import{a as Me}from"./getInstitution-bnPdHE_w.js";import{p as Pe}from"./permitted-DQZ414vW.js";import{g as Je}from"./vue3-datatable-zMyNNFo0.js";import{n as Ye}from"./filters-CoHlS7tX.js";import{_ as je}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./topBarUserProfile-CBH5mGqO.js";const Ge={key:0},Ke={key:1},Xe={class:"mb-1 mt-1"},Qe={key:0},Ze={key:0,class:"text-danger"},$e={key:1,class:"text-success"},et={key:2},tt={key:0,class:"text-danger"},at={key:1,class:"text-success"},lt={key:2},st={__name:"EquipmentHandling",setup(ot){const{institutionData:se}=Me(),O=xe(),{can:oe}=Pe(),ne=ke(),B=qe(),w=B.currentUserRole,S=r(!0),U=r(null),F=r(null),re=r(null),ie=we(),f=r(!1),d=r({filterStatus:[],filterInstitution:[],filterApprovalLevel:[]}),z=r(0);Se(d,a=>{z.value=Ye(a),localStorage.setItem("EHFilter",JSON.stringify(a)),p.current_page=1,h()},{deep:!0});const ue=a=>{p.search=a},I=r(!0),H=r(""),p=Ie({current_page:1,pagesize:10,sort_column:"created_at",sort_direction:"desc",search:""}),R=r(null),D=r([{field:"id",title:"Report Number",isUnique:!0,type:"number",hide:!1},{field:"name",title:"Institution",hide:!1},{field:"address",title:"Address",hide:!1},{field:"user_name",title:"Requested by"},{field:"request_type",title:"Request Category",hide:!1},{field:"request_name",title:"Type of Request",hide:!1},{field:"equipments",title:"Equipment"},{field:"proposed_delivery_date",title:"Proposed Delivery Date",type:"date",hide:!1},{field:"final_installation_date",title:"Final Installation Date",hide:!1},{field:"created_at",title:"Date Requested",type:"date",hide:!1},{field:"approver_name",title:"Pending Approval",hide:!1},{field:"main_status",title:"Status",cellClass:"sticky-last",headerClass:"sticky-last-header",type:"number",hide:!1}])||[],ce=D.value.reduce((a,s)=>(s.title&&s.field&&(a[s.title]=s.field),a),{});A("column",D);const W=[Ue,Fe,ze],de=a=>{W.includes(w)?O.push({name:"WorkOrderInstallation",params:{id:a.id}}):O.push({name:"WorkOrderApprover",params:{id:a.id}})},M=r([]),pe=a=>{M.value=U.value.getSelectedRows(),a&&a.length===1?S.value=!1:S.value=!0;const s=a.map(v=>v.id),m=a.map(v=>v.status);F.value=s[0],re.value=m[0]},me=a=>M.value.map(m=>m.id).includes(a.id)?"highlightRow":"";r(null);const _e=r(W.includes(w)?"WorkOrderInstallation":"WorkOrderApprover"),P=r(null);r(null),oe("create","Equipment Handling")&&B.currentUserRole===Re&&(P.value="WorkOrder");const ve={selectedId:F,btnDisable:S,routeView:_e,createRequest:P.value};A("data",ve);const h=async()=>{var a;try{I.value=!0;const m=(a=(await ie.get("get-equipment-handling",{params:{...p,user_id:ne.user.id,current_role:w,...d.value}})).data)==null?void 0:a.equipment_handling;R.value=m.data,H.value=m.total}catch(s){console.log(s)}I.value=!1},fe=We(h,300),he=a=>{p.current_page=a.current_page,p.pagesize=a.pagesize,p.sort_column=a.sort_column,p.sort_direction=a.sort_direction,a.change_type==="search"?fe():h()};return A("refresh",h),De(()=>{const a=localStorage.getItem("EHFilter");a&&(d.value=JSON.parse(a)),h()}),(a,s)=>{const m=c("v-tooltip"),v=c("v-checkbox"),C=c("v-badge"),ye=c("v-combobox"),y=c("v-col"),V=c("v-icon"),E=c("v-card"),J=c("v-menu"),T=c("v-btn"),ge=c("download-excel"),Y=c("v-row"),be=c("v-chip");return o(),q(He,{onSearchText:ue},{filter:t(()=>[l(Y,null,{default:t(()=>[l(y,{cols:"12",class:"d-flex justify-space-between align-items-center pa-0"},{default:t(()=>[l(C,{color:"warning",dense:"",content:z.value,"offset-y":5},{default:t(()=>[l(v,{"false-icon":"mdi-filter-menu","true-icon":"mdi-close",color:"primary",modelValue:f.value,"onUpdate:modelValue":s[0]||(s[0]=n=>f.value=n)},{default:t(()=>[f.value?X("",!0):(o(),q(m,{key:0,activator:"parent"},{default:t(()=>[_("Expanded Filter")]),_:1}))]),_:1},8,["modelValue"])]),_:1},8,["content"]),l(Ce,{name:"slide-x-transition"},{default:t(()=>[l(y,{class:"d-flex",style:Ve({visibility:f.value?"visible":"hidden",opacity:f.value?"1":"0"})},{default:t(()=>[l(y,{cols:"3",class:"pa-0 mr-1"},{default:t(()=>[l(ye,{transition:"slide-x-transition",color:"primary",modelValue:d.value.filterInstitution,"onUpdate:modelValue":s[1]||(s[1]=n=>d.value.filterInstitution=n),label:"Institution",density:"compact",items:x(se),chips:"","closable-chips":"","single-line":"",itemValue:"institution_id",variant:"outlined",itemTitle:"key",multiple:""},null,8,["modelValue","items"])]),_:1}),l(y,{cols:"auto",class:"pa-0 mr-1"},{default:t(()=>[l(T,{color:"primary",variant:"plain",class:"text-none"},{prepend:t(()=>{var n;return[l(C,{color:"primary",content:(n=d.value.filterStatus)==null?void 0:n.length,inline:""},null,8,["content"])]}),default:t(()=>[_(" Status "),l(V,null,{default:t(()=>[_("mdi-chevron-down")]),_:1}),l(J,{transition:"slide-x-transition","close-on-content-click":!1,"min-width":"400",width:"400",height:"auto",location:"bottom",activator:"parent"},{default:t(()=>[l(E,{width:"auto",class:"pr-3"},{default:t(()=>[(o(!0),u(N,null,L(Ne,n=>(o(),q(v,{modelValue:d.value.filterStatus,"onUpdate:modelValue":s[2]||(s[2]=e=>d.value.filterStatus=e),class:"columnChooserCheckBox",label:n.text,value:n.key},null,8,["modelValue","label","value"]))),256))]),_:1})]),_:1})]),_:1})]),_:1}),l(y,{cols:"auto",class:"pa-0 mr-1"},{default:t(()=>[l(T,{color:"primary",variant:"plain",class:"text-none"},{prepend:t(()=>{var n;return[l(C,{color:"primary",content:(n=d.value.filterApprovalLevel)==null?void 0:n.length,inline:""},null,8,["content"])]}),default:t(()=>[_(" Pending Approval "),l(V,null,{default:t(()=>[_("mdi-chevron-down")]),_:1}),l(J,{transition:"slide-x-transition","close-on-content-click":!1,"min-width":"400",width:"400",height:"auto",location:"bottom",activator:"parent"},{default:t(()=>[l(E,{width:"auto",class:"pr-3"},{default:t(()=>[(o(!0),u(N,null,L(Oe,n=>(o(),q(v,{modelValue:d.value.filterApprovalLevel,"onUpdate:modelValue":s[3]||(s[3]=e=>d.value.filterApprovalLevel=e),class:"columnChooserCheckBox pa-0 ma-0",label:n.key,value:n.value},null,8,["modelValue","label","value"]))),256))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["style"])]),_:1}),l(ge,{data:R.value,type:"xlsx",fields:x(ce),name:"EquipmentHandling - "+x(Be)().format("MM-DD-YYYY")},{default:t(()=>[l(T,{text:"Export","prepend-icon":"mdi-download",variant:"text",color:"primary",class:"text-none"})]),_:1},8,["data","fields","name"])]),_:1})]),_:1}),l(Y)]),default:t(({searchText:n})=>[l(E,{class:"mx-auto"},{default:t(()=>[l(x(Je),{ref_key:"datatable",ref:U,class:"tableLimitText sticky-last-header",rows:R.value,columns:x(D),loading:I.value,search:p.search,totalRows:H.value,pageSize:p.pagesize,isServerMode:!0,onChange:he,onRowSelect:pe,sortColumn:p.sort_column,sortDirection:p.sort_direction,sortable:!0,skin:"bh-table-compact bh-table-bordered bh-table-striped bh-table-hover",hasCheckbox:!0,rowClass:me,selectRowOnClick:!0,cellClass:"internalCell",onRowDBClick:de},{id:t(e=>[k("span",null,i(Ee(e.value.id,e.value.created_at)),1)]),request_type:t(e=>[k("span",null,i(Te(e.value.request_type)),1)]),request_name:t(e=>{var g;return[((g=e.value)==null?void 0:g.request_type)===Ae?(o(),u("span",Ge,[_(i(e.value.request_name)+" ",1),l(m,{location:"left",activator:"parent"},{default:t(()=>[_(" Satellite: "+i(e.value.satellite),1)]),_:2},1024)])):(o(),u("span",Ke,i(Le(e.value.request_type,e.value.request_name,e.value.other)),1))]}),equipments:t(e=>[l(m,{activator:"parent",color:"primary"},{default:t(()=>{var g;return[(o(!0),u(N,null,L((g=e.value.equipments)==null?void 0:g.filter(b=>b.category==="Equipment"),b=>{var j,G,K;return o(),u("p",Xe,[l(V,null,{default:t(()=>[_("mdi-circle-medium")]),_:1}),_(" "+i((j=b.master_data)==null?void 0:j.equipment)+" ",1),(G=b.master_data)!=null&&G.sbu?(o(),u("span",Qe,"[ SBU - "+i((K=b.master_data)==null?void 0:K.sbu)+" ] ",1)):X("",!0)])}),256))]}),_:2},1024)]),approver_name:t(e=>[parseInt(e.value.main_status)===Q?(o(),u("span",Ze,"Disapproved")):parseInt(e.value.main_status)===Z?(o(),u("span",$e,"Completed")):(o(),u("span",et,i($(e.value.level,1))+" "+i(ee===e.value.level||te===e.value.level?e.value.SBU:""),1))]),main_status:t(e=>[k("span",null,[l(be,{label:"",density:"compact",color:ae(e.value.main_status).color},{default:t(()=>[_(i(ae(e.value.main_status).text)+" ",1),l(m,{activator:"parent",location:"left"},{default:t(()=>[parseInt(e.value.main_status)===Q?(o(),u("span",tt,"Disapproved")):parseInt(e.value.main_status)===Z?(o(),u("span",at,"Completed")):(o(),u("span",lt,i($(e.value.level,1))+" "+i(ee===e.value.level||te===e.value.level?e.value.SBU:""),1))]),_:2},1024)]),_:2},1032,["color"])])]),created_at:t(e=>[k("span",null,i(le(e.value.created_at)),1)]),final_installation_date:t(e=>[k("span",null,i(le(e.value.final_installation_date)),1)]),_:1},8,["rows","columns","loading","search","totalRows","pageSize","sortColumn","sortDirection"])]),_:1})]),_:1})}}},vt=je(st,[["__scopeId","data-v-2d6bb10f"]]);export{vt as default};
