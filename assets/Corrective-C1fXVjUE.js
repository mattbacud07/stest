import{g as Ve,r as o,v as Ce,C as ae,J as ke,V as F,c as Ie,x as De,u as Me,E as Re,y as Te,f as p,w as t,T as oe,D as ne,o as c,h as a,G as k,I as b,n as S,j as i,p as I,z,F as q,k as v,t as f,P as y,a1 as Ae,M as Ne,e as d,X as Ue,N as Be,O as Oe}from"./index-Cz72bSYw.js";import{a as J,t as Pe,d as Fe}from"./maintenance-C4GvCYOP.js";import{d as ze}from"./debounce-BH-WzkiD.js";import{g as qe}from"./vue3-datatable-BQ6DeCI2.js";import{O as Je}from"./vue-datepicker-2fw8wqA2.js";/* empty css             */import{L as je}from"./LayoutWithActions-yCU-Oi77.js";import{p as Ee}from"./permitted-DJ8Q4E2X.js";import{_ as Le}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./topBarUserProfile-tltSc7lJ.js";const j=x=>(Be("data-v-c0e3b059"),x=x(),Oe(),x),Ye=j(()=>v("span",{class:"ml-2"},null,-1)),Ge=j(()=>v("span",{class:"ml-2"},null,-1)),We={style:{position:"absolute",bottom:"0!important",left:"0",width:"100%"},class:"d-flex justify-content-center"},Xe={color:"primary"},$e=j(()=>v("br",null,null,-1)),He={key:0,class:"small"},Ke={__name:"Corrective",setup(x){const E=Ve().currentUserRole,L=o(null),{width:se}=Ce(),{can:re}=Ee(),D=o(!1),Y=o(!1),G=o(!1),W=o(!1);o(!1);const M=o({filterOptions:[]});ae(M,e=>{localStorage.setItem("filterChip",JSON.stringify(e)),g()},{deep:!0});const r=o({filterStatus:[],filterInstitution:[],filterSchedule_at:"",filterStatusAfterService:[],filterTag:[]});ae(r,e=>{localStorage.setItem("PMFilterState",JSON.stringify(e)),g()},{deep:!0}),o(!1);const X=ke(()=>Object.values(r.value).filter(e=>Array.isArray(e)&&e.length>0||typeof e=="string"&&e.trim()!=="").length),ie=()=>{r.value={filterOptions:[],filterStatus:[],filterInstitution:[],filterSchedule_at:"",filterStatusAfterService:[],filterTag:[]},localStorage.removeItem("PMFilterState"),localStorage.removeItem("filterChip")},R=o(""),ue=o("PMView");o(null);const T=o(!0),$=o(null),H=o(null);re("create","Preventive Maintenance")&&(H.value="CreatePM");const ce={selectedId:$,btnDisable:T,routeView:ue,work_type:"CM",createRequest:H.value};F("data",ce),Ie();const K=De(),de=Me();o(!1),o(!1);const me=o([]),fe=o([]);o(!1),o(""),o({}),o([]),o([]),o({serial_number:[e=>!!e||"Required field"]});const Q=o([]),pe=e=>{Q.value=L.value.getSelectedRows(),e.length===1?T.value=!1:T.value=!0,$.value=e.map(l=>l.id)[0]},ve=e=>Q.value.map(u=>u.id).includes(e.id)?"highlightRow":"",_e=e=>{de.push({name:"PMView",params:{id:e.id,work_type:"CM"}})},he=e=>{m.search=e},A=o(!0),Z=o(0),m=Re({current_page:1,pagesize:10,sort_column:"scheduled_at",sort_direction:"desc",search:""}),N=o(null),U=o([{field:"id",title:"ID",isUnique:!0,type:"number",hide:!1},{field:"item_id",title:"Item No",hide:!0},{field:"item_code",title:"Item Code"},{field:"description",title:"Item Description",hide:!0},{field:"serial",title:"Serial No."},{field:"institution_name",title:"Institution"},{field:"address",title:"Address",hide:!0},{field:"SBU",title:"SBU"},{field:"username",title:"Delegated to"},{field:"delegation_date",title:"Delegation Date"},{field:"date_accepted",title:"Date Accepted"},{field:"departed_date",title:"Date Out"},{field:"travel_duration",title:"Travel Time"},{field:"start_date",title:"Time In"},{field:"end_date",title:"Time Out"},{field:"status_after_service",title:"Status After Service"},{field:"status",title:"Status"},{field:"tag",title:"Tag"}])||[],ge=U.value.reduce((e,l)=>(l.title&&l.field&&(e[l.title]=l.field),e),{});F("column",U);const g=async()=>{E===oe&&(R.value=oe),E===ne&&(R.value=ne);try{A.value=!0;const e=await K.get("get-preventive-maintenance",{params:{...m,category:R.value,...r.value,...M.value,work_type:"CM"}});if(e.data&&e.data.pm_data){const l=e.data.pm_data;N.value=l.data,Z.value=l.total,me.value=l.data.map(u=>u.item_id),fe.value=l.data.map(u=>u.item_id)}}catch(e){console.log(e)}A.value=!1};F("refresh",g);const ee=o([]),B=o(!1),Se=async()=>{try{B.value=!0;const e=await K.get("get_institution");if(e.data&&e.data.institutions){const l=e.data.institutions;ee.value=l.map(u=>({iName:u.name,iId:u.id}))}}catch(e){console.log(e)}finally{B.value=!1}},ye=ze(g,300),we=e=>{m.current_page=e.current_page,m.pagesize=e.pagesize,m.sort_column=e.sort_column,m.sort_direction=e.sort_direction,e.change_type==="search"?ye():g()};return Te(()=>{const e=localStorage.getItem("PMFilterState"),l=localStorage.getItem("filterChip");e&&(r.value=JSON.parse(e)),l&&(M.value=JSON.parse(l)),g(),Se()}),(e,l)=>{const u=d("v-badge"),_=d("v-btn"),O=d("v-icon"),P=d("v-checkbox"),V=d("v-card"),C=d("v-menu"),h=d("v-col"),be=d("v-combobox"),te=d("v-spacer"),le=d("v-row"),xe=d("download-excel");return c(),p(je,{onSearchText:he},{filter:t(()=>[a(le,null,{default:t(()=>[a(h,{cols:"12",class:"d-flex justify-content-between"},{default:t(()=>[a(C,{modelValue:D.value,"onUpdate:modelValue":l[9]||(l[9]=n=>D.value=n),"close-on-content-click":!1,location:"bottom",transition:"slide-x-reverse-transition"},{activator:t(({props:n})=>[a(_,k({color:"primary","prepend-icon":"mdi-filter-outline",variant:"tonal",text:"Advanced filtering",class:"text-none mb-4"},n),{append:t(()=>[X.value>0?(c(),p(u,{key:0,color:"warning",content:X.value,inline:""},null,8,["content"])):b("",!0)]),_:2},1040)]),default:t(()=>[a(V,{"min-width":"350",width:S(se)<500?"350":"450","max-width":"450","min-height":"500",style:{"overflow-x":"hidden!important"}},{default:t(()=>[a(le,null,{default:t(()=>[a(h,{cols:"12"},{default:t(()=>[a(h,{cols:"12"},{default:t(()=>[a(C,{modelValue:Y.value,"onUpdate:modelValue":l[1]||(l[1]=n=>Y.value=n),"close-on-content-click":!1,height:"auto",location:"bottom","min-width":"auto"},{activator:t(({props:n})=>[a(_,k({color:"primary",variant:"tonal"},n,{class:"text-none w-50 text-left"}),{default:t(()=>[r.value.filterStatus.length>0?(c(),p(u,{key:0,color:"primary",content:r.value.filterStatus.length,class:"mr-3 ml-2"},null,8,["content"])):b("",!0),i(" Status "),a(O,null,{default:t(()=>[i("mdi-chevron-down")]),_:1})]),_:2},1040)]),default:t(()=>[a(V,{width:"auto",class:"pr-3"},{default:t(()=>[(c(!0),I(q,null,z(void 0,(n,s)=>(c(),p(P,{modelValue:r.value.filterStatus,"onUpdate:modelValue":l[0]||(l[0]=w=>r.value.filterStatus=w),class:"columnChooserCheckBox",label:J(n).text,value:n,key:n},null,8,["modelValue","label","value"]))),128))]),_:1})]),_:1},8,["modelValue"]),Ye,a(C,{modelValue:W.value,"onUpdate:modelValue":l[3]||(l[3]=n=>W.value=n),"close-on-content-click":!1,"min-width":"400",width:"400",height:"auto",location:"bottom",class:"ml-3"},{activator:t(({props:n})=>[a(_,k({color:"primary",variant:"tonal"},n,{class:"text-none"}),{default:t(()=>[r.value.filterTag.length>0?(c(),p(u,{key:0,color:"primary",content:r.value.filterTag.length,class:"mr-3"},null,8,["content"])):b("",!0),i(" Tag as"),a(O,null,{default:t(()=>[i("mdi-chevron-down")]),_:1})]),_:2},1040)]),default:t(()=>[a(V,{width:"auto",class:"pr-3"},{default:t(()=>[(c(!0),I(q,null,z(Pe,(n,s)=>(c(),p(P,{modelValue:r.value.filterTag,"onUpdate:modelValue":l[2]||(l[2]=w=>r.value.filterTag=w),class:"columnChooserCheckBox",label:n,value:n,key:s},null,8,["modelValue","label","value"]))),128))]),_:1})]),_:1},8,["modelValue"]),a(C,{modelValue:G.value,"onUpdate:modelValue":l[5]||(l[5]=n=>G.value=n),"close-on-content-click":!1,"min-width":"400",width:"400",height:"auto",location:"bottom",class:"ml-3"},{activator:t(({props:n})=>[a(_,k({color:"primary",variant:"tonal"},n,{class:"text-none w-100 mt-5"}),{default:t(()=>[r.value.filterStatusAfterService.length>0?(c(),p(u,{key:0,color:"primary",content:r.value.filterStatusAfterService.length,class:"mr-3"},null,8,["content"])):b("",!0),i(" Status After Service "),a(O,null,{default:t(()=>[i("mdi-chevron-down")]),_:1})]),_:2},1040)]),default:t(()=>[a(V,{width:"auto",class:"pr-3"},{default:t(()=>[(c(!0),I(q,null,z(Fe,(n,s)=>(c(),p(P,{modelValue:r.value.filterStatusAfterService,"onUpdate:modelValue":l[4]||(l[4]=w=>r.value.filterStatusAfterService=w),class:"columnChooserCheckBox",label:n,value:n,key:s},null,8,["modelValue","label","value"]))),128))]),_:1})]),_:1},8,["modelValue"]),Ge]),_:1}),a(h,{cols:"12"},{default:t(()=>[a(be,{loading:B.value,color:"primary",modelValue:r.value.filterInstitution,"onUpdate:modelValue":l[6]||(l[6]=n=>r.value.filterInstitution=n),label:"Institution",density:"compact",items:ee.value,chips:"","closable-chips":"","single-line":"",itemValue:"iId",variant:"outlined",itemTitle:"iName",multiple:""},null,8,["loading","modelValue","items"])]),_:1}),a(h,{cols:"12"},{default:t(()=>[a(S(Je),{modelValue:r.value.filterSchedule_at,"onUpdate:modelValue":l[7]||(l[7]=n=>r.value.filterSchedule_at=n),"auto-apply":"",range:"","model-type":"yyyy-MM-dd","enable-time-picker":!1,"month-change-on-scroll":!1,placeholder:"Schedule at"},null,8,["modelValue"])]),_:1}),a(h,{cols:"12"},{default:t(()=>[v("div",We,[a(te),a(_,{variant:"tonal",onClick:l[8]||(l[8]=n=>D.value=!1),class:"text-none rounded-0",style:{width:"50%"}},{default:t(()=>[i(" Close ")]),_:1}),a(_,{color:"primary",variant:"flat","prepend-icon":"mdi-close",onClick:ie,class:"text-none rounded-0",style:{width:"50%"}},{default:t(()=>[i(" Clear ")]),_:1})])]),_:1}),a(h,{cols:"12"})]),_:1})]),_:1})]),_:1},8,["width"])]),_:1},8,["modelValue"]),a(te),a(xe,{data:N.value,type:"xlsx",fields:S(ge),name:"PreventiveMaintenance - "+S(Ue)().format("MM-DD-YYYY")},{default:t(()=>[a(_,{text:"Export","prepend-icon":"mdi-download",variant:"tonal",color:"primary",class:"text-none ml-2"})]),_:1},8,["data","fields","name"])]),_:1})]),_:1})]),default:t(({searchText:n})=>[a(S(qe),{ref_key:"datatable",ref:L,rows:N.value,columns:S(U),loading:A.value,search:m.search,isServerMode:!0,totalRows:Z.value,pageSize:m.pagesize,onChange:we,onRowSelect:pe,columnFilter:!1,sortColumn:m.sort_column,sortDirection:m.sort_direction,sortable:!0,style:{border:"1px solid #99999926","border-radius":"3px"},skin:"bh-table-compact bh-table-bordered bh-table-striped bh-table-hover",hasCheckbox:!0,selectRowOnClick:!0,onRowDBClick:_e,rowClass:ve},{id:t(s=>[i(f("PM-"+s.value.id),1)]),scheduled_at:t(s=>[v("div",null,f(y(s.value.scheduled_at)),1)]),delegation_date:t(s=>[i(f(y(s.value.delegation_date)),1)]),date_accepted:t(s=>[i(f(y(s.value.date_accepted)),1)]),departed_date:t(s=>[i(f(y(s.value.departed_date)),1)]),start_date:t(s=>[i(f(y(s.value.start_date)),1)]),end_date:t(s=>[i(f(y(s.value.end_date)),1)]),service_id:t(s=>[v("span",Xe,f(Ae(s.value.service_id)),1)]),status:t(s=>[v("span",{style:Ne({color:J(s.value.status).color})},[v("b",null,f(J(s.value.status).text),1)],4),$e,s.value.status==="Not Set"?(c(),I("span",He,"Contact the admin to configure the frequency")):b("",!0)]),_:1},8,["rows","columns","loading","search","totalRows","pageSize","sortColumn","sortDirection"])]),_:1})}}},ut=Le(Ke,[["__scopeId","data-v-c0e3b059"]]);export{ut as default};
