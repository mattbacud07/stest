import{d as ie,c as re,u as ce,x as ue,g as de,r as s,v as me,C as pe,aG as B,V as M,E as _e,y as ve,f as b,w as l,o as p,h as a,j as _,I as D,_ as fe,M as he,n as u,p as q,z as ge,F as be,t as f,k as y,aH as ye,a1 as xe,e as i,X as we}from"./index-BFEiEqzV.js";import{s as E,a as Se}from"./maintenance-C4GvCYOP.js";import{d as ke}from"./debounce-Ciq6Vdb9.js";import{g as Ce}from"./vue3-datatable-4DUKYgRc.js";import{L as Ve}from"./LayoutWithActions-CJHmZF5c.js";import{a as Me}from"./getInstitution-BUyxC4El.js";import{p as De}from"./permitted-DHah7rlL.js";import{n as Ie}from"./filters-CoHlS7tX.js";import{_ as Re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./topBarUserProfile-DObMqA0B.js";const Pe={color:"primary"},Fe={key:0},Ne={__name:"PreventiveMaintenance",setup(Te){const A=ie.useToast(),{institutionData:L}=Me(),{can:x}=De();re();const Y=ce(),I=ue(),O=de().currentUserRole,R=s(null);me();const v=s(!1),c=s({filterStatus:[],filterInstitution:[],assignment:!1}),P=s(0);pe(c,e=>{P.value=Ie(e),localStorage.setItem("PMFilter",JSON.stringify(e)),r.current_page=1,d()},{deep:!0});const F=s(null),j=s("PMView"),h=s(!0),w=s(null);x("create","Preventive Maintenance")&&(F.value="CreatePM");const J=async()=>{var e;try{(e=(await I.delete(`delete_pm/${w.value}`)).data)!=null&&e.success&&(A.success("Deleted successfully"),d(),h.value=!0)}catch(t){console.log(t)}},G={selectedId:w,btnDisable:h,routeView:j,createRequest:F.value,deleteFunction:x("delete",B)?J:null};M("data",G);const N=s([]),H=e=>{N.value=R.value.getSelectedRows(),e.length===1?h.value=!1:h.value=!0,w.value=e.map(t=>t.id)[0]},W=e=>N.value.map(m=>m.id).includes(e.id)?"highlightRow":"",X=e=>{Y.push({name:"PMView",params:{id:e.id}})},$=e=>{r.search=e},S=s(!0),T=s(0),r=_e({current_page:1,pagesize:10,sort_column:"scheduled_at",sort_direction:"desc",search:""}),k=s(null),C=s([{field:"id",title:"ID",isUnique:!0,type:"number",hide:!1},{field:"service_id",title:"Service No",hide:!0},{field:"item_id",title:"Item No",hide:!0},{field:"item_code",title:"Item Code"},{field:"description",title:"Item Description",hide:!0},{field:"serial",title:"Serial No."},{field:"institution_name",title:"Institution"},{field:"address",title:"Address",hide:!0},{field:"date_installed",title:"Date Installed",hide:!0},{field:"scheduled_at",title:"Scheduled at"},{field:"frequency",title:"Frequency"},{field:"sbu",title:"SBU",hide:!1},{field:"delegated_by",title:"Delegated by"},{field:"delegated_to",title:"Delegated to"},{field:"status_after_service",title:"Status After Service"},{field:"tag",title:"Tag"},{field:"status",title:"Status",cellClass:"sticky-last",headerClass:"sticky-last-header"}])||[],K=C.value.reduce((e,t)=>(t.title&&t.field&&(e[t.title]=t.field),e),{});M("column",C);const d=async()=>{var e;try{S.value=!0;const t=await I.get("get-preventive-maintenance",{params:{...r,...c.value,current_role:O}});if((e=t==null?void 0:t.data)!=null&&e.pm_data){const m=t.data.pm_data;k.value=m.data,T.value=m.total}}catch(t){console.log(t)}S.value=!1};M("refresh",d);const Q=ke(d,300),Z=e=>{r.current_page=e.current_page,r.pagesize=e.pagesize,r.sort_column=e.sort_column,r.sort_direction=e.sort_direction,e.change_type==="search"?Q():d()};return ve(()=>{const e=localStorage.getItem("PMFilter");e&&(c.value=JSON.parse(e)),d()}),(e,t)=>{const m=i("v-tooltip"),V=i("v-checkbox"),z=i("v-badge"),ee=i("v-combobox"),g=i("v-col"),te=i("v-icon"),le=i("v-card"),ae=i("v-menu"),U=i("v-btn"),oe=i("download-excel"),se=i("v-row"),ne=i("v-chip");return p(),b(Ve,{onSearchText:$},{filter:l(()=>[a(se,null,{default:l(()=>[a(g,{cols:"12",class:"d-flex justify-space-between align-items-center pa-0"},{default:l(()=>[a(z,{color:"warning",dense:"",content:P.value,"offset-y":5},{default:l(()=>[a(V,{"false-icon":"mdi-filter-menu","true-icon":"mdi-close",color:"primary",modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=n=>v.value=n)},{default:l(()=>[v.value?D("",!0):(p(),b(m,{key:0,activator:"parent"},{default:l(()=>[_("Expanded Filter")]),_:1}))]),_:1},8,["modelValue"])]),_:1},8,["content"]),a(fe,{name:"slide-x-transition"},{default:l(()=>[a(g,{class:"d-flex",style:he({visibility:v.value?"visible":"hidden",opacity:v.value?"1":"0"})},{default:l(()=>[a(g,{cols:"3",class:"pa-0 mr-1"},{default:l(()=>[a(ee,{transition:"slide-x-transition",color:"primary",modelValue:c.value.filterInstitution,"onUpdate:modelValue":t[1]||(t[1]=n=>c.value.filterInstitution=n),label:"Institution",density:"compact",items:u(L),chips:"","closable-chips":"","single-line":"",itemValue:"institution_id",variant:"outlined",itemTitle:"key",multiple:""},null,8,["modelValue","items"])]),_:1}),a(g,{cols:"auto",class:"pa-0 mr-1"},{default:l(()=>[a(U,{color:"primary",variant:"plain",class:"text-none"},{prepend:l(()=>{var n;return[a(z,{color:"primary",content:(n=c.value.filterStatus)==null?void 0:n.length,inline:""},null,8,["content"])]}),default:l(()=>[_(" Status "),a(te,null,{default:l(()=>[_("mdi-chevron-down")]),_:1}),a(ae,{transition:"slide-x-transition","close-on-content-click":!1,height:"auto",location:"bottom",activator:"parent"},{default:l(()=>[a(le,{width:"auto",class:"pr-3"},{default:l(()=>[(p(!0),q(be,null,ge(Se,n=>(p(),b(V,{modelValue:c.value.filterStatus,"onUpdate:modelValue":t[2]||(t[2]=o=>c.value.filterStatus=o),class:"columnChooserCheckBox",label:n.text,value:n.key},null,8,["modelValue","label","value"]))),256))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["style"])]),_:1}),u(x)("delegate",u(B))?(p(),b(V,{key:0,label:"Show Next Month's Assignments",class:"mr-3",color:"primary",inline:"",modelValue:c.value.assignment,"onUpdate:modelValue":t[3]||(t[3]=n=>c.value.assignment=n)},null,8,["modelValue"])):D("",!0),a(oe,{data:k.value,type:"xlsx",fields:u(K),name:"PreventiveMaintenance - "+u(we)().format("MM-DD-YYYY")},{default:l(()=>[a(U,{text:"Export","prepend-icon":"mdi-download",variant:"tonal",color:"primary",class:"text-none"})]),_:1},8,["data","fields","name"])]),_:1})]),_:1})]),default:l(({searchText:n})=>[a(u(Ce),{ref_key:"datatable",ref:R,rows:k.value,columns:u(C),loading:S.value,search:r.search,isServerMode:!0,totalRows:T.value,pageSize:r.pagesize,onChange:Z,onRowSelect:H,columnFilter:!1,sortColumn:r.sort_column,sortDirection:r.sort_direction,sortable:!0,class:"tableLimitText sticky-last-header",style:{border:"1px solid #99999926","border-radius":"3px"},skin:"bh-table-compact bh-table-bordered bh-table-striped bh-table-hover",hasCheckbox:!0,selectRowOnClick:!0,onRowDBClick:X,rowClass:W,cellClass:"internalCell"},{id:l(o=>[_(f("PM-"+o.value.id),1)]),scheduled_at:l(o=>[y("div",null,f(ye(o.value.scheduled_at)),1)]),service_id:l(o=>[y("span",Pe,f(xe(o.value.service_id)),1)]),sbu:l(o=>[y("span",null,[o.value.sbu?(p(),q("i",Fe,"SBU - ")):D("",!0),_(f(o.value.sbu),1)])]),status:l(o=>[y("span",null,[a(ne,{color:E(o.value.status).color,label:"",size:"small"},{default:l(()=>[_(f(E(o.value.status).text),1)]),_:2},1032,["color"])])]),_:1},8,["rows","columns","loading","search","totalRows","pageSize","sortColumn","sortDirection"])]),_:1})}}},Ge=Re(Ne,[["__scopeId","data-v-c96eecd7"]]);export{Ge as default};
