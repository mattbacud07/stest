import{ap as Pe,J as le,e as a,o as b,f as B,w as t,h as e,k as v,t as V,N as we,O as De,x as _e,d as me,r as c,j as o,i as he,n as D,$ as Me,a0 as qe,p as J,I as U,G as ye,u as Ue,Y as Be,c as Ee,g as Fe,y as Ne,aI as Le,T as je,S as ze,D as Ge,z as Oe,F as de,_ as Je,Z as Ye,aG as Z}from"./index-Ck9pEVLk.js";import{L as Ze}from"./LayoutSinglePage-D402HWj6.js";import{S as He,D as Ke,b as Qe,A as We,c as Xe,I as be,s as ke}from"./maintenance-C4GvCYOP.js";import{_ as Ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as et,a as tt}from"./getActionsTaken-7JWX28Qe.js";import{u as at}from"./getUsers-ojMFm64A.js";import{p as lt}from"./permitted-DQZ414vW.js";import{_ as xe}from"./VDialog-BlvqoXno.js";import{_ as st}from"./ServiceReportForm-BRuBSJvl.js";import"./topBarUserProfile-CBH5mGqO.js";import"./lodash-CtSrTM6H.js";import"./vue3-datatable-zMyNNFo0.js";const te=h=>(we("data-v-689bd18c"),h=h(),De(),h),ot=te(()=>v("p",null,"Institution",-1)),nt={class:"text-grey-darken-1"},rt=te(()=>v("p",null,"Address",-1)),it={class:"text-grey-darken-1"},ct=te(()=>v("p",null,"Equipment",-1)),ut={class:"text-grey-darken-1"},dt=te(()=>v("p",null,"Serial",-1)),_t={class:"text-grey-darken-1"},mt=te(()=>v("p",null,"Frequency",-1)),vt={class:"text-grey-darken-1"},pt={__name:"PMCustomerDetails",props:{customer_details:{type:Object,default:()=>({})}},setup(h){const S=h,{customer_details:E}=Pe(S),R=le(()=>{var _;return(_=E.value)==null?void 0:_.equipment}),C=le(()=>{var _;return(_=E.value)==null?void 0:_.institution});return(_,F)=>{const d=a("v-col"),f=a("v-row"),N=a("v-card");return b(),B(N,{flat:"",style:{"padding-top":"1em"},class:"mb-7 pa-5 mt-5"},{default:t(()=>[e(f,{class:"d-flex justify-space-between"},{default:t(()=>[e(d,{lg:"4",md:"4",sm:"6",cols:"12"},{default:t(()=>{var m;return[ot,v("p",nt,V(((m=C.value)==null?void 0:m.name)??"---"),1)]}),_:1}),e(d,{lg:"4",md:"4",sm:"6",cols:"12"},{default:t(()=>{var m;return[rt,v("p",it,V((m=C.value)==null?void 0:m.address),1)]}),_:1})]),_:1}),e(f,null,{default:t(()=>[e(d,{lg:"4",md:"4",sm:"6",cols:"12"},{default:t(()=>{var m;return[ct,v("p",ut,V((m=R.value)==null?void 0:m.equipment),1)]}),_:1}),e(d,{lg:"4",md:"4",sm:"6",cols:"12"},{default:t(()=>{var m;return[dt,v("p",_t,V((m=R.value)==null?void 0:m.serial),1)]}),_:1}),e(d,{lg:"4",md:"4",sm:"6",cols:"12"},{default:t(()=>{var m;return[mt,v("p",vt,V((m=R.value)==null?void 0:m.frequency),1)]}),_:1})]),_:1})]),_:1})}}},ft=Ve(pt,[["__scopeId","data-v-689bd18c"]]),gt={class:"small text-disabled"},yt={class:"small text-primary",style:{"font-size":"12px"}},bt={key:0,class:"text-disabled"},kt={__name:"PMDelegateEngineer",props:{id:{type:Number,default:null}},emits:["refresh-data"],setup(h,{emit:S}){const E=_e(),R=me.useToast(),{engineers:C}=at(),_=c(""),F=c(!1),d=c(!1),f=c(!1),N=c(!1),m=S,k=h,g=async()=>{var s,i;d.value=!0;const{valid:$}=await N.value.validate();if(!$){d.value=!1;return}try{const r=await E.post("pm_delegate_engineer",{id:k.id,engineer:(s=_.value)==null?void 0:s.value});r.data&&r.data.success?(R.success("Successfully delegated"),m("refresh-data",!0)):(i=r==null?void 0:r.data)!=null&&i.exist?R.error("Currently active"):(R.error(response.data.errorE),d.value=!1)}catch(r){console.log(r),d.value=!1}finally{d.value=!1}};return($,s)=>{const i=a("v-icon"),r=a("v-list-item-title"),z=a("v-list-item"),Y=a("v-combobox"),G=a("v-col"),q=a("v-divider"),O=a("v-btn"),H=a("v-row"),x=a("v-form"),P=a("v-card"),se=a("v-dialog");return b(),B(O,{type:"button",disabled:F.value,color:"primary",variant:"flat",class:"text-none btnSubmit"},{default:t(()=>[e(i,{class:"mr-2"},{default:t(()=>[o("mdi-account-arrow-left-outline")]),_:1}),o(" Delegate Engineer "),e(se,{modelValue:f.value,"onUpdate:modelValue":s[2]||(s[2]=y=>f.value=y),activator:"parent","max-width":"400",persistent:""},{default:t(()=>[e(P,{text:"",title:"Delegate Engineer","prepend-icon":"mdi-account"},{default:t(()=>[e(x,{onSubmit:he(g,["prevent"]),ref_key:"engineerForm",ref:N},{default:t(()=>[e(G,{cols:"12"},{default:t(()=>[e(Y,{color:"primary",class:"mt-5",modelValue:_.value,"onUpdate:modelValue":s[0]||(s[0]=y=>_.value=y),clearable:"",label:"Delegate to",placeholder:"Delegate to",density:"compact",items:D(C),variant:"outlined",itemValue:"value",rules:[y=>!!y||"Required",y=>y.key!==void 0?!0:"Select one of the options listed"],itemTitle:"key"},{item:t(({item:y,props:K})=>[e(z,Me(qe(K)),{default:t(()=>[e(r,null,{default:t(()=>[v("p",gt,"SBU "+V(y.raw.sbu),1)]),_:2},1024)]),_:2},1040)]),selection:t(({item:y,index:K})=>[v("span",yt,[v("b",null,V(y.title),1),o(),y.title?(b(),J("span",bt,"- [SBU : "+V(y.raw.sbu)+"]",1)):U("",!0)])]),_:1},8,["modelValue","items","rules"])]),_:1}),e(q),e(H,{justify:"end",class:"mt-7 mb-5 pr-3"},{default:t(()=>[e(O,{variant:"plain",onClick:s[1]||(s[1]=y=>f.value=!1),color:"primary",class:"text-none mr-2"},{default:t(()=>[o(" Cancel")]),_:1}),e(O,{type:"submit",loading:d.value,disabled:F.value,color:"#191970",flat:"",class:"text-none bg-primary mr-5"},{default:t(()=>[e(i,{class:"mr-2"},{default:t(()=>[o("mdi-check")]),_:1}),o(" Submit")]),_:1},8,["loading","disabled"])]),_:1})]),_:1},512)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["disabled"])}}},xt={__name:"PMAcceptDecline",props:{id:{type:Number,default:null},delegation_id:{type:Number,default:null}},emits:["refresh-data"],setup(h,{emit:S}){const E=_e(),R=me.useToast(),C=c(!1),_=c(!1),F=c(""),d=c(""),f=$=>{d.value=$,_.value=!0},N=S,m=h,k=c(!1),g=async()=>{var s;C.value=!0;const{valid:$}=await k.value.validate();if(!$){C.value=!1;return}try{(s=(await E.post("accept-decline-delegated",{service_id:m.id,delegation_id:m.delegation_id,status:d.value,remarks:F.value})).data)!=null&&s.success&&(R.success("Successful"),N("refresh-data",!0))}catch(i){console.log(i)}finally{C.value=!1,_.value=!1}};return($,s)=>{const i=a("v-btn"),r=a("v-icon"),z=a("v-textarea"),Y=a("v-col"),G=a("v-row"),q=a("v-form"),O=a("v-card"),H=a("v-dialog");return b(),B(H,{modelValue:_.value,"onUpdate:modelValue":s[4]||(s[4]=x=>_.value=x),"max-width":"600",persistent:""},{activator:t(({props:x})=>[e(i,ye({type:"button"},x,{color:"primary",variant:"plain",class:"text-none mr-2",onClick:s[0]||(s[0]=P=>f("declined"))}),{default:t(()=>[o(" Decline ")]),_:2},1040),e(i,ye({type:"button"},x,{color:"primary",variant:"flat",class:"text-none",onClick:s[1]||(s[1]=P=>f("accepted"))}),{default:t(()=>[e(r,{class:"mr-2"},{default:t(()=>[o("mdi-check")]),_:1}),o(" Accept ")]),_:2},1040)]),default:t(()=>[e(O,{class:"pa-5"},{default:t(()=>[e(q,{onSubmit:he(g,["prevent"]),ref_key:"formAcceptDecline",ref:k},{default:t(()=>[e(G,null,{default:t(()=>[e(Y,{class:"d-flex justify-center"},{default:t(()=>[e(z,{modelValue:F.value,"onUpdate:modelValue":s[2]||(s[2]=x=>F.value=x),rules:d.value==="declined"?[x=>!!(x!=null&&x.trim())||"Required"]:[],label:"Remarks",placeholder:"Remarks",dense:"",rows:"3",variant:"outlined",class:"mt-5 w-100"},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(G,{justify:"end",class:"mt-7 mb-5"},{default:t(()=>[e(i,{variant:"plain",onClick:s[3]||(s[3]=x=>_.value=!1),color:"primary",class:"text-none mr-2"},{default:t(()=>[o(" Cancel")]),_:1}),e(i,{type:"submit",loading:C.value,color:"primary",variant:"flat",class:"text-none mr-5"},{default:t(()=>[o(V(d.value==="accepted"?"Accept":"Decline"),1)]),_:1},8,["loading"])]),_:1})]),_:1},512)]),_:1})]),_:1},8,["modelValue"])}}},wt=h=>(we("data-v-487fe8a7"),h=h(),De(),h),Dt={key:2},ht={key:3},Vt={key:4},St=wt(()=>v("div",null,null,-1)),Ct={__name:"PMView",setup(h){var ve,pe,fe;const S=me.useToast(),E=Ue(),R=Be(),C=Ee(),_=_e();Fe().currentUserRole;const d=c("delegation_details"),{can:f}=lt(),N=[{title:"Back",disabled:!1,href:"/preventive-maintenance"},{title:"Preventive Maintenance",disabled:!0,href:""},{title:"PM-Details",disabled:!0,href:""}],m=u=>{!u.disabled&&u.href&&E.push(u.href)};c(!1);const k=c(!1),g=c(!1),$=c(!1),s=parseInt(R.params.id);c(null);const i=c({}),r=c({}),z=c({}),Y=c([]),G=c([]),q=async()=>{var u,l,n;$.value=!0;try{const w=await _.get("get_pm_record_details",{params:{id:s,module_type:Le}});if((u=w==null?void 0:w.data)!=null&&u.pm){const p=w.data.pm;i.value=w.data.pm,r.value=p.task_delegation,Y.value=(l=p.task_delegation)==null?void 0:l.actions_taken,G.value=(n=p.task_delegation)==null?void 0:n.spareparts,z.value=p.latest_task_delegation}else S.error("Something went wrong")}catch(w){console.log(w)}finally{$.value=!1}},O=[je,ze,Ge],H=(fe=(pe=(ve=C.user)==null?void 0:ve.user_roles)==null?void 0:pe.find(u=>O.includes(u.role_id)))==null?void 0:fe.SBU,x=le(()=>{var u,l,n;return(i.value.status===He||((u=i.value)==null?void 0:u.status)===Ke)&&((n=(l=i.value)==null?void 0:l.equipment)==null?void 0:n.sbu)===H}),P=c(!1),se=async()=>{var u,l;g.value=!0,k.value=!0;try{const n=await _.post("in-transit",{id:s,delegation_id:(u=r.value)==null?void 0:u.id});(l=n==null?void 0:n.data)!=null&&l.success&&(q(),S.success("Successfull"))}catch(n){console.log(n),g.value=!1,k.value=!1}finally{g.value=!1,k.value=!1}},y=async()=>{var u,l,n,w;g.value=!0;try{const p=await _.post("start-task",{id:s,delegation_id:(u=r.value)==null?void 0:u.id,in_transit:(w=(n=(l=r.value)==null?void 0:l.task_activity)==null?void 0:n.find(M=>M.status==="In Transit"))==null?void 0:w.acted_at});p.data&&p.data.success&&(S.success("Successfull"),q())}catch(p){console.log(p),g.value=!1}finally{g.value=!1}},K=c(null),ae=c({status_after_service:"",fields:[],spareparts:[],remarks:"",complaint:"",problem:""}),Se=async()=>{var l,n,w,p;if(g.value=!0,k.value=!0,!await((l=K.value)==null?void 0:l.validateServiceForm())){g.value=!1,k.value=!1;return}if(((n=ae.value.fields)==null?void 0:n.length)===0){S.error("Required actions taken"),g.value=!1,k.value=!1;return}try{const M=await _.post("mark_as_completed",{id:s,delegation_id:(w=r.value)==null?void 0:w.id,...ae.value});(p=M==null?void 0:M.data)!=null&&p.success?(S.success("Completed successfully"),q()):S.error(M.data.error)}catch(M){console.log(M)}finally{g.value=!1,k.value=!1}},Q=le(()=>{var n;const u=(n=r.value)==null?void 0:n.assigned_to,l=C.user.id;return u===l}),oe=u=>{u===!0&&q()};return Ne(async()=>{q()}),(u,l)=>{const n=a("v-icon"),w=a("v-breadcrumbs-item"),p=a("v-tooltip"),M=a("v-breadcrumbs"),ge=a("v-spacer"),ne=a("v-btn"),L=a("v-skeleton-loader"),j=a("v-col"),re=a("v-row"),ie=a("v-chip"),ce=a("v-tab"),Ce=a("v-tabs"),ue=a("v-window-item"),Re=a("v-window"),$e=a("v-card-text"),Ie=a("v-card"),Te=a("v-container");return b(),B(Ze,null,{topBarFixed:t(()=>{var W,I,X,ee,T;return[v("div",null,[e(M,{class:"pt-7"},{default:t(()=>[(b(),J(de,null,Oe(N,(A,Ae)=>e(w,{key:Ae,class:Ye({"custom-pointer":!A.disabled}),onClick:Rt=>m(A),disabled:A.disabled},{default:t(()=>[o(V(A.title)+" ",1),e(n,{class:"ml-1",icon:"mdi-chevron-right"})]),_:2},1032,["class","onClick","disabled"])),64)),e(n,{color:"grey",onClick:l[0]||(l[0]=A=>oe(!0))},{default:t(()=>[e(p,{activator:"parent",location:"bottom"},{default:t(()=>[o("Refresh")]),_:1}),o(" mdi-refresh")]),_:1})]),_:1})]),e(ge),v("div",null,[D(f)("delegate",D(Z))&&x.value?(b(),B(kt,{key:0,id:D(s),onRefreshData:oe},null,8,["id"])):U("",!0),D(f)("installer",D(Z))&&Q.value&&((W=r.value)==null?void 0:W.status)===Qe?(b(),B(xt,{key:1,id:D(s),delegation_id:(I=r.value)==null?void 0:I.id,onRefreshData:oe},null,8,["id","delegation_id"])):U("",!0),D(f)("installer",D(Z))&&Q.value&&((X=r.value)==null?void 0:X.status)===We?(b(),J("div",Dt,[e(xe,{modelValue:P.value,"onUpdate:modelValue":l[1]||(l[1]=A=>P.value=A),title:"Information",text:"Are you sure to this action?",onConfirm:se},null,8,["modelValue"]),e(ne,{type:"button",loading:g.value,disabled:k.value,onClick:l[2]||(l[2]=A=>P.value=!0),color:"primary",variant:"flat",class:"text-none"},{default:t(()=>[e(n,{class:"mr-2"},{default:t(()=>[o("mdi-check")]),_:1}),o("In Transit ")]),_:1},8,["loading","disabled"])])):U("",!0),D(f)("installer",D(Z))&&Q.value&&((ee=r.value)==null?void 0:ee.status)===Xe?(b(),J("div",ht,[e(xe,{modelValue:P.value,"onUpdate:modelValue":l[3]||(l[3]=A=>P.value=A),title:"Information",text:"Are you sure to this action?",onConfirm:y},null,8,["modelValue"]),e(ne,{type:"button",loading:g.value,disabled:k.value,onClick:l[4]||(l[4]=A=>P.value=!0),color:"primary",variant:"flat",class:"text-none"},{default:t(()=>[e(n,{class:"mr-2"},{default:t(()=>[o("mdi-check")]),_:1}),o(" Start PM Task")]),_:1},8,["loading","disabled"])])):U("",!0),D(f)("installer",D(Z))&&Q.value&&((T=r.value)==null?void 0:T.status)===be?(b(),J("div",Vt,[e(ne,{onClick:Se,text:"Mark as Completed",disabled:k.value,color:"primary",variant:"flat",class:"text-none mr-5"},null,8,["disabled"])])):U("",!0)])]}),default:t(()=>[e(Te,{class:"mt-10"},{default:t(()=>{var W;return[$.value?(b(),J(de,{key:0},[e(re,null,{default:t(()=>[e(j,{cols:"6"},{default:t(()=>[e(L,{type:"list-item-two-line"})]),_:1}),e(j,{cols:"6"},{default:t(()=>[e(L,{type:"list-item-two-line"})]),_:1})]),_:1}),e(re,null,{default:t(()=>[e(j,{cols:"4"},{default:t(()=>[e(L,{type:"list-item-two-line"})]),_:1}),e(j,{cols:"4"},{default:t(()=>[e(L,{type:"list-item-two-line"})]),_:1}),e(j,{cols:"4"},{default:t(()=>[e(L,{type:"list-item-two-line"})]),_:1})]),_:1}),e(re,null,{default:t(()=>[e(j,{cols:"4"},{default:t(()=>[e(L,{type:"list-item-two-line"})]),_:1}),e(j,{cols:"4"},{default:t(()=>[e(L,{type:"list-item-two-line"})]),_:1}),e(j,{cols:"4"},{default:t(()=>[e(L,{type:"list-item-two-line"})]),_:1})]),_:1})],64)):(b(),J(de,{key:1},[e(Je,{name:"slide-x-transition"},{default:t(()=>{var I,X,ee;return[v("div",null,[e(ie,{class:"ma-2 mt-5",color:ke((I=i.value)==null?void 0:I.status).color,label:""},{default:t(()=>{var T;return[e(p,{activator:"parent",location:"bottom"},{default:t(()=>[o("Status")]),_:1}),o("  "+V(ke((T=i.value)==null?void 0:T.status).text??"---"),1)]}),_:1},8,["color"]),(X=z.value)!=null&&X.status_after_service?(b(),B(ie,{key:0,class:"ma-2 mt-5",color:"purple",label:""},{default:t(()=>{var T;return[e(p,{activator:"parent",location:"bottom"},{default:t(()=>[o("Status after service")]),_:1}),o("  "+V(((T=z.value)==null?void 0:T.status_after_service)??"---"),1)]}),_:1})):U("",!0),(ee=i.value)!=null&&ee.tag?(b(),B(ie,{key:1,class:"ma-2 mt-5",color:"purple",label:""},{default:t(()=>{var T;return[e(p,{activator:"parent",location:"bottom"},{default:t(()=>[o("Tag")]),_:1}),o("  "+V(((T=i.value)==null?void 0:T.tag)??"---"),1)]}),_:1})):U("",!0)])]}),_:1}),D(f)("installer",D(Z))&&Q.value&&((W=r.value)==null?void 0:W.status)===be?(b(),B(st,{key:0,modelValue:ae.value,"onUpdate:modelValue":l[5]||(l[5]=I=>ae.value=I),ref_key:"serviceFormRef",ref:K,class:"mt-7"},null,8,["modelValue"])):U("",!0),e(ft,{customer_details:i.value},null,8,["customer_details"]),e(Ie,{class:"mt-10"},{default:t(()=>[e(Ce,{modelValue:d.value,"onUpdate:modelValue":l[6]||(l[6]=I=>d.value=I),density:"compact",class:"border-b-sm"},{default:t(()=>[v("div",null,[e(ce,{value:"delegation_details",class:"text-none",color:"primary"},{default:t(()=>[e(n,{class:"mr-2"},{default:t(()=>[o("mdi-gesture-tap-button")]),_:1}),o(" Delegation Details")]),_:1}),e(ce,{value:"service_report",class:"text-none",color:"primary"},{default:t(()=>[e(n,{class:"mr-2"},{default:t(()=>[o("mdi-poll")]),_:1}),o(" Service Report")]),_:1})]),e(ge),e(ce,{value:"customer_details",class:"text-none",color:"primary"},{default:t(()=>[e(n,{class:"mr-2"},{default:t(()=>[o("mdi-badge-account")]),_:1}),o(" Customer Details")]),_:1}),St]),_:1},8,["modelValue"]),e($e,null,{default:t(()=>[e(Re,{modelValue:d.value,"onUpdate:modelValue":l[7]||(l[7]=I=>d.value=I)},{default:t(()=>[e(ue,{value:"delegation_details"},{default:t(()=>[e(et,{internalData:i.value},null,8,["internalData"])]),_:1}),e(ue,{value:"service_report"},{default:t(()=>[e(tt,{task_delegation:r.value,actions_taken:Y.value,spareparts:G.value},null,8,["task_delegation","actions_taken","spareparts"])]),_:1}),e(ue,{value:"customer_details"})]),_:1},8,["modelValue"])]),_:1})]),_:1})],64))]}),_:1})]),_:1})}}},Lt=Ve(Ct,[["__scopeId","data-v-487fe8a7"]]);export{Lt as default};
