import{d as Ee,r as n,ad as Ke,x as Pe,e as s,o as h,f as le,w as t,h as e,G as be,j as c,i as Ne,n as J,$ as Ye,a0 as Ze,k as S,t as $,p as A,I as ae,g as Qe,u as Xe,Y as et,v as tt,c as lt,L as G,J as H,V as at,y as st,ae as De,af as Ie,ag as me,ah as Ae,ai as Be,aj as _e,a5 as ot,a3 as rt,z as nt,F as te,_ as it,a7 as ut,aa as Ue,ak as Ce,Z as ct,M as dt,N as pt,O as vt}from"./index-Cz72bSYw.js";import{L as mt}from"./LayoutSinglePage-Dk5b2Jaw.js";import{R as _t,_ as ft}from"./ApproverHistoryLog-N6lJxyHe.js";import{R as bt,_ as yt}from"./RequestDetails-Bjrhk5cX.js";import{p as gt}from"./permitted-DJ8Q4E2X.js";import{u as ht}from"./getUsers-BD_7D9yP.js";import{s as fe,a as St}from"./department-IKZ5hSBF.js";import{_ as qt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./topBarUserProfile-tltSc7lJ.js";const wt=S("h5",{style:{"font-weight":"500",color:"#191970"}},[S("span",null,"Service Department - Internal Servicing")],-1),xt=S("p",{class:"small mt-2 mb-3"}," If you select Start the Internal Servicing, the process will pause and wait until the internal servicing is completed before proceeding further ",-1),Vt=S("h5",{class:"mt-3",style:{"font-weight":"500",color:"#191970"}},"Internal Servicing - Delegation of Service",-1),kt={class:"small text-disabled"},Rt={class:"small text-primary",style:{"font-size":"12px"}},Dt={key:0,class:"text-disabled"},It={__name:"InternalServicingDelegation",props:{service_id:{type:Number}},emits:["refresh"],setup(B,{emit:U}){const se=Ee.useToast(),x=n(!1),L=n(""),C=n(!1),E=n(!1),oe=n(!1),f=Ke("disableButton",null),M=U,P=Pe(),K=B,{engineers:O}=ht(),z=async()=>{E.value=!0;const{valid:b}=await C.value.validate();if(!b){E.value=!1;return}try{const p=await P.post("internal-process",{service_id:K.service_id,assigned_to:L.value.value});p.data&&p.data.success?(se.success("Successfully delegated"),typeof f=="function"&&f(),M("refresh")):p.data&&p.data.exist_service_id&&se.warning("Request already exist.")}catch(p){alert(p)}finally{E.value=!1,x.value=!1}};return(b,p)=>{const V=s("v-col"),N=s("v-row"),j=s("v-icon"),k=s("v-btn"),Y=s("v-divider"),q=s("v-list-item-title"),re=s("v-list-item"),ne=s("v-combobox"),ie=s("v-form"),T=s("v-card"),ue=s("v-dialog");return h(),le(T,{flat:"",class:"mb-5 mt-7 pt-3 pb-1",color:"info",variant:"tonal"},{default:t(()=>[e(V,{cols:"12"},{default:t(()=>[e(N,null,{default:t(()=>[e(V,{cols:"12"},{default:t(()=>[wt,xt]),_:1})]),_:1}),e(ue,{modelValue:x.value,"onUpdate:modelValue":p[2]||(p[2]=d=>x.value=d),"max-width":"500",persistent:""},{activator:t(({props:d})=>[e(k,be({type:"button",variant:"tonal"},d,{color:"primary",class:"text-none btnSubmit mt-3"}),{default:t(()=>[e(j,{class:"mr-2"},{default:t(()=>[c("mdi-transfer-right")]),_:1}),c(" Start Internal Servicing")]),_:2},1040)]),default:t(()=>[e(T,null,{default:t(()=>[e(ie,{onSubmit:Ne(z,["prevent"]),ref_key:"form",ref:C},{default:t(()=>[e(V,{cols:"12"},{default:t(()=>[Vt,e(Y),e(ne,{color:"primary",class:"mt-5",modelValue:L.value,"onUpdate:modelValue":p[0]||(p[0]=d=>L.value=d),clearable:"",label:"Delegate to",placeholder:"Delegate to",density:"compact",items:J(O),variant:"outlined",itemValue:"value",rules:[d=>!!d||"Required",d=>d.key!==void 0?!0:"Select one of the options listed"],itemTitle:"key"},{item:t(({item:d,props:u})=>[e(re,Ye(Ze(u)),{default:t(()=>[e(q,null,{default:t(()=>[S("p",kt,"SBU "+$(d.raw.sbu),1)]),_:2},1024)]),_:2},1040)]),selection:t(({item:d,index:u})=>[S("span",Rt,[S("b",null,$(d.title),1),c(),d.title?(h(),A("span",Dt,"- [SBU : "+$(d.raw.sbu)+"]",1)):ae("",!0)])]),_:1},8,["modelValue","items","rules"])]),_:1}),e(Y,{class:"mb-5"}),e(N,{justify:"end",class:"mb-3"},{default:t(()=>[e(k,{onClick:p[1]||(p[1]=d=>x.value=!1),elevation:"0",size:"small",class:"text-none mr-2"},{default:t(()=>[c(" Cancel")]),_:1}),e(k,{type:"submit",size:"small",loading:E.value,disabled:oe.value,color:"#191970",class:"text-none bg-primary mr-5"},{default:t(()=>[e(j,{class:"mr-2"},{default:t(()=>[c("mdi-check")]),_:1}),c(" Delegate")]),_:1},8,["loading","disabled"])]),_:1})]),_:1},512)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}}},At=B=>(pt("data-v-2accc5dc"),B=B(),vt(),B),Bt={key:0},Ut=At(()=>S("p",{class:"text-error"},"* Internal Processing in Progress",-1)),Ct=[Ut],Et={key:1},Pt={__name:"WorkOrderApprover",setup(B){var we,xe;const U=Ee.useToast(),x=Qe().currentUserRole,{can:L}=gt(),C=Xe(),E=et(),{width:oe}=tt(),f=lt(),M=Pe(),P=n("equipments"),K=n(!1),O=n(!1),z=n(!1);n(!1);const b=n(!1),p=n(!1),V=parseInt(E.params.id),N=n([]),j=n(!1),k=n("");n(null),n(0);const Y=n(""),q=n({receiving_option:"",final_installation_date:"",driver:""}),re=[{title:"Back",disabled:!1,href:"/equipment-handling",display:"block"},{title:"Equipment Handling",disabled:!0,href:"",display:"none"},{title:"Work Order",disabled:!0,href:"",display:"none"}],ne=o=>{!o.disabled&&o.href&&C.push(o.href)},ie=async()=>{if(p.value=!0,f.user.approval_level.includes(Ce)&&!j.value){U.error("Please ensure all serial number fields are filled in"),p.value=!1;return}const{valid:o}=await K.value.validate();if(!o){p.value=!1;return}try{const l=await M.post("approve-request",{id:f.user.id,serial:N.value,service_id:V,engineer:Y.value.value,level:u.value.level,remark:k.value,...q.value});l.data&&l.data.success&&(b.value=!0,U.success("Approved successfully"),C.push("/equipment-handling"))}catch(l){l.response.data&&l.response.data.errorMisMatch&&(U.error(l.response.data.errorMisMatch),de()),console.log(l)}finally{p.value=!1}},T=n(""),ue=async()=>{b.value=!0;try{const o=await M.post("disapprove-request",{service_id:V,remark:T.value});o.data&&o.data.success&&(U.success("Disapproval completed successfully"),C.push("/equipment-handling"))}catch(o){console.log(o)}finally{b.value=!1}},d=n(!1),u=n({}),ye=n({});n({});const ce=n([]),ge=n([]),he=n([]),Se=n([]),de=async()=>{var o,l,m,R,D;try{d.value=!0;const y=await M.get("get-specific-equipment-handling",{params:{service_id:V}});if((o=y==null?void 0:y.data)!=null&&o.request){const r=y.data.request;u.value=r,ye.value={full_name:(l=r.users)==null?void 0:l.full_name,institution:(m=r.institution)==null?void 0:m.name,address:(R=r.institution)==null?void 0:R.address,proposed_delivery_date:r.proposed_delivery_date,created_at:r.created_at},ce.value=r.equipments,ge.value=r.peripherals,he.value=(D=r.approval_logs)==null?void 0:D.filter(i=>![18,19,20].includes(i.level)&&i.acted_at!==null).map(i=>{var Q,W,X,ee;const _=(Q=i==null?void 0:i.approvers)==null?void 0:Q.filter(v=>{var g;return((g=v.users)==null?void 0:g.department)===fe}),w=(W=i==null?void 0:i.approvers)==null?void 0:W.filter(v=>{var g;return((g=v.users)==null?void 0:g.department)===St}),I=(X=i==null?void 0:i.approvers)==null?void 0:X.filter(v=>v.satellite===(r==null?void 0:r.satellite)),Z=(r==null?void 0:r.equipments.map(v=>{var g;return(g=v.master_data)==null?void 0:g.sbu}))||[],F=_.filter(v=>Z.includes(v.sbu));return i.level===De?{...i,driver:r==null?void 0:r.driver}:i.level===Ie?((ee=r.users)==null?void 0:ee.department)===fe?{...i,approvers:F}:{...i,approvers:w}:i.level===me?{...i,approvers:F}:Ae.includes(i.level)?{...i,approvers:I}:i}),Se.value=r.users}else alert("Something went wrong")}catch(y){console.log(y)}finally{d.value=!1}},Te=o=>{var l;N.value=Array.from(o),j.value=(l=N.value)==null?void 0:l.every(m=>m.serial&&m.serial.trim()!=="")},pe=(we=f.user.user_roles.find(o=>o.role_id===G))==null?void 0:we.SBU,$e=(xe=f.user.user_roles.find(o=>o.role_id===G))==null?void 0:xe.satellite,ve=H(()=>ce.value.map(o=>{var l;return(l=o.master_data)==null?void 0:l.sbu})),Le=H(()=>{var o,l;return u.value.level===me&&u.value.main_status!==Be&&x===G?(ve.value.includes(pe)||((l=(o=f.user)==null?void 0:o.user_roles)==null?void 0:l.some(m=>m.role_id===_e)))&&!u.value.bypass:!1}),Me=H(()=>{var o,l,m,R,D,y,r,i,_;return f.user.approval_level.includes(u.value.level)&&x===G&&((o=u.value)==null?void 0:o.main_status)!==ot?u.value.level===Ie?((l=f.user)==null?void 0:l.department)===fe?ve.value.includes(pe)||((R=(m=f.user)==null?void 0:m.user_roles)==null?void 0:R.some(w=>w.role_id===_e)):((D=f.user)==null?void 0:D.department)===((y=Se.value)==null?void 0:y.department):u.value.level===me?ve.value.includes(pe)||((i=(r=f.user)==null?void 0:r.user_roles)==null?void 0:i.some(w=>w.role_id===_e)):Ae.includes(u.value.level)?((_=u.value)==null?void 0:_.satellite)===$e:!0:!1}),Oe=H(()=>u.value.main_status===Be),ze=H(()=>{var o;return u.value.level===De&&x===G&&((o=u.value)==null?void 0:o.request_type)===rt}),qe=n(0),je=()=>{de(),qe.value+=1};return at("disableButton",()=>{b.value=!0}),st(async()=>{b.value=!0,f.user.approval_level!==1&&(b.value=!1),b.value=!1,de()}),(o,l)=>{const m=s("v-icon"),R=s("v-breadcrumbs-item"),D=s("v-breadcrumbs"),y=s("v-spacer"),r=s("v-btn"),i=s("v-textarea"),_=s("v-col"),w=s("v-row"),I=s("v-card"),Z=s("v-dialog"),F=s("v-radio"),Q=s("v-radio-group"),W=s("v-text-field"),X=s("v-divider"),ee=s("v-form"),v=s("v-skeleton-loader"),g=s("v-tooltip"),Ve=s("v-chip"),ke=s("v-tab"),Fe=s("v-tabs"),Re=s("v-window-item"),We=s("v-window"),Ge=s("v-card-text"),He=s("v-container");return h(),le(mt,null,{topBarFixed:t(()=>[S("div",null,[e(D,{class:"pt-7"},{default:t(()=>[(h(),A(te,null,nt(re,(a,Je)=>e(R,{key:Je,class:ct({"custom-pointer":!a.disabled}),style:dt({display:J(oe)<=768?a.display:""}),onClick:Tt=>ne(a),disabled:a.disabled},{default:t(()=>[c($(a.title)+" ",1),e(m,{class:"ml-1",icon:"mdi-chevron-right"})]),_:2},1032,["class","style","onClick","disabled"])),64))]),_:1})]),e(y),Oe.value?(h(),A("div",Bt,Ct)):(h(),A("div",Et,[J(L)("approve","Equipment Handling")&&Me.value?(h(),A(te,{key:0},[e(Z,{modelValue:O.value,"onUpdate:modelValue":l[2]||(l[2]=a=>O.value=a),"max-width":"600",persistent:""},{activator:t(({props:a})=>[e(r,be({disabled:b.value},a,{color:"primary",variant:"plain",class:"text-none mr-2"}),{default:t(()=>[c(" Disapprove")]),_:2},1040,["disabled"])]),default:t(()=>[e(I,{text:"",title:"Disapprove"},{actions:t(()=>[e(w,{justify:"end"},{default:t(()=>[e(r,{onClick:l[1]||(l[1]=a=>O.value=!1),class:"text-none mr-2"},{default:t(()=>[c(" Cancel")]),_:1}),e(r,{onClick:ue,color:"primary",elevation:"2",class:"text-none mr-3",style:{"background-color":"#191970",color:"#fff!important"}},{default:t(()=>[c("Disapprove")]),_:1})]),_:1})]),default:t(()=>[e(_,{cols:"12"},{default:t(()=>[e(i,{class:"mr-2 ml-2",modelValue:T.value,"onUpdate:modelValue":l[0]||(l[0]=a=>T.value=a),rules:[a=>!!(a!=null&&a.trim())||"Please provide a reason for disapproval"],clearable:"",label:"Reason of Disapproval",color:"primary",variant:"outlined"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Z,{modelValue:z.value,"onUpdate:modelValue":l[8]||(l[8]=a=>z.value=a),"max-width":"600",persistent:""},{activator:t(({props:a})=>[e(r,be({type:"button"},a,{disabled:b.value,color:"primary",variant:"flat",class:"text-none btnSubmit"}),{default:t(()=>[e(m,{class:"mr-2"},{default:t(()=>[c("mdi-check")]),_:1}),c(" Approve")]),_:2},1040,["disabled"])]),default:t(()=>[e(I,{text:"",title:"Approve"},{default:t(()=>[e(ee,{onSubmit:Ne(ie,["prevent"]),ref_key:"form",ref:K},{default:t(()=>[e(_,{cols:"12"},{default:t(()=>[e(i,{class:"mr-2 ml-2",modelValue:k.value,"onUpdate:modelValue":l[3]||(l[3]=a=>k.value=a),clearable:"",label:"Remarks (optional)",color:"primary",variant:"outlined"},null,8,["modelValue"]),ze.value?(h(),A(te,{key:0},[e(I,{class:"mr-2 ml-2 mt-5"},{default:t(()=>[e(Q,{modelValue:q.value.receiving_option,"onUpdate:modelValue":l[4]||(l[4]=a=>q.value.receiving_option=a),rules:[a=>!!a||"Required"],label:"Set receiving option",color:"primary"},{default:t(()=>[e(F,{label:"Door to Door",value:"door"}),e(F,{label:"Pickup",value:"pickup"})]),_:1},8,["modelValue","rules"])]),_:1}),e(W,{type:"date",class:"mr-2 ml-2 mt-5",modelValue:q.value.final_installation_date,"onUpdate:modelValue":l[5]||(l[5]=a=>q.value.final_installation_date=a),variant:"outlined",color:"primary",density:"compact",rules:[a=>!!a||"Required"],label:"Final Installation Date"},null,8,["modelValue","rules"]),e(W,{class:"mr-2 ml-2 mt-5",modelValue:q.value.driver,"onUpdate:modelValue":l[6]||(l[6]=a=>q.value.driver=a),variant:"outlined",color:"primary",density:"compact",rules:[a=>!!a||"Required"],label:"Driver"},null,8,["modelValue","rules"])],64)):ae("",!0)]),_:1}),e(X),e(w,{justify:"end",class:"mt-7 mb-5 pr-3"},{default:t(()=>[e(r,{variant:"plain",onClick:l[7]||(l[7]=a=>z.value=!1),color:"primary",class:"text-none mr-2"},{default:t(()=>[c(" Cancel")]),_:1}),e(r,{type:"submit",loading:p.value,disabled:b.value,color:"#191970",flat:"",class:"text-none bg-primary mr-5"},{default:t(()=>[e(m,{class:"mr-2"},{default:t(()=>[c("mdi-check")]),_:1}),c(" Approve")]),_:1},8,["loading","disabled"])]),_:1})]),_:1},512)]),_:1})]),_:1},8,["modelValue"])],64)):ae("",!0)]))]),default:t(()=>[e(He,{class:"container-form mt-3"},{default:t(()=>[d.value?(h(),le(w,{key:0},{default:t(()=>[e(_,{cols:"6"},{default:t(()=>[e(v,{type:"list-item-two-line"})]),_:1}),e(_,{cols:"6"},{default:t(()=>[e(v,{type:"list-item-two-line"})]),_:1}),e(_,{cols:"4"},{default:t(()=>[e(v,{type:"list-item-two-line"})]),_:1}),e(_,{cols:"4"},{default:t(()=>[e(v,{type:"list-item-two-line"})]),_:1}),e(_,{cols:"4"},{default:t(()=>[e(v,{type:"list-item-two-line"})]),_:1}),e(_,{cols:"4"},{default:t(()=>[e(v,{type:"list-item-two-line"})]),_:1}),e(_,{cols:"4"},{default:t(()=>[e(v,{type:"list-item-two-line"})]),_:1}),e(_,{cols:"4"},{default:t(()=>[e(v,{type:"list-item-two-line"})]),_:1})]),_:1})):(h(),A(te,{key:1},[e(it,{name:"slide-x-transition"},{default:t(()=>[e(I,{class:"mt-5 statusVCard",elevation:"0"},{default:t(()=>[e(Ve,{class:"ma-2",color:"purple",label:""},{default:t(()=>[S("i",null," "+$(ut(u.value.level,1)??"---"),1),e(g,{activator:"parent",location:"bottom"},{default:t(()=>[c("Pending approval")]),_:1})]),_:1}),e(Ve,{class:"ma-2",color:Ue(u.value.main_status).color,label:""},{default:t(()=>[e(g,{activator:"parent",location:"bottom"},{default:t(()=>[c("Status")]),_:1}),S("strong",null," "+$(Ue(u.value.main_status).text),1)]),_:1},8,["color"])]),_:1})]),_:1}),Le.value?(h(),le(It,{service_id:J(V),onRefresh:je,key:qe.value},null,8,["service_id"])):ae("",!0),e(bt,{request_data:ye.value},null,8,["request_data"]),e(_t,{request_data:u.value},null,8,["request_data"])],64)),e(I,{class:"mt-10"},{default:t(()=>[e(Fe,{modelValue:P.value,"onUpdate:modelValue":l[9]||(l[9]=a=>P.value=a),density:"compact",class:"border-b-sm"},{default:t(()=>[e(ke,{value:"equipments",class:"text-none"},{default:t(()=>[e(m,{class:"mr-2"},{default:t(()=>[c("mdi-hammer-screwdriver")]),_:1}),c(" Requested Equipments")]),_:1}),e(ke,{value:"history",class:"text-none"},{default:t(()=>[e(m,{class:"mr-2"},{default:t(()=>[c("mdi-account-details")]),_:1}),c(" Approval Requirements")]),_:1})]),_:1},8,["modelValue"]),e(Ge,null,{default:t(()=>[e(We,{modelValue:P.value,"onUpdate:modelValue":l[10]||(l[10]=a=>P.value=a),disabled:!0},{default:t(()=>[e(Re,{value:"equipments"},{default:t(()=>[e(yt,{equipments:ce.value,peripherals:ge.value,onSetSerial:Te,editSerial:u.value.level===J(Ce)},null,8,["equipments","peripherals","editSerial"])]),_:1}),e(Re,{value:"history"},{default:t(()=>[e(ft,{history:he.value,status:u.value.main_status},null,8,["history","status"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})}}},Ht=qt(Pt,[["__scopeId","data-v-2accc5dc"]]);export{Ht as default};
