import{v as re,u as ie,c as ce,x as ue,g as de,r as s,C as me,V as w,E as pe,y as _e,f as S,w as t,o as u,h as a,j as d,I as L,_ as ve,M as fe,n as x,p as g,z as O,F as J,k as P,t as b,a1 as ge,ax as j,e as r,ay as be}from"./index-Ck9pEVLk.js";import{d as he}from"./debounce-Bm0l6c8n.js";import{a as ye}from"./getInstitution-bnPdHE_w.js";import{L as we}from"./LayoutWithActions-DkCsU_ku.js";import{g as Se}from"./vue3-datatable-zMyNNFo0.js";import{n as xe}from"./filters-CoHlS7tX.js";import{_ as Ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./topBarUserProfile-CBH5mGqO.js";import"./permitted-DQZ414vW.js";const Re={class:"mb-1 mt-1"},Ce={key:0},De={__name:"InternalRequestMainData",setup(ke){const{institutionData:A}=ye();re();const W=ie();ce();const G=ue(),H=de().currentUserRole,m=s(!1),i=s({filterStatus:[],filterInstitution:[]}),I=s(0);me(i,e=>{I.value=xe(e),localStorage.setItem("ISFilter",JSON.stringify(e)),n.current_page=1,p()},{deep:!0});const h=s(!0),R=s(null);s(!1);const C=s(null),K=s(null),Q=s("InternalServicingProcess");w("data",{selectedId:C,status:K,btnDisable:h,routeView:Q});const D=s([]),X=e=>{D.value=R.value.getSelectedRows(),e&&e.length===1?h.value=!1:h.value=!0,C.value=e.map(l=>l.id)[0]},Y=e=>D.value.map(c=>c.id).includes(e.id)?"highlightRow":"",Z=e=>{W.push({name:"InternalServicingProcess",params:{id:e.id}})},$=e=>{n.search=e},y=s(!0),k=s(""),n=pe({current_page:1,pagesize:10,sort_column:"created_at",sort_direction:"desc",search:""}),V=s(null),q=s([{field:"id",title:"ID",isUnique:!0,type:"number",hide:!0,width:"auto"},{field:"service_id",title:"JO"},{field:"requested_by",title:"Requested by"},{field:"institution",title:"Institution"},{field:"equipments_data",title:"Equipmetns"},{field:"assigned_by",title:"Delegated by"},{field:"assigned_to",title:"Delegated to"},{field:"proposed_delivery_date",title:"Proposed Delivery Date"},{field:"status",title:"Status"}])||[];w("column",q);const p=async()=>{var e;try{y.value=!0;const c=(e=(await G.get("getInternalRequest",{params:{current_role:H,...n,...i.value}})).data)==null?void 0:e.internal_servicing_data;V.value=c.data,k.value=c.total}catch(l){alert(l)}y.value=!1},ee=he(p,300),te=e=>{n.current_page=e.current_page,n.pagesize=e.pagesize,n.sort_column=e.sort_column,n.sort_direction=e.sort_direction,e.change_type==="search"?ee():p()};return w("refresh",p),_e(()=>{const e=localStorage.getItem("ISFilter");e&&(i.value=JSON.parse(e)),p()}),(e,l)=>{const c=r("v-tooltip"),z=r("v-checkbox"),B=r("v-badge"),ae=r("v-combobox"),v=r("v-col"),F=r("v-icon"),N=r("v-card"),oe=r("v-menu"),se=r("v-btn"),le=r("v-row"),ne=r("v-chip");return u(),S(we,{onSearchText:$},{filter:t(()=>[a(le,null,{default:t(()=>[a(v,{cols:"12",class:"d-flex justify-space-between align-items-center pa-0"},{default:t(()=>[a(B,{color:"grey",dense:"",content:I.value,"offset-y":5},{default:t(()=>[a(z,{"false-icon":"mdi-filter-menu","true-icon":"mdi-close",color:"primary",modelValue:m.value,"onUpdate:modelValue":l[0]||(l[0]=o=>m.value=o)},{default:t(()=>[m.value?L("",!0):(u(),S(c,{key:0,activator:"parent"},{default:t(()=>[d("Expanded Filter")]),_:1}))]),_:1},8,["modelValue"])]),_:1},8,["content"]),a(ve,{name:"slide-x-transition"},{default:t(()=>[a(v,{class:"d-flex",style:fe({visibility:m.value?"visible":"hidden",opacity:m.value?"1":"0"})},{default:t(()=>[a(v,{cols:"3",class:"pa-0 mr-1"},{default:t(()=>[a(ae,{transition:"slide-x-transition",color:"primary",modelValue:i.value.filterInstitution,"onUpdate:modelValue":l[1]||(l[1]=o=>i.value.filterInstitution=o),label:"Institution",density:"compact",items:x(A),chips:"","closable-chips":"","single-line":"",itemValue:"institution_id",variant:"outlined",itemTitle:"key",multiple:""},null,8,["modelValue","items"])]),_:1}),a(v,{cols:"auto",class:"pa-0 mr-1"},{default:t(()=>[a(se,{color:"primary",variant:"plain",class:"text-none"},{prepend:t(()=>{var o;return[a(B,{color:"primary",content:(o=i.value.filterStatus)==null?void 0:o.length,inline:""},null,8,["content"])]}),default:t(()=>[d(" Status "),a(F,null,{default:t(()=>[d("mdi-chevron-down")]),_:1}),a(oe,{transition:"slide-x-transition","close-on-content-click":!1,"min-width":"400",width:"400",height:"auto",location:"bottom",activator:"parent"},{default:t(()=>[a(N,{width:"auto",class:"pr-3"},{default:t(()=>[(u(!0),g(J,null,O(be,o=>(u(),S(z,{modelValue:i.value.filterStatus,"onUpdate:modelValue":l[2]||(l[2]=f=>i.value.filterStatus=f),class:"columnChooserCheckBox",label:o.text,value:o.text},null,8,["modelValue","label","value"]))),256))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["style"])]),_:1})]),_:1})]),_:1})]),default:t(()=>[a(N,{class:"mx-auto mt-2"},{default:t(()=>[a(x(Se),{ref_key:"datatable",ref:R,rows:V.value,sort:!0,columns:x(q),loading:y.value,search:n.search,isServerMode:!0,pageSize:n.pagesize,sortable:!0,sortColumn:n.sort_column,sortDirection:n.sort_direction,skin:"bh-table-hover bh-table-compact bh-table-bordered",hasCheckbox:!0,selectRowOnClick:!0,onRowSelect:X,onRowDBClick:Z,rowClass:Y,onChange:te,totalRows:k.value,cellClass:"internalCell",class:"tableLimitText"},{service_id:t(o=>[P("span",null,b(ge(o.value.service_id,o.value.created_at)),1)]),equipments_data:t(o=>[a(c,{activator:"parent",color:"primary"},{default:t(()=>{var f,U;return[(u(!0),g(J,null,O((U=(f=o.value.equipment_handling)==null?void 0:f.equipments)==null?void 0:U.filter(_=>_.category==="Equipment"),_=>{var E,T,M;return u(),g("p",Re,[a(F,null,{default:t(()=>[d("mdi-circle-medium")]),_:1}),d(" "+b((E=_.master_data)==null?void 0:E.equipment)+" ",1),(T=_.master_data)!=null&&T.sbu?(u(),g("span",Ce,"[ SBU - "+b((M=_.master_data)==null?void 0:M.sbu)+" ] ",1)):L("",!0)])}),256))]}),_:2},1024)]),status:t(o=>[P("span",null,[a(ne,{label:"",density:"compact",color:j(o.value.status).color},{default:t(()=>[d(b(j(o.value.status).text),1)]),_:2},1032,["color"])])]),_:1},8,["rows","columns","loading","search","pageSize","sortColumn","sortDirection","totalRows"])]),_:1})]),_:1})}}},Oe=Ie(De,[["__scopeId","data-v-dbbc5729"]]);export{Oe as default};
